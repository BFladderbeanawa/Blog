import{r as M,gI as it,vS as ot,BD as ue,kw as Oe,BE as Me,BF as F,cJ as me,BG as lt,BH as ct,bg as P,bi as w,BI as ne,bh as $,fA as dt,c0 as _,bn as n,bq as f,bl as p,bs as C,x4 as ut,br as Y,lg as mt,z4 as pt,gh as Z,bz as W,x7 as ht,zS as pe,pk as Ne,BJ as gt,cO as ft,ac as vt,bp as De,cN as bt,BK as J,bQ as L,cv as Te,i6 as Ve,BL as yt,qR as xt,f1 as Re,qn as Le,BM as _e,BN as oe,dL as ve,dB as he,dC as B,zP as wt,dn as Ct,bV as St,bR as Et,bS as kt,bT as At,bU as It,Af as Ot,x5 as Be,BO as Pe,BP as Fe,jm as Ue,ju as Mt,xT as Nt,BQ as Dt,dV as Tt,BR as Vt,eA as $e,dm as Rt,en as Lt,qS as _t,d2 as Bt,d5 as Pt,d3 as Ft,e5 as Ut,e7 as $t,e8 as Wt,eb as Ht,bN as We,ga as ge,zR as fe,BS as jt,BT as le,fy as be,BU as U,BV as zt,mD as qt,dR as Yt,BW as Kt,cC as Gt,cy as He,i_ as Xt,cF as Zt,ez as Qt,aD as Jt,ee as se,BX as en,a7 as ce,BY as tn,BZ as nn,aV as rn,xg as ie,vT as an,e$ as sn,qa as on,a2 as G,B_ as ln,B$ as je,C0 as te,C1 as H,C2 as cn,dO as dn,C3 as un,C4 as mn,E as pn,b_ as hn,M as gn,C5 as fn,C6 as ye,ep as vn,C7 as bn,xj as yn,xk as xn,C8 as wn,C9 as Cn}from"./reconnectSaga-e33541d6.js";import{P as Sn}from"./PageWrapper-ec94ee8c.js";import{M as En,a as kn,b as An,i as In}from"./vaultStatsIconsMap-22591a91.js";import{M as On}from"./home.react-73004e97.js";import{U as ze}from"./UserListItem-85567f7e.js";import{M as Mn}from"./crownIcon.react-fea741bd.js";import{S as Nn}from"./SelectMemberRole-56b5fb05.js";import{D as Dn}from"./Divider-e92035bb.js";import{M as Tn}from"./checkIconGradient.react-d7eac3e2.js";const Vn=e=>e.vaultsManagement,Rn=(e,t)=>M.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:15,viewBox:"0 0 14 15",fill:"none",ref:t,...e},M.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 14.5C10.866 14.5 14 11.366 14 7.5C14 3.63401 10.866 0.5 7 0.5C3.13401 0.5 0 3.63401 0 7.5C0 11.366 3.13401 14.5 7 14.5ZM6.125 4C6.125 3.51675 6.51675 3.125 7 3.125C7.48325 3.125 7.875 3.51675 7.875 4V7.5C7.875 7.98325 7.48325 8.375 7 8.375C6.51675 8.375 6.125 7.98325 6.125 7.5V4ZM6.125 10.1523C6.125 9.65398 6.52898 9.25 7.02731 9.25C7.52564 9.25 7.92962 9.65398 7.92962 10.1523V10.2204C7.92962 10.7187 7.52564 11.1227 7.02731 11.1227C6.52898 11.1227 6.125 10.7187 6.125 10.2204V10.1523Z",fill:"currentColor"})),Ln=M.forwardRef(Rn),_n=M.memo(Ln),Bn=it([ot,ue,Oe],(e,t,r)=>{const s=(r==null?void 0:r.id)??Me;if((t==null?void 0:t.owner_id)==null||(t==null?void 0:t.owner)==null)return[];const a=e.filter(i=>i.is_access_granted).map(i=>({email:i.email,full_name:i.full_name,user_id:i.user_id,role:i.role,vault_id:s}));return a.unshift({role:"Editor",user_id:t.owner_id,email:t.owner,full_name:t.owner_name,vault_id:s}),a}),qe=(e,t)=>{if(F(t))return;const{entities:{hosts:s,snippets:a,portForwardingRules:i,sshKeys:o,visibleIdentities:d}}=e,l=u=>u.filter(c=>me(t)?lt(c):ct(c,t)).length;return{hosts:l(s),snippets:l(a),portForwardingRules:l(i),sshKeys:l(o),visibleIdentities:l(d)}},Pn=({vault:e,onClose:t,onDelete:r,progress:s})=>{const{classes:a}=Ye(),i=w(u=>qe(u,e)),o=w(ne).find(u=>u.id===e.id),d=i&&Object.values(i).some(u=>u>0),l=$();return dt(()=>{l(_("deleteVaultScreenOpened",{hasVaultDataAccess:o?"no":"yes",vaultID:e.id,numberOfHosts:(i==null?void 0:i.hosts)||0,numberOfSshKeys:(i==null?void 0:i.sshKeys)||0,numberOfSnippets:(i==null?void 0:i.snippets)||0,numberOfIdentities:(i==null?void 0:i.visibleIdentities)||0}))}),n(f,{paddingX:"15px",children:n(f,{alignItems:"center",width:"100%",className:a.card,children:p(f,{width:"100%",gap:"20px",children:[p(f,{gap:"10px",children:[n(C,{color:"primary",children:"You are going to delete this vault:"}),p(f,{width:"100%",direction:"row",justifyContent:"space-between",className:a.statItem,children:[p(f,{direction:"row",alignItems:"center",gap:"5px",overflow:"hidden",children:[n(f,{alignItems:"center",justifyContent:"center",width:"24px",height:"24px",flexShrink:0,children:n(On,{})}),n(C,{variant:"body1",color:"primary",ellipsis:!0,children:e.name??""})]}),p(f,{direction:"row",gap:"5px",alignItems:"center",className:a.membersCount,children:[n(ut,{}),n(C,{variant:"body2",color:"secondary",children:e.members.length})]})]})]}),d&&p(f,{gap:"10px",children:[n(C,{color:"primary",children:"And all data inside:"}),n(f,{gap:"5px",component:"ul",children:Object.entries(i).map(([u,c])=>{const{icon:m,label:h}=Fn[u];return n(Un,{icon:m,count:c,name:c===1?h.single:h.plural},u)})})]}),o&&p(f,{gap:"10px",direction:"row",alignItems:"center",children:[n(_n,{style:{color:"var(--secondary)"}}),n(C,{color:"secondary",variant:"body1",children:"All data in this vault will be deleted"})]}),p(f,{gap:"10px",width:"100%",children:[r&&n(Y,{color:"error",onClick:()=>{l(_("deleteVaultButtonPressed",{vaultID:e.id,hasVaultDataAccess:o?"no":"yes"})),r()},fullWidth:!0,progress:s,children:"Delete"}),n(Y,{disabled:s,variant:"text",onClick:t,fullWidth:!0,children:"Cancel"})]})]})})})},Fn={hosts:{icon:n(En,{color:"var(--main)"}),label:{single:"host",plural:"hosts"}},snippets:{icon:n(kn,{color:"var(--main)"}),label:{single:"snippet",plural:"snippets"}},portForwardingRules:{icon:n(mt,{width:"14px",color:"var(--main)"}),label:{single:"port forwarding",plural:"port forwardings"}},sshKeys:{icon:n(pt,{color:"var(--main)"}),label:{single:"key",plural:"keys"}},visibleIdentities:{icon:n(An,{color:"var(--main)"}),label:{single:"identity",plural:"identities"}}},Un=({icon:e,count:t,name:r})=>{const{classes:s}=Ye();return t>0?p(f,{component:"li",direction:"row",alignItems:"center",gap:"5px",className:s.statItem,children:[n(f,{alignItems:"center",justifyContent:"center",width:"24px",height:"24px",children:e}),p(C,{variant:"body1",color:"primary",children:[t," ",r]}),n("br",{})]}):null},Ye=P()({card:{padding:"20px 20px 20px 20px",backgroundColor:"var(--card-a)",borderRadius:"15px"},statItem:{padding:"10px",borderRadius:"10px",backgroundColor:"var(--background)"},membersCount:{color:"var(--secondary)"}}),Ke=({variant:e})=>{const{classes:t}=Q();return e==="hidden"?null:n(f,{gap:"10px",children:n(f,{className:t.banner,direction:"row",justifyContent:"center",alignItems:"center",gap:"5px",children:zn[e]})})},$n=()=>{const{classes:e}=Q(),t=w(Z);return p(C,{variant:"body2",color:"secondary",children:[n(W,{size:12,icon:n(ht,{className:e.teamInlineIcon}),className:e.iconContainer}),"New members will be automatically added to this vault and will see all data inside."," ",t&&p(f,{className:e.externalLink,onClick:pe,direction:"row",alignContent:"center",gap:"2px",children:[n(C,{color:"accent",variant:"body2",display:"inline",children:"Invite members"}),n(Ne,{className:e.externalLinkIcon})]})]})},Wn=()=>{const{classes:e,cx:t}=Q();return p(C,{variant:"body2",color:"secondary",display:"inline",children:[n(W,{size:12,icon:n(gt,{className:t(e.icon,e.personalIconInline)}),className:e.iconContainer}),"Only you can access data in this vault. Personal credentials can be used to connect to entities in other vaults."]})},Hn=()=>{const{classes:e,cx:t}=Q();return p(C,{variant:"body2",color:"secondary",display:"inline",children:[n(W,{size:12,icon:n(ft,{className:t(e.icon,e.noAccessIconInline)}),className:e.iconContainer}),"Contact your team admin to request access."]})},jn=()=>{var r;const{classes:e}=Q(),t=(r=w(ue))==null?void 0:r.owner;return p(C,{variant:"body2",color:"secondary",className:e.memberBannerRoot,children:[n(f,{display:"inline-block",className:e.ownerEmail,children:t||"Team owner"})," ","has permissions to manage this vault"]})},zn={team:n($n,{}),personal:n(Wn,{}),noAccess:n(Hn,{}),withOwnerAccess:n(jn,{})},Q=P()({banner:{color:"var(--secondary)",padding:"10px",borderRadius:"10px",backgroundColor:"var(--background)"},iconContainer:{display:"inline",marginRight:"5px"},icon:{color:"var(--secondary)",width:"12px",height:"12px"},noAccessIconInline:{marginBottom:"-2px"},personalIconInline:{marginBottom:"-2px",marginLeft:"-2px"},teamInlineIcon:{color:"var(--secondary)",marginBottom:"-3px"},externalLinkIcon:{width:"12px",height:"12px"},externalLink:{cursor:"pointer",display:"inline-flex",alignItems:"center",color:"var(--accent)"},memberBannerRoot:{overflow:"hidden"},ownerEmail:{maxWidth:"100%",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",lineHeight:"inherit",verticalAlign:"bottom"}});var re={exports:{}},Ge={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",Ấ:"A",Ắ:"A",Ẳ:"A",Ẵ:"A",Ặ:"A",Æ:"AE",Ầ:"A",Ằ:"A",Ȃ:"A",Ả:"A",Ạ:"A",Ẩ:"A",Ẫ:"A",Ậ:"A",Ç:"C",Ḉ:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ế:"E",Ḗ:"E",Ề:"E",Ḕ:"E",Ḝ:"E",Ȇ:"E",Ẻ:"E",Ẽ:"E",Ẹ:"E",Ể:"E",Ễ:"E",Ệ:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ḯ:"I",Ȋ:"I",Ỉ:"I",Ị:"I",Ð:"D",Ñ:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",Ố:"O",Ṍ:"O",Ṓ:"O",Ȏ:"O",Ỏ:"O",Ọ:"O",Ổ:"O",Ỗ:"O",Ộ:"O",Ờ:"O",Ở:"O",Ỡ:"O",Ớ:"O",Ợ:"O",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ủ:"U",Ụ:"U",Ử:"U",Ữ:"U",Ự:"U",Ý:"Y",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",ấ:"a",ắ:"a",ẳ:"a",ẵ:"a",ặ:"a",æ:"ae",ầ:"a",ằ:"a",ȃ:"a",ả:"a",ạ:"a",ẩ:"a",ẫ:"a",ậ:"a",ç:"c",ḉ:"c",è:"e",é:"e",ê:"e",ë:"e",ế:"e",ḗ:"e",ề:"e",ḕ:"e",ḝ:"e",ȇ:"e",ẻ:"e",ẽ:"e",ẹ:"e",ể:"e",ễ:"e",ệ:"e",ì:"i",í:"i",î:"i",ï:"i",ḯ:"i",ȋ:"i",ỉ:"i",ị:"i",ð:"d",ñ:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",ố:"o",ṍ:"o",ṓ:"o",ȏ:"o",ỏ:"o",ọ:"o",ổ:"o",ỗ:"o",ộ:"o",ờ:"o",ở:"o",ỡ:"o",ớ:"o",ợ:"o",ù:"u",ú:"u",û:"u",ü:"u",ủ:"u",ụ:"u",ử:"u",ữ:"u",ự:"u",ý:"y",ÿ:"y",Ā:"A",ā:"a",Ă:"A",ă:"a",Ą:"A",ą:"a",Ć:"C",ć:"c",Ĉ:"C",ĉ:"c",Ċ:"C",ċ:"c",Č:"C",č:"c",C̆:"C",c̆:"c",Ď:"D",ď:"d",Đ:"D",đ:"d",Ē:"E",ē:"e",Ĕ:"E",ĕ:"e",Ė:"E",ė:"e",Ę:"E",ę:"e",Ě:"E",ě:"e",Ĝ:"G",Ǵ:"G",ĝ:"g",ǵ:"g",Ğ:"G",ğ:"g",Ġ:"G",ġ:"g",Ģ:"G",ģ:"g",Ĥ:"H",ĥ:"h",Ħ:"H",ħ:"h",Ḫ:"H",ḫ:"h",Ĩ:"I",ĩ:"i",Ī:"I",ī:"i",Ĭ:"I",ĭ:"i",Į:"I",į:"i",İ:"I",ı:"i",Ĳ:"IJ",ĳ:"ij",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",Ḱ:"K",ḱ:"k",K̆:"K",k̆:"k",Ĺ:"L",ĺ:"l",Ļ:"L",ļ:"l",Ľ:"L",ľ:"l",Ŀ:"L",ŀ:"l",Ł:"l",ł:"l",Ḿ:"M",ḿ:"m",M̆:"M",m̆:"m",Ń:"N",ń:"n",Ņ:"N",ņ:"n",Ň:"N",ň:"n",ŉ:"n",N̆:"N",n̆:"n",Ō:"O",ō:"o",Ŏ:"O",ŏ:"o",Ő:"O",ő:"o",Œ:"OE",œ:"oe",P̆:"P",p̆:"p",Ŕ:"R",ŕ:"r",Ŗ:"R",ŗ:"r",Ř:"R",ř:"r",R̆:"R",r̆:"r",Ȓ:"R",ȓ:"r",Ś:"S",ś:"s",Ŝ:"S",ŝ:"s",Ş:"S",Ș:"S",ș:"s",ş:"s",Š:"S",š:"s",Ţ:"T",ţ:"t",ț:"t",Ț:"T",Ť:"T",ť:"t",Ŧ:"T",ŧ:"t",T̆:"T",t̆:"t",Ũ:"U",ũ:"u",Ū:"U",ū:"u",Ŭ:"U",ŭ:"u",Ů:"U",ů:"u",Ű:"U",ű:"u",Ų:"U",ų:"u",Ȗ:"U",ȗ:"u",V̆:"V",v̆:"v",Ŵ:"W",ŵ:"w",Ẃ:"W",ẃ:"w",X̆:"X",x̆:"x",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Y̆:"Y",y̆:"y",Ź:"Z",ź:"z",Ż:"Z",ż:"z",Ž:"Z",ž:"z",ſ:"s",ƒ:"f",Ơ:"O",ơ:"o",Ư:"U",ư:"u",Ǎ:"A",ǎ:"a",Ǐ:"I",ǐ:"i",Ǒ:"O",ǒ:"o",Ǔ:"U",ǔ:"u",Ǖ:"U",ǖ:"u",Ǘ:"U",ǘ:"u",Ǚ:"U",ǚ:"u",Ǜ:"U",ǜ:"u",Ứ:"U",ứ:"u",Ṹ:"U",ṹ:"u",Ǻ:"A",ǻ:"a",Ǽ:"AE",ǽ:"ae",Ǿ:"O",ǿ:"o",Þ:"TH",þ:"th",Ṕ:"P",ṕ:"p",Ṥ:"S",ṥ:"s",X́:"X",x́:"x",Ѓ:"Г",ѓ:"г",Ќ:"К",ќ:"к",A̋:"A",a̋:"a",E̋:"E",e̋:"e",I̋:"I",i̋:"i",Ǹ:"N",ǹ:"n",Ồ:"O",ồ:"o",Ṑ:"O",ṑ:"o",Ừ:"U",ừ:"u",Ẁ:"W",ẁ:"w",Ỳ:"Y",ỳ:"y",Ȁ:"A",ȁ:"a",Ȅ:"E",ȅ:"e",Ȉ:"I",ȉ:"i",Ȍ:"O",ȍ:"o",Ȑ:"R",ȑ:"r",Ȕ:"U",ȕ:"u",B̌:"B",b̌:"b",Č̣:"C",č̣:"c",Ê̌:"E",ê̌:"e",F̌:"F",f̌:"f",Ǧ:"G",ǧ:"g",Ȟ:"H",ȟ:"h",J̌:"J",ǰ:"j",Ǩ:"K",ǩ:"k",M̌:"M",m̌:"m",P̌:"P",p̌:"p",Q̌:"Q",q̌:"q",Ř̩:"R",ř̩:"r",Ṧ:"S",ṧ:"s",V̌:"V",v̌:"v",W̌:"W",w̌:"w",X̌:"X",x̌:"x",Y̌:"Y",y̌:"y",A̧:"A",a̧:"a",B̧:"B",b̧:"b",Ḑ:"D",ḑ:"d",Ȩ:"E",ȩ:"e",Ɛ̧:"E",ɛ̧:"e",Ḩ:"H",ḩ:"h",I̧:"I",i̧:"i",Ɨ̧:"I",ɨ̧:"i",M̧:"M",m̧:"m",O̧:"O",o̧:"o",Q̧:"Q",q̧:"q",U̧:"U",u̧:"u",X̧:"X",x̧:"x",Z̧:"Z",z̧:"z",й:"и",Й:"И",ё:"е",Ё:"Е"},Xe=Object.keys(Ge).join("|"),qn=new RegExp(Xe,"g"),Yn=new RegExp(Xe,"");function Kn(e){return Ge[e]}var Ze=function(e){return e.replace(qn,Kn)},Gn=function(e){return!!e.match(Yn)};re.exports=Ze;re.exports.has=Gn;re.exports.remove=Ze;var Xn=re.exports;const Zn=vt(Xn);/**
 * @name match-sorter
 * @license MIT license.
 * @copyright (c) 2020 Kent C. Dodds
 * @author Kent C. Dodds <me@kentcdodds.com> (https://kentcdodds.com)
 */const R={CASE_SENSITIVE_EQUAL:7,EQUAL:6,STARTS_WITH:5,WORD_STARTS_WITH:4,CONTAINS:3,ACRONYM:2,MATCHES:1,NO_MATCH:0},Qn=(e,t)=>String(e.rankedValue).localeCompare(String(t.rankedValue));function j(e,t,r){r===void 0&&(r={});const{keys:s,threshold:a=R.MATCHES,baseSort:i=Qn,sorter:o=u=>u.sort((c,m)=>nr(c,m,i))}=r,d=e.reduce(l,[]);return o(d).map(u=>{let{item:c}=u;return c});function l(u,c,m){const h=Jn(c,s,t,r),{rank:E,keyThreshold:v=a}=h;return E>=v&&u.push({...h,item:c,index:m}),u}}j.rankings=R;function Jn(e,t,r,s){if(!t){const i=e;return{rankedValue:i,rank:xe(i,r,s),keyIndex:-1,keyThreshold:s.threshold}}return sr(e,t).reduce((i,o,d)=>{let{rank:l,rankedValue:u,keyIndex:c,keyThreshold:m}=i,{itemValue:h,attributes:E}=o,v=xe(h,r,s),x=u;const{minRanking:b,maxRanking:I,threshold:D}=E;return v<b&&v>=R.MATCHES?v=b:v>I&&(v=I),v>l&&(l=v,c=d,m=D,x=h),{rankedValue:x,rank:l,keyIndex:c,keyThreshold:m}},{rankedValue:e,rank:R.NO_MATCH,keyIndex:-1,keyThreshold:s.threshold})}function xe(e,t,r){return e=we(e,r),t=we(t,r),t.length>e.length?R.NO_MATCH:e===t?R.CASE_SENSITIVE_EQUAL:(e=e.toLowerCase(),t=t.toLowerCase(),e===t?R.EQUAL:e.startsWith(t)?R.STARTS_WITH:e.includes(` ${t}`)?R.WORD_STARTS_WITH:e.includes(t)?R.CONTAINS:t.length===1?R.NO_MATCH:er(e).includes(t)?R.ACRONYM:tr(e,t))}function er(e){let t="";return e.split(" ").forEach(s=>{s.split("-").forEach(i=>{t+=i.substr(0,1)})}),t}function tr(e,t){let r=0,s=0;function a(l,u,c){for(let m=c,h=u.length;m<h;m++)if(u[m]===l)return r+=1,m+1;return-1}function i(l){const u=1/l,c=r/t.length;return R.MATCHES+c*u}const o=a(t[0],e,0);if(o<0)return R.NO_MATCH;s=o;for(let l=1,u=t.length;l<u;l++){const c=t[l];if(s=a(c,e,s),!(s>-1))return R.NO_MATCH}const d=s-o;return i(d)}function nr(e,t,r){const{rank:i,keyIndex:o}=e,{rank:d,keyIndex:l}=t;return i===d?o===l?r(e,t):o<l?-1:1:i>d?-1:1}function we(e,t){let{keepDiacritics:r}=t;return e=`${e}`,r||(e=Zn(e)),e}function rr(e,t){typeof t=="object"&&(t=t.key);let r;if(typeof t=="function")r=t(e);else if(e==null)r=null;else if(Object.hasOwnProperty.call(e,t))r=e[t];else{if(t.includes("."))return ar(t,e);r=null}return r==null?[]:Array.isArray(r)?r:[String(r)]}function ar(e,t){const r=e.split(".");let s=[t];for(let a=0,i=r.length;a<i;a++){const o=r[a];let d=[];for(let l=0,u=s.length;l<u;l++){const c=s[l];if(c!=null)if(Object.hasOwnProperty.call(c,o)){const m=c[o];m!=null&&d.push(m)}else o==="*"&&(d=d.concat(c))}s=d}return Array.isArray(s[0])?[].concat(...s):s}function sr(e,t){const r=[];for(let s=0,a=t.length;s<a;s++){const i=t[s],o=ir(i),d=rr(e,i);for(let l=0,u=d.length;l<u;l++)r.push({itemValue:d[l],attributes:o})}return r}const Ce={maxRanking:1/0,minRanking:-1/0};function ir(e){return typeof e=="string"?Ce:{...Ce,...e}}const de=({vault:e,membersCount:t,onClick:r,variant:s="default",selected:a=!1})=>{const{classes:i,cx:o}=Qe(),d=F(e),l=w(u=>qe(u,e));return p(f,{direction:"row",alignItems:"center",justifyContent:"space-between",className:o(i.root,{[i.selected]:a,[i.compact]:s==="compact"}),onClick:u=>{u.stopPropagation(),r()},children:[p("section",{className:i.leftSection,children:[n(W,{size:24,icon:n(De,{width:"16px",color:"var(--main)"})}),d&&!e.name?n(C,{variant:"body1",color:"secondary",ellipsis:!0,children:"Enter vault name, e.g. Production..."}):n(C,{title:e.name,variant:"body1",color:"primary",ellipsis:!0,children:e.name})]}),l&&!d&&p("section",{className:i.rightSection,children:[s==="default"&&n(or,{stats:l}),n(bt,{vault:e,membersCount:t})]})]})},or=({stats:e})=>{const{classes:t}=Qe();return e&&Object.values(e).some(s=>s>0)?p(f,{className:t.statList,direction:"row",gap:"10px",alignItems:"center",children:[Object.entries(e).map(([s,a])=>a>0&&p(f,{direction:"row",gap:"5px",alignItems:"center",className:t.statItem,children:[n(W,{size:14,icon:In[s]}),n(C,{variant:"body1",children:a})]},s)),n("div",{className:t.verticalDivider})]}):null},Qe=P()((e,t,r)=>({root:{"--stats-color":"transparent","--menu-item-svg-color":"var(--secondary)","--title-flex-shrink":0,"--stats-divider-color":"transparent","--stats-opacity":0,"--stats-width":"0px",padding:"10px",borderRadius:"10px",[`&.${r.compact}`]:{padding:0,height:24},[`&.${r.selected}`]:{backgroundColor:"var(--list-hover-hover)","--stats-color":"var(--secondary)","--stats-opacity":1,"--stats-width":"100%","--title-flex-shrink":1,"--stats-divider-color":"var(--light-grey-4)","&:hover":{background:"var(--list-hover-hover)"},".termius-dark-theme &":{"--stats-divider-color":"var(--dark-grey-transparent)"}},"&:hover":{backgroundColor:"var(--list-hover-hover)","--stats-color":"var(--secondary)","--stats-opacity":1,"--stats-width":"100%","--title-flex-shrink":1,"--stats-divider-color":"var(--light-grey-4)",".termius-dark-theme &":{backgroundColor:"var(--list-hover-hover)",borderColor:"var(--list-hover-hover)","--stats-divider-color":"var(--dark-grey-transparent)"}},[`&:hover .${r.statList}`]:{visibility:"visible"},[`&:hover:not(.${r.selected})`]:{backgroundColor:"var(--list-hover-hover)",borderColor:"var(--list-hover-hover)"},".termius-dark-theme &":{boxShadow:"none",[`&:hover:not(.${r.selected})`]:{backgroundColor:"var(--list-hover-hover)",borderColor:"var(--list-hover-hover)"}}},selected:{},leftSection:{display:"flex",alignItems:"center",overflow:"hidden",gap:"5px",paddingRight:"10px"},rightSection:{display:"flex",alignItems:"center",flexShrink:0,position:"relative"},statList:{visibility:"hidden",transition:"opacity 0.1s ease-in",opacity:"var(--stats-opacity)",maxWidth:"var(--stats-width)",[`.${r.selected} &`]:{visibility:"visible"}},statItem:{color:"var(--stats-color)"},verticalDivider:{height:"12px",width:"1px",backgroundColor:"var(--stats-divider-color)",marginRight:"10px"},compact:{}})),X={keys:["full_name","email"],threshold:j.rankings.CONTAINS},lr={...X,keys:["name"],sorter:e=>e},cr={type:"divider"},dr=(e,t,r,s)=>{const a=j(e,t.inputValue,X),i=j(r,t.inputValue,X),o=j(s,t.inputValue,lr);return ur(o,a,i)},ur=(e,t,r)=>!e.length&&!t.length&&!r.length?[{type:"noOptions"}]:[...e,...e.length&&t.length?[cr]:[],...t],ae=P()((e,t,r)=>({emailInput:{"--border-color":"var(--card-b)"},listContainer:{backgroundColor:"var(--card-a)",padding:"10px",borderRadius:"15px"},vaultsListTitle:{padding:"5px 0 5px 5px"},emailNotFoundPaper:{padding:"5px 5px 5px 10px"},teamPageLink:{color:"var(--info-base)",textDecoration:"none"},option:{cursor:"pointer",padding:"5px",margin:"0",borderRadius:"10px",[`&:hover:not(.${r.optionDisabled})`]:{backgroundColor:"var(--list-hover-hover)"},[`&.${J.focused}, &.${J.focused}[aria-selected="true"]`]:{backgroundColor:"var(--list-hover-hover)"}},vaultOption:{padding:"8px"},optionDisabled:{cursor:"not-allowed"},paper:{boxShadow:"0px 15px 30px 0px var(--black-a15)",borderRadius:"10px"},noOptions:{padding:"5px 10px 5px 5px"},popperRoot:{"--scrollbar-width":0,borderRadius:15,width:280,boxShadow:"0px 15px 30px 0px var(--black-a15)",backgroundColor:"var(--card-a)"},externalLinkIcon:{width:14,height:14,color:"var(--secondary)"},optionDivider:{height:1,backgroundColor:"var(--background-entity)",margin:"10px"},fullNameOption:{margin:"5px 0",width:"initial","&:first-of-type":{marginTop:0},[`&.${J.focused}, &.${J.focused}[aria-selected="true"]`]:{backgroundColor:"var(--list-hover-hover)"}},emailSecondary:{fontSize:"12px"},fullNameOptionPending:{cursor:"not-allowed","&:last-of-type":{marginBottom:0}}})),Je=({members:e})=>{const{classes:t,cx:r}=ae();return p(L.Fragment,{children:[n(C,{variant:"body2",color:"secondary",className:t.vaultsListTitle,children:"Pending"}),e.map(s=>n(ze,{user:s,className:r(t.fullNameOption,t.fullNameOptionPending),subTitleClassName:t.emailSecondary},s.id))]})},mr=L.forwardRef((e,t)=>{const{classes:r}=ae(),{sentInvitesMembers:s,showVaults:a,showInvites:i,children:o,...d}=e,l=!(Array.isArray(o)&&o.some(u=>u.key==="noOptions"));return p("div",{className:r.listContainer,children:[a&&n(C,{variant:"body2",color:"secondary",className:r.vaultsListTitle,children:"Copy from"}),p("ul",{...d,ref:t,style:{padding:0},children:[o,i&&s.length>0&&l&&p(L.Fragment,{children:[n("div",{className:r.optionDivider}),n("ul",{children:n(Je,{members:s})})]})]})]})}),pr=({inputValue:e,alreadySelected:t})=>{const{classes:r,cx:s}=ae(),a=w(Z),i=w(Te);return!a||!i||t?n(C,{variant:"body1",color:"secondary",ellipsis:!0,className:r.emailNotFoundPaper,children:"No matching members found"}):p(f,{direction:"row",justifyContent:"space-between",alignItems:"center",role:"button",overflow:"hidden",textOverflow:"ellipsis",onClick:pe,className:s(r.option,r.emailNotFoundPaper),children:[p(C,{variant:"body1",color:"secondary",children:["Invite"," ",n(C,{variant:"body1",color:e?"main":"secondary",display:"inline",children:e||"new member"})]}),i&&n(Ne,{className:r.externalLinkIcon})]})},hr=({memberSuggestions:e,selectedMembers:t,onSelectedMembers:r,allVaults:s,currentVault:a,disabled:i=!1})=>{const{classes:o,cx:d}=ae(),l=w(Ve),{open:u,inputValue:c,sentInvitesMembers:m,vaultOptionRef:h,vaultsOptionsList:E,sentInvitesMatch:v,handleOpen:x,handleClose:b,handleChange:I,handleInputChange:D,handleVaultSelect:N}=gr({memberSuggestions:e,selectedMembers:t,onSelectedMembers:r,allVaults:s,currentVault:a});return n(yt,{classes:{paper:o.paper,noOptions:o.noOptions,option:o.option},disabled:i,open:u,onOpen:x,onClose:b,disableClearable:!0,forcePopupIcon:!1,options:e,inputValue:c,autoSelect:!1,autoHighlight:!0,multiple:!0,renderTags:()=>null,value:t,filterSelectedOptions:!0,filterOptions:(k,g)=>dr(k,g,m,E),onChange:I,PopperComponent:k=>n(xt,{...k,placement:"left-start",style:{borderRadius:15},id:"vaults-autocomplete-popper"}),PaperComponent:k=>n("div",{...k,className:o.popperRoot}),ListboxComponent:mr,ListboxProps:{sentInvitesMembers:m,showVaults:!c,showInvites:v.length>0},noOptionsText:n(Je,{members:v}),renderInput:k=>n(Re,{...k,size:"medium",autoComplete:"off",variant:"outlined",label:"Add members by name or email",className:d(o.emailInput,k.inputProps.className)}),onInputChange:D,isOptionEqualToValue:(k,g)=>"user_id"in k&&"user_id"in g?k.user_id===g.user_id:!1,renderOption:(k,g)=>{switch(g.type){case"divider":return n("div",{className:o.optionDivider},g.type);case"noOptions":{const T=c?j(t,c,X).length>0:!1;return n(pr,{inputValue:c,alreadySelected:T},g.type)}case"vault":return M.createElement("li",{...k,className:d(o.option,o.vaultOption),ref:h,key:g.id},n(de,{variant:"compact",vault:g,membersCount:g.members.length,onClick:()=>{N(g)}}));default:return M.createElement(ze,{...k,key:g.user_id,user:g,avatar:Le(l,g.user_id),className:o.fullNameOption,subTitleClassName:o.emailSecondary})}},getOptionLabel:()=>""})},gr=({memberSuggestions:e,selectedMembers:t,onSelectedMembers:r,allVaults:s,currentVault:a})=>{const i=$(),o=w(_e),[d,l]=L.useState(""),[u,c]=M.useState(!1),[m,h]=L.useState(o),E=L.useRef(null),v=w(ne).find(S=>S.id===(a==null?void 0:a.id)),x=S=>{const y=j(o,S||d,X);h(y)},b=M.useMemo(()=>Array.from(s.values()).filter(S=>F(S)?!1:oe(S).length>0&&S.id!==(a==null?void 0:a.id)).map(S=>({...S,type:"vault",members:oe(S)})),[s,a==null?void 0:a.id]),I=S=>{const y=S.map(O=>({...O,role:"Editor"}));S.filter(O=>!t.some(V=>V.user_id===O.user_id)).forEach(O=>{i(_("vaultMemberAdded",{isSearched:d?"yes":"no",vaultID:a==null?void 0:a.id,teamMemberID:O.email,hasVaultDataAccess:v?"no":"yes"}))}),r(ve([...t,...y],"user_id"))},D=(S,y,A,O)=>{if(S.stopPropagation(),typeof y=="string"||!y)return;const V=(O==null?void 0:O.option.type)==="vault",z=y.find(q=>q.type==="noOptions");if(V&&S.code==="Enter"){N(O==null?void 0:O.option);return}if(z){pe();return}!V&&!z&&I(y)},N=S=>{const y=S.members.map(A=>({...A,role:A.role==="Owner"?"Editor":A.role})).filter(A=>e.some(O=>O.user_id===A.user_id));r(ve([...y],"user_id")),c(!1),i(_("copyVaultMembersButtonPressed",{vaultID:a==null?void 0:a.id,sourceVaultID:S.id,isDefaultVault:a!=null&&a.isDefault?"yes":"no",numberOfParticipants:S.members.length,isSearched:d?"yes":"no",hasVaultDataAccess:v?"no":"yes"}))};return{open:u,inputValue:d,sentInvitesMembers:o,sentInvitesMatch:m,vaultOptionRef:E,vaultsOptionsList:b,handleOpen:()=>{x(),c(!0),i(_("addingMembersToVaultStarted",{vaultID:a==null?void 0:a.id,hasVaultDataAccess:v?"no":"yes"}))},handleClose:()=>{c(!1)},handleChange:D,handleInputChange:(S,y,A)=>(A==="reset"&&l(""),x(y),l(y)),handleVaultSelect:N}},fr=({variant:e,onRemoveAccess:t,onInviteNewMember:r})=>{const{classes:s}=vr();return n(L.Fragment,{children:p(he,{children:[n(B,{when:e==="enabled",children:n(wt,{className:s.removeButton,role:"button",onClick:t,tabIndex:0,children:n(f,{direction:"row",justifyContent:"space-between",alignItems:"center",width:"100%",children:n(C,{variant:"body1",color:"error",children:"remove access"})})})}),n(B,{when:e==="disabled",children:p(f,{gap:"5px",children:[n(f,{direction:"row",justifyContent:"space-between",alignItems:"center",width:"100%",padding:"0 10px",onClick:a=>a.stopPropagation(),children:n(C,{variant:"body1",color:"secondary",className:s.teamVaultRemoveAccessLabel,children:"remove access"})}),n("div",{className:s.addNewVaultContainer,children:p(C,{variant:"body2",color:"secondary",children:[n(C,{variant:"body2",display:"inline",children:n(Ct,{color:"accent",onClick:r,children:"Add new vault"})})," ","to set granular permissions"]})})]})})]})})},ee={hoverLight:"var(--light-grey-transparent-10)",hoverDark:"var(--dark-grey-transparent-10)"},vr=P()({removeButton:{color:"var(--dark-grey-6)",borderRadius:"10px",padding:"10px",".termius-dark-theme &":{color:"var(--white)"},"&.Mui-selected":{background:ee.hoverLight,"&:hover":{background:ee.hoverLight}},"&.Mui-focusVisible":{background:ee.hoverLight},"&:hover":{borderRadius:"10px",".termius-dark-theme &":{backgroundColor:ee.hoverDark}}},teamVaultRemoveAccessLabel:{color:"var(--light-grey-3)",".termius-dark-theme &":{color:"var(--dark-grey-6)"}},addNewVaultContainer:{height:"46px",padding:"5px 10px",background:"var(--background)",borderRadius:"10px"}}),br=e=>e==="Editor"||e==="Owner"?"can edit":"can view",et=({member:e,onRoleChange:t,additionalSelectElement:r,disabled:s=!1})=>{const{classes:a}=tt(),i=w(Ve);return n(St,{position:"relative",component:"li",children:p(f,{direction:"row",justifyContent:"space-between",alignItems:"center",gap:"10px",className:a.root,children:[p(f,{direction:"row",gap:"10px",alignItems:"center",overflow:"hidden",children:[n(Et,{avatar:Le(i,e.user_id),color:kt(e.email,e.user_id??0),letter:At({email:e.email}),size:"medium"}),n(It,{title:e.email,placement:"top",tooltipClassName:a.emailTooltip,PopperProps:{modifiers:[{name:"offset",options:{offset:[0,-8]}}]},children:n("span",{className:a.email,children:n(C,{color:"primary",fontSize:14,ellipsis:!0,children:e.full_name||e.email})})})]}),n(yr,{member:e}),n(f,{children:t?e.role!=="Owner"&&n(Nn,{value:e.role,disabled:s,onChange:t,additionalSelectElement:r,renderLabel:o=>o==="Editor"?"can edit":"can view"}):n(C,{variant:"body1",color:"secondary",children:br(e.role)})})]})},e.user_id)},yr=({member:e})=>{var a;const{classes:t}=tt(),r=w(Ot),s=[];return r.account.user_id===e.user_id&&s.push(n(f,{className:t.ownerAdditionalSectionWrapper,children:n(C,{fontSize:7,bolder:!0,className:t.ownerAdditionalSectionLabel,children:"YOU"})},"you")),((a=r.team)==null?void 0:a.owner_id)===e.user_id&&s.push(n(f,{className:t.ownerAdditionalSectionWrapper,children:n(Mn,{})},"owner")),s.length===0?null:n(f,{direction:"row",gap:"5px",children:s})},tt=P()({root:{padding:"5px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",borderRadius:"15px",height:"34px"},email:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"150px"},ownerAdditionalSectionWrapper:{justifyContent:"center",alignItems:"center",width:"25px",height:"15px",background:"var(--gradient-light-main)",borderRadius:"4px",".termius-dark-theme &":{background:"var(--main-gradient-outline)"}},ownerAdditionalSectionLabel:{background:"var(--gradient-universal-main)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textFillColor:"transparent"},emailTooltip:{userSelect:"text"}}),Se={borderLight:"var(--light-grey-5)",borderDark:"var(--dark-grey-1)"},nt=P()({inviteForm:{overflowY:"hidden",height:"100%"},addMembersSection:{margin:"0 15px",padding:"15px 20px 20px 20px",backgroundColor:"var(--card-a)",borderRadius:"15px",overflow:"auto"},submitButtonWrapper:{marginTop:"10px",padding:"15px 15px 5px 15px",borderTop:`1px solid ${Se.borderLight}`,".termius-dark-theme &":{borderTop:`1px solid ${Se.borderDark}`}},submitButton:{flexShrink:0},dividerLine:{".termius-dark-theme &":{backgroundColor:"var(--background-entity)"}}}),xr=()=>{var s;const{classes:e}=nt(),t=w(_e),r=((s=w(Oe))==null?void 0:s.id)??Me;return t.length?p(L.Fragment,{children:[n(Dn,{className:e.dividerLine}),n(f,{direction:"row",alignItems:"center",gap:"5px",children:n(C,{variant:"subtitle1",color:"main",children:"Pending"})}),n(f,{component:"ul",gap:"10px",children:t.map((a,i)=>n(et,{member:{id:a.id,role:a.role,vault_id:r,user_id:a.user_id,email:a.email,full_name:a.full_name||""},additionalSelectElement:null},i))})]}):null},wr=e=>{const{disabled:t,formControl:r}=e,s=$(),a=w(Be),{field:i}=Pe({name:"selectedMembers",control:r}),{value:o}=i,d=c=>{t||i.onChange(c)};return{selectedMembers:o,applyUpdate:d,updateMemberRole:(c,m)=>{const h=o.map(E=>E.user_id===c.user_id?{...E,role:m}:E);d(h),s(_("vaultPermissionsChanged",{permissionPickerLocation:"Edit Vault Screen",vaultPermissions:Cr(m),teamMemberID:c.email,vaultID:c.vault_id,hasVaultDataAccess:a.includes(c.vault_id)?"no":"yes"}))},removeSelectedMember:c=>{s(_("vaultPermissionsChanged",{permissionPickerLocation:"Edit Vault Screen",vaultPermissions:"No access",teamMemberID:c.email,vaultID:c.vault_id,hasVaultDataAccess:a.includes(c.vault_id)?"no":"yes"}));const m=o.filter(h=>h.user_id!==c.user_id);return d(m)}}},Cr=e=>e?e==="Editor"||e==="Owner"?"Can edit":"Can view":"No access",Sr=e=>{const{allVaults:t,selectedVault:r,onAddVaultClick:s,teamOwner:a,userId:i,disabled:o}=e,{permissions:d}=r,l=d.has("editMembersList"),u=w(Bn),{selectedMembers:c,applyUpdate:m,updateMemberRole:h,removeSelectedMember:E}=wr(e),v=c.some(b=>b.user_id===a.userId),x=(b,I)=>{I!=="no access"&&h(b,I)};return p(L.Fragment,{children:[d.has("editMembersList")&&n(hr,{memberSuggestions:Ee(u),allVaults:t,currentVault:r,selectedMembers:Ee(c),onSelectedMembers:m,disabled:o}),!v&&a.userId!==i&&n(Ke,{variant:"withOwnerAccess"}),c.length>0&&n(f,{component:"ul",gap:"10px",children:c.map(b=>n(et,{disabled:o,member:b,onRoleChange:d.has("updateMembersRoles")?I=>x(b,I):void 0,additionalSelectElement:n(fr,{variant:l?"enabled":"disabled",onInviteNewMember:s,onRemoveAccess:l?()=>E(b):void 0})},b.user_id))}),r.isDefault&&n(xr,{})]})},Ee=e=>e.map(t=>({...t,type:"member"})),Er=e=>{const{selectedVault:t,...r}=e,{classes:s}=nt();if(!t)return null;const i=!F(t)&&me(t),d=t.isDefault&&Fe(t),l=!i&&!d,{submitButton:u,handleSubmit:c}=e.saving;return p(f,{component:"form",justifyContent:"space-between",className:s.inviteForm,onSubmit:c,"data-testid":"vault-edit-form",children:[n(f,{className:s.addMembersSection,children:p(f,{gap:"10px",children:[n(C,{variant:"subtitle1",color:"main",children:d?"No access to this vault":"People with access to this vault"}),n(Ke,{variant:kr(t)}),l&&n(Sr,{...r,selectedVault:t})]})}),u&&n(f,{className:s.submitButtonWrapper,children:n(Y,{className:s.submitButton,color:"accent",size:"medium",type:"submit",fullWidth:!0,disabled:u.disabled,children:u.label})})]})},kr=e=>{const r=!F(e)&&me(e),s=e.isDefault,a=s&&Fe(e);return r?"personal":a?"noAccess":s?"team":"hidden"},Ar=({formControl:e,canEdit:t,disabled:r,forbiddenNames:s,vaultNameInputRef:a,onSubmit:i})=>{var E,v;const{classes:o,cx:d}=Ir(),[l,u]=M.useState(!0),c=x=>!s.includes(x.trim())||"This name is already in use",{field:m,fieldState:h}=Pe({name:"name",control:e,rules:{required:"Vault name is required",validate:t?{notAllowed:c}:void 0}});return p("header",{className:o.header,children:[n("form",{className:o.form,onSubmitCapture:x=>{i(),x.preventDefault()},onSubmit:i,children:n(f,{direction:"row",gap:"5px",alignItems:"center",width:"100%",children:p(L.Fragment,{children:[n(W,{icon:n(De,{width:"20px",height:"20px",color:"var(--main)"}),size:36}),p(he,{children:[n(B,{when:t,children:n(Re,{name:"name",title:"Vault name input field",disabled:r,inputRef:a,inputProps:{...m},autoFocus:!0,type:"text",onBlur:()=>{u(!1)},onFocus:()=>u(!0),placeholder:"Vault name",className:d({[o.nameEdit]:!0,[o.nameEditIdle]:!l,[o.errorField]:!!((E=h.error)!=null&&E.message)}),onKeyDown:x=>{x.key==="Escape"&&(x.preventDefault(),x.stopPropagation(),x.target instanceof HTMLInputElement&&(x==null||x.target.blur()))}})}),n(B,{when:!t,children:n(C,{className:o.nameStatic,variant:"mediumBody1",color:"main",title:"Vault name static",ellipsis:!0,children:m.value})})]})]})})}),n(Ue,{in:!!h.error,children:n("div",{className:o.error,children:n(Mt,{skipInternalMargin:!0,status:"error",children:(v=h.error)==null?void 0:v.message})})})]})},Ir=P()({header:{padding:"15px 20px 15px 10px",margin:"0 15px 15px 15px",borderRadius:"15px",backgroundColor:"var(--card-a)"},form:{display:"flex",justifyContent:"space-between",alignItems:"center"},nameStatic:{marginLeft:"0px"},nameEdit:{width:"100%"},nameEditIdle:{"--border-color":"var(--card-b)",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",background:"transparent","&:hover":{borderColor:"var(--light-grey-3)"}},errorField:{borderColor:"var(--error-medium)"},error:{paddingLeft:4,marginTop:5}}),rt=e=>{const{children:t}=e;return n(f,{paddingX:"15px",children:n(f,{alignItems:"center",gap:"10px",width:"100%",padding:"40px 20px 20px 20px",borderRadius:"15px",bgcolor:"var(--card-a)",children:t})})},at=e=>{const{icon:t,title:r,description:s,action:a}=e;return p(rt,{children:[n(W,{size:64,icon:t}),p(f,{gap:"5px",alignItems:"center",textAlign:"center",children:[n(C,{variant:"h3",h3Margin:!0,color:"main",children:r}),s&&n(C,{variant:"body1",color:"secondary",children:s})]}),n(f,{gap:"10px",width:"100%",marginTop:"20px",children:a})]})},Or=({action:e})=>n(at,{icon:n(Nt,{color:"var(--light-grey-3)"}),title:"Connection error",description:p(M.Fragment,{children:["Please check your internet connection",n("br",{})," and try again"]}),action:e}),Mr=({action:e,title:t})=>n(at,{icon:n(Dt,{color:"var(--text-error)"}),title:t,action:e}),ke=e=>{const{title:t,description:r}=e;return p(rt,{children:[n(Tn,{width:"64px",height:"64px"}),p(f,{gap:"5px",alignItems:"center",textAlign:"center",children:[n(C,{variant:"h3",h3Margin:!0,color:"main",children:t}),r&&n(C,{variant:"body1",color:"secondary",children:r})]})]})},Nr=n(C,{color:"error",component:"span",children:"Delete vault"},"removeVault"),Dr=({open:e,title:t,onCloseStart:r,onCloseEnd:s,onDelete:a,children:i,disabled:o=!1})=>{const{classes:d}=Tr(),l=Tt(),u=w(h=>Vt(h,$e())),c=[{name:Nr,handler:()=>{a==null||a(),l.closeMenu()}}];Rt("keydown",h=>{h.key==="Escape"&&(r==null||r(h))});const m=()=>{const h=document.getElementById("vaults-autocomplete-popper");!e||h||u.length||r==null||r()};return n(Lt,{className:d.sidebar,isOpened:e,onCloseAnimationEnd:s,children:n(_t,{onClickAway:m,mouseEvent:"onMouseDown",children:p("div",{className:d.form,children:[n(Bt,{left:n(Pt,{title:t}),right:p(Ft,{margin:"md",children:[a&&n(Ut,{ref:l.triggerRef,onClick:l.openMenu,disabled:o,"aria-label":"Extra actions",children:n($t,{})}),n(Wt,{disabled:o,"data-testid":"form-close-btn",onClick:h=>r==null?void 0:r(h)})]})}),n(Ht,{onClose:l.closeMenu,autoClose:!0,open:l.isOpened,anchorEl:l.triggerRef.current,anchorOrigin:{horizontal:"right",vertical:"bottom"},transformOrigin:{horizontal:"right",vertical:"top"},menuItems:c}),i]})})})},Ae={borderLight:"var(--light-grey-5)",borderDark:"var(--dark-grey-1)"},Tr=P()({sidebar:{marginTop:"calc(0px - var(--header-height))"},form:{".termius-dark-theme &":{background:"var(--dark-grey-2)",borderLeft:`1px solid ${Ae.borderDark}`},flex:1,overflowY:"hidden",display:"flex",flexDirection:"column",background:"var(--light-grey-6)",borderLeft:`1px solid ${Ae.borderLight}`}}),Vr=({selectedVault:e,allVaults:t,originalVaults:r,open:s,xstate:a,form:i,onCloseStart:o,onCloseEnd:d,onSubmit:l,onAddVaultClick:u,vaultNameInputRef:c})=>{const{state:m,send:h}=a,{control:E}=i,v=w(ue),x=w(We),b=w(ge),I=w(fe),D=$(),N=M.useMemo(()=>x==null||v==null||v.owner_id==null||v.owner==null,[v,x]);M.useEffect(()=>{N&&D(jt("/account"))},[D,N]);const{title:k,submitButton:g,formState:T,vaultName:S}=Br({userId:x,username:b,userFullName:I,form:i,selectedVault:e,allVaults:t,xstate:a,originalVaults:r}),{hasDeletePermission:y,deleteButtonAvailable:A,vaultEditDisabled:O}=_r(e,m,T),V=()=>m.matches("deleting")?"Couldn't delete vault":m.context.SAVE_MODE==="create"?"Couldn't create vault":"Couldn't update vault",z=Lr(s,o,T),K=r.get((e==null?void 0:e.id)??0),q=(m.matches("idle")||m.matches("saving.persisting")||m.matches("saving.updateSuccess"))&&!!e;return n(Dr,{open:s,title:k,disabled:O,onCloseStart:z,onCloseEnd:d,onDelete:A?()=>h("DELETE"):void 0,children:n(f,{direction:"column",justifyContent:"flex-start",padding:"15px 0px 10px 0px",width:"552px",height:"100%",maxWidth:"100%",overflow:"auto",children:p(he,{children:[n(B,{when:q,children:n(Rr,{userId:x,vaultName:S,vaultNameInputRef:c,allVaults:t,selectedVault:e,formControl:E,formState:T,submitButton:g,onSubmit:l,onAddVaultClick:u,teamInfo:v})}),n(B,{when:m.matches("saving.createSuccess"),children:n(ke,{title:"The vault has been created!",description:`Now you can move your entities to it
or create new in this vault to collaborate.`})}),n(B,{when:(m.matches("deleting.prompt")||m.matches("deleting.requesting"))&&!!K,children:K&&n(Pn,{vault:K,progress:m.hasTag("pending"),onDelete:y?()=>h("CONFIRM_DELETE"):void 0,onClose:y?()=>h("CANCEL_DELETE"):void 0})}),n(B,{when:m.matches("deleting.success"),children:n(ke,{title:"The vault has been deleted!"})}),n(B,{when:m.matches("saving.genericError")||m.matches("deleting.genericError"),children:n(Mr,{title:V(),action:n(Y,{onClick:()=>h("RESET"),variant:"contained",color:"accent",fullWidth:!0,children:"Back"})})}),n(B,{when:m.matches("saving.networkError")||m.matches("deleting.networkError"),children:n(Or,{action:p(M.Fragment,{children:[n(Y,{onClick:()=>!T.pending&&h("RETRY"),variant:"contained",color:"accent",fullWidth:!0,children:"Try again"}),n(Y,{onClick:()=>h("RESET"),variant:"text",fullWidth:!0,children:"Back"})]})})})]})})})},Rr=({formControl:e,vaultNameInputRef:t,vaultName:r,formState:s,allVaults:a,submitButton:i,userId:o,selectedVault:d,onSubmit:l,onAddVaultClick:u,teamInfo:c})=>!((c==null?void 0:c.owner_id)!=null&&(c==null?void 0:c.owner)!=null)||!o?null:p(L.Fragment,{children:[n(Ar,{formControl:e,vaultNameInputRef:t,canEdit:r.canEdit,disabled:r.disabled,forbiddenNames:r.forbiddenNames,onSubmit:()=>{s.dirty&&s.isValid&&l()}}),n(Er,{allVaults:a,disabled:s.pending,saving:{handleSubmit:l,submitButton:i},userId:o,teamOwner:{userId:c.owner_id,email:c.owner,fullName:c.owner_name},selectedVault:d,onAddVaultClick:u,formControl:e})]}),Lr=(e,t,r)=>s=>{if(!e)return;const a=r.dirty,i=(s==null?void 0:s.type)==="click"||(s==null?void 0:s.key)==="Escape";t({isDirty:a,forceClose:i||void 0})},_r=(e,t,r)=>{var o;const s=!!((o=e==null?void 0:e.permissions)!=null&&o.has("removeVault")),a=s&&!t.matches("saving.createSuccess")&&!t.matches("deleting")&&!t.hasTag("errorNotification"),i=r.pending||t.matches("deleting.requesting");return{hasDeletePermission:s,deleteButtonAvailable:a,vaultEditDisabled:i}},Br=({userId:e,username:t,userFullName:r,form:s,selectedVault:a,allVaults:i,xstate:o,originalVaults:d})=>{const{state:l}=o,u=(a==null?void 0:a.permissions)??new Set,c=Array.from(i.values()).filter(y=>y.id!==(a==null?void 0:a.id)).map(y=>y.name),m=!!(a&&F(a)),h=u.has("editName")||u.has("editMembersList")||u.has("updateMembersRoles"),E=u.has("editName"),v=y=>y.map(A=>({user_id:A.user_id,role:A.role})).sort((A,O)=>A.user_id-O.user_id),x=M.useMemo(()=>{if(!(a!=null&&a.id)||!s.formState.isDirty)return!1;const y=d.get(a.id);if(!y||!e)return!1;const A={members:v(le({vault:y,shouldCreate:m,userId:e,username:t,userFullName:r})),name:y.name},O={members:v(a.members),name:a.name};return!be(A,O)},[s.formState.isDirty,m,d,a,e,t,r]),b=M.useMemo(()=>{if(!e)return!1;const y={members:v(le({vault:U,shouldCreate:m,userId:e,username:t,userFullName:r})),name:U.name},A={members:v((a==null?void 0:a.members)??[]),name:a==null?void 0:a.name};return!be(y,A)},[m,a==null?void 0:a.members,a==null?void 0:a.name,e,t,r]),I=(()=>l.matches("deleting")?"Delete this vault":m?"New vault":"Vault details")(),D=(y,A)=>y?m?"Create vault":"Saving changes":A?"Changes saved":m?"Create vault":"Save changes",N=(y,A)=>y?n(qt,{thickness:5,size:14,color:"inherit"}):A?n(Yt,{width:"14px",height:"14px"}):null,k=(()=>{const y=l.hasTag("pending")&&l.matches("saving"),A=l.matches("saving.updateSuccess"),O=D(y,A),V=N(y,A);return V?p(f,{direction:"row",gap:"10px",alignItems:"center",color:"'var(--light-grey-3)'",children:[V,n(C,{variant:"subtitle2",children:O})]}):O})(),g={dirty:m?s.formState.isDirty&&!l.hasTag("pending")&&b:s.formState.isDirty&&!l.hasTag("pending")&&!l.matches("saving.updateSuccess")&&x,pending:l.hasTag("pending")&&l.matches("saving"),isValid:s.formState.isValid},T=h?{label:k,disabled:!g.dirty||!g.isValid,progress:g.pending}:void 0,S={canEdit:E,disabled:g.pending,forbiddenNames:zt.concat(c)};return{title:I,vaultName:S,submitButton:T,formState:g}},Pr=(e,t)=>M.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},M.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 20C15.5228 20 20 15.5228 20 10C20 4.47715 15.5228 0 10 0C4.47715 0 0 4.47715 0 10C0 15.5228 4.47715 20 10 20ZM5.05025 8.9598L9.50502 4.50502C9.77839 4.23166 10.2216 4.23166 10.495 4.50502L14.9497 8.9598C15.2231 9.23317 15.2231 9.67638 14.9497 9.94975C14.6764 10.2231 14.2332 10.2231 13.9598 9.94975L10.7 6.68995L10.7 15C10.7 15.3866 10.3866 15.7 10 15.7C9.6134 15.7 9.3 15.3866 9.3 15V6.68995L6.0402 9.94975C5.76683 10.2231 5.32362 10.2231 5.05025 9.94975C4.77689 9.67638 4.77689 9.23316 5.05025 8.9598Z",fill:"currentColor"})),Fr=M.forwardRef(Pr),Ur=M.memo(Fr),$r=({vaults:e,selectedVault:t,vaultNameInputRef:r,onClick:s,onVaultClick:a,onAddVaultClick:i})=>{const{classes:o}=st(),d=w(Z),[l,u]=M.useState(!1),c=w(Be),m=w(Kt),h=w(Te),E=w(Gt),v=$(),x=He(),b=d?Xt(Array.from(e.values()),g=>!(g.id&&c.includes(g.id))):[Array.from(e.values())],[I,D]=b,N=g=>F(g)?0:oe(g).length;M.useEffect(()=>{const g=I.some(T=>T.id===U.id);u(g)},[I]);const k=()=>{E&&v(_("newVaultButtonPressed",{newVaultSource:"Vaults Screen",eventTeamRole:E})),h?i():Qt(x,{dialog:"UpgradeToBusinessViaVaultsDialog",target:$e(),props:{}}).catch(Jt)};return p(f,{className:o.root,alignItems:"center",gap:"30px",onClick:s,children:[p(f,{className:o.vaults,component:"ul",children:[I.map(g=>{const T=F(g),S=n(de,{vault:g,selected:g.id===(t==null?void 0:t.id),onClick:()=>{var y;return T?(y=r.current)==null?void 0:y.focus():a(g)},membersCount:N(g)},g.id);return T?n(Ue,{in:l,children:S},g.id):S}),m&&p(L.Fragment,{children:[n("div",{className:o.divider}),n(Wr,{onClick:k,label:"Add vault",variant:h?"default":"withUpgradeIcon"})]})]}),d&&D.length>0&&p(f,{className:o.vaults,component:"ul",children:[n(C,{variant:"subtitle1",color:"secondary",className:o.listTitle,children:"Other vaults"}),D.map(g=>n(de,{vault:g,selected:g.id===(t==null?void 0:t.id),onClick:()=>a(g),membersCount:N(g)},g.id))]})]})},Wr=({onClick:e,label:t,variant:r})=>{const{classes:s}=st(),a=i=>{i.stopPropagation(),e()};return p("div",{role:"button",className:s.newVaultButton,onClick:a,tabIndex:0,children:[n(W,{size:24,icon:n(Zt,{color:"var(--main)"})}),p(f,{direction:"row",alignItems:"center",gap:"8px",children:[n(C,{variant:"body1",color:"primary",ellipsis:!0,children:t}),r==="withUpgradeIcon"&&n(Ur,{width:14,height:14,color:"var(--secondary)"})]})]})},st=P()({root:{background:"var(--background)",padding:"30px 20px 30px 20px",width:"100%",height:"100%",overflowY:"auto",overflowX:"hidden"},vaults:{width:"100%",maxWidth:"700px",listStyle:"none",margin:0,padding:15,borderRadius:15,display:"flex",flexDirection:"column",gap:"5px",backgroundColor:"var(--card-a)","@media only screen and (max-width: 1280px)":{maxWidth:"600px"},"@media only screen and (max-width: 900px)":{maxWidth:"500px"},"@media only screen and (max-width: 800px)":{width:"100%",margin:"30px 20px 0 20px"}},listTitle:{padding:"0 15px"},newVaultButton:{display:"flex",gap:"5px",alignItems:"center",alignSelf:"stretch",padding:"10px",borderRadius:"10px","&:hover":{background:"var(--background)",borderColor:"var(--background)",".termius-dark-theme &":{background:"var(--list-hover-hover)",borderColor:"var(--list-hover-hover)"}}},divider:{height:"1px",width:"100%",backgroundColor:"var(--background-entity)"}}),Hr=()=>{const e=He();return{deleteVault:async a=>se(e,nn,{vaultId:a}),createVaults:async a=>se(e,en,a),updateVault:async(a,i,o,d,l)=>(ce(a.id,"Vault id is required"),se(e,tn,{vaultName:i,vaultId:a.id,teamOwnerId:l,newVaultMembers:o,originalVaultMembers:d}))}},jr=rn({predictableActionArguments:!0,preserveActionOrder:!0,id:"vaultLifecycleFlow",initial:"idle",context:{SAVE_MODE:"create",result:null},on:{RESET:{target:"idle"}},states:{idle:{id:"idle",on:{CREATE:{target:"saving",actions:"setCreateMode"},UPDATE:{target:"saving",actions:"setUpdateMode"},DELETE:{target:"deleting",cond:"isDeleteAvailable"},CLOSE:{target:"idle",actions:{type:"onDismiss"}}}},saving:{initial:"persisting",states:{persisting:{tags:["pending"],invoke:{src:"saveVault",id:"saveVaultActor",onDone:[{target:"networkError",cond:"isNetworkErrorResult",actions:{type:"onSaveFailed"}},{target:"genericError",cond:"isErrorResult",actions:{type:"onSaveFailed"}},{target:"createSuccess",cond:e=>e.SAVE_MODE==="create",actions:[{type:"onSaveSuccess"},ie({result:(e,t)=>t.data.val})]},{target:"updateSuccess",cond:e=>e.SAVE_MODE==="update",actions:{type:"onSaveSuccess"}}]}},createSuccess:{after:{2e3:[{target:"#idle",cond:"hasVault"},{target:"#closeTransition",actions:{type:"onDismiss"}}]},on:{CLOSE:{target:"#idle"}}},updateSuccess:{after:{1e3:{target:"#idle"}},on:{CLOSE:{target:"#idle"}}},genericError:{tags:["errorNotification"],on:{CLOSE:{target:"#idle",actions:{type:"onDismiss"}},RETRY:{target:"persisting"}}},networkError:{tags:["errorNotification"],on:{CLOSE:{target:"#idle",actions:{type:"onDismiss"}},RETRY:{target:"persisting"}}}}},deleting:{initial:"prompt",states:{prompt:{on:{CONFIRM_DELETE:{target:"requesting"},CANCEL_DELETE:{target:"#idle"},CLOSE:{target:"#idle",actions:{type:"onDismiss"}}}},requesting:{tags:["pending"],invoke:{src:"deleteVault",id:"deleteVaultActor",onDone:[{target:"networkError",cond:"isNetworkErrorResult",actions:{type:"onDeleteFailed"}},{target:"genericError",cond:"isErrorResult",actions:{type:"onDeleteFailed"}},{target:"success",actions:{type:"onDeleteSuccess"}}]}},success:{after:{2e3:{target:"#closeTransition",actions:{type:"onDismiss"}}},on:{CLOSE:{target:"#closeTransition",actions:{type:"onDismiss"}}}},genericError:{tags:["errorNotification"],on:{RETRY:{target:"requesting"},CLOSE:{target:"#idle",actions:{type:"onDismiss"}}}},networkError:{tags:["errorNotification"],on:{RETRY:{target:"requesting"},CLOSE:{target:"#idle",actions:{type:"onDismiss"}}}}}},closeTransition:{id:"closeTransition",after:{200:{target:"#idle"}}}},tsTypes:{},schema:{context:{},services:{},events:{}}},{services:{},actions:{setCreateMode:ie({SAVE_MODE:"create"}),setUpdateMode:ie({SAVE_MODE:"update"})},guards:{isNetworkErrorResult:(e,{data:t})=>{var r;return t.err&&((r=t.val.message)==null?void 0:r.startsWith("Network error"))},isErrorResult:(e,t)=>t.data.err,hasVault:e=>{var t;return!!((t=e.result)!=null&&t.vault)}}}),zr="update",qr="delete",Ie="onChange";function Yr(e){const{userId:t,vault:r,onDismiss:s,onSuccess:a,allVaults:i}=e,o=w(ge),d=w(fe),l=w(an),u=r&&F(r),{createVaults:c,updateVault:m,deleteVault:h}=Hr(),E={name:"",selectedMembers:[{user_id:t,role:"Editor",email:o,full_name:d,vault_id:r==null?void 0:r.id}]},v=sn({defaultValues:E,reValidateMode:Ie,mode:Ie}),x=v.watch("name"),b=v.watch("selectedMembers"),[I,D]=on(jr,{services:{saveVault:async()=>{var k;if(l==null)return G({message:"Team owner not found"});if(r==null)return G({message:"Vault not found"});if(u)return c({teamOwnerId:l,vaults:[{vaultName:x,newVaultMembers:b}]});const N=(k=i.get(r.id))==null?void 0:k.members.filter(g=>"id"in g);return N==null?G({message:"Original vault members were not found"}):r.id==null?G({message:"Vault id not found"}):m(r,x,b,N,l)},deleteVault:async()=>r==null||r.id==null?G({message:"Vault not found"}):h(r.id)},actions:{onSaveSuccess:(N,k)=>{ce(k.data.ok,"Save vault failed"),a({data:k.data.val,mode:zr})},onSaveFailed(){},onDeleteSuccess:(N,k)=>{ce(k.data.ok,"Delete vault failed"),a({data:k.data.val,mode:qr})},onDeleteFailed(){},onDismiss(){s()}},guards:{isDeleteAvailable:()=>r!=null},id:r==null?"new-vault":`edit-vault-${r.id}`,devTools:!1,context:{SAVE_MODE:"create"}});return[I,D,v]}const Kr=e=>{const{userId:t,form:r,xstate:s,sliderOpen:a,selectedVaultId:i}=e,o=$(),d=w(Z),l=w(ge),u=w(fe),c=w(ne),m=b=>{if(!t)return;const I={name:b.name,members:le({vault:b,shouldCreate:b.id===U.id,userId:t,username:l,userFullName:u}),permissions:ln(b,t,d)};o(je(b.id)),o(te({...b,...I})),r.reset({name:I.name,selectedMembers:I.members})},h=b=>{s.state.hasTag("pending")||i===b.id||(s.send("RESET"),m(b))},E=b=>{o(_("editVaultScreenOpened",{isDefaultVault:b.isDefault?"yes":"no",vaultID:b.id,numberOfParticipants:b.members.length||0,hasVaultDataAccess:c.find(I=>I.id===b.id)?"no":"yes"}))};return{handleVaultClick:b=>{h(b),E(b)},changeEditVaultData:h,handleVaultListClick:()=>{!s.state.hasTag("pending")&&a&&o(H())},setDraftAndSelectedVaultId:m}},Gr=e=>{const{form:t,selectedVaultId:r,draft:s,xstate:{send:a}}=e,i=$(),o=w(ne),[d,l]=cn({control:t.control,name:["name","selectedMembers"]}),u=t.handleSubmit(()=>(i(_("saveVaultButtonPressed",{vaultID:s==null?void 0:s.id,numberOfParticipants:(s==null?void 0:s.members.length)||0,hasVaultDataAccess:o.find(c=>c.id===(s==null?void 0:s.id))?"no":"yes"})),r===U.id?a("CREATE"):a("UPDATE")));return M.useEffect(()=>{if(r){if(!d){i(te({name:"",members:l}));return}t.formState.isDirty&&i(te({name:d,members:l}))}},[i,d,t.formState.isDirty,l,r]),{handleSubmit:u}},ia=()=>{const{state:{sliderOpen:e,draft:t},vaultsMap:r,presentedVaults:s,xstate:a,form:i,vaultNameInputRef:o,handleVaultClick:d,handleVaultListClick:l,handleCloseStart:u,handleCloseEnd:c,handleSubmit:m}=Xr();return p(dn,{fullHeight:!0,children:[n(Sn,{children:n($r,{vaults:s,selectedVault:t,vaultNameInputRef:o,onClick:l,onVaultClick:d,onAddVaultClick:()=>d(U)})}),n(Vr,{selectedVault:t,allVaults:s,originalVaults:r,open:e,xstate:a,form:i,vaultNameInputRef:o,onCloseStart:u,onCloseEnd:c,onSubmit:m,onAddVaultClick:()=>d(U)})]})},Xr=()=>{const e=$(),t=w(un),r=w(We),s=w(Z),a=w(mn),{sliderOpen:i,selectedVaultId:o,openVaultRemotelyById:d,vaultDraft:l,openConfirmDialog:u}=w(Vn),c=L.createRef(),m=pn(u);hn(()=>{e(_("vaultsScreenOpened"))}),gn(()=>{e(H())});const h=({data:S,mode:y})=>{const{vaults:A,participants:O,vault:V}=S;e(yn({items:A})),e(xn(O));const[z]=wn(A);if(y==="update"&&V){const q=Cn(z,O,r,s,a).get(V==null?void 0:V.id);q&&D(q)}y==="update"&&!V&&(e(H()),x.reset(),v("CLOSE")),y==="delete"&&(e(je(void 0)),e(te(void 0)))},[E,v,x]=Yr({userId:r,vault:l,allVaults:t,onDismiss:()=>{e(H())},onSuccess:h}),{handleVaultClick:b,handleVaultListClick:I,setDraftAndSelectedVaultId:D}=Kr({userId:r,form:x,xstate:{state:E,send:v},sliderOpen:i,selectedVaultId:o}),{handleSubmit:N}=Gr({form:x,xstate:{state:E,send:v},selectedVaultId:o,draft:l});M.useEffect(()=>{l&&o!==void 0&&e(fn(!0))},[l,o,e]);const k=M.useCallback(async({isDirty:S,forceClose:y})=>{if(!S&&y){e(H());return}S&&!E.hasTag("pending")&&!m.current&&(e(ye(!0)),await vn({title:"Discard changes?",text:"You have unsaved changes. Are you sure you want to discard them?",confirmButtonTitle:"Discard",cancelButtonTitle:"Keep editing",buttonColor:"error"}).finally(()=>{e(ye(!1))}),e(H()))},[e,E,m]),g=()=>{E.hasTag("pending")||(e(H()),x.reset(),v("CLOSE"))},T=(()=>{const S=new Map(t);return l&&S.set(l.id,l),S})();return M.useEffect(()=>{d&&(x.formState.isDirty?k({isDirty:!0}):b(U),e(bn(void 0)))},[d]),{state:{draft:l,sliderOpen:i},presentedVaults:T,xstate:{state:E,send:v},form:x,vaultsMap:t,vaultNameInputRef:c,handleVaultClick:b,handleVaultListClick:I,handleCloseStart:k,handleCloseEnd:g,handleSubmit:N}};export{ia as Vaults,Xr as useVaultsList};
//# sourceMappingURL=Vaults-1dba523a.js.map

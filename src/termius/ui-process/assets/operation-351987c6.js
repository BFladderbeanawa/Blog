import{l as $,d as k,e as x}from"./serviceClient-281bbae4.js";function M(o){return`, ${o.trim()}`.split(", Bearer ").filter(e=>e).map(e=>`${e.trim()}, `.split('", ').filter(i=>i).map(i=>(([a,r])=>({[a]:r}))(i.trim().split('="'))).reduce((i,a)=>Object.assign(Object.assign({},i),a),{}))}async function Y(o){const{scopes:t,response:e}=o,n=o.logger||$,s=e.headers.get("WWW-Authenticate");if(!s)return n.info("The WWW-Authenticate header was missing. Failed to perform the Continuous Access Evaluation authentication flow."),!1;const a=(M(s)||[]).find(l=>l.claims);if(!a)return n.info('The WWW-Authenticate header was missing the necessary "claims" to perform the Continuous Access Evaluation authentication flow.'),!1;const r=await o.getAccessToken(a.scope?[a.scope]:t,{claims:k(a.claims)});return r?(o.request.headers.set("Authorization",`Bearer ${r.token}`),!0):!1}const L=x("core-lro"),Z=2e3,w=["succeeded","canceled","failed"];function ee(o){try{return JSON.parse(o).state}catch{throw new Error(`Unable to deserialize input state: ${o}`)}}function R(o){const{state:t,stateProxy:e,isOperationError:n}=o;return s=>{throw n(s)&&(e.setError(t,s),e.setFailed(t)),s}}function P(o){const{state:t,stateProxy:e,status:n,isDone:s,processResult:i,response:a,setErrorAsResult:r}=o;switch(n){case"succeeded":{e.setSucceeded(t);break}case"failed":{e.setError(t,new Error("The long-running operation has failed")),e.setFailed(t);break}case"canceled":{e.setCanceled(t);break}}(s!=null&&s(a,t)||s===void 0&&["succeeded","canceled"].concat(r?[]:["failed"]).includes(n))&&e.setResult(t,W({response:a,state:t,processResult:i}))}function W(o){const{processResult:t,response:e,state:n}=o;return t?t(e,n):e}async function _(o){const{init:t,stateProxy:e,processResult:n,getOperationStatus:s,withOperationLocation:i,setErrorAsResult:a}=o,{operationLocation:r,resourceLocation:l,metadata:c,response:u}=await t();r&&(i==null||i(r,!1));const d={metadata:c,operationLocation:r,resourceLocation:l};L.verbose("LRO: Operation description:",d);const f=e.initState(d),v=s({response:u,state:f,operationLocation:r});return P({state:f,status:v,stateProxy:e,response:u,setErrorAsResult:a,processResult:n}),f}async function D(o){const{poll:t,state:e,stateProxy:n,operationLocation:s,getOperationStatus:i,getResourceLocation:a,isOperationError:r,options:l}=o,c=await t(s,l).catch(R({state:e,stateProxy:n,isOperationError:r})),u=i(c,e);if(L.verbose(`LRO: Status:
	Polling from: ${e.config.operationLocation}
	Operation status: ${u}
	Polling status: ${w.includes(u)?"Stopped":"Running"}`),u==="succeeded"){const d=a(c,e);if(d!==void 0)return{response:await t(d).catch(R({state:e,stateProxy:n,isOperationError:r})),status:u}}return{response:c,status:u}}async function U(o){const{poll:t,state:e,stateProxy:n,options:s,getOperationStatus:i,getResourceLocation:a,getOperationLocation:r,isOperationError:l,withOperationLocation:c,getPollingInterval:u,processResult:d,updateState:f,setDelay:v,isDone:T,setErrorAsResult:z}=o,{operationLocation:p}=e.config;if(p!==void 0){const{response:g,status:y}=await D({poll:t,getOperationStatus:i,state:e,stateProxy:n,operationLocation:p,getResourceLocation:a,isOperationError:l,options:s});if(P({status:y,response:g,state:e,stateProxy:n,isDone:T,processResult:d,setErrorAsResult:z}),!w.includes(y)){const O=u==null?void 0:u(g);O&&v(O);const h=r==null?void 0:r(g,e);if(h!==void 0){const I=p!==h;e.config.operationLocation=h,c==null||c(h,I)}else c==null||c(p,!1)}f==null||f(e,g)}}function S(o){const{azureAsyncOperation:t,operationLocation:e}=o;return e??t}function E(o){return o.headers.location}function A(o){return o.headers["operation-location"]}function b(o){return o.headers["azure-asyncoperation"]}function B(o){const{location:t,requestMethod:e,requestPath:n,resourceLocationConfig:s}=o;switch(e){case"PUT":return n;case"DELETE":return;default:switch(s){case"azure-async-operation":return;case"original-uri":return n;case"location":default:return t}}}function H(o){const{rawResponse:t,requestMethod:e,requestPath:n,resourceLocationConfig:s}=o,i=A(t),a=b(t),r=S({operationLocation:i,azureAsyncOperation:a}),l=E(t),c=e==null?void 0:e.toLocaleUpperCase();return r!==void 0?{mode:"OperationLocation",operationLocation:r,resourceLocation:B({requestMethod:c,location:l,requestPath:n,resourceLocationConfig:s})}:l!==void 0?{mode:"ResourceLocation",operationLocation:l}:c==="PUT"&&n?{mode:"Body",operationLocation:n}:void 0}function C(o){const{status:t,statusCode:e}=o;if(typeof t!="string"&&t!==void 0)throw new Error(`Polling was unsuccessful. Expected status to have a string value or no value but it has instead: ${t}. This doesn't necessarily indicate the operation has failed. Check your Azure subscription or resource status for more information.`);switch(t==null?void 0:t.toLocaleLowerCase()){case void 0:return m(e);case"succeeded":return"succeeded";case"failed":return"failed";case"running":case"accepted":case"started":case"canceling":case"cancelling":return"running";case"canceled":case"cancelled":return"canceled";default:return L.verbose(`LRO: unrecognized operation status: ${t}`),t}}function N(o){var t;const{status:e}=(t=o.body)!==null&&t!==void 0?t:{};return C({status:e,statusCode:o.statusCode})}function j(o){var t,e;const{properties:n,provisioningState:s}=(t=o.body)!==null&&t!==void 0?t:{},i=(e=n==null?void 0:n.provisioningState)!==null&&e!==void 0?e:s;return C({status:i,statusCode:o.statusCode})}function m(o){return o===202?"running":o<300?"succeeded":"failed"}function F({rawResponse:o}){const t=o.headers["retry-after"];if(t!==void 0){const e=parseInt(t);return isNaN(e)?V(new Date(t)):e*1e3}}function V(o){const t=Math.floor(new Date().getTime()),e=o.getTime();if(t<e)return e-t}function J(o){const{response:t,state:e,operationLocation:n}=o;function s(){var a;switch((a=e.config.metadata)===null||a===void 0?void 0:a.mode){case void 0:return m(t.rawResponse.statusCode);case"Body":return q(t,e);default:return"running"}}const i=s();return i==="running"&&n===void 0?"succeeded":i}async function te(o){const{stateProxy:t,resourceLocationConfig:e,processResult:n,lro:s,setErrorAsResult:i}=o;return _({init:async()=>{const a=await s.sendInitialRequest(),r=H({rawResponse:a.rawResponse,requestPath:s.requestPath,requestMethod:s.requestMethod,resourceLocationConfig:e});return Object.assign({response:a,operationLocation:r==null?void 0:r.operationLocation,resourceLocation:r==null?void 0:r.resourceLocation},r!=null&&r.mode?{metadata:{mode:r.mode}}:{})},stateProxy:t,processResult:n?({flatResponse:a},r)=>n(a,r):({flatResponse:a})=>a,getOperationStatus:J,setErrorAsResult:i})}function G({rawResponse:o},t){var e;switch((e=t.config.metadata)===null||e===void 0?void 0:e.mode){case"OperationLocation":return S({operationLocation:A(o),azureAsyncOperation:b(o)});case"ResourceLocation":return E(o);case"Body":default:return}}function q({rawResponse:o},t){var e;const n=(e=t.config.metadata)===null||e===void 0?void 0:e.mode;switch(n){case"OperationLocation":return N(o);case"ResourceLocation":return m(o.statusCode);case"Body":return j(o);default:throw new Error(`Internal error: Unexpected operation mode: ${n}`)}}function K({flatResponse:o},t){if(typeof o=="object"){const e=o.resourceLocation;e!==void 0&&(t.config.resourceLocation=e)}return t.config.resourceLocation}function Q(o){return o.name==="RestError"}async function oe(o){const{lro:t,stateProxy:e,options:n,processResult:s,updateState:i,setDelay:a,state:r,setErrorAsResult:l}=o;return U({state:r,stateProxy:e,setDelay:a,processResult:s?({flatResponse:c},u)=>s(c,u):({flatResponse:c})=>c,updateState:i,getPollingInterval:F,getOperationLocation:G,getOperationStatus:q,isOperationError:Q,getResourceLocation:K,options:n,poll:async(c,u)=>t.sendPollRequest(c,u),setErrorAsResult:l})}export{Z as P,Y as a,_ as b,U as c,ee as d,H as e,q as f,J as g,Q as h,te as i,G as j,K as k,L as l,F as m,oe as p};
//# sourceMappingURL=operation-351987c6.js.map

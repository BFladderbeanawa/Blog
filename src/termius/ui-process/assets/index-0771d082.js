var M=Object.defineProperty;var x=(s,t,e)=>t in s?M(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var y=(s,t,e)=>(x(s,typeof t!="symbol"?t+"":t,e),e);import{du as v,A4 as b,dL as H,A5 as R,A6 as A,a0 as $,A7 as L,A8 as E,A9 as k,Aa as P}from"./reconnectSaga-e33541d6.js";import{s as I,i as K}from"./splitAtFirst-6f6946f9.js";function T(s){return s.replace(/\r\n?/g,`
`).split(/(\n){2,}/).flatMap(t=>{const e=D(t.split(`
`));return e!=null?[e]:[]})}function D(s){if(s.length===0)return;const t=G(s[0]);if(t!=null)return{label:t,values:N(s.slice(1))}}function G(s){const t=s.match(/\[(.+?)\]/);return t!=null?t[1]:void 0}function N(s){return s.map(t=>I(t,"=")).filter(K)}function h(s){return{is_visible:!1,username:s||void 0}}function m(s){return s?{path:s}:void 0}function u(s){return s?Number.parseInt(s,10):void 0}function X(s){let t=[];const e=[];return s.filter(U).forEach(n=>{const o=W(n)||[];o.length>0?t=w(t,o,C(n)):e.push(...C(n))}),[{groups:t,snippets:[],hosts:e,tags:[],knownHosts:[]}]}function U(s){return s.label.toLowerCase().startsWith("bookmarks")}function W(s){var t;return(t=s.values.find(([e])=>e==="SubRep"))==null?void 0:t[1].split("\\").filter(e=>!!e)}function w(s,t,e,n,o){var p,a;let r=n||"",i=t,l=o||0;for(const[c,f]of i.entries())if(c!==i.length-1){const d=r+l,g=(p=v(s,d))==null?void 0:p.label;if(g==null)b(s,d,{label:f.trim(),groups:[],hosts:[]}),r+=`${l}.groups.`,i=i.slice(1);else if(g===f.trim())r+=`${l}.groups.`,i=t.slice(1);else return l+=1,w(s,i,e,r,l);return w(s,i,e,r)}else{const d=r+l,g=(a=v(s,d))==null?void 0:a.label;if(g==null)b(s,d,{label:f.trim(),groups:[],hosts:e});else if(g===f.trim())r+=`${l}.hosts`,v(s,r).push(...e);else return l+=1,w(s,i,e,r,l)}return s}function C(s){const t=s.values.flatMap(([n,o])=>{const r=q(n,o);return r!=null?[r]:[]});let e=t.flatMap(n=>n.hostChains??[]);return e=H(e,"label"),t.map(n=>n.host).concat(e)}function q(s,t){for(const[e,n]of z){const o=t.match(e);if(o!=null)try{const r=n(s,o[1].split("%"));if(r.host.address)return r}catch{}}}const z=[[/\s*#109#(.*)/,(s,t)=>{const e=t.length===15,n=Y(t[8],t[9],t[10],e?"":t[15]);return{host:{address:t[1],label:s,sshConfig:{port:u(t[2]),proxy:e?void 0:J(t[19],t[20],t[21],t[22]),charset:e?void 0:S(t[30])},identity:h(t[3]),pfRules:[],hostChain:n.map(o=>o.label),identityFile:e?void 0:m(t[14])},hostChains:n}}],[/\s*#98#(.*)/,(s,t)=>({host:{address:t[1],label:s,telnetConfig:{port:u(t[2]),charset:S(t[19])},identity:h(t[3]),pfRules:[],hostChain:[]}})],[/\s*#145#(.*)/,(s,t)=>({host:{address:t[1],label:s,sshConfig:{port:u(t[3]),use_mosh:!0,mosh_server_command:Q(t[7])},identity:h(t[2]),pfRules:[],hostChain:[]}})],[/\s*#140#(.*)/,(s,t)=>({host:{address:t[1],label:s,sshConfig:{port:u(t[2]),proxy:V(t[10],t[11],t[12],t[13],t[14])},identity:h(t[3]),pfRules:[],hostChain:[],identityFile:m(t[9])}})]];function J(s,t,e,n){return["1","2","3"].includes(s)&&t?{type:s==="3"?"http":"socks",hostname:t,port:u(e),identity:n?{is_visible:!1,username:n}:void 0}:void 0}function V(s,t,e,n,o){return["1","2","3","4"].includes(s)&&t?{type:"socks",hostname:t,port:u(e),identity:n||o?{is_visible:!1,username:n||void 0,password:o||void 0}:void 0}:void 0}function Y(s,t,e,n){const o="__PIPE__",r=s.split(o),i=t.split(o),l=e.split(o),p=n.split(o);return R(r,i,l,p).flatMap(([a,c,f,d])=>a?[{address:a,label:j(f,a,c||"22"),sshConfig:{port:u(c)},identity:h(f||""),pfRules:[],hostChain:[],identityFile:d?{path:d}:void 0}]:[])}function j(s,t,e){return t.includes(":")&&(t=`[${t}]`),s?`${s}@${t}:${e}`:`${t}:${e}`}function Q(s){return s&&s!=="mosh-server"?A.replace("mosh-server",s):void 0}function S(s){try{return["ISO-8859-1","ISO-8859-2","ISO-8859-3","ISO-8859-4","ISO-8859-5","ISO-8859-6","ISO-8859-7","ISO-8859-8","ISO-8859-9","ISO-8859-10","ISO-8859-11","ISO-8859-13","ISO-8859-14","ISO-8859-15","ISO-8859-16",void 0,"KOI8-R","KOI8-U","GBK","Big5","Shift_JIS","EUC-KR",void 0,"windows-1252","windows-1251","windows-1250","windows-1253","windows-1254","windows-1255","windows-1256","windows-1257","windows-1258","CP437",void 0,void 0,void 0,void 0,void 0,void 0,void 0][Number.parseInt(s,10)]}catch{return}}function Z(s,t){const e=s.lastIndexOf(t);return e===-1?[s]:[s.slice(0,e),s.slice(e+t.length)]}function tt(s,t){return new Map(s.filter(st).flatMap(e=>et(e,t)))}function st(s){return s.label.toLowerCase()==="passwords"}function et(s,t){return s.values.map(([e,n])=>[e,B(n,t)])}function B(s,t){const e=t==null?void 0:t.decrypt(s);return e!=null?{value:e,encoding:"utf-8"}:{value:s,encoding:"base64",decryptionAlgorithm:"MobaXterm"}}function nt(s,t){return new Map(s.filter(ot).flatMap(e=>rt(e,t)))}function ot(s){return s.label.toLowerCase()==="credentials"}function rt(s,t){return s.values.map(([e,n])=>[e,it(e,n,t)])}function it(s,t,e){const[n,o]=Z(t,":");return{is_visible:!0,label:s,username:n,password:o!=null?B(o,e):void 0}}const lt=$("browserify-aes/browser"),{createDecipheriv:at}=lt;class F{constructor(t){y(this,"key");y(this,"iv");const e=L("sha512");this.key=e.update(t).digest().slice(0,32);const n=E("aes-256-ecb",this.key,null);this.iv=n.update(Uint8Array.from(Array(16).fill(0)))}decrypt(t){const n=at("aes-256-cfb8",this.key,this.iv).update(Buffer.from(t,"base64"));return ut(n)?n.toString():void 0}}function ut(s){return s.every(t=>t===9||t===10||t===13||t>=32&&t<=126)}function ct(s){return s.filter(dt).map(pt)}function dt(s){return s.label.toLowerCase()==="portforwarding"}function pt(s){return{groups:[],snippets:[],hosts:ft(s),tags:[],knownHosts:[]}}function ft(s){const t=s.values.flatMap(([e,n])=>{const o=ht(e,n);return o!=null?[o]:[]});return gt(t)}function gt(s){const t=new Map;return s.forEach(e=>{const n=t.get(e.label);n==null?t.set(e.label,e):n.pfRules=n.pfRules.concat(e.pfRules)}),[...t.values()]}function ht(s,t){const[,e]=I(s,"."),n=t.split(";"),o=yt(n[0]);if(o==null)return;const r=n[1].match(/(.+)@((.+)|\[(.+)\]):(\d+)/);if(r==null)return;const i=n[2].match(/((.+)|\[(.+)\]):(\d+)/);if(i!=null)return{address:r[3]??r[4],label:n[1],sshConfig:{port:u(r[5]),proxy:mt(n[7])},identity:{is_visible:!1,username:r[1]},pfRules:[{label:e||void 0,host_label:n[1],pf_type:o,remote_port:u(n[3])??0,local_port:u(i[4])??0,hostname:i[2]??i[3],bound_address:n[6]}],hostChain:[],identityFile:vt(n[5])}}const wt=new Map([["local","Local Rule"],["remote","Remote Rule"],["dynamic","Dynamic Rule"]]);function yt(s){return wt.get(s.toLowerCase())}function vt(s){return s!=="No SSH key selected"?m(s):void 0}function mt(s){if(s==="No proxy selected")return;const t=s.split(","),e=t[1],n=t[2],o=t[3];return["SOCKS4 proxy","SOCKS5 proxy"].includes(t[0])&&e?{type:"socks",hostname:e,port:u(n),identity:o?{is_visible:!1,username:o}:void 0}:void 0}async function Ft(s,t){const n=Ct(s.trim())?bt(s,t):s,o=T(n),r=t!=null?new F(t):void 0,i=nt(o,r),l=tt(o,r),p=[...X(o),...ct(o)].reduce((a,c)=>({groups:c.groups.concat(a.groups),snippets:c.snippets.concat(a.snippets),hosts:c.hosts.concat(a.hosts),tags:c.tags.concat(a.tags),knownHosts:c.knownHosts.concat(a.knownHosts)}),{groups:[],snippets:[],hosts:[],tags:[],knownHosts:[]});return{groups:_(p.groups,i,l),snippets:[],hosts:O(p.hosts,i,l),tags:[],knownHosts:[]}}function bt(s,t){if(t==null)throw new k;const e=new F(t).decrypt(s);if(e==null)throw new k;return e}function _(s,t,e){return s.map(P(n=>{n.groups=_(n.groups,t,e),n.hosts=O(n.hosts,t,e)}))}function O(s,t,e){return s.map(P(n=>{var r;const o=(r=n.identity.username)==null?void 0:r.match(/\[(.*?)\]/);if(o!=null){const i=t.get(o[1]);i!=null&&(n.identityFile!=null?n.identity={...i,is_visible:!1,label:void 0}:n.identity=i)}else n.identity.password=kt(n,e)}))}function kt(s,t){const{username:e}=s.identity;if(e==null)return;const n=[],{address:o,sshConfig:r}=s;return(r==null?void 0:r.port)!=null&&n.push(`ssh${r.port}:${e}@${o}`),n.push(`${e}@${o}`),n.map(i=>t.get(i)).find(Boolean)}function Ct(s){const t=Buffer.from(s,"base64");return t.length!==0&&s===t.toString("base64")}export{Ft as parseMobaXtermConfig};
//# sourceMappingURL=index-0771d082.js.map

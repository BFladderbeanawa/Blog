import{AX as O,AY as w,aa as Y,jc as T,uW as H,AZ as E,A_ as Z,A$ as G,a7 as j,B0 as ee,bg as P,r as p,ep as te,bn as r,ct as se,e5 as L,cH as ne,bW as A,cw as oe,e1 as ce,oR as z,pJ as ae,bl as N,bQ as _,cd as re,bs as K,fr as ie,B1 as F,B2 as le,aU as ue,al as he,hN as de,B3 as me,dq as pe,b3 as R,B4 as Se,c4 as ge,fh as fe,bh as ye,B5 as be,c0 as J}from"./reconnectSaga-e33541d6.js";import{S as Ce}from"./SettingsTabContent-3aa4d4a9.js";import{M as ke,K as ve}from"./KeyboardKey-80a39b2a.js";function xe(){try{if(!!localStorage.getItem(O.commandPalette))return;const e=localStorage.getItem(w.schemes);if(e==null)return;const t=JSON.parse(e),o=we(t);localStorage.setItem(O.commandPalette,JSON.stringify(!0)),localStorage.setItem(w.schemes,JSON.stringify(o))}catch(n){Y.exception("Failed to migrate command palette shortcuts",n)}}function we(n){const e=new Set(["Mac hotkeys","PC hotkeys"]),t=new Set(["cmd+k","cmd+j","cmd+t"]),o=new Set(["ctrl+k","ctrl+j","ctrl+t"]),c=new Set(["commandPalette","jumpTo","newTab"]),s={commandPalette:a=>`${a}+K`,jumpTo:a=>`${a}+J`,newTab:a=>`${a}+T`};return T(n,a=>{var h,m;const d=Object.entries(a).filter(([b])=>!e.has(b));for(const[b,{shortcuts:v,mod:x}]of d)for(const y of v){const C=x.toLowerCase()==="cmd"&&t.has(((h=y.shortcut)==null?void 0:h.toLowerCase())||""),k=x.toLowerCase()==="ctrl"&&o.has(((m=y.shortcut)==null?void 0:m.toLowerCase())||""),f=C||k;c.has(y.type)?y.shortcut==null&&(y.shortcut=s[y.type](x)):f&&(y.shortcut=null)}})}class Ne{constructor(){this.migrateHotkeysSpecialSymbolsToNames(),xe()}getShortcutSchemes(){return JSON.parse(localStorage.getItem(w.schemes)??"null")??{}}setShortcutSchemes(e){localStorage.setItem(w.schemes,JSON.stringify(e))}getCurrentScheme(){if(this.getShortcutsDisabled())return{type:"disabled"};const e=localStorage.getItem(w.currentScheme);return e?{type:"enabled",value:e}:{type:"not set"}}setCurrentScheme(e){this.setShortcutsDisabled(!1),localStorage.setItem(w.currentScheme,e)}disableCurrentScheme(){this.setShortcutsDisabled(!0)}getShortcutsDisabled(){return JSON.parse(localStorage.getItem(w.disabled)??"false")}setShortcutsDisabled(e){localStorage.setItem(w.disabled,JSON.stringify(e))}migrateHotkeysSpecialSymbolsToNames(){if(H!=="mac"||localStorage.getItem(O.hotkeysSpecialSymbolsToNames))return;const e=localStorage.getItem(w.schemes);if(e){const t=e.replace(/⌘/gi,E.metaKey.mac).replace(/⌃/gi,E.ctrlKey.mac).replace(/⌥/gi,E.altKey.mac).replace(/⇧/gi,E.shiftKey.mac);localStorage.setItem(w.schemes,t)}localStorage.setItem(O.hotkeysSpecialSymbolsToNames,JSON.stringify(!0))}static clearStorageForTests(){localStorage.clear()}}class Ie{constructor(e=H,t=new Ne){this.platform=e,this.storage=t,this.storage.setShortcutSchemes(this.shortcutSchemes)}get defaultPresets(){return Z(this.platform)}get defaultSchemesNames(){return[...Object.keys(this.defaultPresets)]}get shortcutSchemes(){return G(this.storage.getShortcutSchemes(),this.defaultPresets)}get currentScheme(){const e=this.defaultSchemesNames[0],t=this.storage.getCurrentScheme()??e,{shortcutSchemes:o}=this;switch(t.type){case"disabled":return;case"not set":return{name:e,value:o[e]};case"enabled":{const{value:c}=t;return{name:c,value:o[c]??o[e]}}default:j(!1,"unreachable");return}}selectScheme(e){const{shortcutSchemes:t}=this;e!=null&&t[e]==null||(e!=null?this.storage.setCurrentScheme(e):this.storage.disableCurrentScheme())}renameScheme(e,t){var c,s;const{shortcutSchemes:o}=this;(c=o[e])!=null&&c.editable&&(o[t]=o[e],delete o[e],((s=this.currentScheme)==null?void 0:s.name)===e&&this.storage.setCurrentScheme(t),this.storage.setShortcutSchemes(o))}deleteScheme(e){var o,c;const{shortcutSchemes:t}=this;(o=t[e])!=null&&o.editable&&(delete t[e],((c=this.currentScheme)==null?void 0:c.name)===e&&this.storage.setCurrentScheme(this.defaultSchemesNames[0]),this.storage.setShortcutSchemes(t))}changeShortcutByType({shortcut:e,type:t}){ee(t)&&this.modifyCurrentScheme(T(o=>{if(e!=null){const s=o.shortcuts.find(({shortcut:a})=>a===e);s!=null&&(s.shortcut=null)}const c=o.shortcuts.find(({type:s})=>t===s);c!=null&&(c.shortcut=e)}))}changeTabsModifier(e){this.modifyCurrentScheme(T(t=>{t.mod=e}))}changePanesModifier(e){this.modifyCurrentScheme(T(t=>{t.paneMod=e}))}modifyCurrentScheme(e){const{currentScheme:t,shortcutSchemes:o}=this;if(t==null)return;const c=this.getSchemeName(t.name),s=Me(t.value,t.name);o[c]=e(s),this.storage.setCurrentScheme(c),this.storage.setShortcutSchemes(o)}getSchemeName(e){const{shortcutSchemes:t}=this;if(t[e].editable)return e;const o=`${e} copy`;let c=o,s=0;for(;c in t;)c=`${o} ${s}`,s+=1;return c}}function Me(n,e){return T(n,t=>{n.editable||(t.editable=!0,t.parentScheme=e)})}const Pe=n=>{const{schemes:e,onChange:t,onDeleteScheme:o}=n,c=[{name:"Disabled"},...e],{classes:s}=De(),a=p.useCallback(async(d,h)=>{d.stopPropagation();try{await te({...{title:"Remove shortcuts scheme",text:"Are you sure you want to delete shortcuts scheme?",confirmButtonTitle:"Remove"},buttonColor:"error"}),o(h.name)}catch{}},[o]);return r(se,{toggler:({isOpen:d})=>r(L,{children:r(ne,{className:A({[s.arrowIcon]:!0,[s.open]:d})})}),children:({closeMenu:d})=>c.map(h=>r(oe,{dense:!0,onClick:()=>{t(h.name),d()},endAdornment:h.editable?r("div",{className:s.schemeActions,children:r(L,{color:"error",onMouseDown:m=>m.stopPropagation(),onClick:m=>{a(m,h),d()},children:r(ce,{htmlColor:"inherit"})})}):null,children:h.name},h.name))})},De=P()({arrowIcon:{width:15,height:6,fill:"var(--light-grey-2)"},open:{transform:"rotate(180deg)"},schemeActions:{display:"none",marginLeft:"10px","& svg":{fontSize:18}}}),Be=n=>{const{isEditing:e,keys:t,keydown:o,keyup:c,onFocus:s}=n,a=p.useRef(null),{classes:d}=Te();return p.useLayoutEffect(()=>{const{current:h}=a;if(h!=null)return h.addEventListener("keydown",o),h.addEventListener("keyup",c),()=>{h.removeEventListener("keydown",o),h.removeEventListener("keyup",c)}},[o,c]),e?r(z,{ref:a,autoFocus:!0,value:t||"",placeholder:"Disabled",onFocus:s,classes:{root:d.input}}):null},Te=P()({input:{position:"absolute",left:"0",width:"0px",opacity:"0"}});function U(n){return p.forwardRef((e,t)=>r("span",{ref:t,children:r(n,{...e})}))}const Ae=U(ke),V=n=>{const{dark:e,tipPosition:t,tipMargin:o,...c}=n,{classes:s}=Ke({tipMargin:o});return r(ae,{...c,classes:{popper:A(s.popper,{"termius-dark-theme":e}),tooltip:s.tooltip},title:N(_.Fragment,{children:[r(Ae,{className:A(s.tipIcon,s[t])}),n.title]})})};V.defaultProps={tipPosition:"center",tipMargin:3};const Ke=P()((n,e)=>({tooltip:{position:"relative",background:"var(--card-c)",color:"var(--main-color)",padding:"12px 13px",borderRadius:"6px",fontSize:"12px",fontWeight:450,lineHeight:"15px",boxShadow:`0px 5px 5px -3px rgba(0, 0, 0, 0.2),
      0px 8px 10px 1px rgba(0, 0, 0, 0.14),
      0px 3px 14px 2px rgba(0, 0, 0, 0.12)`},tipIcon:{fill:"var(--card-c)",position:"absolute",height:"11px",width:"20px",top:"-9px"},left:{left:`${e.tipMargin}px`},right:{right:`${e.tipMargin}px`},center:{left:"calc(50% - 10px)"},popper:{opacity:"1",marginLeft:"9px",marginTop:"-5px",background:"none"}})),Ee=U(re),$e=n=>{const{conflictingWith:e}=n,{classes:t}=Oe();return e?r(V,{open:!0,tipPosition:"left",tipMargin:2,placement:"bottom-start",title:`This will disable "${e}" shortcut`,children:r(Ee,{className:t.warningIcon})}):null},Oe=P()({warningIcon:{height:"100%",width:"14px",marginLeft:"15px"}});function je(n){const{className:e,keys:t,keyClassName:o}=n,{classes:c,cx:s}=Fe();return r("div",{className:s(c.shortcutPresenter,e),children:t.map(a=>r(ve,{className:A(o),children:a},a))})}const Fe=P()({shortcutPresenter:{display:"flex",gap:"10px"}}),Le=n=>{const{className:e,keys:t,endAdornment:o,isEditing:c}=n,{classes:s}=Re();return!t.length&&!c?r(K,{variant:"body2",color:"secondary",children:"Disabled"}):N("div",{className:A(e,s.keyCombination),children:[c?r(ie,{value:t.join("+"),inputProps:{className:s.input}}):r(je,{keys:t,keyClassName:s.key}),o&&r(K,{variant:"body2",color:"secondary",children:N("div",{className:s.additionalTextContainer,children:[r("div",{className:s.additionalText,children:"+"}),r("div",{className:s.additionalText,children:o})]})})]})},Re=P()({keyCombination:{display:"flex"},key:{background:"var(--white)"},input:{width:"100px",textAlign:"center"},additionalTextContainer:{display:"flex",gap:10},additionalText:{justifyContent:"center",display:"flex",alignItems:"center",minWidth:"22px",height:"22px"}}),W=[16,17,18,91,93],$=n=>{const{onClick:e,isEditing:t,acceptOnlyModKey:o,getConflictingActionName:c,actionDescription:s,onChange:a,actionType:d,onFocus:h,onSubmitBinding:m,onCancelBinding:b,oldShortcut:v,endAdornment:x,disabled:y}=n,{classes:C}=Je(),[k,f]=p.useState([]),I=p.useCallback(l=>{l.preventDefault(),l.stopPropagation();const S=F(l);if(f([...k,l.keyCode]),!W.includes(l.keyCode)||o){const B=S.length===0,M=l.currentTarget;if(B)switch(l.keyCode){case 13:m(),M==null||M.blur();return;case 8:a(null);return;case 27:a(v),M==null||M.blur(),b();return;default:return}o||S.push(le(l))}a(S.join("+"))},[o,v,a,k,f,b,m]),D=p.useCallback(ue(()=>{if(o)return;k.filter(S=>!W.includes(S)).length||a(v)},150),[k,a,v,o]),i=he(n.keys,de)??[],g=t&&n.keys&&!o?c(d):"",u=p.useCallback(()=>{t&&m()},[t,m]);return r(me,{onClickAway:u,children:N(pe,{className:A({[C.listItem]:!0,[C.active]:!!t}),onMouseDown:l=>t&&l.preventDefault(),onClick:l=>!y&&e(l),disableRipple:!0,children:[N("div",{className:C.leftContainer,children:[r(Le,{keys:i,isEditing:t,endAdornment:x}),r($e,{conflictingWith:g}),r(Be,{isEditing:t,keys:n.keys,keydown:I,keyup:D,onFocus:h})]}),r(K,{variant:"body2",color:"secondary",children:s})]})})};$.defaultProps={onChange:()=>{},isEditing:!1,actionType:"",onClick:()=>{},acceptOnlyModKey:!1,disabled:!1,getConflictingActionName:()=>{},oldShortcut:null,onFocus:()=>{},onSubmitBinding:()=>{},onCancelBinding:()=>{}};const Je=P()({listItem:{"--active-color":"var(--light-grey-4)",".termius-dark-theme &":{"--active-color":"var(--dark-grey-3)"},width:"100%",padding:"0 20px",height:"40px",display:"flex",alignItems:"center",justifyContent:"flex-start","&:hover, &:focus":{background:"var(--active-color)"}},active:{background:"var(--active-color)"},leftContainer:{width:"210px",display:"flex"}}),We=n=>{var D,i,g;const{shortcutsManager:e,onSubmitShortcut:t,onStartEditingShortcut:o}=n,c=Se(),[s,a]=p.useState(),d=((D=e.currentScheme)==null?void 0:D.value.mod)??null,h=((i=e.currentScheme)==null?void 0:i.value.paneMod)??null,m=Object.fromEntries(((g=e.currentScheme)==null?void 0:g.value.shortcuts.map(u=>[u.type,u]))??[]),b=p.useCallback(()=>{if(s==null)return;const{actionType:u,oldShortcut:l,newShortcut:S,funnelID:B}=s;if(l===S)return;const{title:M,canBeDisabled:Q,setShortcutImpl:X}=qe(u,m,e);S==null&&!Q||(X(S),t(M,l,S,B))},[s,t,m,e]),v=p.useCallback(()=>{R.bind(void 0)},[]),x=p.useCallback(()=>{var u;R.bind((u=e.currentScheme)==null?void 0:u.value)},[e]);if(!Object.keys(c).length||!Object.keys(m).length)return null;const y=u=>{if(s==null)return null;const{newShortcut:l}=s,S=Object.keys(c).find(B=>m[B].shortcut===l&&B!==u);return S?c[S].actionName:null},C=(u,l)=>{if(u!==(s==null?void 0:s.actionType)){const S=ge.v4();o(l,S),a({actionType:u,oldShortcut:l,newShortcut:l,funnelID:S})}},k=(s==null?void 0:s.actionType)==="mod",f=(s==null?void 0:s.actionType)==="paneMod",I=u=>{a(l=>(j(l!=null),T(l,S=>{S.newShortcut=u})))};return N(_.Fragment,{children:[r($,{onClick:()=>{C("mod",d)},isEditing:k,actionDescription:"Switch to specific Tab [1…9]",endAdornment:"[1…9]",acceptOnlyModKey:!0,keys:k?s.newShortcut:d,onCancelBinding:()=>{a(void 0)},onSubmitBinding:()=>{b(),a(void 0)},onChange:I}),r($,{onClick:()=>{C("paneMod",h)},isEditing:f,actionDescription:"Move focus between Split View panes",endAdornment:"arrows",keys:f?s.newShortcut:h,onCancelBinding:()=>{a(void 0)},onSubmitBinding:()=>{b(),a(void 0)},onChange:I}),Object.keys(c).map(u=>{const l=u===(s==null?void 0:s.actionType);return r($,{onClick:()=>{C(u,m[u].shortcut)},isEditing:l,oldShortcut:m[u].shortcut,actionDescription:c[u].actionName,keys:l?s.newShortcut:m[u].shortcut,actionType:u,getConflictingActionName:y,onFocus:v,onSubmitBinding:()=>{b(),x(),a(void 0)},onCancelBinding:()=>{x(),a(void 0)},onChange:I},u)})]})};function qe(n,e,t){return new Map([["mod",{title:"Switch to specific Tab mod",canBeDisabled:!1,setShortcutImpl:c=>{j(c!=null,"Tab mod cannot be disabled"),t.changeTabsModifier(c)}}],["paneMod",{title:"Move focus between Split View panes",canBeDisabled:!1,setShortcutImpl:c=>{j(c!=null,"Panes mod cannot be disabled"),t.changePanesModifier(c)}}]]).get(n)??{title:e[n].actionName,canBeDisabled:!0,setShortcutImpl:c=>{t.changeShortcutByType({shortcut:c,type:n})}}}function q(n){return{scheme:n==null?void 0:n.name,schemeNew:(n==null?void 0:n.name)??"Disabled"}}const He=()=>{const{current:n}=fe(()=>new Ie),e=n.shortcutSchemes,[t,o]=p.useState(()=>q(n.currentScheme)),[c,s]=p.useState(""),a=ye(),d=p.useCallback(()=>{const{currentScheme:i}=n;o(q(i)),a(be(i==null?void 0:i.value))},[a,n]),h=()=>{o({...t,scheme:c,schemeNew:c})},m=i=>{i.target.select(),s(i.target.value)},b=i=>i&&e[i].editable,v=i=>{n.deleteScheme(i),d()},x=()=>{t.schemeNew===""||n.defaultSchemesNames.includes(t.schemeNew)?h():t.scheme!=null&&t.scheme!==t.schemeNew&&n.renameScheme(t.scheme,t.schemeNew),d()},y=i=>{const g=i.currentTarget;i.keyCode===13&&F(i).length===0&&(g==null||g.blur()),i.keyCode===27&&F(i).length===0&&(h(),g==null||g.blur())};p.useEffect(()=>{t.scheme&&d()},[]);const C=p.useCallback(i=>{n.selectScheme(i==="Disabled"?void 0:i),d()},[d,n]),k=Object.entries(e).map(([i,g])=>({name:i,id:i,...g})),{classes:f}=ze(),I=p.useCallback((i,g,u,l)=>{d(),a(J("shortcutChanged",{shortcutActionTitle:i,previousKeyCombination:g??"Disabled",currentKeyCombination:u??"Disabled",shortcutModificationFunnelID:l}))},[a,d]),D=p.useCallback((i,g)=>{a(J("shortcutEditingStarted",{currentKeyCombination:i??"Disabled",shortcutModificationFunnelID:g}))},[a]);return r(Ce,{children:N("div",{className:f.root,children:[N("div",{className:f.pageHeader,children:[N("div",{className:f.schemeMenu,children:[r(z,{disabled:!b(t.scheme),onChange:i=>{o({...t,schemeNew:i.target.value})},placeholder:c,onFocus:m,onKeyUp:y,value:t.schemeNew,onBlur:x,classes:{root:f.schemeInput}}),r(Pe,{onDeleteScheme:v,schemes:k,onChange:C})]}),t.scheme&&N("div",{className:f.shortcutsHeader,children:[r("div",{className:f.leftContainer,children:r(K,{variant:"subtitle1",color:"main",children:"Shortcut"})}),r("div",{children:r(K,{variant:"subtitle1",color:"main",children:"Action"})})]})]}),t.scheme&&r(We,{shortcutsManager:n,onStartEditingShortcut:D,onSubmitShortcut:I})]})})},Xe=He,ze=P()({root:{padding:"30px 0"},schemeInput:{fontWeight:500,fontSize:"16px",marginRight:"10px","--text-color":"var(--main)","&&:before, &&:hover:before":{borderBottomColor:"var(--text-color)"},"&& input":{WebkitTextFillColor:"var(--text-color)"}},pageHeader:{padding:"0 20px"},schemeMenu:{display:"flex",alignItems:"center"},shortcutsHeader:{marginTop:"15px",height:"36px",display:"flex",alignItems:"center"},leftContainer:{width:"210px"}});export{Xe as default};
//# sourceMappingURL=index-3ea78f75.js.map

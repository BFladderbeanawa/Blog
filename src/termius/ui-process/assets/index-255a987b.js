import{ac as K,a as V,y_ as D,oG as U,d8 as L,b0 as j,c2 as I,f7 as q,aG as B,c6 as W,y$ as G,eM as z,z0 as Q}from"./reconnectSaga-e33541d6.js";function J(s,t){for(let o of t)s=s.replace(new RegExp("\\"+o,"g"),"\\"+o);return s}function $(s,t){return s=J(s,"\\()[]{}.+^$|"),s=s.replace(/\*/g,".*").replace(/\?/g,".?"),new RegExp("^(?:"+s+")$").test(t)}function X(s,t){const o=Array.isArray(s)?s:s.split(/,/);let e=!1;for(const n of o){if(n[0]=="!"&&$(n.slice(1),t))return!1;$(n,t)&&(e=!0)}return e}var Y=X;const Z=Y,v=/\s/,b=/\r|\n/,H=/^(Host|Match)$/i,tt=/^(GlobalKnownHostsFile|Host|IPQoS|SendEnv|UserKnownHostsFile)$/i,et=/^(?:CertificateFile|IdentityFile|User)$/i,g=1,F=2;function x(s,t){return t.hasOwnProperty(s.param)&&t[s.param]===s.value}const _=["IdentityFile","LocalForward","RemoteForward","DynamicForward","CertificateFile"];class y extends Array{compute(t){const o={},e=(n,i)=>{_.includes(n)?(o[n]||(o[n]=[])).push(i):o[n]==null&&(o[n]=i)};for(const n of this)n.type===g&&(n.param==="Host"?Z(n.value,t)&&(e(n.param,n.value),n.config.filter(i=>i.type===g).forEach(i=>e(i.param,i.value))):n.param==="Match"||e(n.param,n.value));return o}find(t={}){if(typeof t=="function")return super.find(t);if(!(t&&("Host"in t||"Match"in t)))throw new Error("Can only find by Host or Match");return super.find(o=>x(o,t))}remove(t={}){if(!(t&&("Host"in t||"Match"in t)))throw new Error("Can only remove by Host or Match");const o=typeof t=="function"?super.findIndex(t):super.findIndex(e=>x(e,t));if(o>=0)return this.splice(o,1)}toString(){return this.constructor.stringify(this)}append(t){let o="  ";t:for(const c of this)if(H.test(c.param)){for(const f of c.config)if(f.before){o=f.before;break t}}const e=this.length>0?this[this.length-1]:null;let n=e&&e.config||this,i=this,r=n.length>0?n[n.length-1]:e;r&&!r.after&&(r.after=`
`);for(const c in t){const f={type:g,param:c,separator:" ",value:t[c],before:"",after:`
`};H.test(c)?(n=i,r&&r.after===`
`&&(r.after+=`
`),n.push(f),n=f.config=new y):(f.before=n===i?"":o,n.push(f)),r=f}return i}static stringify(t){let o="";function e(r,c){return Array.isArray(r)?r.map(f=>e(f,v.test(f))).join(" "):c?`"${r}"`:r}function n(r){const c=r.quoted||et.test(r.param)&&v.test(r.value),f=e(r.value,c);return`${r.param}${r.separator}${f}`}const i=r=>{o+=r.before,r.type===F?o+=r.content:r.type===g&&_.includes(r.param)?[].concat(r.value).forEach(function(c,f,d){o+=n({...r,value:c}),f<d.length-1&&(o+=`
${r.before}`)}):r.type===g&&(o+=n(r)),o+=r.after,r.config&&r.config.forEach(i)};return t.forEach(i),o}static get DIRECTIVE(){return g}static get COMMENT(){return F}static parse(t){let o=0,e=r(),n=new y,i=n;function r(){return t[o++]}function c(){let a="";for(;v.test(e);)a+=e,e=r();return a}function f(){let a="";for(;b.test(e);)a+=e,e=r();return a}function d(){let a="";for(;e&&/[^ \t=]/.test(e);)a+=e,e=r();return/^Host$/i.test(a)?"Host":a}function u(){let a=c();return e==="="&&(a+=e,e=r()),a+c()}function h(){let a="",l=!1,p=!1;for(;e&&!b.test(e);)p?(a+=e==='"'?e:`\\${e}`,p=!1):e==='"'&&(!a||l)?l=!l:e==="\\"?p=!0:a+=e,e=r();if(l||p)throw new Error(`Unexpected line break at ${a}`);return a.trim()}function w(){const a=F;let l="";for(;e&&!b.test(e);)l+=e,e=r();return{type:a,content:l}}function E(){const a=[];let l="",p=!1,m=!1;for(;e&&!b.test(e);)m?(l+=e==='"'?e:`\\${e}`,m=!1):e==='"'?p=!p:e==="\\"?m=!0:p?l+=e:/[ \t]/.test(e)?l&&(a.push(l),l=""):l+=e,e=r();if(p||m)throw new Error(`Unexpected line break at ${a.concat(l).join(" ")}`);return l&&a.push(l),a.length>1?a:a[0]}function T(){const a=g,l=d(),p=tt.test(l),m={type:a,param:l,separator:u(),quoted:!p&&e==='"',value:p?E():h()};return m.quoted||delete m.quoted,m}function k(){const a=c(),l=e==="#"?w():T(),p=f();return l.before=a,l.after=p,l}for(;e;){let a=k();a.type===g&&H.test(a.param)?(n=i,n.push(a),n=a.config=new y):n.push(a)}return i}}var st=y;const rt=K(st),nt=s=>/^Host$/i.test(s.param),S=s=>/[!?*]/g.test(s);function ot(s,t){return s.Host===t}function at(s){return S(s.Host)||Array.isArray(s.Host)}const N=s=>{const t=rt.parse(s),o=[],e=r=>o.find(c=>ot(c,r)),n=r=>{if(S(r)||e(r))return;const c=t.compute(r);at(c)&&(c.Host=r),o.push(c)},i=r=>{r.forEach(c=>n(c))};for(const r of t)nt(r)&&r.value&&(Array.isArray(r.value)?i(r.value):n(r.value));return o};function it(s,t){var o={};return t=V(t),D(s,function(e,n,i){U(o,t(e,n,i),e)}),o}const ct=s=>{var t;return((t=s.proxyjump)==null?void 0:t.split(",").map(o=>o.trim()))??[]},ft=(s,t,o)=>{const e={pf_type:s,remote_port:0,local_port:22,hostname:"127.0.0.1",bound_address:void 0,host_label:o},n=t.indexOf(" ")!==-1?t.indexOf(" "):t.length,i=t.substring(0,n),r=i.lastIndexOf(":");let c;if(r!==-1?(e.bound_address=i.substring(0,r),c=Number.parseInt(i.substring(r+1),10)):c=Number.parseInt(i,10),Number.isNaN(c)||(e.local_port=c),n!==t.length){const f=t.substring(n+1),d=f.lastIndexOf(":"),u=Number.parseInt(f.substring(d+1),10);Number.isNaN(u)||(e.remote_port=u),e.hostname=f.substring(0,d)}return e},R=(s,t,o)=>t.map(e=>ft(s,e,o)),lt=s=>{const t=[];return s.localforward&&t.push(...R("Local Rule",s.localforward,s.host)),s.remoteforward&&t.push(...R("Remote Rule",s.remoteforward,s.host)),s.dynamicforward&&t.push(...R("Dynamic Rule",s.dynamicforward,s.host)),t},ut=s=>{const t={};if(s.forwardagent&&(t.agent_forwarding=s.forwardagent==="yes"),s.port){const o=Number.parseInt(s.port,10);Number.isNaN(o)||(t.port=o)}if(s.sendenv){const o=Array.isArray(s.sendenv)?s.sendenv:[s.sendenv];t.env_variables=o.map(e=>{if(e.includes("=")){const[n,i]=e.split("=");return{name:n,value:i}}return{name:e,value:process.env[e]??""}})}return t},pt=s=>it(s,(t,o)=>o.toLowerCase()),O=s=>{var n,i;const t=pt(s),o=t.hostname||t.host;if(!o)return;const e=((n=t.identityfile)==null?void 0:n[1])??((i=t.identityfile)==null?void 0:i[0]);return{address:o,label:t.host,identity:{is_visible:!1,label:t.host,username:t.user??null},sshConfig:ut(t),pfRules:lt(t),hostChain:ct(t),identityFile:e?{path:e}:void 0}},dt=process.env.HOME||process.env.USERPROFILE||"",A=L.join(dt,".ssh","known_hosts");function ht(s){if(s)return Q.createHash("md5").update(s,"base64").digest("hex")}function mt(s){const t=[];return s&&s.trim().split(`
`).forEach(o=>{const e=o.startsWith("|1|"),n=o.indexOf(" ");if(n===-1||e)return;const i=o.slice(0,n).trim().split(","),r=o.slice(n+1),c=ht(r.split(" ").pop());i.forEach(f=>{t.some(d=>d.host===f)||t.push({host:f,publicKey:r,fingerprint:c})})}),t}function P(s){var t;return(t=s.match(/\[(.*)\]/))==null?void 0:t[1]}const bt=async()=>{if(j)throw new Error("Windows platforms are not supported");const s=I.existsSync(A)?I.readFileSync(A,"utf-8"):void 0,t=mt(s),o=t.map(u=>new q({hostnames:u.host,key:u.publicKey})),e=t.map(u=>{var h;return{address:P(u.host)||u.host,label:P(u.host)||u.host,sshConfig:{port:Number((h=u.host.split(":"))==null?void 0:h[1])||22},identity:{is_visible:!1},pfRules:[],hostChain:[]}}),n=B.getPath("home"),i=I.readdirSync(`${n}/.ssh`,{withFileTypes:!0}),r=[],c=i.map(async u=>{const h=await W.readFile(`${n}/.ssh/${u.name}`);return(G(h.toString("utf8"))||z(h.toString("utf8")))&&r.push({path:`${n}/.ssh/${u.name}`}),h}),f=await Promise.allSettled(c).then(u=>{const h=u.filter(gt).map(E=>E.value);return Buffer.concat(h)}),d=N(f.toString("utf8"));return{groups:[],snippets:[],hosts:[...d.map(O).filter(C),...e],numberOfIgnoredSubconfigs:M(f.toString("utf8")),tags:[],knownHosts:o,keyPaths:r}};function C(s){return s!=null}const wt=async s=>{const t=N(s);return{groups:[],snippets:[],hosts:t.map(O).filter(C),numberOfIgnoredSubconfigs:M(s),tags:[],knownHosts:[]}};function M(s){var t;return((t=s.match(/^\s*include\s.*$/gim))==null?void 0:t.length)??0}const gt=s=>s.status==="fulfilled";export{bt as autoImportSshConfig,P as extractStringBetweenBrackets,mt as parseKnownHostsFileData,wt as parseSshConfig};
//# sourceMappingURL=index-255a987b.js.map

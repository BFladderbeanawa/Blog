"use strict";var Wh=Object.defineProperty;var Vh=(e,t,n)=>t in e?Wh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var hn=(e,t,n)=>(Vh(e,typeof t!="symbol"?t+"":t,n),n);const Pg=require("crypto"),yr=require("util"),Wa=require("net"),Dg=require("stream"),$g=require("os"),zn=require("fs"),Rh=require("http"),Yh=require("https"),pn=require("url"),Xh=require("zlib"),Hh=require("tls"),Sh=require("domain"),Nh=require("async_hooks"),wh=require("child_process"),ur=require("path");function Tt(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const n in e)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:()=>e[n]})}}return t.default=e,Object.freeze(t)}const Kh=Tt(yr),$r=Tt(Wa),ut=Tt($g),Qi=Tt(zn),ss=Tt(Rh),_h=Tt(Yh),rl=Tt(Hh),qg=Tt(Sh),Fh=Tt(Nh),No=Tt(ur);var We=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ln(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var kh=Pg,Jh=function(){return kh.randomBytes(16)},eu=[];for(var ji=0;ji<256;++ji)eu[ji]=(ji+256).toString(16).substr(1);function zh(e,t){var n=t||0,r=eu;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}var Th=zh,Uh=Jh,Eh=Th;function xh(e,t,n){var r=t&&n||0;typeof e=="string"&&(t=e==="binary"?new Array(16):null,e=null),e=e||{};var s=e.random||(e.rng||Uh)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t)for(var a=0;a<16;++a)t[r+a]=s[a];return t||Eh(s)}var Lh=xh;const Qh=Ln(Lh);function jh(){this._events_={},this.publish=this.trigger=this.emit=r,this.subscribe=this.on=e,this.once=t,this.unSubscribe=this.off=n,this.emit$=s;function e(a,c,u){if(!c)throw new ReferenceError("handler not defined.");return this._events_[a]||(this._events_[a]=[]),u&&(c._once_=u),this._events_[a].push(c),this}function t(a,c){return this.on(a,c,!0)}function n(a,c){if(!this._events_[a])return this;if(!c)throw new ReferenceError('handler not defined. if you wish to remove all handlers from the event please pass "*" as the handler');if(c=="*")return delete this._events_[a],this;for(var u=this._events_[a];u.includes(c);)u.splice(u.indexOf(c),1);return u.length<1&&delete this._events_[a],this}function r(a){if(this.emit$.apply(this,arguments),!this._events_[a])return this;arguments.splice=Array.prototype.splice,arguments.splice(0,1);var c=this._events_[a],u=[];for(var d in c){var h=c[d];h.apply(this,arguments),h._once_&&u.push(h)}for(var d in u)this.off(a,u[d]);return this}function s(a,c){if(!this._events_["*"])return this;var u=this._events_["*"];c.shift=Array.prototype.shift,c.shift(a);for(var d of u)d.apply(this,c);return this}return this}Array.prototype.includes||(Array.prototype.includes=function(e){if(this==null)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),n=parseInt(t.length,10)||0;if(n===0)return!1;var r=parseInt(arguments[1],10)||0,s;r>=0?s=r:(s=n+r,s<0&&(s=0));for(var a;s<n;){if(a=t[s],e===a||e!==e&&a!==a)return!0;s++}return!1});var Oh=jh,wo,il;function Mh(){if(il)return wo;il=1;class e{constructor(n){this._events_={},this.publish=this.trigger=this.emit,this.subscribe=this.on,this.unSubscribe=this.off}on(n,r,s){if(!r)throw new ReferenceError("handler not defined.");return this._events_[n]||(this._events_[n]=[]),s&&(r._once_=s),this._events_[n].push(r),this}once(n,r){return this.on(n,r,!0)}off(n,r){if(!this._events_[n])return this;if(!r)throw new ReferenceError('handler not defined. if you wish to remove all handlers from the event please pass "*" as the handler');if(r=="*")return delete this._events_[n],this;const s=this._events_[n];for(;s.includes(r);)s.splice(s.indexOf(r),1);return s.length<1&&delete this._events_[n],this}emit(n,...r){if(!this._events_[n])return this.emit$(n,...r);const s=this._events_[n],a=[];for(let c of s)c.apply(this,r),c._once_&&a.push(c);for(let c of a)this.off(n,c);return this.emit$(n,...r)}emit$(n,...r){if(!this._events_["*"])return this;const s=this._events_["*"];for(let a of s)a.call(this,n,...r);return this}}return wo=e,wo}let tu=Oh;process.version[1]>5&&(tu=Mh());var nu=tu;function Ph(){Object.defineProperties(this,{data:{enumerable:!0,get:r,set:c},type:{enumerable:!0,get:n,set:a},load:{enumerable:!0,writable:!1,value:u},JSON:{enumerable:!0,get:s}});var e="",t={};function n(){return e}function r(){return t}function s(){return JSON.stringify({type:e,data:t})}function a(d){e=d}function c(d){t=d}function u(d){try{var d=JSON.parse(d);e=d.type,t=d.data}catch(m){var h=d;e="error",t={message:"Invalid JSON response format",err:m,response:h}}}}var ru=Ph;function Dh(e){Object.defineProperties(this,{add:{enumerable:!0,writable:!1,value:c},next:{enumerable:!0,writable:!1,value:u},clear:{enumerable:!0,writable:!1,value:r},contents:{enumerable:!1,get:s,set:a},autoRun:{enumerable:!0,writable:!0,value:!0},stop:{enumerable:!0,writable:!0,value:!1}});var t=[],n=!1;function r(){return t=[],t}function s(){return t}function a(d){return t=d,t}function c(){for(var d in arguments)t.push(arguments[d]);!n&&!this.stop&&this.autoRun&&this.next()}function u(){if(n=!0,t.length<1||this.stop){n=!1;return}t.shift().bind(this)()}}var $h=Dh;const qh=$g;let eC=class{constructor(){this.appspace="app.",this.socketRoot="/tmp/",this.id=qh.hostname(),this.encoding="utf8",this.rawBuffer=!1,this.sync=!1,this.unlink=!0,this.delimiter="\f",this.silent=!1,this.logDepth=5,this.logInColor=!0,this.logger=console.log.bind(console),this.maxConnections=100,this.retry=500,this.maxRetries=1/0,this.stopRetrying=!1,this.readableAll=!1,this.writableAll=!1,this.interface={localAddress:!1,localPort:!1,family:!1,hints:!1,lookup:!1}}};var iu=eC;const tC=iu;class nC{constructor(t){t||(t=new tC),this.delimiter=t.delimiter}format(t){return!t.data&&t.data!==!1&&t.data!==0&&(t.data={}),t.data._maxListeners&&(t.data={}),t=t.JSON+this.delimiter,t}parse(t){const n=t.split(this.delimiter);return n.pop(),n}}var su=nC;const rC=Wa,{Readable:iC}=Dg,sC=nu,ou=ru,oC=$h,au=su;let si=new au,aC=class cu extends sC{constructor(t,n){super(),Object.assign(this,{Client:cu,config:t,queue:new oC,socket:!1,connect:gC,emit:cC,log:n,retriesRemaining:t.maxRetries||0,explicitlyDisconnected:!1}),si=new au(this.config)}};function cC(e,t){this.log("dispatching event to ",this.id,this.path," : ",e,",",t);let n=new ou;if(n.type=e,n.data=t,this.config.rawBuffer?n=Buffer.from(e,this.config.encoding):n=si.format(n),!this.config.sync){this.socket.write(n);return}this.queue.add(lC.bind(this,n))}function lC(e){this.log("dispatching event to ",this.id,this.path," : ",e),this.socket.write(e)}function gC(){let e=this;if(e.log("requested connection to ",e.id,e.path),!this.path){e.log(`

######
error: `,e.id," client has not specified socket path it wishes to connect to.");return}const t={};e.log("Connecting client on Unix Socket :",e.path),t.path=e.path,process.platform==="win32"&&!e.path.startsWith("\\\\.\\pipe\\")&&(t.path=t.path.replace(/^\//,""),t.path=t.path.replace(/\//g,"-"),t.path=`\\\\.\\pipe\\${t.path}`),e.socket=rC.connect(t),e.socket.setEncoding(this.config.encoding),e.socket.on("error",n=>{e.log(`

######
error: `,n),e.publish("error",n)}),e.socket.on("connect",()=>{e.publish("connect"),e.retriesRemaining=e.config.maxRetries,e.log("retrying reset")}),e.socket.on("close",()=>{if(e.log("connection closed",e.id,e.path,e.retriesRemaining,"tries remaining of",e.config.maxRetries),e.config.stopRetrying||e.retriesRemaining<1||e.explicitlyDisconnected){e.publish("disconnect"),e.log(e.config.id,"exceeded connection rety amount of"," or stopRetrying flag set."),e.socket.destroy(),e.publish("destroy"),e=void 0;return}setTimeout((function(){e.explicitlyDisconnected||(e.retriesRemaining-=1,e.connect())}).bind(null,e),e.config.retry),e.publish("disconnect")}),e.socket.on("data",n=>{if(e.log("## received events ##"),e.config.rawBuffer){if(e.publish("data",Buffer.from(n,e.config.encoding)),!e.config.sync)return;e.queue.next();return}if(this.ipcBuffer||(this.ipcBuffer=new iC({objectMode:!1,read(){}})),this.ipcBuffer.push(n),n.slice(-1)!==si.delimiter||n.indexOf(si.delimiter)===-1){e.log("Messages are large, You may want to consider smaller messages.");return}n=this.ipcBuffer.read().toString();const r=si.parse(n),s=r.length;for(let a=0;a<s;a+=1){const c=new ou;c.load(r[a]),e.log("detected event",c.type,c.data),e.publish(c.type,c.data)}e.config.sync&&e.queue.next()})}var uC=aC;const dC=zn,IC=Wa,hC=nu,Va=ru,lu=su;let lr=new lu,CC=class extends hC{constructor(t,n,r,s){super(),Object.assign(this,{config:n,path:t,port:s,log:r,server:!1,sockets:[],emit:bC,broadcast:pC}),lr=new lu(this.config),this.on("close",mC.bind(this))}onStart(t){this.trigger("start",t)}stop(){this.server.close()}start(){if(!this.path){this.log("Socket Server Path not specified, refusing to start");return}this.config.unlink?dC.unlink(this.path,sl.bind(this)):sl.bind(this)()}};function bC(e,t,n){this.log("dispatching event to socket"," : ",t,n);let r=new Va;r.type=t,r.data=n,this.config.rawBuffer?(this.log(this.config.encoding),r=Buffer.from(t,this.config.encoding)):r=lr.format(r),e.write(r)}function pC(e,t){this.log("broadcasting event to all known sockets listening to ",this.path," : ",this.port?this.port:"",e,t);let n=new Va;n.type=e,n.data=t,this.config.rawBuffer?n=Buffer.from(e,this.config.encoding):n=lr.format(n);for(let r=0,s=this.sockets.length;r<s;r+=1)this.sockets[r].write(n)}function mC(){for(let e=0,t=this.sockets.length;e<t;e+=1){const n=this.sockets[e];let r=!1;if(!(n&&n.readable)){n.id&&(r=n.id),this.log("socket disconnected",r.toString()),n&&n.destroy&&n.destroy(),this.sockets.splice(e,1),this.publish("socket.disconnected",n,r);return}}}function fC(e,t){if(this.config.rawBuffer){t=Buffer.from(t,this.config.encoding),this.publish("data",t,e);return}if(e.ipcBuffer||(e.ipcBuffer=""),e.ipcBuffer+=t,t=e.ipcBuffer,t.slice(-1)!==lr.delimiter||t.indexOf(lr.delimiter)===-1){this.log("Messages are large, You may want to consider smaller messages.");return}for(e.ipcBuffer="",t=lr.parse(t);t.length>0;){const n=new Va;n.load(t.shift()),n.data&&n.data.id&&(e.id=n.data.id),this.log("received event of : ",n.type,n.data),this.publish(n.type,n.data,e)}}function ZC(e){this.publish("close",e)}function yC(e){this.sockets.push(e),e.setEncoding&&e.setEncoding(this.config.encoding),this.log("## socket connection to server detected ##"),e.on("close",ZC.bind(this)),e.on("error",(function(t){this.log("server socket error",t),this.publish("error",t)}).bind(this)),e.on("data",fC.bind(this,e)),e.on("message",(function(t,n){if(!n)return;this.log("Received UDP message from ",n.address,n.port);let r;this.config.rawSocket?r=Buffer.from(t,this.config.encoding):r=t.toString(),e.emit("data",r,n)}).bind(this)),this.publish("connect",e)}function sl(){this.log("starting server on ",this.path,this.port?`:${this.port}`:""),this.log("starting server"),this.server=IC.createServer(yC.bind(this)),this.server.on("error",(function(e){this.log("server error",e),this.publish("error",e)}).bind(this)),this.server.maxConnections=this.config.maxConnections,this.log("starting server as","Unix || Windows Socket"),process.platform==="win32"&&(this.path=this.path.replace(/^\//,""),this.path=this.path.replace(/\//g,"-"),this.path=`\\\\.\\pipe\\${this.path}`),this.server.listen({path:this.path,readableAll:this.config.readableAll,writableAll:this.config.writableAll},this.onStart.bind(this))}var GC=CC;const BC=yr,AC=uC,vC=GC,WC=iu;let VC=class{constructor(){Object.defineProperties(this,{config:{enumerable:!0,writable:!0,value:new WC},connectTo:{enumerable:!0,writable:!1,value:XC},disconnect:{enumerable:!0,writable:!1,value:RC},serve:{enumerable:!0,writable:!1,value:YC},of:{enumerable:!0,writable:!0,value:{}},server:{enumerable:!0,writable:!0,configurable:!0,value:!1},log:{enumerable:!0,writable:!1,value:gu}})}};function gu(...e){if(!this.config.silent){for(let t=0,n=e.length;t<n;t+=1)typeof e[t]=="object"&&(e[t]=BC.inspect(e[t],{depth:this.config.logDepth,colors:this.config.logInColor}));this.config.logger(e.join(" "))}}function RC(e){this.of[e]&&(this.of[e].explicitlyDisconnected=!0,this.of[e].off("*","*"),this.of[e].socket&&this.of[e].socket.destroy&&this.of[e].socket.destroy(),delete this.of[e])}function YC(e,t){typeof e=="function"&&(t=e,e=!1),e||(this.log("Server path not specified, so defaulting to","ipc.config.socketRoot + ipc.config.appspace + ipc.config.id",this.config.socketRoot+this.config.appspace+this.config.id),e=this.config.socketRoot+this.config.appspace+this.config.id),t||(t=uu),this.server=new vC(e,this.config,gu),this.server.on("start",t)}function uu(){}function XC(e,t,n){if(typeof t=="function"&&(n=t,t=!1),n||(n=uu),!e){this.log("Service id required","Requested service connection without specifying service id. Aborting connection attempt");return}if(t||(this.log("Service path not specified, so defaulting to","ipc.config.socketRoot + ipc.config.appspace + id",(this.config.socketRoot+this.config.appspace+e).data),t=this.config.socketRoot+this.config.appspace+e),this.of[e]){if(!this.of[e].socket.destroyed){this.log("Already Connected to",e,"- So executing success without connection"),n();return}this.of[e].socket.destroy()}this.of[e]=new AC(this.config,this.log),this.of[e].id=e,this.of[e].path=t,this.of[e].connect(),n(this)}var HC=VC;const ol=HC;class SC extends ol{constructor(){super(),Object.defineProperty(this,"IPC",{enumerable:!0,writable:!1,value:ol})}}var Bs=new SC;Bs.config.id=Qh();Bs.config.silent=!0;const NC=Bs;function wC(e){const t=new Bs.IPC;return t.config.silent=!0,t.config.socketRoot=typeof e=="string"?e:KC(e),t}function KC(e){const t=e.getPath("userData");return _C(t)}const _C=e=>e.endsWith("/")?e:`${e}/`,du=Object.prototype.toString;function Iu(e){switch(du.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return Un(e,Error)}}function Ra(e,t){return du.call(e)===`[object ${t}]`}function dr(e){return Ra(e,"String")}function Ya(e){return typeof e=="object"&&e!==null&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function FC(e){return e===null||Ya(e)||typeof e!="object"&&typeof e!="function"}function Tn(e){return Ra(e,"Object")}function kC(e){return typeof Event<"u"&&Un(e,Event)}function JC(e){return typeof Element<"u"&&Un(e,Element)}function hu(e){return Ra(e,"RegExp")}function Bt(e){return!!(e&&e.then&&typeof e.then=="function")}function zC(e){return Tn(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e}function Cu(e){return typeof e=="number"&&e!==e}function Un(e,t){try{return e instanceof t}catch{return!1}}function TC(e){return!!(typeof e=="object"&&e!==null&&(e.__isVue||e._isVue))}function gr(e,t=0){return typeof e!="string"||t===0||e.length<=t?e:`${e.slice(0,t)}...`}function Ko(e,t){let n=e;const r=n.length;if(r<=150)return n;t>r&&(t=r);let s=Math.max(t-60,0);s<5&&(s=0);let a=Math.min(s+140,r);return a>r-5&&(a=r),a===r&&(s=Math.max(a-140,0)),n=n.slice(s,a),s>0&&(n=`'{snip} ${n}`),a<r&&(n+=" {snip}"),n}function UC(e,t,n=!1){return dr(e)?hu(t)?t.test(e):dr(t)?n?e===t:e.includes(t):!1:!1}function Gr(e,t=[],n=!1){return t.some(r=>UC(e,r,n))}function EC(e,t,n=250,r,s,a,c){if(!a.exception||!a.exception.values||!c||!Un(c.originalException,Error))return;const u=a.exception.values.length>0?a.exception.values[a.exception.values.length-1]:void 0;u&&(a.exception.values=xC(Do(e,t,s,c.originalException,r,a.exception.values,u,0),n))}function Do(e,t,n,r,s,a,c,u){if(a.length>=n+1)return a;let d=[...a];if(Un(r[s],Error)){al(c,u);const h=e(t,r[s]),m=d.length;cl(h,s,m,u),d=Do(e,t,n,r[s],s,[h,...d],h,m)}return Array.isArray(r.errors)&&r.errors.forEach((h,m)=>{if(Un(h,Error)){al(c,u);const y=e(t,h),v=d.length;cl(y,`errors[${m}]`,v,u),d=Do(e,t,n,h,s,[y,...d],y,v)}}),d}function al(e,t){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,...e.type==="AggregateError"&&{is_exception_group:!0},exception_id:t}}function cl(e,t,n,r){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,type:"chained",source:t,exception_id:n,parent_id:r}}function xC(e,t){return e.map(n=>(n.value&&(n.value=gr(n.value,t)),n))}function Oi(e){return e&&e.Math==Math?e:void 0}const ve=typeof globalThis=="object"&&Oi(globalThis)||typeof window=="object"&&Oi(window)||typeof self=="object"&&Oi(self)||typeof global=="object"&&Oi(global)||function(){return this}()||{};function LC(){return ve}function bu(e,t,n){const r=n||ve,s=r.__SENTRY__=r.__SENTRY__||{};return s[e]||(s[e]=t())}const QC=LC(),jC=80;function OC(e,t={}){if(!e)return"<unknown>";try{let n=e;const r=5,s=[];let a=0,c=0;const u=" > ",d=u.length;let h;const m=Array.isArray(t)?t:t.keyAttrs,y=!Array.isArray(t)&&t.maxStringLength||jC;for(;n&&a++<r&&(h=MC(n,m),!(h==="html"||a>1&&c+s.length*d+h.length>=y));)s.push(h),c+=h.length,n=n.parentNode;return s.reverse().join(u)}catch{return"<unknown>"}}function MC(e,t){const n=e,r=[];let s,a,c,u,d;if(!n||!n.tagName)return"";if(QC.HTMLElement&&n instanceof HTMLElement&&n.dataset&&n.dataset.sentryComponent)return n.dataset.sentryComponent;r.push(n.tagName.toLowerCase());const h=t&&t.length?t.filter(y=>n.getAttribute(y)).map(y=>[y,n.getAttribute(y)]):null;if(h&&h.length)h.forEach(y=>{r.push(`[${y[0]}="${y[1]}"]`)});else if(n.id&&r.push(`#${n.id}`),s=n.className,s&&dr(s))for(a=s.split(/\s+/),d=0;d<a.length;d++)r.push(`.${a[d]}`);const m=["aria-label","type","name","title","alt"];for(d=0;d<m.length;d++)c=m[d],u=n.getAttribute(c),u&&r.push(`[${c}="${u}"]`);return r.join("")}const Ci=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,PC="Sentry Logger ",$o=["debug","info","warn","error","log","assert","trace"],os={};function Gn(e){if(!("console"in ve))return e();const t=ve.console,n={},r=Object.keys(os);r.forEach(s=>{const a=os[s];n[s]=t[s],t[s]=a});try{return e()}finally{r.forEach(s=>{t[s]=n[s]})}}function DC(){let e=!1;const t={enable:()=>{e=!0},disable:()=>{e=!1},isEnabled:()=>e};return Ci?$o.forEach(n=>{t[n]=(...r)=>{e&&Gn(()=>{ve.console[n](`${PC}[${n}]:`,...r)})}}):$o.forEach(n=>{t[n]=()=>{}}),t}const L=DC(),$C=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function qC(e){return e==="http"||e==="https"}function As(e,t=!1){const{host:n,path:r,pass:s,port:a,projectId:c,protocol:u,publicKey:d}=e;return`${u}://${d}${t&&s?`:${s}`:""}@${n}${a?`:${a}`:""}/${r&&`${r}/`}${c}`}function eb(e){const t=$C.exec(e);if(!t){Gn(()=>{console.error(`Invalid Sentry Dsn: ${e}`)});return}const[n,r,s="",a,c="",u]=t.slice(1);let d="",h=u;const m=h.split("/");if(m.length>1&&(d=m.slice(0,-1).join("/"),h=m.pop()),h){const y=h.match(/^\d+/);y&&(h=y[0])}return pu({host:a,pass:s,path:d,projectId:h,port:c,protocol:n,publicKey:r})}function pu(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function tb(e){if(!Ci)return!0;const{port:t,projectId:n,protocol:r}=e;return["protocol","publicKey","host","projectId"].find(c=>e[c]?!1:(L.error(`Invalid Sentry Dsn: ${c} missing`),!0))?!1:n.match(/^\d+$/)?qC(r)?t&&isNaN(parseInt(t,10))?(L.error(`Invalid Sentry Dsn: Invalid port ${t}`),!1):!0:(L.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(L.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1)}function nb(e){const t=typeof e=="string"?eb(e):pu(e);if(!(!t||!tb(t)))return t}class Ft extends Error{constructor(t,n="warn"){super(t),this.message=t,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=n}}function at(e,t,n){if(!(t in e))return;const r=e[t],s=n(r);typeof s=="function"&&rb(s,r),e[t]=s}function gi(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch{Ci&&L.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function rb(e,t){try{const n=t.prototype||{};e.prototype=t.prototype=n,gi(e,"__sentry_original__",t)}catch{}}function ib(e){return e.__sentry_original__}function sb(e){return Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")}function mu(e){if(Iu(e))return{message:e.message,name:e.name,stack:e.stack,...gl(e)};if(kC(e)){const t={type:e.type,target:ll(e.target),currentTarget:ll(e.currentTarget),...gl(e)};return typeof CustomEvent<"u"&&Un(e,CustomEvent)&&(t.detail=e.detail),t}else return e}function ll(e){try{return JC(e)?OC(e):Object.prototype.toString.call(e)}catch{return"<unknown>"}}function gl(e){if(typeof e=="object"&&e!==null){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}else return{}}function ob(e,t=40){const n=Object.keys(mu(e));if(n.sort(),!n.length)return"[object has no keys]";if(n[0].length>=t)return gr(n[0],t);for(let r=n.length;r>0;r--){const s=n.slice(0,r).join(", ");if(!(s.length>t))return r===n.length?s:gr(s,t)}return""}function Je(e){return qo(e,new Map)}function qo(e,t){if(ab(e)){const n=t.get(e);if(n!==void 0)return n;const r={};t.set(e,r);for(const s of Object.keys(e))typeof e[s]<"u"&&(r[s]=qo(e[s],t));return r}if(Array.isArray(e)){const n=t.get(e);if(n!==void 0)return n;const r=[];return t.set(e,r),e.forEach(s=>{r.push(qo(s,t))}),r}return e}function ab(e){if(!Tn(e))return!1;try{const t=Object.getPrototypeOf(e).constructor.name;return!t||t==="Object"}catch{return!0}}function cb(e,t=!1){return!(t||e&&!e.startsWith("/")&&!e.match(/^[A-Z]:/)&&!e.startsWith(".")&&!e.match(/^[a-zA-Z]([a-zA-Z0-9.\-+])*:\/\//))&&e!==void 0&&!e.includes("node_modules/")}function lb(e){const t=/^\s*[-]{4,}$/,n=/at (?:async )?(?:(.+?)\s+\()?(?:(.+):(\d+):(\d+)?|([^)]+))\)?/;return r=>{const s=r.match(n);if(s){let a,c,u,d,h;if(s[1]){u=s[1];let v=u.lastIndexOf(".");if(u[v-1]==="."&&v--,v>0){a=u.slice(0,v),c=u.slice(v+1);const _=a.indexOf(".Module");_>0&&(u=u.slice(_+1),a=a.slice(0,_))}d=void 0}c&&(d=a,h=c),c==="<anonymous>"&&(h=void 0,u=void 0),u===void 0&&(h=h||"<anonymous>",u=d?`${d}.${h}`:h);let m=s[2]&&s[2].startsWith("file://")?s[2].slice(7):s[2];const y=s[5]==="native";return m&&m.match(/\/[A-Z]:/)&&(m=m.slice(1)),!m&&s[5]&&!y&&(m=s[5]),{filename:m,module:e?e(m):void 0,function:u,lineno:parseInt(s[3],10)||void 0,colno:parseInt(s[4],10)||void 0,in_app:cb(m,y)}}if(r.match(t))return{filename:r}}}const fu=50,ul=/\(error: (.*)\)/,dl=/captureMessage|captureException/;function Zu(...e){const t=e.sort((n,r)=>n[0]-r[0]).map(n=>n[1]);return(n,r=0)=>{const s=[],a=n.split(`
`);for(let c=r;c<a.length;c++){const u=a[c];if(u.length>1024)continue;const d=ul.test(u)?u.replace(ul,"$1"):u;if(!d.match(/\S*Error: /)){for(const h of t){const m=h(d);if(m){s.push(m);break}}if(s.length>=fu)break}}return ub(s)}}function gb(e){return Array.isArray(e)?Zu(...e):e}function ub(e){if(!e.length)return[];const t=Array.from(e);return/sentryWrapped/.test(t[t.length-1].function||"")&&t.pop(),t.reverse(),dl.test(t[t.length-1].function||"")&&(t.pop(),dl.test(t[t.length-1].function||"")&&t.pop()),t.slice(0,fu).map(n=>({...n,filename:n.filename||t[t.length-1].filename,function:n.function||"?"}))}const _o="<anonymous>";function yu(e){try{return!e||typeof e!="function"?_o:e.name||_o}catch{return _o}}function db(e){return[90,lb(e)]}const ns={},Il={};function Xa(e,t){ns[e]=ns[e]||[],ns[e].push(t)}function Ha(e,t){Il[e]||(t(),Il[e]=!0)}function Sa(e,t){const n=e&&ns[e];if(n)for(const r of n)try{r(t)}catch(s){Ci&&L.error(`Error while triggering instrumentation handler.
Type: ${e}
Name: ${yu(r)}
Error:`,s)}}function Ib(e){const t="console";Xa(t,e),Ha(t,hb)}function hb(){"console"in ve&&$o.forEach(function(e){e in ve.console&&at(ve.console,e,function(t){return os[e]=t,function(...n){Sa("console",{args:n,level:e});const s=os[e];s&&s.apply(ve.console,n)}})})}function Re(){const e=ve,t=e.crypto||e.msCrypto;let n=()=>Math.random()*16;try{if(t&&t.randomUUID)return t.randomUUID().replace(/-/g,"");t&&t.getRandomValues&&(n=()=>{const r=new Uint8Array(1);return t.getRandomValues(r),r[0]})}catch{}return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,r=>(r^(n()&15)>>r/4).toString(16))}function Gu(e){return e.exception&&e.exception.values?e.exception.values[0]:void 0}function kn(e){const{message:t,event_id:n}=e;if(t)return t;const r=Gu(e);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function Cb(e,t,n){const r=e.exception=e.exception||{},s=r.values=r.values||[],a=s[0]=s[0]||{};a.value||(a.value=t||""),a.type||(a.type=n||"Error")}function Bu(e,t){const n=Gu(e);if(!n)return;const r={type:"generic",handled:!0},s=n.mechanism;if(n.mechanism={...r,...s,...t},t&&"data"in t){const a={...s&&s.data,...t.data};n.mechanism.data=a}}const bb=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/;function pb(e){const t=e.match(bb)||[],n=parseInt(t[1],10),r=parseInt(t[2],10),s=parseInt(t[3],10);return{buildmetadata:t[5],major:isNaN(n)?void 0:n,minor:isNaN(r)?void 0:r,patch:isNaN(s)?void 0:s,prerelease:t[4]}}function mb(e,t,n=5){if(t.lineno===void 0)return;const r=e.length,s=Math.max(Math.min(r-1,t.lineno-1),0);t.pre_context=e.slice(Math.max(0,s-n),s).map(a=>Ko(a,0)),t.context_line=Ko(e[Math.min(r-1,s)],t.colno||0),t.post_context=e.slice(Math.min(s+1,r),s+1+n).map(a=>Ko(a,0))}function hl(e){if(e&&e.__sentry_captured__)return!0;try{gi(e,"__sentry_captured__",!0)}catch{}return!1}function as(e){return Array.isArray(e)?e:[e]}let Mi=null;function fb(e){const t="error";Xa(t,e),Ha(t,Zb)}function Zb(){Mi=ve.onerror,ve.onerror=function(e,t,n,r,s){return Sa("error",{column:r,error:s,line:n,msg:e,url:t}),Mi&&!Mi.__SENTRY_LOADER__?Mi.apply(this,arguments):!1},ve.onerror.__SENTRY_INSTRUMENTED__=!0}let Pi=null;function yb(e){const t="unhandledrejection";Xa(t,e),Ha(t,Gb)}function Gb(){Pi=ve.onunhandledrejection,ve.onunhandledrejection=function(e){return Sa("unhandledrejection",e),Pi&&!Pi.__SENTRY_LOADER__?Pi.apply(this,arguments):!0},ve.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function Gt(e,t){return e.require(t)}function Ir(e){let t;try{t=Gt(module,e)}catch{}try{const{cwd:n}=Gt(module,"process");t=Gt(module,`${n()}/node_modules/${e}`)}catch{}return t}function Bb(){const e=typeof WeakSet=="function",t=e?new WeakSet:[];function n(s){if(e)return t.has(s)?!0:(t.add(s),!1);for(let a=0;a<t.length;a++)if(t[a]===s)return!0;return t.push(s),!1}function r(s){if(e)t.delete(s);else for(let a=0;a<t.length;a++)if(t[a]===s){t.splice(a,1);break}}return[n,r]}function Kt(e,t=100,n=1/0){try{return ea("",e,t,n)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function Au(e,t=3,n=100*1024){const r=Kt(e,t);return Vb(r)>n?Au(e,t-1,n):r}function ea(e,t,n=1/0,r=1/0,s=Bb()){const[a,c]=s;if(t==null||["number","boolean","string"].includes(typeof t)&&!Cu(t))return t;const u=Ab(e,t);if(!u.startsWith("[object "))return u;if(t.__sentry_skip_normalization__)return t;const d=typeof t.__sentry_override_normalization_depth__=="number"?t.__sentry_override_normalization_depth__:n;if(d===0)return u.replace("object ","");if(a(t))return"[Circular ~]";const h=t;if(h&&typeof h.toJSON=="function")try{const _=h.toJSON();return ea("",_,d-1,r,s)}catch{}const m=Array.isArray(t)?[]:{};let y=0;const v=mu(t);for(const _ in v){if(!Object.prototype.hasOwnProperty.call(v,_))continue;if(y>=r){m[_]="[MaxProperties ~]";break}const F=v[_];m[_]=ea(_,F,d-1,r,s),y++}return c(t),m}function Ab(e,t){try{if(e==="domain"&&t&&typeof t=="object"&&t._events)return"[Domain]";if(e==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&t===global)return"[Global]";if(typeof window<"u"&&t===window)return"[Window]";if(typeof document<"u"&&t===document)return"[Document]";if(TC(t))return"[VueViewModel]";if(zC(t))return"[SyntheticEvent]";if(typeof t=="number"&&t!==t)return"[NaN]";if(typeof t=="function")return`[Function: ${yu(t)}]`;if(typeof t=="symbol")return`[${String(t)}]`;if(typeof t=="bigint")return`[BigInt: ${String(t)}]`;const n=vb(t);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(n){return`**non-serializable** (${n})`}}function vb(e){const t=Object.getPrototypeOf(e);return t?t.constructor.name:"null prototype"}function Wb(e){return~-encodeURI(e).split(/%..|./).length}function Vb(e){return Wb(JSON.stringify(e))}const Rb=/^(\S+:\\|\/?)([\s\S]*?)((?:\.{1,2}|[^/\\]+?|)(\.[^./\\]*|))(?:[/\\]*)$/;function vu(e){const t=e.length>1024?`<truncated>${e.slice(-1024)}`:e,n=Rb.exec(t);return n?n.slice(1):[]}function Yb(e){const t=vu(e),n=t[0];let r=t[1];return!n&&!r?".":(r&&(r=r.slice(0,r.length-1)),n+r)}function Xb(e,t){let n=vu(e)[2];return t&&n.slice(t.length*-1)===t&&(n=n.slice(0,n.length-t.length)),n}var Mt;(function(e){e[e.PENDING=0]="PENDING";const n=1;e[e.RESOLVED=n]="RESOLVED";const r=2;e[e.REJECTED=r]="REJECTED"})(Mt||(Mt={}));function hr(e){return new pt(t=>{t(e)})}function Wu(e){return new pt((t,n)=>{n(e)})}class pt{constructor(t){pt.prototype.__init.call(this),pt.prototype.__init2.call(this),pt.prototype.__init3.call(this),pt.prototype.__init4.call(this),this._state=Mt.PENDING,this._handlers=[];try{t(this._resolve,this._reject)}catch(n){this._reject(n)}}then(t,n){return new pt((r,s)=>{this._handlers.push([!1,a=>{if(!t)r(a);else try{r(t(a))}catch(c){s(c)}},a=>{if(!n)s(a);else try{r(n(a))}catch(c){s(c)}}]),this._executeHandlers()})}catch(t){return this.then(n=>n,t)}finally(t){return new pt((n,r)=>{let s,a;return this.then(c=>{a=!1,s=c,t&&t()},c=>{a=!0,s=c,t&&t()}).then(()=>{if(a){r(s);return}n(s)})})}__init(){this._resolve=t=>{this._setResult(Mt.RESOLVED,t)}}__init2(){this._reject=t=>{this._setResult(Mt.REJECTED,t)}}__init3(){this._setResult=(t,n)=>{if(this._state===Mt.PENDING){if(Bt(n)){n.then(this._resolve,this._reject);return}this._state=t,this._value=n,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===Mt.PENDING)return;const t=this._handlers.slice();this._handlers=[],t.forEach(n=>{n[0]||(this._state===Mt.RESOLVED&&n[1](this._value),this._state===Mt.REJECTED&&n[2](this._value),n[0]=!0)})}}}function Hb(e){const t=[];function n(){return e===void 0||t.length<e}function r(c){return t.splice(t.indexOf(c),1)[0]}function s(c){if(!n())return Wu(new Ft("Not adding Promise because buffer limit was reached."));const u=c();return t.indexOf(u)===-1&&t.push(u),u.then(()=>r(u)).then(null,()=>r(u).then(null,()=>{})),u}function a(c){return new pt((u,d)=>{let h=t.length;if(!h)return u(!0);const m=setTimeout(()=>{c&&c>0&&u(!1)},c);t.forEach(y=>{hr(y).then(()=>{--h||(clearTimeout(m),u(!0))},d)})})}return{$:t,add:s,drain:a}}function Sb(e){const t={};let n=0;for(;n<e.length;){const r=e.indexOf("=",n);if(r===-1)break;let s=e.indexOf(";",n);if(s===-1)s=e.length;else if(s<r){n=e.lastIndexOf(";",r-1)+1;continue}const a=e.slice(n,r).trim();if(t[a]===void 0){let c=e.slice(r+1,s).trim();c.charCodeAt(0)===34&&(c=c.slice(1,-1));try{t[a]=c.indexOf("%")!==-1?decodeURIComponent(c):c}catch{t[a]=c}}n=s+1}return t}function Nb(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:n,hash:r,relative:t[5]+n+r}}function cs(e){return e.split(/[\?#]/,1)[0]}function ls(e){return e.split(/\\?\//).filter(t=>t.length>0&&t!==",").length}function wb(e){const{protocol:t,host:n,path:r}=e,s=n&&n.replace(/^.*@/,"[filtered]:[filtered]@").replace(/(:80)$/,"").replace(/(:443)$/,"")||"";return`${t?`${t}://`:""}${s}${r}`}const Kb={ip:!1,request:!0,transaction:!0,user:!0},_b=["cookies","data","headers","method","query_string","url"],Vu=["id","username","email"];function Fb(e,t,n){if(e){if(!e.metadata.source||e.metadata.source==="url"){const[r,s]=Cr(t,{path:!0,method:!0});e.updateName(r),e.setMetadata({source:s})}e.setAttribute("url",t.originalUrl||t.url),t.baseUrl&&e.setAttribute("baseUrl",t.baseUrl),e.setData("query",Ru(t,n))}}function Cr(e,t={}){const n=e.method&&e.method.toUpperCase();let r="",s="url";t.customRoute||e.route?(r=t.customRoute||`${e.baseUrl||""}${e.route&&e.route.path}`,s="route"):(e.originalUrl||e.url)&&(r=cs(e.originalUrl||e.url||""));let a="";return t.method&&n&&(a+=n),t.method&&t.path&&(a+=" "),t.path&&r&&(a+=r),[a,s]}function kb(e,t){switch(t){case"path":return Cr(e,{path:!0})[0];case"handler":return e.route&&e.route.stack&&e.route.stack[0]&&e.route.stack[0].name||"<anonymous>";case"methodPath":default:{const n=e._reconstructedRoute?e._reconstructedRoute:void 0;return Cr(e,{path:!0,method:!0,customRoute:n})[0]}}}function Jb(e,t){const n={};return(Array.isArray(t)?t:Vu).forEach(s=>{e&&s in e&&(n[s]=e[s])}),n}function ui(e,t){const{include:n=_b,deps:r}=t||{},s={},a=e.headers||{},c=e.method,u=a.host||e.hostname||e.host||"<no host>",d=e.protocol==="https"||e.socket&&e.socket.encrypted?"https":"http",h=e.originalUrl||e.url||"",m=h.startsWith(d)?h:`${d}://${u}${h}`;return n.forEach(y=>{switch(y){case"headers":{s.headers=a,n.includes("cookies")||delete s.headers.cookie;break}case"method":{s.method=c;break}case"url":{s.url=m;break}case"cookies":{s.cookies=e.cookies||a.cookie&&Sb(a.cookie)||{};break}case"query_string":{s.query_string=Ru(e,r);break}case"data":{if(c==="GET"||c==="HEAD")break;e.body!==void 0&&(s.data=dr(e.body)?e.body:JSON.stringify(Kt(e.body)));break}default:({}).hasOwnProperty.call(e,y)&&(s[y]=e[y])}}),s}function Na(e,t,n){const r={...Kb,...n&&n.include};if(r.request){const s=Array.isArray(r.request)?ui(t,{include:r.request,deps:n&&n.deps}):ui(t,{deps:n&&n.deps});e.request={...e.request,...s}}if(r.user){const s=t.user&&Tn(t.user)?Jb(t.user,r.user):{};Object.keys(s).length&&(e.user={...e.user,...s})}if(r.ip){const s=t.ip||t.socket&&t.socket.remoteAddress;s&&(e.user={...e.user,ip_address:s})}return r.transaction&&!e.transaction&&(e.transaction=kb(t,r.transaction)),e}function Ru(e,t){let n=e.originalUrl||e.url||"";if(n){n.startsWith("/")&&(n=`http://dogs.are.great${n}`);try{return e.query||typeof URL<"u"&&new URL(n).search.slice(1)||t&&t.url&&t.url.parse(n).query||void 0}catch{return}}}const zb=["fatal","error","warning","log","info","debug"];function Tb(e){return e==="warn"?"warning":zb.includes(e)?e:"log"}const Yu=1e3;function vs(){return Date.now()/Yu}function Ub(){const{performance:e}=ve;if(!e||!e.now)return vs;const t=Date.now()-e.now(),n=e.timeOrigin==null?t:e.timeOrigin;return()=>(n+e.now())/Yu}const Pt=Ub();(()=>{const{performance:e}=ve;if(!e||!e.now)return;const t=3600*1e3,n=e.now(),r=Date.now(),s=e.timeOrigin?Math.abs(e.timeOrigin+n-r):t,a=s<t,c=e.timing&&e.timing.navigationStart,d=typeof c=="number"?Math.abs(c+n-r):t,h=d<t;return a||h?s<=d?e.timeOrigin:c:r})();const Xu="sentry-",Eb=/^sentry-/,xb=8192;function Hu(e){if(!dr(e)&&!Array.isArray(e))return;let t={};if(Array.isArray(e))t=e.reduce((r,s)=>{const a=Cl(s);for(const c of Object.keys(a))r[c]=a[c];return r},{});else{if(!e)return;t=Cl(e)}const n=Object.entries(t).reduce((r,[s,a])=>{if(s.match(Eb)){const c=s.slice(Xu.length);r[c]=a}return r},{});if(Object.keys(n).length>0)return n}function wa(e){if(!e)return;const t=Object.entries(e).reduce((n,[r,s])=>(s&&(n[`${Xu}${r}`]=s),n),{});return Lb(t)}function Cl(e){return e.split(",").map(t=>t.split("=").map(n=>decodeURIComponent(n.trim()))).reduce((t,[n,r])=>(t[n]=r,t),{})}function Lb(e){if(Object.keys(e).length!==0)return Object.entries(e).reduce((t,[n,r],s)=>{const a=`${encodeURIComponent(n)}=${encodeURIComponent(r)}`,c=s===0?a:`${t},${a}`;return c.length>xb?(Ci&&L.warn(`Not adding key: ${n} with val: ${r} to baggage header due to exceeding baggage size limits.`),t):c},"")}const Qb=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function Ka(e){if(!e)return;const t=e.match(Qb);if(!t)return;let n;return t[3]==="1"?n=!0:t[3]==="0"&&(n=!1),{traceId:t[1],parentSampled:n,parentSpanId:t[2]}}function jb(e,t){const n=Ka(e),r=Hu(t),{traceId:s,parentSpanId:a,parentSampled:c}=n||{};return n?{traceparentData:n,dynamicSamplingContext:r||{},propagationContext:{traceId:s||Re(),parentSpanId:a||Re().substring(16),spanId:Re().substring(16),sampled:c,dsc:r||{}}}:{traceparentData:n,dynamicSamplingContext:void 0,propagationContext:{traceId:s||Re(),spanId:Re().substring(16)}}}function Ob(e,t){const n=Ka(e),r=Hu(t),{traceId:s,parentSpanId:a,parentSampled:c}=n||{};return n?{traceId:s||Re(),parentSpanId:a||Re().substring(16),spanId:Re().substring(16),sampled:c,dsc:r||{}}:{traceId:s||Re(),spanId:Re().substring(16)}}function _a(e=Re(),t=Re().substring(16),n){let r="";return n!==void 0&&(r=n?"-1":"-0"),`${e}-${t}${r}`}function bi(e,t=[]){return[e,t]}function Mb(e,t){const[n,r]=e;return[n,[...r,t]]}function bl(e,t){const n=e[1];for(const r of n){const s=r[0].type;if(t(r,s))return!0}return!1}function ta(e,t){return(t||new TextEncoder).encode(e)}function Su(e,t){const[n,r]=e;let s=JSON.stringify(n);function a(c){typeof s=="string"?s=typeof c=="string"?s+c:[ta(s,t),c]:s.push(typeof c=="string"?ta(c,t):c)}for(const c of r){const[u,d]=c;if(a(`
${JSON.stringify(u)}
`),typeof d=="string"||d instanceof Uint8Array)a(d);else{let h;try{h=JSON.stringify(d)}catch{h=JSON.stringify(Kt(d))}a(h)}}return typeof s=="string"?s:Pb(s)}function Pb(e){const t=e.reduce((s,a)=>s+a.length,0),n=new Uint8Array(t);let r=0;for(const s of e)n.set(s,r),r+=s.length;return n}function Db(e,t){const n=typeof e.data=="string"?ta(e.data,t):e.data;return[Je({type:"attachment",length:n.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType}),n]}const $b={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket"};function pl(e){return $b[e]}function Nu(e){if(!e||!e.sdk)return;const{name:t,version:n}=e.sdk;return{name:t,version:n}}function qb(e,t,n,r){const s=e.sdkProcessingMetadata&&e.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:e.event_id,sent_at:new Date().toISOString(),...t&&{sdk:t},...!!n&&r&&{dsn:As(r)},...s&&{trace:Je({...s})}}}const ep=60*1e3;function tp(e,t=Date.now()){const n=parseInt(`${e}`,10);if(!isNaN(n))return n*1e3;const r=Date.parse(`${e}`);return isNaN(r)?ep:r-t}function np(e,t){return e[t]||e.all||0}function rp(e,t,n=Date.now()){return np(e,t)>n}function ip(e,{statusCode:t,headers:n},r=Date.now()){const s={...e},a=n&&n["x-sentry-rate-limits"],c=n&&n["retry-after"];if(a)for(const u of a.trim().split(",")){const[d,h,,,m]=u.split(":",5),y=parseInt(d,10),v=(isNaN(y)?60:y)*1e3;if(!h)s.all=r+v;else for(const _ of h.split(";"))_==="metric_bucket"?(!m||m.split(";").includes("custom"))&&(s[_]=r+v):s[_]=r+v}else c?s.all=r+tp(c,r):t===429&&(s.all=r+60*1e3);return s}function wu(e,t){return e(t.stack||"",1)}function Ku(e,t){const n={type:t.name||t.constructor.name,value:t.message},r=wu(e,t);return r.length&&(n.stacktrace={frames:r}),n}function sp(e){if("name"in e&&typeof e.name=="string"){let t=`'${e.name}' captured as exception`;return"message"in e&&typeof e.message=="string"&&(t+=` with message '${e.message}'`),t}else return"message"in e&&typeof e.message=="string"?e.message:`Object captured as exception with keys: ${ob(e)}`}function op(e,t,n,r){const s=typeof e=="function"?e().getClient():e;let a=n;const u=r&&r.data&&r.data.mechanism||{handled:!0,type:"generic"};let d;if(!Iu(n)){if(Tn(n)){const m=s&&s.getOptions().normalizeDepth;d={__serialized__:Au(n,m)};const y=sp(n);a=r&&r.syntheticException||new Error(y),a.message=y}else a=r&&r.syntheticException||new Error(n),a.message=n;u.synthetic=!0}const h={exception:{values:[Ku(t,a)]}};return d&&(h.extra=d),Cb(h,void 0,void 0),Bu(h,u),{...h,event_id:r&&r.event_id}}function ap(e,t,n="info",r,s){const a={event_id:r&&r.event_id,level:n};if(s&&r&&r.syntheticException){const c=wu(e,r.syntheticException);c.length&&(a.exception={values:[{value:t,stacktrace:{frames:c}}]})}if(Ya(t)){const{__sentry_template_string__:c,__sentry_template_values__:u}=t;return a.logentry={message:c,params:u},a}return a.message=t,a}class br{constructor(t){this._maxSize=t,this._cache=new Map}get size(){return this._cache.size}get(t){const n=this._cache.get(t);if(n!==void 0)return this._cache.delete(t),this._cache.set(t,n),n}set(t,n){this._cache.size>=this._maxSize&&this._cache.delete(this._cache.keys().next().value),this._cache.set(t,n)}remove(t){const n=this._cache.get(t);return n&&this._cache.delete(t),n}clear(){this._cache.clear()}keys(){return Array.from(this._cache.keys())}values(){const t=[];return this._cache.forEach(n=>t.push(n)),t}}function pr(e,t){return e??t()}function j(e){let t,n=e[0],r=1;for(;r<e.length;){const s=e[r],a=e[r+1];if(r+=2,(s==="optionalAccess"||s==="optionalCall")&&n==null)return;s==="access"||s==="optionalAccess"?(t=n,n=a(n)):(s==="call"||s==="optionalCall")&&(n=a((...c)=>n.call(t,...c)),t=void 0)}return n}function ml(e){const t=j(e);return t??!0}const ge=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Ws="production";function Fa(){return bu("globalEventProcessors",()=>[])}function _u(e){Fa().push(e)}function gs(e,t,n,r=0){return new pt((s,a)=>{const c=e[r];if(t===null||typeof c!="function")s(t);else{const u=c({...t},n);ge&&c.id&&u===null&&L.log(`Event processor "${c.id}" dropped event`),Bt(u)?u.then(d=>gs(e,d,n,r+1).then(s)).then(null,a):gs(e,u,n,r+1).then(s).then(null,a)}})}function Fu(e){const t=Pt(),n={sid:Re(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>cp(n)};return e&&En(n,e),n}function En(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),!e.did&&!t.did&&(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||Pt(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=t.sid.length===32?t.sid:Re()),t.init!==void 0&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),typeof t.started=="number"&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if(typeof t.duration=="number")e.duration=t.duration;else{const n=e.timestamp-e.started;e.duration=n>=0?n:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),typeof t.errors=="number"&&(e.errors=t.errors),t.status&&(e.status=t.status)}function ku(e,t){let n={};t?n={status:t}:e.status==="ok"&&(n={status:"exited"}),En(e,n)}function cp(e){return Je({sid:`${e.sid}`,init:e.init,started:new Date(e.started*1e3).toISOString(),timestamp:new Date(e.timestamp*1e3).toISOString(),status:e.status,errors:e.errors,did:typeof e.did=="number"||typeof e.did=="string"?`${e.did}`:void 0,duration:e.duration,abnormal_mechanism:e.abnormal_mechanism,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}})}const lp=0,Ju=1;function Vs(e){const{spanId:t,traceId:n}=e.spanContext(),{data:r,op:s,parent_span_id:a,status:c,tags:u,origin:d}=Oe(e);return Je({data:r,op:s,parent_span_id:a,span_id:t,status:c,tags:u,trace_id:n,origin:d})}function pi(e){const{traceId:t,spanId:n}=e.spanContext(),r=Ja(e);return _a(t,n,r)}function ka(e){return typeof e=="number"?fl(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?fl(e.getTime()):Pt()}function fl(e){return e>9999999999?e/1e3:e}function Oe(e){return gp(e)?e.getSpanJSON():typeof e.toJSON=="function"?e.toJSON():{}}function gp(e){return typeof e.getSpanJSON=="function"}function Ja(e){const{traceFlags:t}=e.spanContext();return!!(t&Ju)}function up(e,t,n,r,s,a){const{normalizeDepth:c=3,normalizeMaxBreadth:u=1e3}=e,d={...t,event_id:t.event_id||n.event_id||Re(),timestamp:t.timestamp||vs()},h=n.integrations||e.integrations.map(z=>z.name);dp(d,e),Cp(d,h),t.type===void 0&&Ip(d,e.stackParser);const m=pp(r,n.captureContext);n.mechanism&&Bu(d,n.mechanism);const y=s&&s.getEventProcessors?s.getEventProcessors():[],v=Ta().getScopeData();if(a){const z=a.getScopeData();us(v,z)}if(m){const z=m.getScopeData();us(v,z)}const _=[...n.attachments||[],...v.attachments];_.length&&(n.attachments=_),Eu(d,v);const F=[...y,...Fa(),...v.eventProcessors];return gs(F,d,n).then(z=>(z&&hp(z),typeof c=="number"&&c>0?bp(z,c,u):z))}function dp(e,t){const{environment:n,release:r,dist:s,maxValueLength:a=250}=t;"environment"in e||(e.environment="environment"in t?n:Ws),e.release===void 0&&r!==void 0&&(e.release=r),e.dist===void 0&&s!==void 0&&(e.dist=s),e.message&&(e.message=gr(e.message,a));const c=e.exception&&e.exception.values&&e.exception.values[0];c&&c.value&&(c.value=gr(c.value,a));const u=e.request;u&&u.url&&(u.url=gr(u.url,a))}const Zl=new WeakMap;function Ip(e,t){const n=ve._sentryDebugIds;if(!n)return;let r;const s=Zl.get(t);s?r=s:(r=new Map,Zl.set(t,r));const a=Object.keys(n).reduce((c,u)=>{let d;const h=r.get(u);h?d=h:(d=t(u),r.set(u,d));for(let m=d.length-1;m>=0;m--){const y=d[m];if(y.filename){c[y.filename]=n[u];break}}return c},{});try{e.exception.values.forEach(c=>{c.stacktrace.frames.forEach(u=>{u.filename&&(u.debug_id=a[u.filename])})})}catch{}}function hp(e){const t={};try{e.exception.values.forEach(r=>{r.stacktrace.frames.forEach(s=>{s.debug_id&&(s.abs_path?t[s.abs_path]=s.debug_id:s.filename&&(t[s.filename]=s.debug_id),delete s.debug_id)})})}catch{}if(Object.keys(t).length===0)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const n=e.debug_meta.images;Object.keys(t).forEach(r=>{n.push({type:"sourcemap",code_file:r,debug_id:t[r]})})}function Cp(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}function bp(e,t,n){if(!e)return null;const r={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map(s=>({...s,...s.data&&{data:Kt(s.data,t,n)}}))},...e.user&&{user:Kt(e.user,t,n)},...e.contexts&&{contexts:Kt(e.contexts,t,n)},...e.extra&&{extra:Kt(e.extra,t,n)}};return e.contexts&&e.contexts.trace&&r.contexts&&(r.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(r.contexts.trace.data=Kt(e.contexts.trace.data,t,n))),e.spans&&(r.spans=e.spans.map(s=>{const a=Oe(s).data;return a&&(s.data=Kt(a,t,n)),s})),r}function pp(e,t){if(!t)return e;const n=e?e.clone():new kt;return n.update(t),n}function mp(e){if(e)return fp(e)?{captureContext:e}:yp(e)?{captureContext:e}:e}function fp(e){return e instanceof kt||typeof e=="function"}const Zp=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function yp(e){return Object.keys(e).some(t=>Zp.includes(t))}function mn(e,t){return Ve().captureException(e,mp(t))}function Gp(e,t){const n=typeof t=="string"?t:void 0,r=typeof t!="string"?{captureContext:t}:void 0;return Ve().captureMessage(e,n,r)}function Bp(e,t){return Ve().captureEvent(e,t)}function Ap(e){Ve().configureScope(e)}function di(e,t){Ve().addBreadcrumb(e,t)}function vp(e,t){Ve().setContext(e,t)}function Wp(e){Ve().setExtras(e)}function Vp(e,t){Ve().setExtra(e,t)}function Rp(e){Ve().setTags(e)}function Yp(e,t){Ve().setTag(e,t)}function Xp(e){Ve().setUser(e)}function mi(...e){const t=Ve();if(e.length===2){const[n,r]=e;return n?t.withScope(()=>(t.getStackTop().scope=n,r(n))):t.withScope(r)}return t.withScope(e[0])}function Hp(e){return Br(()=>e(At()))}function Sp(e,t){return mi(n=>(n.setSpan(e),t(n)))}function za(e,t){return Ve().startTransaction({...e},t)}function na(e,t){const n=Se(),r=Ze();if(!r)ge&&L.warn("Cannot capture check-in. No client defined.");else if(!r.captureCheckIn)ge&&L.warn("Cannot capture check-in. Client does not support sending check-ins.");else return r.captureCheckIn(e,t,n);return Re()}function Ii(e,t,n){const r=na({monitorSlug:e,status:"in_progress"},n),s=Pt();function a(u){na({monitorSlug:e,status:u,checkInId:r,duration:Pt()-s})}let c;try{c=t()}catch(u){throw a("error"),u}return Bt(c)?Promise.resolve(c).then(()=>{a("ok")},()=>{a("error")}):a("ok"),c}async function zu(e){const t=Ze();return t?t.flush(e):(ge&&L.warn("Cannot flush events. No client defined."),Promise.resolve(!1))}async function Np(e){const t=Ze();return t?t.close(e):(ge&&L.warn("Cannot flush events and disable SDK. No client defined."),Promise.resolve(!1))}function wp(){return Ve().lastEventId()}function Ze(){return Ve().getClient()}function Kp(){return!!Ze()}function Se(){return Ve().getScope()}function Tu(e){const t=Ze(),n=At(),r=Se(),{release:s,environment:a=Ws}=t&&t.getOptions()||{},{userAgent:c}=ve.navigator||{},u=Fu({release:s,environment:a,user:r.getUser()||n.getUser(),...c&&{userAgent:c},...e}),d=n.getSession();return d&&d.status==="ok"&&En(d,{status:"exited"}),Rs(),n.setSession(u),r.setSession(u),u}function Rs(){const e=At(),t=Se(),n=t.getSession()||e.getSession();n&&ku(n),Uu(),e.setSession(),t.setSession()}function Uu(){const e=At(),t=Se(),n=Ze(),r=t.getSession()||e.getSession();r&&n&&n.captureSession&&n.captureSession(r)}function _p(e=!1){if(e){Rs();return}Uu()}function hi(e){return e.transaction}function fi(e,t,n){const r=t.getOptions(),{publicKey:s}=t.getDsn()||{},{segment:a}=n&&n.getUser()||{},c=Je({environment:r.environment||Ws,release:r.release,user_segment:a,public_key:s,trace_id:e});return t.emit&&t.emit("createDsc",c),c}function Bn(e){const t=Ze();if(!t)return{};const n=fi(Oe(e).trace_id||"",t,Se()),r=hi(e);if(!r)return n;const s=r&&r._frozenDynamicSamplingContext;if(s)return s;const{sampleRate:a,source:c}=r.metadata;a!=null&&(n.sample_rate=`${a}`);const u=Oe(r);return c&&c!=="url"&&(n.transaction=u.description),n.sampled=String(Ja(r)),t.emit&&t.emit("createDsc",n),n}function Eu(e,t){const{fingerprint:n,span:r,breadcrumbs:s,sdkProcessingMetadata:a}=t;Fp(e,t),r&&zp(e,r),Tp(e,n),kp(e,s),Jp(e,a)}function us(e,t){const{extra:n,tags:r,user:s,contexts:a,level:c,sdkProcessingMetadata:u,breadcrumbs:d,fingerprint:h,eventProcessors:m,attachments:y,propagationContext:v,transactionName:_,span:F}=t;qr(e,"extra",n),qr(e,"tags",r),qr(e,"user",s),qr(e,"contexts",a),qr(e,"sdkProcessingMetadata",u),c&&(e.level=c),_&&(e.transactionName=_),F&&(e.span=F),d.length&&(e.breadcrumbs=[...e.breadcrumbs,...d]),h.length&&(e.fingerprint=[...e.fingerprint,...h]),m.length&&(e.eventProcessors=[...e.eventProcessors,...m]),y.length&&(e.attachments=[...e.attachments,...y]),e.propagationContext={...e.propagationContext,...v}}function qr(e,t,n){if(n&&Object.keys(n).length){e[t]={...e[t]};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[t][r]=n[r])}}function Fp(e,t){const{extra:n,tags:r,user:s,contexts:a,level:c,transactionName:u}=t,d=Je(n);d&&Object.keys(d).length&&(e.extra={...d,...e.extra});const h=Je(r);h&&Object.keys(h).length&&(e.tags={...h,...e.tags});const m=Je(s);m&&Object.keys(m).length&&(e.user={...m,...e.user});const y=Je(a);y&&Object.keys(y).length&&(e.contexts={...y,...e.contexts}),c&&(e.level=c),u&&(e.transaction=u)}function kp(e,t){const n=[...e.breadcrumbs||[],...t];e.breadcrumbs=n.length?n:void 0}function Jp(e,t){e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...t}}function zp(e,t){e.contexts={trace:Vs(t),...e.contexts};const n=hi(t);if(n){e.sdkProcessingMetadata={dynamicSamplingContext:Bn(t),...e.sdkProcessingMetadata};const r=Oe(n).description;r&&(e.tags={transaction:r,...e.tags})}}function Tp(e,t){e.fingerprint=e.fingerprint?as(e.fingerprint):[],t&&(e.fingerprint=e.fingerprint.concat(t)),e.fingerprint&&!e.fingerprint.length&&delete e.fingerprint}const Up=100;let Fo;class kt{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=yl()}static clone(t){return t?t.clone():new kt}clone(){const t=new kt;return t._breadcrumbs=[...this._breadcrumbs],t._tags={...this._tags},t._extra={...this._extra},t._contexts={...this._contexts},t._user=this._user,t._level=this._level,t._span=this._span,t._session=this._session,t._transactionName=this._transactionName,t._fingerprint=this._fingerprint,t._eventProcessors=[...this._eventProcessors],t._requestSession=this._requestSession,t._attachments=[...this._attachments],t._sdkProcessingMetadata={...this._sdkProcessingMetadata},t._propagationContext={...this._propagationContext},t._client=this._client,t}setClient(t){this._client=t}getClient(){return this._client}addScopeListener(t){this._scopeListeners.push(t)}addEventProcessor(t){return this._eventProcessors.push(t),this}setUser(t){return this._user=t||{email:void 0,id:void 0,ip_address:void 0,segment:void 0,username:void 0},this._session&&En(this._session,{user:t}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(t){return this._requestSession=t,this}setTags(t){return this._tags={...this._tags,...t},this._notifyScopeListeners(),this}setTag(t,n){return this._tags={...this._tags,[t]:n},this._notifyScopeListeners(),this}setExtras(t){return this._extra={...this._extra,...t},this._notifyScopeListeners(),this}setExtra(t,n){return this._extra={...this._extra,[t]:n},this._notifyScopeListeners(),this}setFingerprint(t){return this._fingerprint=t,this._notifyScopeListeners(),this}setLevel(t){return this._level=t,this._notifyScopeListeners(),this}setTransactionName(t){return this._transactionName=t,this._notifyScopeListeners(),this}setContext(t,n){return n===null?delete this._contexts[t]:this._contexts[t]=n,this._notifyScopeListeners(),this}setSpan(t){return this._span=t,this._notifyScopeListeners(),this}getSpan(){return this._span}getTransaction(){const t=this._span;return t&&t.transaction}setSession(t){return t?this._session=t:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(t){if(!t)return this;const n=typeof t=="function"?t(this):t;if(n instanceof kt){const r=n.getScopeData();this._tags={...this._tags,...r.tags},this._extra={...this._extra,...r.extra},this._contexts={...this._contexts,...r.contexts},r.user&&Object.keys(r.user).length&&(this._user=r.user),r.level&&(this._level=r.level),r.fingerprint.length&&(this._fingerprint=r.fingerprint),n.getRequestSession()&&(this._requestSession=n.getRequestSession()),r.propagationContext&&(this._propagationContext=r.propagationContext)}else if(Tn(n)){const r=t;this._tags={...this._tags,...r.tags},this._extra={...this._extra,...r.extra},this._contexts={...this._contexts,...r.contexts},r.user&&(this._user=r.user),r.level&&(this._level=r.level),r.fingerprint&&(this._fingerprint=r.fingerprint),r.requestSession&&(this._requestSession=r.requestSession),r.propagationContext&&(this._propagationContext=r.propagationContext)}return this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this._attachments=[],this._propagationContext=yl(),this}addBreadcrumb(t,n){const r=typeof n=="number"?n:Up;if(r<=0)return this;const s={timestamp:vs(),...t},a=this._breadcrumbs;return a.push(s),this._breadcrumbs=a.length>r?a.slice(-r):a,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(t){return this._attachments.push(t),this}getAttachments(){return this.getScopeData().attachments}clearAttachments(){return this._attachments=[],this}getScopeData(){const{_breadcrumbs:t,_attachments:n,_contexts:r,_tags:s,_extra:a,_user:c,_level:u,_fingerprint:d,_eventProcessors:h,_propagationContext:m,_sdkProcessingMetadata:y,_transactionName:v,_span:_}=this;return{breadcrumbs:t,attachments:n,contexts:r,tags:s,extra:a,user:c,level:u,fingerprint:d||[],eventProcessors:h,propagationContext:m,sdkProcessingMetadata:y,transactionName:v,span:_}}applyToEvent(t,n={},r=[]){Eu(t,this.getScopeData());const s=[...r,...Fa(),...this._eventProcessors];return gs(s,t,n)}setSDKProcessingMetadata(t){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...t},this}setPropagationContext(t){return this._propagationContext=t,this}getPropagationContext(){return this._propagationContext}captureException(t,n){const r=n&&n.event_id?n.event_id:Re();if(!this._client)return L.warn("No client configured on scope - will not capture exception!"),r;const s=new Error("Sentry syntheticException");return this._client.captureException(t,{originalException:t,syntheticException:s,...n,event_id:r},this),r}captureMessage(t,n,r){const s=r&&r.event_id?r.event_id:Re();if(!this._client)return L.warn("No client configured on scope - will not capture message!"),s;const a=new Error(t);return this._client.captureMessage(t,n,{originalException:t,syntheticException:a,...r,event_id:s},this),s}captureEvent(t,n){const r=n&&n.event_id?n.event_id:Re();return this._client?(this._client.captureEvent(t,{...n,event_id:r},this),r):(L.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(t=>{t(this)}),this._notifyingListeners=!1)}}function Ta(){return Fo||(Fo=new kt),Fo}function yl(){return{traceId:Re(),spanId:Re().substring(16)}}const mr="7.110.0",Ua=parseFloat(mr),Ep=100;class Ys{constructor(t,n,r,s=Ua){this._version=s;let a;n?a=n:(a=new kt,a.setClient(t));let c;r?c=r:(c=new kt,c.setClient(t)),this._stack=[{scope:a}],t&&this.bindClient(t),this._isolationScope=c}isOlderThan(t){return this._version<t}bindClient(t){const n=this.getStackTop();n.client=t,n.scope.setClient(t),t&&t.setupIntegrations&&t.setupIntegrations()}pushScope(){const t=this.getScope().clone();return this.getStack().push({client:this.getClient(),scope:t}),t}popScope(){return this.getStack().length<=1?!1:!!this.getStack().pop()}withScope(t){const n=this.pushScope();let r;try{r=t(n)}catch(s){throw this.popScope(),s}return Bt(r)?r.then(s=>(this.popScope(),s),s=>{throw this.popScope(),s}):(this.popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStack(){return this._stack}getStackTop(){return this._stack[this._stack.length-1]}captureException(t,n){const r=this._lastEventId=n&&n.event_id?n.event_id:Re(),s=new Error("Sentry syntheticException");return this.getScope().captureException(t,{originalException:t,syntheticException:s,...n,event_id:r}),r}captureMessage(t,n,r){const s=this._lastEventId=r&&r.event_id?r.event_id:Re(),a=new Error(t);return this.getScope().captureMessage(t,n,{originalException:t,syntheticException:a,...r,event_id:s}),s}captureEvent(t,n){const r=n&&n.event_id?n.event_id:Re();return t.type||(this._lastEventId=r),this.getScope().captureEvent(t,{...n,event_id:r}),r}lastEventId(){return this._lastEventId}addBreadcrumb(t,n){const{scope:r,client:s}=this.getStackTop();if(!s)return;const{beforeBreadcrumb:a=null,maxBreadcrumbs:c=Ep}=s.getOptions&&s.getOptions()||{};if(c<=0)return;const d={timestamp:vs(),...t},h=a?Gn(()=>a(d,n)):d;h!==null&&(s.emit&&s.emit("beforeAddBreadcrumb",h,n),r.addBreadcrumb(h,c))}setUser(t){this.getScope().setUser(t),this.getIsolationScope().setUser(t)}setTags(t){this.getScope().setTags(t),this.getIsolationScope().setTags(t)}setExtras(t){this.getScope().setExtras(t),this.getIsolationScope().setExtras(t)}setTag(t,n){this.getScope().setTag(t,n),this.getIsolationScope().setTag(t,n)}setExtra(t,n){this.getScope().setExtra(t,n),this.getIsolationScope().setExtra(t,n)}setContext(t,n){this.getScope().setContext(t,n),this.getIsolationScope().setContext(t,n)}configureScope(t){const{scope:n,client:r}=this.getStackTop();r&&t(n)}run(t){const n=ra(this);try{t(this)}finally{ra(n)}}getIntegration(t){const n=this.getClient();if(!n)return null;try{return n.getIntegration(t)}catch{return ge&&L.warn(`Cannot retrieve integration ${t.id} from the current Hub`),null}}startTransaction(t,n){const r=this._callExtensionMethod("startTransaction",t,n);return ge&&!r&&(this.getClient()?L.warn(`Tracing extension 'startTransaction' has not been added. Call 'addTracingExtensions' before calling 'init':
Sentry.addTracingExtensions();
Sentry.init({...});
`):L.warn("Tracing extension 'startTransaction' is missing. You should 'init' the SDK before calling 'startTransaction'")),r}traceHeaders(){return this._callExtensionMethod("traceHeaders")}captureSession(t=!1){if(t)return this.endSession();this._sendSessionUpdate()}endSession(){const n=this.getStackTop().scope,r=n.getSession();r&&ku(r),this._sendSessionUpdate(),n.setSession()}startSession(t){const{scope:n,client:r}=this.getStackTop(),{release:s,environment:a=Ws}=r&&r.getOptions()||{},{userAgent:c}=ve.navigator||{},u=Fu({release:s,environment:a,user:n.getUser(),...c&&{userAgent:c},...t}),d=n.getSession&&n.getSession();return d&&d.status==="ok"&&En(d,{status:"exited"}),this.endSession(),n.setSession(u),u}shouldSendDefaultPii(){const t=this.getClient(),n=t&&t.getOptions();return!!(n&&n.sendDefaultPii)}_sendSessionUpdate(){const{scope:t,client:n}=this.getStackTop(),r=t.getSession();r&&n&&n.captureSession&&n.captureSession(r)}_callExtensionMethod(t,...n){const s=vn().__SENTRY__;if(s&&s.extensions&&typeof s.extensions[t]=="function")return s.extensions[t].apply(this,n);ge&&L.warn(`Extension method ${t} couldn't be found, doing nothing.`)}}function vn(){return ve.__SENTRY__=ve.__SENTRY__||{extensions:{},hub:void 0},ve}function ra(e){const t=vn(),n=Dt(t);return Xs(t,e),n}function Ve(){const e=vn();if(e.__SENTRY__&&e.__SENTRY__.acs){const t=e.__SENTRY__.acs.getCurrentHub();if(t)return t}return xu(e)}function At(){return Ve().getIsolationScope()}function xu(e=vn()){return(!Qu(e)||Dt(e).isOlderThan(Ua))&&Xs(e,new Ys),Dt(e)}function Ea(e,t=xu()){if(!Qu(e)||Dt(e).isOlderThan(Ua)){const n=t.getClient(),r=t.getScope(),s=t.getIsolationScope();Xs(e,new Ys(n,r.clone(),s.clone()))}}function Lu(e){const t=vn();t.__SENTRY__=t.__SENTRY__||{},t.__SENTRY__.acs=e}function Br(e,t={}){const n=vn();return n.__SENTRY__&&n.__SENTRY__.acs?n.__SENTRY__.acs.runWithAsyncContext(e,t):e()}function Qu(e){return!!(e&&e.__SENTRY__&&e.__SENTRY__.hub)}function Dt(e){return bu("hub",()=>new Ys,e)}function Xs(e,t){if(!e)return!1;const n=e.__SENTRY__=e.__SENTRY__||{};return n.hub=t,!0}function fr(e){return(e||Ve()).getScope().getTransaction()}const xp=Ka;let Gl=!1;function Lp(){Gl||(Gl=!0,fb(ia),yb(ia))}function ia(){const e=fr();if(e){const t="internal_error";ge&&L.log(`[Tracing] Transaction: ${t} -> Global error occured`),e.setStatus(t)}}ia.tag="sentry_tracingErrorCallback";var Bl;(function(e){const t="ok";e.Ok=t;const n="deadline_exceeded";e.DeadlineExceeded=n;const r="unauthenticated";e.Unauthenticated=r;const s="permission_denied";e.PermissionDenied=s;const a="not_found";e.NotFound=a;const c="resource_exhausted";e.ResourceExhausted=c;const u="invalid_argument";e.InvalidArgument=u;const d="unimplemented";e.Unimplemented=d;const h="unavailable";e.Unavailable=h;const m="internal_error";e.InternalError=m;const y="unknown_error";e.UnknownError=y;const v="cancelled";e.Cancelled=v;const _="already_exists";e.AlreadyExists=_;const F="failed_precondition";e.FailedPrecondition=F;const Q="aborted";e.Aborted=Q;const z="out_of_range";e.OutOfRange=z;const te="data_loss";e.DataLoss=te})(Bl||(Bl={}));function xa(e){if(e<400&&e>=100)return"ok";if(e>=400&&e<500)switch(e){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(e>=500&&e<600)switch(e){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}const Qp=xa;function xn(e,t){e.setTag("http.status_code",String(t)),e.setData("http.response.status_code",t);const n=xa(t);n!=="unknown_error"&&e.setStatus(n)}function La(e,t,n=()=>{}){let r;try{r=e()}catch(s){throw t(s),n(),s}return jp(r,t,n)}function jp(e,t,n){return Bt(e)?e.then(r=>(n(),r),r=>{throw t(r),n(),r}):(n(),e)}function Ar(e){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const t=Ze(),n=e||t&&t.getOptions();return!!n&&(n.enableTracing||"tracesSampleRate"in n||"tracesSampler"in n)}function Op(e,t,n=()=>{},r=()=>{}){const s=Ve(),a=Se(),c=a.getSpan(),u=Ss(e),d=Hs(s,{parentSpan:c,spanContext:u,forceTransaction:!1,scope:a});return a.setSpan(d),La(()=>t(d),h=>{d&&d.setStatus("internal_error"),n(h,d)},()=>{d&&d.end(),a.setSpan(c),r()})}function Qa(e,t){const n=Ss(e);return Br(()=>mi(e.scope,r=>{const s=Ve(),a=r.getSpan(),u=e.onlyIfParent&&!a?void 0:Hs(s,{parentSpan:a,spanContext:n,forceTransaction:e.forceTransaction,scope:r});return La(()=>t(u),()=>{if(u){const{status:d}=Oe(u);(!d||d==="ok")&&u.setStatus("internal_error")}},()=>u&&u.end())}))}const Mp=Qa;function Pp(e,t){const n=Ss(e);return Br(()=>mi(e.scope,r=>{const s=Ve(),a=r.getSpan(),u=e.onlyIfParent&&!a?void 0:Hs(s,{parentSpan:a,spanContext:n,forceTransaction:e.forceTransaction,scope:r});function d(){u&&u.end()}return La(()=>t(u,d),()=>{if(u&&u.isRecording()){const{status:h}=Oe(u);(!h||h==="ok")&&u.setStatus("internal_error")}})}))}function Dp(e){if(!Ar())return;const t=Ss(e),n=Ve(),r=e.scope?e.scope.getSpan():vr();if(e.onlyIfParent&&!r)return;const c=(e.scope||Se()).clone();return Hs(n,{parentSpan:r,spanContext:t,forceTransaction:e.forceTransaction,scope:c})}function vr(){return Se().getSpan()}const ja=({sentryTrace:e,baggage:t},n)=>{const r=Se(),{traceparentData:s,dynamicSamplingContext:a,propagationContext:c}=jb(e,t);r.setPropagationContext(c),ge&&s&&L.log(`[Tracing] Continuing trace ${s.traceId}.`);const u={...s,metadata:Je({dynamicSamplingContext:a})};return n?Br(()=>n(u)):u};function Hs(e,{parentSpan:t,spanContext:n,forceTransaction:r,scope:s}){if(!Ar())return;const a=At();let c;if(t&&!r)c=t.startChild(n);else if(t){const u=Bn(t),{traceId:d,spanId:h}=t.spanContext(),m=Ja(t);c=e.startTransaction({traceId:d,parentSpanId:h,parentSampled:m,...n,metadata:{dynamicSamplingContext:u,...n.metadata}})}else{const{traceId:u,dsc:d,parentSpanId:h,sampled:m}={...a.getPropagationContext(),...s.getPropagationContext()};c=e.startTransaction({traceId:u,parentSpanId:h,parentSampled:m,...n,metadata:{dynamicSamplingContext:d,...n.metadata}})}return s.setSpan(c),$p(c,s,a),c}function Ss(e){if(e.startTime){const t={...e};return t.startTimestamp=ka(e.startTime),delete t.startTime,t}return e}const ju="_sentryScope",Ou="_sentryIsolationScope";function $p(e,t,n){e&&(gi(e,Ou,n),gi(e,ju,t))}function qp(e){return{scope:e[ju],isolationScope:e[Ou]}}let oi;function Mu(e){return oi?oi.get(e):void 0}function Pu(e){const t=Mu(e);if(!t)return;const n={};for(const[,[r,s]]of t)n[r]||(n[r]=[]),n[r].push(Je(s));return n}function Du(e,t,n,r,s,a){const c=vr();if(c){const u=Mu(c)||new Map,d=`${e}:${t}@${r}`,h=u.get(a);if(h){const[,m]=h;u.set(a,[d,{min:Math.min(m.min,n),max:Math.max(m.max,n),count:m.count+=1,sum:m.sum+=n,tags:m.tags}])}else u.set(a,[d,{min:n,max:n,count:1,sum:n,tags:s}]);oi||(oi=new WeakMap),oi.set(c,u)}}const fn="sentry.source",Jn="sentry.sample_rate",ii="sentry.op",cr="sentry.origin",em="profile_id";class tm{constructor(t=1e3){this._maxlen=t,this.spans=[]}add(t){this.spans.length>this._maxlen?t.spanRecorder=void 0:this.spans.push(t)}}class Oa{constructor(t={}){this._traceId=t.traceId||Re(),this._spanId=t.spanId||Re().substring(16),this._startTime=t.startTimestamp||Pt(),this.tags=t.tags?{...t.tags}:{},this.data=t.data?{...t.data}:{},this.instrumenter=t.instrumenter||"sentry",this._attributes={},this.setAttributes({[cr]:t.origin||"manual",[ii]:t.op,...t.attributes}),this._name=t.name||t.description,t.parentSpanId&&(this._parentSpanId=t.parentSpanId),"sampled"in t&&(this._sampled=t.sampled),t.status&&(this._status=t.status),t.endTimestamp&&(this._endTime=t.endTimestamp),t.exclusiveTime!==void 0&&(this._exclusiveTime=t.exclusiveTime),this._measurements=t.measurements?{...t.measurements}:{}}get name(){return this._name||""}set name(t){this.updateName(t)}get description(){return this._name}set description(t){this._name=t}get traceId(){return this._traceId}set traceId(t){this._traceId=t}get spanId(){return this._spanId}set spanId(t){this._spanId=t}set parentSpanId(t){this._parentSpanId=t}get parentSpanId(){return this._parentSpanId}get sampled(){return this._sampled}set sampled(t){this._sampled=t}get attributes(){return this._attributes}set attributes(t){this._attributes=t}get startTimestamp(){return this._startTime}set startTimestamp(t){this._startTime=t}get endTimestamp(){return this._endTime}set endTimestamp(t){this._endTime=t}get status(){return this._status}set status(t){this._status=t}get op(){return this._attributes[ii]}set op(t){this.setAttribute(ii,t)}get origin(){return this._attributes[cr]}set origin(t){this.setAttribute(cr,t)}spanContext(){const{_spanId:t,_traceId:n,_sampled:r}=this;return{spanId:t,traceId:n,traceFlags:r?Ju:lp}}startChild(t){const n=new Oa({...t,parentSpanId:this._spanId,sampled:this._sampled,traceId:this._traceId});n.spanRecorder=this.spanRecorder,n.spanRecorder&&n.spanRecorder.add(n);const r=hi(this);if(n.transaction=r,ge&&r){const s=t&&t.op||"< unknown op >",a=Oe(n).description||"< unknown name >",c=r.spanContext().spanId,u=`[Tracing] Starting '${s}' span on transaction '${a}' (${c}).`;L.log(u),this._logMessage=u}return n}setTag(t,n){return this.tags={...this.tags,[t]:n},this}setData(t,n){return this.data={...this.data,[t]:n},this}setAttribute(t,n){n===void 0?delete this._attributes[t]:this._attributes[t]=n}setAttributes(t){Object.keys(t).forEach(n=>this.setAttribute(n,t[n]))}setStatus(t){return this._status=t,this}setHttpStatus(t){return xn(this,t),this}setName(t){this.updateName(t)}updateName(t){return this._name=t,this}isSuccess(){return this._status==="ok"}finish(t){return this.end(t)}end(t){if(this._endTime)return;const n=hi(this);if(ge&&n&&n.spanContext().spanId!==this._spanId){const r=this._logMessage;r&&L.log(r.replace("Starting","Finishing"))}this._endTime=ka(t)}toTraceparent(){return pi(this)}toContext(){return Je({data:this._getData(),description:this._name,endTimestamp:this._endTime,op:this.op,parentSpanId:this._parentSpanId,sampled:this._sampled,spanId:this._spanId,startTimestamp:this._startTime,status:this._status,tags:this.tags,traceId:this._traceId})}updateWithContext(t){return this.data=t.data||{},this._name=t.name||t.description,this._endTime=t.endTimestamp,this.op=t.op,this._parentSpanId=t.parentSpanId,this._sampled=t.sampled,this._spanId=t.spanId||this._spanId,this._startTime=t.startTimestamp||this._startTime,this._status=t.status,this.tags=t.tags||{},this._traceId=t.traceId||this._traceId,this}getTraceContext(){return Vs(this)}getSpanJSON(){return Je({data:this._getData(),description:this._name,op:this._attributes[ii],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:this._status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[cr],_metrics_summary:Pu(this),profile_id:this._attributes[em],exclusive_time:this._exclusiveTime,measurements:Object.keys(this._measurements).length>0?this._measurements:void 0})}isRecording(){return!this._endTime&&!!this._sampled}toJSON(){return this.getSpanJSON()}_getData(){const{data:t,_attributes:n}=this,r=Object.keys(t).length>0,s=Object.keys(n).length>0;if(!(!r&&!s))return r&&s?{...t,...n}:r?t:n}}class nm extends Oa{constructor(t,n){super(t),this._contexts={},this._hub=n||Ve(),this._name=t.name||"",this._metadata={...t.metadata},this._trimEnd=t.trimEnd,this.transaction=this;const r=this._metadata.dynamicSamplingContext;r&&(this._frozenDynamicSamplingContext={...r})}get name(){return this._name}set name(t){this.setName(t)}get metadata(){return{source:"custom",spanMetadata:{},...this._metadata,...this._attributes[fn]&&{source:this._attributes[fn]},...this._attributes[Jn]&&{sampleRate:this._attributes[Jn]}}}set metadata(t){this._metadata=t}setName(t,n="custom"){this._name=t,this.setAttribute(fn,n)}updateName(t){return this._name=t,this}initSpanRecorder(t=1e3){this.spanRecorder||(this.spanRecorder=new tm(t)),this.spanRecorder.add(this)}setContext(t,n){n===null?delete this._contexts[t]:this._contexts[t]=n}setMeasurement(t,n,r=""){this._measurements[t]={value:n,unit:r}}setMetadata(t){this._metadata={...this._metadata,...t}}end(t){const n=ka(t),r=this._finishTransaction(n);if(r)return this._hub.captureEvent(r)}toContext(){const t=super.toContext();return Je({...t,name:this._name,trimEnd:this._trimEnd})}updateWithContext(t){return super.updateWithContext(t),this._name=t.name||"",this._trimEnd=t.trimEnd,this}getDynamicSamplingContext(){return Bn(this)}setHub(t){this._hub=t}getProfileId(){if(this._contexts!==void 0&&this._contexts.profile!==void 0)return this._contexts.profile.profile_id}_finishTransaction(t){if(this._endTime!==void 0)return;this._name||(ge&&L.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>"),super.end(t);const n=this._hub.getClient();if(n&&n.emit&&n.emit("finishTransaction",this),this._sampled!==!0){ge&&L.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),n&&n.recordDroppedEvent("sample_rate","transaction");return}const r=this.spanRecorder?this.spanRecorder.spans.filter(m=>m!==this&&Oe(m).timestamp):[];if(this._trimEnd&&r.length>0){const m=r.map(y=>Oe(y).timestamp).filter(Boolean);this._endTime=m.reduce((y,v)=>y>v?y:v)}const{scope:s,isolationScope:a}=qp(this),{metadata:c}=this,{source:u}=c,d={contexts:{...this._contexts,trace:Vs(this)},spans:r,start_timestamp:this._startTime,tags:this.tags,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{...c,capturedSpanScope:s,capturedSpanIsolationScope:a,...Je({dynamicSamplingContext:Bn(this)})},_metrics_summary:Pu(this),...u&&{transaction_info:{source:u}}};return Object.keys(this._measurements).length>0&&(ge&&L.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),d.measurements=this._measurements),ge&&L.log(`[Tracing] Finishing ${this.op} transaction: ${this._name}.`),d}}function rm(e,t,n){if(!Ar(t))return e.sampled=!1,e;if(e.sampled!==void 0)return e.setAttribute(Jn,Number(e.sampled)),e;let r;return typeof t.tracesSampler=="function"?(r=t.tracesSampler(n),e.setAttribute(Jn,Number(r))):n.parentSampled!==void 0?r=n.parentSampled:typeof t.tracesSampleRate<"u"?(r=t.tracesSampleRate,e.setAttribute(Jn,Number(r))):(r=1,e.setAttribute(Jn,r)),im(r)?r?(e.sampled=Math.random()<r,e.sampled?(ge&&L.log(`[Tracing] starting ${e.op} transaction - ${Oe(e).description}`),e):(ge&&L.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(r)})`),e)):(ge&&L.log(`[Tracing] Discarding transaction because ${typeof t.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),e.sampled=!1,e):(ge&&L.warn("[Tracing] Discarding transaction because of invalid sample rate."),e.sampled=!1,e)}function im(e){return Cu(e)||!(typeof e=="number"||typeof e=="boolean")?(ge&&L.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(e)} of type ${JSON.stringify(typeof e)}.`),!1):e<0||e>1?(ge&&L.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${e}.`),!1):!0}function sm(){const t=this.getScope().getSpan();return t?{"sentry-trace":pi(t)}:{}}function om(e,t){const n=this.getClient(),r=n&&n.getOptions()||{},s=r.instrumenter||"sentry",a=e.instrumenter||"sentry";s!==a&&(ge&&L.error(`A transaction was started with instrumenter=\`${a}\`, but the SDK is configured with the \`${s}\` instrumenter.
The transaction will not be sampled. Please use the ${s} instrumentation to start transactions.`),e.sampled=!1);let c=new nm(e,this);return c=rm(c,r,{name:e.name,parentSampled:e.parentSampled,transactionContext:e,attributes:{...e.data,...e.attributes},...t}),c.isRecording()&&c.initSpanRecorder(r._experiments&&r._experiments.maxSpans),n&&n.emit&&n.emit("startTransaction",c),c}function am(){const e=vn();e.__SENTRY__&&(e.__SENTRY__.extensions=e.__SENTRY__.extensions||{},e.__SENTRY__.extensions.startTransaction||(e.__SENTRY__.extensions.startTransaction=om),e.__SENTRY__.extensions.traceHeaders||(e.__SENTRY__.extensions.traceHeaders=sm),Lp())}function cm(e,t,n){const r=fr();r&&r.setMeasurement(e,t,n)}function lm(e,t){return t&&(e.sdk=e.sdk||{},e.sdk.name=e.sdk.name||t.name,e.sdk.version=e.sdk.version||t.version,e.sdk.integrations=[...e.sdk.integrations||[],...t.integrations||[]],e.sdk.packages=[...e.sdk.packages||[],...t.packages||[]]),e}function gm(e,t,n,r){const s=Nu(n),a={sent_at:new Date().toISOString(),...s&&{sdk:s},...!!r&&t&&{dsn:As(t)}},c="aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()];return bi(a,[c])}function um(e,t,n,r){const s=Nu(n),a=e.type&&e.type!=="replay_event"?e.type:"event";lm(e,n&&n.sdk);const c=qb(e,s,r,t);return delete e.sdkProcessingMetadata,bi(c,[[{type:a},e]])}class dm{constructor(t,n){this._client=t,this.flushTimeout=60,this._pendingAggregates={},this._isEnabled=!0,this._intervalId=setInterval(()=>this.flush(),this.flushTimeout*1e3),this._intervalId.unref&&this._intervalId.unref(),this._sessionAttrs=n}flush(){const t=this.getSessionAggregates();t.aggregates.length!==0&&(this._pendingAggregates={},this._client.sendSession(t))}getSessionAggregates(){const t=Object.keys(this._pendingAggregates).map(r=>this._pendingAggregates[parseInt(r)]),n={attrs:this._sessionAttrs,aggregates:t};return Je(n)}close(){clearInterval(this._intervalId),this._isEnabled=!1,this.flush()}incrementSessionStatusCount(){if(!this._isEnabled)return;const t=Se(),n=t.getRequestSession();n&&n.status&&(this._incrementSessionStatusCount(n.status,new Date),t.setRequestSession(void 0))}_incrementSessionStatusCount(t,n){const r=new Date(n).setSeconds(0,0);this._pendingAggregates[r]=this._pendingAggregates[r]||{};const s=this._pendingAggregates[r];switch(s.started||(s.started=new Date(r).toISOString()),t){case"errored":return s.errored=(s.errored||0)+1,s.errored;case"ok":return s.exited=(s.exited||0)+1,s.exited;default:return s.crashed=(s.crashed||0)+1,s.crashed}}}const Im="7";function hm(e){const t=e.protocol?`${e.protocol}:`:"",n=e.port?`:${e.port}`:"";return`${t}//${e.host}${n}${e.path?`/${e.path}`:""}/api/`}function Cm(e){return`${hm(e)}${e.projectId}/envelope/`}function bm(e,t){return sb({sentry_key:e.publicKey,sentry_version:Im,...t&&{sentry_client:`${t.name}/${t.version}`}})}function pm(e,t={}){const n=typeof t=="string"?t:t.tunnel,r=typeof t=="string"||!t._metadata?void 0:t._metadata.sdk;return n||`${Cm(e)}?${bm(e,r)}`}const Al=[];function mm(e){const t={};return e.forEach(n=>{const{name:r}=n,s=t[r];s&&!s.isDefaultInstance&&n.isDefaultInstance||(t[r]=n)}),Object.keys(t).map(n=>t[n])}function fm(e){const t=e.defaultIntegrations||[],n=e.integrations;t.forEach(c=>{c.isDefaultInstance=!0});let r;Array.isArray(n)?r=[...t,...n]:typeof n=="function"?r=as(n(t)):r=t;const s=mm(r),a=Gm(s,c=>c.name==="Debug");if(a!==-1){const[c]=s.splice(a,1);s.push(c)}return s}function Zm(e,t){const n={};return t.forEach(r=>{r&&$u(e,r,n)}),n}function vl(e,t){for(const n of t)n&&n.afterAllSetup&&n.afterAllSetup(e)}function $u(e,t,n){if(n[t.name]){ge&&L.log(`Integration skipped because it was already installed: ${t.name}`);return}if(n[t.name]=t,Al.indexOf(t.name)===-1&&(t.setupOnce(_u,Ve),Al.push(t.name)),t.setup&&typeof t.setup=="function"&&t.setup(e),e.on&&typeof t.preprocessEvent=="function"){const r=t.preprocessEvent.bind(t);e.on("preprocessEvent",(s,a)=>r(s,a,e))}if(e.addEventProcessor&&typeof t.processEvent=="function"){const r=t.processEvent.bind(t),s=Object.assign((a,c)=>r(a,c,e),{id:t.name});e.addEventProcessor(s)}ge&&L.log(`Integration installed: ${t.name}`)}function ym(e){const t=Ze();if(!t||!t.addIntegration){ge&&L.warn(`Cannot add integration "${e.name}" because no SDK Client is available.`);return}t.addIntegration(e)}function Gm(e,t){for(let n=0;n<e.length;n++)if(t(e[n])===!0)return n;return-1}function nt(e,t){return Object.assign(function(...r){return t(...r)},{id:e})}function qu(e,t,n,r){const s=Object.entries(Je(r)).sort((a,c)=>a[0].localeCompare(c[0]));return`${e}${t}${n}${s}`}function Bm(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);t=(t<<5)-t+r,t&=t}return t>>>0}function Am(e){let t="";for(const n of e){const r=Object.entries(n.tags),s=r.length>0?`|#${r.map(([a,c])=>`${a}:${c}`).join(",")}`:"";t+=`${n.name}@${n.unit}:${n.metric}|${n.metricType}${s}|T${n.timestamp}
`}return t}function ed(e){return e.replace(/[^\w]+/gi,"_")}function td(e){return e.replace(/[^\w\-.]+/gi,"_")}function vm(e){return e.replace(/[^\w\-./]+/gi,"")}const Wm=[[`
`,"\\n"],["\r","\\r"],["	","\\t"],["\\","\\\\"],["|","\\u{7c}"],[",","\\u{2c}"]];function Vm(e){for(const[t,n]of Wm)if(e===t)return n;return e}function Rm(e){return[...e].reduce((t,n)=>t+Vm(n),"")}function nd(e){const t={};for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const r=vm(n);t[r]=Rm(String(e[n]))}return t}function Ym(e,t,n,r){const s={sent_at:new Date().toISOString()};n&&n.sdk&&(s.sdk={name:n.sdk.name,version:n.sdk.version}),r&&t&&(s.dsn=As(t));const a=Xm(e);return bi(s,[a])}function Xm(e){const t=Am(e);return[{type:"statsd",length:t.length},t]}const Wl="Not capturing exception because it's already been captured.";class Hm{constructor(t){if(this._options=t,this._integrations={},this._integrationsInitialized=!1,this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],t.dsn?this._dsn=nb(t.dsn):ge&&L.warn("No DSN provided, client will not send events."),this._dsn){const n=pm(this._dsn,t);this._transport=t.transport({recordDroppedEvent:this.recordDroppedEvent.bind(this),...t.transportOptions,url:n})}}captureException(t,n,r){if(hl(t)){ge&&L.log(Wl);return}let s=n&&n.event_id;return this._process(this.eventFromException(t,n).then(a=>this._captureEvent(a,n,r)).then(a=>{s=a})),s}captureMessage(t,n,r,s){let a=r&&r.event_id;const c=Ya(t)?t:String(t),u=FC(t)?this.eventFromMessage(c,n,r):this.eventFromException(t,r);return this._process(u.then(d=>this._captureEvent(d,r,s)).then(d=>{a=d})),a}captureEvent(t,n,r){if(n&&n.originalException&&hl(n.originalException)){ge&&L.log(Wl);return}let s=n&&n.event_id;const c=(t.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(t,n,c||r).then(u=>{s=u})),s}captureSession(t){typeof t.release!="string"?ge&&L.warn("Discarded session because of missing or non-string release"):(this.sendSession(t),En(t,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(t){const n=this._transport;return n?(this.metricsAggregator&&this.metricsAggregator.flush(),this._isClientDoneProcessing(t).then(r=>n.flush(t).then(s=>r&&s))):hr(!0)}close(t){return this.flush(t).then(n=>(this.getOptions().enabled=!1,this.metricsAggregator&&this.metricsAggregator.close(),n))}getEventProcessors(){return this._eventProcessors}addEventProcessor(t){this._eventProcessors.push(t)}setupIntegrations(t){(t&&!this._integrationsInitialized||this._isEnabled()&&!this._integrationsInitialized)&&this._setupIntegrations()}init(){this._isEnabled()&&this._setupIntegrations()}getIntegrationById(t){return this.getIntegrationByName(t)}getIntegrationByName(t){return this._integrations[t]}getIntegration(t){try{return this._integrations[t.id]||null}catch{return ge&&L.warn(`Cannot retrieve integration ${t.id} from the current Client`),null}}addIntegration(t){const n=this._integrations[t.name];$u(this,t,this._integrations),n||vl(this,[t])}sendEvent(t,n={}){this.emit("beforeSendEvent",t,n);let r=um(t,this._dsn,this._options._metadata,this._options.tunnel);for(const a of n.attachments||[])r=Mb(r,Db(a,this._options.transportOptions&&this._options.transportOptions.textEncoder));const s=this._sendEnvelope(r);s&&s.then(a=>this.emit("afterSendEvent",t,a),null)}sendSession(t){const n=gm(t,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(n)}recordDroppedEvent(t,n,r){if(this._options.sendClientReports){const s=`${t}:${n}`;ge&&L.log(`Adding outcome: "${s}"`),this._outcomes[s]=this._outcomes[s]+1||1}}captureAggregateMetrics(t){ge&&L.log(`Flushing aggregated metrics, number of metrics: ${t.length}`);const n=Ym(t,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(n)}on(t,n){this._hooks[t]||(this._hooks[t]=[]),this._hooks[t].push(n)}emit(t,...n){this._hooks[t]&&this._hooks[t].forEach(r=>r(...n))}_setupIntegrations(){const{integrations:t}=this._options;this._integrations=Zm(this,t),vl(this,t),this._integrationsInitialized=!0}_updateSessionFromEvent(t,n){let r=!1,s=!1;const a=n.exception&&n.exception.values;if(a){s=!0;for(const d of a){const h=d.mechanism;if(h&&h.handled===!1){r=!0;break}}}const c=t.status==="ok";(c&&t.errors===0||c&&r)&&(En(t,{...r&&{status:"crashed"},errors:t.errors||Number(s||r)}),this.captureSession(t))}_isClientDoneProcessing(t){return new pt(n=>{let r=0;const s=1,a=setInterval(()=>{this._numProcessing==0?(clearInterval(a),n(!0)):(r+=s,t&&r>=t&&(clearInterval(a),n(!1)))},s)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(t,n,r,s=At()){const a=this.getOptions(),c=Object.keys(this._integrations);return!n.integrations&&c.length>0&&(n.integrations=c),this.emit("preprocessEvent",t,n),up(a,t,n,r,this,s).then(u=>{if(u===null)return u;const d={...s.getPropagationContext(),...r?r.getPropagationContext():void 0};if(!(u.contexts&&u.contexts.trace)&&d){const{traceId:m,spanId:y,parentSpanId:v,dsc:_}=d;u.contexts={trace:{trace_id:m,span_id:y,parent_span_id:v},...u.contexts};const F=_||fi(m,this,r);u.sdkProcessingMetadata={dynamicSamplingContext:F,...u.sdkProcessingMetadata}}return u})}_captureEvent(t,n={},r){return this._processEvent(t,n,r).then(s=>s.event_id,s=>{if(ge){const a=s;a.logLevel==="log"?L.log(a.message):L.warn(a)}})}_processEvent(t,n,r){const s=this.getOptions(),{sampleRate:a}=s,c=id(t),u=rd(t),d=t.type||"error",h=`before send for type \`${d}\``;if(u&&typeof a=="number"&&Math.random()>a)return this.recordDroppedEvent("sample_rate","error",t),Wu(new Ft(`Discarding event because it's not included in the random sample (sampling rate = ${a})`,"log"));const m=d==="replay_event"?"replay":d,v=(t.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(t,n,r,v).then(_=>{if(_===null)throw this.recordDroppedEvent("event_processor",m,t),new Ft("An event processor returned `null`, will not send event.","log");if(n.data&&n.data.__sentry__===!0)return _;const Q=Nm(s,_,n);return Sm(Q,h)}).then(_=>{if(_===null)throw this.recordDroppedEvent("before_send",m,t),new Ft(`${h} returned \`null\`, will not send event.`,"log");const F=r&&r.getSession();!c&&F&&this._updateSessionFromEvent(F,_);const Q=_.transaction_info;if(c&&Q&&_.transaction!==t.transaction){const z="custom";_.transaction_info={...Q,source:z}}return this.sendEvent(_,n),_}).then(null,_=>{throw _ instanceof Ft?_:(this.captureException(_,{data:{__sentry__:!0},originalException:_}),new Ft(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${_}`))})}_process(t){this._numProcessing++,t.then(n=>(this._numProcessing--,n),n=>(this._numProcessing--,n))}_sendEnvelope(t){if(this.emit("beforeEnvelope",t),this._isEnabled()&&this._transport)return this._transport.send(t).then(null,n=>{ge&&L.error("Error while sending event:",n)});ge&&L.error("Transport disabled")}_clearOutcomes(){const t=this._outcomes;return this._outcomes={},Object.keys(t).map(n=>{const[r,s]=n.split(":");return{reason:r,category:s,quantity:t[n]}})}}function Sm(e,t){const n=`${t} must return \`null\` or a valid event.`;if(Bt(e))return e.then(r=>{if(!Tn(r)&&r!==null)throw new Ft(n);return r},r=>{throw new Ft(`${t} rejected with ${r}`)});if(!Tn(e)&&e!==null)throw new Ft(n);return e}function Nm(e,t,n){const{beforeSend:r,beforeSendTransaction:s}=e;return rd(t)&&r?r(t,n):id(t)&&s?s(t,n):t}function rd(e){return e.type===void 0}function id(e){return e.type==="transaction"}function wm(e){const t=Ze();!t||!t.addEventProcessor||t.addEventProcessor(e)}function Km(e,t,n,r,s){const a={sent_at:new Date().toISOString()};n&&n.sdk&&(a.sdk={name:n.sdk.name,version:n.sdk.version}),r&&s&&(a.dsn=As(s)),t&&(a.trace=Je(t));const c=_m(e);return bi(a,[c])}function _m(e){return[{type:"check_in"},e]}const sd="c",od="g",Ns="s",ad="d",Fm=5e3,ko=1e4,km=1e4;class Jm{constructor(t){this._value=t}get weight(){return 1}add(t){this._value+=t}toString(){return`${this._value}`}}class zm{constructor(t){this._last=t,this._min=t,this._max=t,this._sum=t,this._count=1}get weight(){return 5}add(t){this._last=t,t<this._min&&(this._min=t),t>this._max&&(this._max=t),this._sum+=t,this._count++}toString(){return`${this._last}:${this._min}:${this._max}:${this._sum}:${this._count}`}}class Tm{constructor(t){this._value=[t]}get weight(){return this._value.length}add(t){this._value.push(t)}toString(){return this._value.join(":")}}class Um{constructor(t){this.first=t,this._value=new Set([t])}get weight(){return this._value.size}add(t){this._value.add(t)}toString(){return Array.from(this._value).map(t=>typeof t=="string"?Bm(t):t).join(":")}}const cd={[sd]:Jm,[od]:zm,[ad]:Tm,[Ns]:Um};let Em=class{constructor(t){this._client=t,this._buckets=new Map,this._bucketsTotalWeight=0,this._interval=setInterval(()=>this._flush(),ko),this._interval.unref&&this._interval.unref(),this._flushShift=Math.floor(Math.random()*ko/1e3),this._forceFlush=!1}add(t,n,r,s="none",a={},c=Pt()){const u=Math.floor(c),d=td(n),h=nd(a),m=ed(s),y=qu(t,d,m,h);let v=this._buckets.get(y);const _=v&&t===Ns?v.metric.weight:0;v?(v.metric.add(r),v.timestamp<u&&(v.timestamp=u)):(v={metric:new cd[t](r),timestamp:u,metricType:t,name:d,unit:m,tags:h},this._buckets.set(y,v));const F=typeof r=="string"?v.metric.weight-_:r;Du(t,d,F,m,a,y),this._bucketsTotalWeight+=v.metric.weight,this._bucketsTotalWeight>=km&&this.flush()}flush(){this._forceFlush=!0,this._flush()}close(){this._forceFlush=!0,clearInterval(this._interval),this._flush()}_flush(){if(this._forceFlush){this._forceFlush=!1,this._bucketsTotalWeight=0,this._captureMetrics(this._buckets),this._buckets.clear();return}const t=Math.floor(Pt())-ko/1e3-this._flushShift,n=new Map;for(const[r,s]of this._buckets)s.timestamp<=t&&(n.set(r,s),this._bucketsTotalWeight-=s.metric.weight);for(const[r]of n)this._buckets.delete(r);this._captureMetrics(n)}_captureMetrics(t){if(t.size>0&&this._client.captureAggregateMetrics){const n=Array.from(t).map(([,r])=>r);this._client.captureAggregateMetrics(n)}}};class xm extends Hm{constructor(t){am(),super(t),t._experiments&&t._experiments.metricsAggregator&&(this.metricsAggregator=new Em(this))}eventFromException(t,n){return hr(op(Ze(),this._options.stackParser,t,n))}eventFromMessage(t,n="info",r){return hr(ap(this._options.stackParser,t,n,r,this._options.attachStacktrace))}captureException(t,n,r){if(this._options.autoSessionTracking&&this._sessionFlusher&&r){const s=r.getRequestSession();s&&s.status==="ok"&&(s.status="errored")}return super.captureException(t,n,r)}captureEvent(t,n,r){if(this._options.autoSessionTracking&&this._sessionFlusher&&r&&(t.type||"exception")==="exception"&&t.exception&&t.exception.values&&t.exception.values.length>0){const c=r.getRequestSession();c&&c.status==="ok"&&(c.status="errored")}return super.captureEvent(t,n,r)}close(t){return this._sessionFlusher&&this._sessionFlusher.close(),super.close(t)}initSessionFlusher(){const{release:t,environment:n}=this._options;t?this._sessionFlusher=new dm(this,{release:t,environment:n}):ge&&L.warn("Cannot initialise an instance of SessionFlusher if no release is provided!")}captureCheckIn(t,n,r){const s="checkInId"in t&&t.checkInId?t.checkInId:Re();if(!this._isEnabled())return ge&&L.warn("SDK not enabled, will not capture checkin."),s;const a=this.getOptions(),{release:c,environment:u,tunnel:d}=a,h={check_in_id:s,monitor_slug:t.monitorSlug,status:t.status,release:c,environment:u};"duration"in t&&(h.duration=t.duration),n&&(h.monitor_config={schedule:n.schedule,checkin_margin:n.checkinMargin,max_runtime:n.maxRuntime,timezone:n.timezone});const[m,y]=this._getTraceInfoFromScope(r);y&&(h.contexts={trace:y});const v=Km(h,m,this.getSdkMetadata(),d,this.getDsn());return ge&&L.info("Sending checkin:",t.monitorSlug,t.status),this._sendEnvelope(v),s}_captureRequestSession(){this._sessionFlusher?this._sessionFlusher.incrementSessionStatusCount():ge&&L.warn("Discarded request mode session because autoSessionTracking option was disabled")}_prepareEvent(t,n,r,s){return this._options.platform&&(t.platform=t.platform||this._options.platform),this._options.runtime&&(t.contexts={...t.contexts,runtime:(t.contexts||{}).runtime||this._options.runtime}),this._options.serverName&&(t.server_name=t.server_name||this._options.serverName),super._prepareEvent(t,n,r,s)}_getTraceInfoFromScope(t){if(!t)return[void 0,void 0];const n=t.getSpan();if(n)return[hi(n)?Bn(n):void 0,Vs(n)];const{traceId:r,spanId:s,parentSpanId:a,dsc:c}=t.getPropagationContext(),u={trace_id:r,span_id:s,parent_span_id:a};return c?[c,u]:[fi(r,this,t),u]}}function Lm(e,t){t.debug===!0&&(ge?L.enable():Gn(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),Se().update(t.initialScope);const r=new e(t);ld(r),Qm(r)}function ld(e){const n=Ve().getStackTop();n.client=e,n.scope.setClient(e)}function Qm(e){e.init?e.init():e.setupIntegrations&&e.setupIntegrations()}const jm=30;function sa(e,t,n=Hb(e.bufferSize||jm)){let r={};const s=c=>n.drain(c);function a(c){const u=[];if(bl(c,(y,v)=>{const _=pl(v);if(rp(r,_)){const F=Vl(y,v);e.recordDroppedEvent("ratelimit_backoff",_,F)}else u.push(y)}),u.length===0)return hr();const d=bi(c[0],u),h=y=>{bl(d,(v,_)=>{const F=Vl(v,_);e.recordDroppedEvent(y,pl(_),F)})},m=()=>t({body:Su(d,e.textEncoder)}).then(y=>(y.statusCode!==void 0&&(y.statusCode<200||y.statusCode>=300)&&ge&&L.warn(`Sentry responded with status code ${y.statusCode} to sent event.`),r=ip(r,y),y),y=>{throw h("network_error"),y});return n.add(m).then(y=>y,y=>{if(y instanceof Ft)return ge&&L.error("Skipped sending event because buffer is full."),h("queue_overflow"),hr();throw y})}return a.__sentry__baseTransport__=!0,{send:a,flush:s}}function Vl(e,t){if(!(t!=="event"&&t!=="transaction"))return Array.isArray(e)?e[1]:void 0}function rs(e,t){const n=t&&Pm(t)?t.getClient():t,r=n&&n.getDsn(),s=n&&n.getOptions().tunnel;return Mm(e,r)||Om(e,s)}function Om(e,t){return t?Rl(e)===Rl(t):!1}function Mm(e,t){return t?e.includes(t.host):!1}function Rl(e){return e[e.length-1]==="/"?e.slice(0,-1):e}function Pm(e){return e.getClient!==void 0}function Dm(e,...t){const n=new String(String.raw(e,...t));return n.__sentry_template_string__=e.join("\0").replace(/%/g,"%%").replace(/\0/g,"%s"),n.__sentry_template_values__=t,n}function $m(e,t,n=[t],r="npm"){const s=e._metadata||{};s.sdk||(s.sdk={name:`sentry.javascript.${t}`,packages:n.map(a=>({name:`${r}:@sentry/${a}`,version:mr})),version:mr}),e._metadata=s}const Jo={include:{cookies:!0,data:!0,headers:!0,ip:!1,query_string:!0,url:!0,user:{id:!0,username:!0,email:!0}},transactionNamingScheme:"methodPath"},gd="RequestData",qm=(e={})=>{const t=Na,n={...Jo,...e,include:{method:!0,...Jo.include,...e.include,user:e.include&&typeof e.include.user=="boolean"?e.include.user:{...Jo.include.user,...(e.include||{}).user}}};return{name:gd,setupOnce(){},processEvent(r,s,a){const{transactionNamingScheme:c}=n,{sdkProcessingMetadata:u={}}=r,d=u.request;if(!d)return r;const h=u.requestDataOptionsFromExpressHandler||u.requestDataOptionsFromGCPWrapper||tf(n),m=t(r,d,h);if(r.type==="transaction"||c==="handler")return m;const v=d._sentryTransaction;if(v){const _=Oe(v).description||"",F=nf(a)==="sentry.javascript.nextjs"?_.startsWith("/api"):c!=="path",[Q]=Cr(d,{path:!0,method:F,customRoute:_});m.transaction=Q}return m}}},Ma=qm,ef=nt(gd,Ma);function tf(e){const{transactionNamingScheme:t,include:{ip:n,user:r,...s}}=e,a=[];for(const[u,d]of Object.entries(s))d&&a.push(u);let c;if(r===void 0)c=!0;else if(typeof r=="boolean")c=r;else{const u=[];for(const[d,h]of Object.entries(r))h&&u.push(d);c=u}return{include:{ip:n,user:c,request:a.length!==0?a:void 0,transaction:t}}}function nf(e){try{return e.getOptions()._metadata.sdk.name}catch{return}}const rf=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/],sf=[/^.*\/healthcheck$/,/^.*\/healthy$/,/^.*\/live$/,/^.*\/ready$/,/^.*\/heartbeat$/,/^.*\/health$/,/^.*\/healthz$/],ud="InboundFilters",of=(e={})=>({name:ud,setupOnce(){},processEvent(t,n,r){const s=r.getOptions(),a=cf(e,s);return lf(t,a)?null:t}}),Pa=of,af=nt(ud,Pa);function cf(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:rf],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[],...e.disableTransactionDefaults?[]:sf],ignoreInternal:e.ignoreInternal!==void 0?e.ignoreInternal:!0}}function lf(e,t){return t.ignoreInternal&&Cf(e)?(ge&&L.warn(`Event dropped due to being internal Sentry Error.
Event: ${kn(e)}`),!0):gf(e,t.ignoreErrors)?(ge&&L.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${kn(e)}`),!0):uf(e,t.ignoreTransactions)?(ge&&L.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${kn(e)}`),!0):df(e,t.denyUrls)?(ge&&L.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${kn(e)}.
Url: ${ds(e)}`),!0):If(e,t.allowUrls)?!1:(ge&&L.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${kn(e)}.
Url: ${ds(e)}`),!0)}function gf(e,t){return e.type||!t||!t.length?!1:hf(e).some(n=>Gr(n,t))}function uf(e,t){if(e.type!=="transaction"||!t||!t.length)return!1;const n=e.transaction;return n?Gr(n,t):!1}function df(e,t){if(!t||!t.length)return!1;const n=ds(e);return n?Gr(n,t):!1}function If(e,t){if(!t||!t.length)return!0;const n=ds(e);return n?Gr(n,t):!0}function hf(e){const t=[];e.message&&t.push(e.message);let n;try{n=e.exception.values[e.exception.values.length-1]}catch{}return n&&n.value&&(t.push(n.value),n.type&&t.push(`${n.type}: ${n.value}`)),ge&&t.length===0&&L.error(`Could not extract message for event ${kn(e)}`),t}function Cf(e){try{return e.exception.values[0].type==="SentryError"}catch{}return!1}function bf(e=[]){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&n.filename!=="<anonymous>"&&n.filename!=="[native code]")return n.filename||null}return null}function ds(e){try{let t;try{t=e.exception.values[0].stacktrace.frames}catch{}return t?bf(t):null}catch{return ge&&L.error(`Cannot extract url for event ${kn(e)}`),null}}let Yl;const dd="FunctionToString",Xl=new WeakMap,pf=()=>({name:dd,setupOnce(){Yl=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=ib(this),n=Xl.has(Ze())&&t!==void 0?t:this;return Yl.apply(n,e)}}catch{}},setup(e){Xl.set(e,!0)}}),Da=pf,mf=nt(dd,Da),ff="cause",Zf=5,Id="LinkedErrors",yf=(e={})=>{const t=e.limit||Zf,n=e.key||ff;return{name:Id,setupOnce(){},preprocessEvent(r,s,a){const c=a.getOptions();EC(Ku,c.stackParser,c.maxValueLength,n,t,r,s)}}},$a=yf,Gf=nt(Id,$a),Bf=Object.freeze(Object.defineProperty({__proto__:null,FunctionToString:mf,InboundFilters:af,LinkedErrors:Gf},Symbol.toStringTag,{value:"Module"}));class Af{constructor(t){this._client=t,this._buckets=new Map,this._interval=setInterval(()=>this.flush(),Fm)}add(t,n,r,s="none",a={},c=Pt()){const u=Math.floor(c),d=td(n),h=nd(a),m=ed(s),y=qu(t,d,m,h);let v=this._buckets.get(y);const _=v&&t===Ns?v.metric.weight:0;v?(v.metric.add(r),v.timestamp<u&&(v.timestamp=u)):(v={metric:new cd[t](r),timestamp:u,metricType:t,name:d,unit:m,tags:h},this._buckets.set(y,v));const F=typeof r=="string"?v.metric.weight-_:r;Du(t,d,F,m,a,y)}flush(){if(this._buckets.size!==0){if(this._client.captureAggregateMetrics){const t=Array.from(this._buckets).map(([,n])=>n);this._client.captureAggregateMetrics(t)}this._buckets.clear()}}close(){clearInterval(this._interval),this.flush()}}const hd="MetricsAggregator",vf=()=>({name:hd,setupOnce(){},setup(e){e.metricsAggregator=new Af(e)}}),Cd=vf,Wf=nt(hd,Cd);function ws(e,t,n,r={}){const s=Ze(),a=Se();if(s){if(!s.metricsAggregator){ge&&L.warn("No metrics aggregator enabled. Please add the MetricsAggregator integration to use metrics APIs");return}const{unit:c,tags:u,timestamp:d}=r,{release:h,environment:m}=s.getOptions(),y=a.getTransaction(),v={};h&&(v.release=h),m&&(v.environment=m),y&&(v.transaction=Oe(y).description||""),ge&&L.log(`Adding value of ${n} to ${e} metric ${t}`),s.metricsAggregator.add(e,t,n,c,{...v,...u},d)}}function Vf(e,t=1,n){ws(sd,e,t,n)}function Rf(e,t,n){ws(ad,e,t,n)}function Yf(e,t,n){ws(Ns,e,t,n)}function Xf(e,t,n){ws(od,e,t,n)}const Hf={increment:Vf,distribution:Rf,set:Yf,gauge:Xf,MetricsAggregator:Wf,metricsAggregatorIntegration:Cd},Sf=Bf,ze=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function Qn(e){const t=j([e,"call",r=>r(),"access",r=>r.getClient,"call",r=>r(),"optionalAccess",r=>r.getOptions,"call",r=>r()]);return(j([t,"optionalAccess",r=>r.instrumenter])||"sentry")!=="sentry"}class Ks{static __initStatic(){this.id="Express"}constructor(t={}){this.name=Ks.id,this._router=t.router||t.app,this._methods=(Array.isArray(t.methods)?t.methods:[]).concat("use")}setupOnce(t,n){if(!this._router){ze&&L.error("ExpressIntegration is missing an Express instance");return}if(Qn(n)){ze&&L.log("Express Integration is skipped because of instrumenter configuration.");return}Kf(this._router,this._methods),_f(this._router)}}Ks.__initStatic();function Hl(e,t){const n=e.length;switch(n){case 2:return function(r,s){const a=s.__sentry_transaction;if(a){const c=a.startChild({description:e.name,op:`middleware.express.${t}`,origin:"auto.middleware.express"});s.once("finish",()=>{c.end()})}return e.call(this,r,s)};case 3:return function(r,s,a){const c=s.__sentry_transaction,u=j([c,"optionalAccess",d=>d.startChild,"call",d=>d({description:e.name,op:`middleware.express.${t}`,origin:"auto.middleware.express"})]);e.call(this,r,s,function(...d){j([u,"optionalAccess",h=>h.end,"call",h=>h()]),a.call(this,...d)})};case 4:return function(r,s,a,c){const u=a.__sentry_transaction,d=j([u,"optionalAccess",h=>h.startChild,"call",h=>h({description:e.name,op:`middleware.express.${t}`,origin:"auto.middleware.express"})]);e.call(this,r,s,a,function(...h){j([d,"optionalAccess",m=>m.end,"call",m=>m()]),c.call(this,...h)})};default:throw new Error(`Express middleware takes 2-4 arguments. Got: ${n}`)}}function Nf(e,t){return e.map(n=>typeof n=="function"?Hl(n,t):Array.isArray(n)?n.map(r=>typeof r=="function"?Hl(r,t):r):n)}function wf(e,t){const n=e[t];return e[t]=function(...r){return n.call(this,...Nf(r,t))},e}function Kf(e,t=[]){t.forEach(n=>wf(e,n))}function _f(e){const t="settings"in e;t&&e._router===void 0&&e.lazyrouter&&e.lazyrouter();const n=t?e._router:e;if(!n){ze&&L.debug("Cannot instrument router for URL Parameterization (did not find a valid router)."),ze&&L.debug("Routing instrumentation is currently only supported in Express 4.");return}const r=Object.getPrototypeOf(n),s=r.process_params;r.process_params=function(c,u,d,h,m){d._reconstructedRoute||(d._reconstructedRoute="");const{layerRoutePath:y,isRegex:v,isArray:_,numExtraSegments:F}=kf(c);(y||v||_)&&(d._hasParameters=!0);let Q;y?Q=y:Q=Tf(d.originalUrl,d._reconstructedRoute,c.path)||"";const z=Q.split("/").filter(re=>re.length>0&&(v||_||!re.includes("*"))).join("/");z&&z.length>0&&(d._reconstructedRoute+=`/${z}${v?"/":""}`);const te=ls(cs(d.originalUrl||""))+F,ce=ls(d._reconstructedRoute);if(te===ce){d._hasParameters||d._reconstructedRoute!==d.originalUrl&&(d._reconstructedRoute=d.originalUrl?cs(d.originalUrl):d.originalUrl);const re=h.__sentry_transaction,Ie=re&&Oe(re).data||{};if(re&&Ie[fn]!=="custom"){const fe=d._reconstructedRoute||"/",[oe,ue]=Cr(d,{path:!0,method:!0,customRoute:fe});re.updateName(oe),re.setAttribute(fn,ue)}}return s.call(this,c,u,d,h,m)}}const Ff=(e,t,n)=>{if(!e||!t||!n||Object.keys(n).length===0||!j([n,"access",h=>h[0],"optionalAccess",h=>h.offset]))return;const r=n.sort((h,m)=>h.offset-m.offset),a=new RegExp(t,`${t.flags}d`).exec(e);if(!a||!a.indices)return;const[,...c]=a.indices;if(c.length!==r.length)return;let u=e,d=0;return c.forEach((h,m)=>{if(h){const[y,v]=h,_=u.substring(0,y-d),F=`:${r[m].name}`,Q=u.substring(v-d);u=_+F+Q,d=d+(v-y-F.length)}}),u};function kf(e){let t=j([e,"access",c=>c.route,"optionalAccess",c=>c.path]);const n=hu(t),r=Array.isArray(t);if(!t){const[c]=ve.process.versions.node.split(".").map(Number);c>=16&&(t=Ff(e.path,e.regexp,e.keys))}if(!t)return{isRegex:n,isArray:r,numExtraSegments:0};const s=r?Math.max(Jf(t)-ls(e.path||""),0):0;return{layerRoutePath:zf(r,t),isRegex:n,isArray:r,numExtraSegments:s}}function Jf(e){return e.reduce((t,n)=>t+ls(n.toString()),0)}function zf(e,t){return e?t.map(n=>n.toString()).join(","):t&&t.toString()}function Tf(e,t,n){const r=cs(e||""),s=j([r,"optionalAccess",d=>d.split,"call",d=>d("/"),"access",d=>d.filter,"call",d=>d(h=>!!h)]);let a=0;const c=j([t,"optionalAccess",d=>d.split,"call",d=>d("/"),"access",d=>d.filter,"call",d=>d(h=>!!h),"access",d=>d.length])||0;return j([n,"optionalAccess",d=>d.split,"call",d=>d("/"),"access",d=>d.filter,"call",d=>d(h=>j([s,"optionalAccess",m=>m[c+a]])===h?(a+=1,!0):!1),"access",d=>d.join,"call",d=>d("/")])}class _s{static __initStatic(){this.id="Postgres"}constructor(t={}){this.name=_s.id,this._usePgNative=!!t.usePgNative,this._module=t.module}loadDependency(){return this._module=this._module||Ir("pg")}setupOnce(t,n){if(Qn(n)){ze&&L.log("Postgres Integration is skipped because of instrumenter configuration.");return}const r=this.loadDependency();if(!r){ze&&L.error("Postgres Integration was unable to require `pg` package.");return}const s=this._usePgNative?j([r,"access",a=>a.native,"optionalAccess",a=>a.Client]):r.Client;if(!s){ze&&L.error("Postgres Integration was unable to access 'pg-native' bindings.");return}at(s.prototype,"query",function(a){return function(c,u,d){const m=n().getScope().getSpan(),y={"db.system":"postgresql"};try{this.database&&(y["db.name"]=this.database),this.host&&(y["server.address"]=this.host),this.port&&(y["server.port"]=this.port),this.user&&(y["db.user"]=this.user)}catch{}const v=j([m,"optionalAccess",F=>F.startChild,"call",F=>F({description:typeof c=="string"?c:c.text,op:"db",origin:"auto.db.postgres",data:y})]);if(typeof d=="function")return a.call(this,c,u,function(F,Q){j([v,"optionalAccess",z=>z.end,"call",z=>z()]),d(F,Q)});if(typeof u=="function")return a.call(this,c,function(F,Q){j([v,"optionalAccess",z=>z.end,"call",z=>z()]),u(F,Q)});const _=typeof u<"u"?a.call(this,c,u):a.call(this,c);return Bt(_)?_.then(F=>(j([v,"optionalAccess",Q=>Q.end,"call",Q=>Q()]),F)):(j([v,"optionalAccess",F=>F.end,"call",F=>F()]),_)}})}}_s.__initStatic();class Fs{static __initStatic(){this.id="Mysql"}constructor(){this.name=Fs.id}loadDependency(){return this._module=this._module||Ir("mysql/lib/Connection.js")}setupOnce(t,n){if(Qn(n)){ze&&L.log("Mysql Integration is skipped because of instrumenter configuration.");return}const r=this.loadDependency();if(!r){ze&&L.error("Mysql Integration was unable to require `mysql` package.");return}let s;try{r.prototype.connect=new Proxy(r.prototype.connect,{apply(u,d,h){return s||(s=d.config),u.apply(d,h)}})}catch{ze&&L.error("Mysql Integration was unable to instrument `mysql` config.")}function a(){return s?{"server.address":s.host,"server.port":s.port,"db.user":s.user}:{}}function c(u){if(!u)return;const d=a();Object.keys(d).forEach(h=>{u.setAttribute(h,d[h])}),u.end()}at(r,"createQuery",function(u){return function(d,h,m){const v=n().getScope().getSpan(),_=j([v,"optionalAccess",Q=>Q.startChild,"call",Q=>Q({description:typeof d=="string"?d:d.sql,op:"db",origin:"auto.db.mysql",data:{"db.system":"mysql"}})]);if(typeof m=="function")return u.call(this,d,h,function(Q,z,te){c(_),m(Q,z,te)});if(typeof h=="function")return u.call(this,d,function(Q,z,te){c(_),h(Q,z,te)});const F=u.call(this,d,h);return F.on("end",()=>{c(_)}),F}})}}Fs.__initStatic();const Uf=["aggregate","bulkWrite","countDocuments","createIndex","createIndexes","deleteMany","deleteOne","distinct","drop","dropIndex","dropIndexes","estimatedDocumentCount","find","findOne","findOneAndDelete","findOneAndReplace","findOneAndUpdate","indexes","indexExists","indexInformation","initializeOrderedBulkOp","insertMany","insertOne","isCapped","mapReduce","options","parallelCollectionScan","rename","replaceOne","stats","updateMany","updateOne"],Ef={bulkWrite:["operations"],countDocuments:["query"],createIndex:["fieldOrSpec"],createIndexes:["indexSpecs"],deleteMany:["filter"],deleteOne:["filter"],distinct:["key","query"],dropIndex:["indexName"],find:["query"],findOne:["query"],findOneAndDelete:["filter"],findOneAndReplace:["filter","replacement"],findOneAndUpdate:["filter","update"],indexExists:["indexes"],insertMany:["docs"],insertOne:["doc"],mapReduce:["map","reduce"],rename:["newName"],replaceOne:["filter","doc"],updateMany:["filter","update"],updateOne:["filter","update"]};function xf(e){return e&&typeof e=="object"&&e.once&&typeof e.once=="function"}class ks{static __initStatic(){this.id="Mongo"}constructor(t={}){this.name=ks.id,this._operations=Array.isArray(t.operations)?t.operations:Uf,this._describeOperations="describeOperations"in t?t.describeOperations:!0,this._useMongoose=!!t.useMongoose}loadDependency(){const t=this._useMongoose?"mongoose":"mongodb";return this._module=this._module||Ir(t)}setupOnce(t,n){if(Qn(n)){ze&&L.log("Mongo Integration is skipped because of instrumenter configuration.");return}const r=this.loadDependency();if(!r){const s=this._useMongoose?"mongoose":"mongodb";ze&&L.error(`Mongo Integration was unable to require \`${s}\` package.`);return}this._instrumentOperations(r.Collection,this._operations,n)}_instrumentOperations(t,n,r){n.forEach(s=>this._patchOperation(t,s,r))}_patchOperation(t,n,r){if(!(n in t.prototype))return;const s=this._getSpanContextFromOperationArguments.bind(this);at(t.prototype,n,function(a){return function(...c){const u=c[c.length-1],d=r(),h=d.getScope(),m=d.getClient(),y=h.getSpan(),v=j([m,"optionalAccess",F=>F.getOptions,"call",F=>F(),"access",F=>F.sendDefaultPii]);if(typeof u!="function"||n==="mapReduce"&&c.length===2){const F=j([y,"optionalAccess",z=>z.startChild,"call",z=>z(s(this,n,c,v))]),Q=a.call(this,...c);if(Bt(Q))return Q.then(z=>(j([F,"optionalAccess",te=>te.end,"call",te=>te()]),z));if(xf(Q)){const z=Q;try{z.once("close",()=>{j([F,"optionalAccess",te=>te.end,"call",te=>te()])})}catch{j([F,"optionalAccess",ce=>ce.end,"call",ce=>ce()])}return z}else return j([F,"optionalAccess",z=>z.end,"call",z=>z()]),Q}const _=j([y,"optionalAccess",F=>F.startChild,"call",F=>F(s(this,n,c.slice(0,-1)))]);return a.call(this,...c.slice(0,-1),function(F,Q){j([_,"optionalAccess",z=>z.end,"call",z=>z()]),u(F,Q)})}})}_getSpanContextFromOperationArguments(t,n,r,s=!1){const a={"db.system":"mongodb","db.name":t.dbName,"db.operation":n,"db.mongodb.collection":t.collectionName},c={op:"db",origin:"auto.db.mongo",description:n,data:a},u=Ef[n],d=Array.isArray(this._describeOperations)?this._describeOperations.includes(n):this._describeOperations;if(!u||!d||!s)return c;try{if(n==="mapReduce"){const[h,m]=r;a[u[0]]=typeof h=="string"?h:h.name||"<anonymous>",a[u[1]]=typeof m=="string"?m:m.name||"<anonymous>"}else for(let h=0;h<u.length;h++)a[`db.mongodb.${u[h]}`]=JSON.stringify(r[h])}catch{}return c}}ks.__initStatic();function Lf(e){return!!e&&!!e.$use}class Js{static __initStatic(){this.id="Prisma"}constructor(t={}){if(this.name=Js.id,Lf(t.client)&&!t.client._sentryInstrumented){gi(t.client,"_sentryInstrumented",!0);const n={};try{const r=t.client._engineConfig;if(r){const{activeProvider:s,clientVersion:a}=r;s&&(n["db.system"]=s),a&&(n["db.prisma.version"]=a)}}catch{}t.client.$use((r,s)=>{if(Qn(Ve))return s(r);const a=r.action,c=r.model;return Qa({name:c?`${c} ${a}`:a,onlyIfParent:!0,op:"db.prisma",attributes:{[cr]:"auto.db.prisma"},data:{...n,"db.operation":a}},()=>s(r))})}else ze&&L.warn("Unsupported Prisma client provided to PrismaIntegration. Provided client:",t.client)}setupOnce(){}}Js.__initStatic();class zs{static __initStatic(){this.id="GraphQL"}constructor(){this.name=zs.id}loadDependency(){return this._module=this._module||Ir("graphql/execution/execute.js")}setupOnce(t,n){if(Qn(n)){ze&&L.log("GraphQL Integration is skipped because of instrumenter configuration.");return}const r=this.loadDependency();if(!r){ze&&L.error("GraphQL Integration was unable to require graphql/execution package.");return}at(r,"execute",function(s){return function(...a){const c=n().getScope(),u=c.getSpan(),d=j([u,"optionalAccess",m=>m.startChild,"call",m=>m({description:"execute",op:"graphql.execute",origin:"auto.graphql.graphql"})]);j([c,"optionalAccess",m=>m.setSpan,"call",m=>m(d)]);const h=s.call(this,...a);return Bt(h)?h.then(m=>(j([d,"optionalAccess",y=>y.end,"call",y=>y()]),j([c,"optionalAccess",y=>y.setSpan,"call",y=>y(u)]),m)):(j([d,"optionalAccess",m=>m.end,"call",m=>m()]),j([c,"optionalAccess",m=>m.setSpan,"call",m=>m(u)]),h)}})}}zs.__initStatic();class Ts{static __initStatic(){this.id="Apollo"}constructor(t={useNestjs:!1}){this.name=Ts.id,this._useNest=!!t.useNestjs}loadDependency(){return this._useNest?this._module=this._module||Ir("@nestjs/graphql"):this._module=this._module||Ir("apollo-server-core"),this._module}setupOnce(t,n){if(Qn(n)){ze&&L.log("Apollo Integration is skipped because of instrumenter configuration.");return}if(this._useNest){const r=this.loadDependency();if(!r){ze&&L.error("Apollo-NestJS Integration was unable to require @nestjs/graphql package.");return}at(r.GraphQLFactory.prototype,"mergeWithSchema",function(s){return function(...a){return at(this.resolversExplorerService,"explore",function(c){return function(){const u=as(c.call(this));return Sl(u,n)}}),s.call(this,...a)}})}else{const r=this.loadDependency();if(!r){ze&&L.error("Apollo Integration was unable to require apollo-server-core package.");return}at(r.ApolloServerBase.prototype,"constructSchema",function(s){return function(){if(!this.config.resolvers)return ze&&(this.config.schema?(L.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `schema` property.If you are using NestJS with Apollo, please use `Sentry.Integrations.Apollo({ useNestjs: true })` instead."),L.warn()):this.config.modules&&L.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `modules` property."),L.error("Skipping tracing as no resolvers found on the `ApolloServer` instance.")),s.call(this);const a=as(this.config.resolvers);return this.config.resolvers=Sl(a,n),s.call(this)}})}}}Ts.__initStatic();function Sl(e,t){return e.map(n=>(Object.keys(n).forEach(r=>{Object.keys(n[r]).forEach(s=>{typeof n[r][s]=="function"&&Qf(n,r,s,t)})}),n))}function Qf(e,t,n,r){at(e[t],n,function(s){return function(...a){const u=r().getScope().getSpan(),d=j([u,"optionalAccess",m=>m.startChild,"call",m=>m({description:`${t}.${n}`,op:"graphql.resolve",origin:"auto.graphql.apollo"})]),h=s.call(this,...a);return Bt(h)?h.then(m=>(j([d,"optionalAccess",y=>y.end,"call",y=>y()]),m)):(j([d,"optionalAccess",m=>m.end,"call",m=>m()]),h)}})}const jf=[()=>{const e=Gt(module,"./apollo");return new e.Apollo},()=>{const e=Gt(module,"./apollo");return new e.Apollo({useNestjs:!0})},()=>{const e=Gt(module,"./graphql");return new e.GraphQL},()=>{const e=Gt(module,"./mongo");return new e.Mongo},()=>{const e=Gt(module,"./mongo");return new e.Mongo({mongoose:!0})},()=>{const e=Gt(module,"./mysql");return new e.Mysql},()=>{const e=Gt(module,"./postgres");return new e.Postgres}];function Of(){const e=jf.map(t=>{try{return t()}catch{return}}).filter(t=>!!t);return e.length===0&&L.warn("Performance monitoring integrations could not be automatically loaded."),e.filter(t=>!!t.loadDependency())}class bd extends xm{constructor(t){$m(t,"node"),t.transportOptions={textEncoder:new yr.TextEncoder,...t.transportOptions};const n={...t,platform:"node",runtime:{name:"node",version:global.process.version},serverName:t.serverName||global.process.env.SENTRY_NAME||ut.hostname()};super(n)}}const Nt=Symbol("AgentBaseInternalState");class Mf extends ss.Agent{constructor(t){super(t),this[Nt]={}}isSecureEndpoint(t){if(t){if(typeof t.secureEndpoint=="boolean")return t.secureEndpoint;if(typeof t.protocol=="string")return t.protocol==="https:"}const{stack:n}=new Error;return typeof n!="string"?!1:n.split(`
`).some(r=>r.indexOf("(https.js:")!==-1||r.indexOf("node:https:")!==-1)}createSocket(t,n,r){const s={...n,secureEndpoint:this.isSecureEndpoint(n)};Promise.resolve().then(()=>this.connect(t,s)).then(a=>{if(a instanceof ss.Agent)return a.addRequest(t,s);this[Nt].currentSocket=a,super.createSocket(t,n,r)},r)}createConnection(){const t=this[Nt].currentSocket;if(this[Nt].currentSocket=void 0,!t)throw new Error("No socket was returned in the `connect()` function");return t}get defaultPort(){return pr(this[Nt].defaultPort,()=>this.protocol==="https:"?443:80)}set defaultPort(t){this[Nt]&&(this[Nt].defaultPort=t)}get protocol(){return pr(this[Nt].protocol,()=>this.isSecureEndpoint()?"https:":"http:")}set protocol(t){this[Nt]&&(this[Nt].protocol=t)}}function Di(...e){L.log("[https-proxy-agent:parse-proxy-response]",...e)}function Pf(e){return new Promise((t,n)=>{let r=0;const s=[];function a(){const m=e.read();m?h(m):e.once("readable",a)}function c(){e.removeListener("end",u),e.removeListener("error",d),e.removeListener("readable",a)}function u(){c(),Di("onend"),n(new Error("Proxy connection ended before receiving CONNECT response"))}function d(m){c(),Di("onerror %o",m),n(m)}function h(m){s.push(m),r+=m.length;const y=Buffer.concat(s,r),v=y.indexOf(`\r
\r
`);if(v===-1){Di("have not received end of HTTP headers yet..."),a();return}const _=y.slice(0,v).toString("ascii").split(`\r
`),F=_.shift();if(!F)return e.destroy(),n(new Error("No header received from proxy CONNECT response"));const Q=F.split(" "),z=+Q[1],te=Q.slice(2).join(" "),ce={};for(const re of _){if(!re)continue;const Ie=re.indexOf(":");if(Ie===-1)return e.destroy(),n(new Error(`Invalid header from proxy CONNECT response: "${re}"`));const fe=re.slice(0,Ie).toLowerCase(),oe=re.slice(Ie+1).trimStart(),ue=ce[fe];typeof ue=="string"?ce[fe]=[ue,oe]:Array.isArray(ue)?ue.push(oe):ce[fe]=oe}Di("got proxy server response: %o %o",F,ce),c(),t({connect:{statusCode:z,statusText:te,headers:ce},buffered:y})}e.on("error",d),e.on("end",u),a()})}function ei(...e){L.log("[https-proxy-agent]",...e)}class pd extends Mf{static __initStatic(){this.protocols=["http","https"]}constructor(t,n){super(n),this.options={},this.proxy=typeof t=="string"?new pn.URL(t):t,this.proxyHeaders=pr(j([n,"optionalAccess",a=>a.headers]),()=>({})),ei("Creating new HttpsProxyAgent instance: %o",this.proxy.href);const r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),s=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...n?Nl(n,"headers"):null,host:r,port:s}}async connect(t,n){const{proxy:r}=this;if(!n.host)throw new TypeError('No "host" provided');let s;if(r.protocol==="https:"){ei("Creating `tls.Socket`: %o",this.connectOpts);const v=this.connectOpts.servername||this.connectOpts.host;s=rl.connect({...this.connectOpts,servername:v&&$r.isIP(v)?void 0:v})}else ei("Creating `net.Socket`: %o",this.connectOpts),s=$r.connect(this.connectOpts);const a=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},c=$r.isIPv6(n.host)?`[${n.host}]`:n.host;let u=`CONNECT ${c}:${n.port} HTTP/1.1\r
`;if(r.username||r.password){const v=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;a["Proxy-Authorization"]=`Basic ${Buffer.from(v).toString("base64")}`}a.Host=`${c}:${n.port}`,a["Proxy-Connection"]||(a["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(const v of Object.keys(a))u+=`${v}: ${a[v]}\r
`;const d=Pf(s);s.write(`${u}\r
`);const{connect:h,buffered:m}=await d;if(t.emit("proxyConnect",h),this.emit("proxyConnect",h,t),h.statusCode===200){if(t.once("socket",Df),n.secureEndpoint){ei("Upgrading socket connection to TLS");const v=n.servername||n.host;return rl.connect({...Nl(n,"host","path","port"),socket:s,servername:$r.isIP(v)?void 0:v})}return s}s.destroy();const y=new $r.Socket({writable:!1});return y.readable=!0,t.once("socket",v=>{ei("Replaying proxy buffer for failed request"),v.push(m),v.push(null)}),y}}pd.__initStatic();function Df(e){e.resume()}function Nl(e,...t){const n={};let r;for(r in e)t.includes(r)||(n[r]=e[r]);return n}const $f=1024*32;function qf(e){return new Dg.Readable({read(){this.push(e),this.push(null)}})}function md(e){let t;try{t=new pn.URL(e.url)}catch{return Gn(()=>{console.warn("[@sentry/node]: Invalid dsn or tunnel option, will not send any events. The tunnel option must be a full URL when used.")}),sa(e,()=>Promise.resolve({}))}const n=t.protocol==="https:",r=eZ(t,e.proxy||(n?process.env.https_proxy:void 0)||process.env.http_proxy),s=n?_h:ss,a=e.keepAlive===void 0?!1:e.keepAlive,c=r?new pd(r):new s.Agent({keepAlive:a,maxSockets:30,timeout:2e3}),u=tZ(e,pr(e.httpModule,()=>s),c);return sa(e,u)}function eZ(e,t){const{no_proxy:n}=process.env;if(!(n&&n.split(",").some(s=>e.host.endsWith(s)||e.hostname.endsWith(s))))return t}function tZ(e,t,n){const{hostname:r,pathname:s,port:a,protocol:c,search:u}=new pn.URL(e.url);return function(h){return new Promise((m,y)=>{let v=qf(h.body);const _={...e.headers};h.body.length>$f&&(_["content-encoding"]="gzip",v=v.pipe(Xh.createGzip()));const F=t.request({method:"POST",agent:n,headers:_,hostname:r,path:`${s}${u}`,port:a,protocol:c,ca:e.caCerts},Q=>{Q.on("data",()=>{}),Q.on("end",()=>{}),Q.setEncoding("utf8");const z=pr(Q.headers["retry-after"],()=>null),te=pr(Q.headers["x-sentry-rate-limits"],()=>null);m({statusCode:Q.statusCode,headers:{"retry-after":z,"x-sentry-rate-limits":Array.isArray(te)?te[0]:te}})});F.on("error",y),v.pipe(F)})}}const Zn=pb(process.versions.node);function fd(){return qg.active}function nZ(){const e=fd();if(e)return Ea(e),Dt(e)}function rZ(e){const t={};return Ea(t,e),Dt(t)}function iZ(e,t){const n=fd();if(n&&j([t,"optionalAccess",c=>c.reuseExisting]))return e();const r=qg.create(),s=n?Dt(n):void 0,a=rZ(s);return Xs(r,a),r.bind(()=>e())()}function sZ(){Lu({getCurrentHub:nZ,runWithAsyncContext:iZ})}let $i;function oZ(){$i||($i=new Fh.AsyncLocalStorage);function e(){return $i.getStore()}function t(r){const s={};return Ea(s,r),Dt(s)}function n(r,s){const a=e();if(a&&j([s,"optionalAccess",u=>u.reuseExisting]))return r();const c=t(a);return $i.run(c,()=>r())}Lu({getCurrentHub:e,runWithAsyncContext:n})}function aZ(){Zn.major>=14?oZ():sZ()}const Zd="Console",cZ=()=>({name:Zd,setupOnce(){},setup(e){Ib(({args:t,level:n})=>{Ze()===e&&di({category:"console",level:Tb(n),message:Kh.format.apply(void 0,t)},{input:[...t],level:n})})}}),qa=cZ,lZ=nt(Zd,qa),gZ=yr.promisify(zn.readFile),uZ=yr.promisify(zn.readdir),yd="Context",dZ=(e={})=>{let t;const n={app:!0,os:!0,device:!0,culture:!0,cloudResource:!0,...e};async function r(a){t===void 0&&(t=s());const c=hZ(await t);return a.contexts={...a.contexts,app:{...c.app,...j([a,"access",u=>u.contexts,"optionalAccess",u=>u.app])},os:{...c.os,...j([a,"access",u=>u.contexts,"optionalAccess",u=>u.os])},device:{...c.device,...j([a,"access",u=>u.contexts,"optionalAccess",u=>u.device])},culture:{...c.culture,...j([a,"access",u=>u.contexts,"optionalAccess",u=>u.culture])},cloud_resource:{...c.cloud_resource,...j([a,"access",u=>u.contexts,"optionalAccess",u=>u.cloud_resource])}},a}async function s(){const a={};if(n.os&&(a.os=await CZ()),n.app&&(a.app=pZ()),n.device&&(a.device=mZ(n.device)),n.culture){const c=bZ();c&&(a.culture=c)}return n.cloudResource&&(a.cloud_resource=AZ()),a}return{name:yd,setupOnce(){},processEvent(a){return r(a)}}},ec=dZ,IZ=nt(yd,ec);function hZ(e){return j([e,"optionalAccess",t=>t.app,"optionalAccess",t=>t.app_memory])&&(e.app.app_memory=process.memoryUsage().rss),j([e,"optionalAccess",t=>t.device,"optionalAccess",t=>t.free_memory])&&(e.device.free_memory=ut.freemem()),e}async function CZ(){const e=ut.platform();switch(e){case"darwin":return GZ();case"linux":return BZ();default:return{name:fZ[e]||e,version:ut.release()}}}function bZ(){try{if(typeof process.versions.icu!="string")return;const e=new Date(9e8);if(new Intl.DateTimeFormat("es",{month:"long"}).format(e)==="enero"){const n=Intl.DateTimeFormat().resolvedOptions();return{locale:n.locale,timezone:n.timeZone}}}catch{}}function pZ(){const e=process.memoryUsage().rss;return{app_start_time:new Date(Date.now()-process.uptime()*1e3).toISOString(),app_memory:e}}function mZ(e){const t={};let n;try{n=ut.uptime&&ut.uptime()}catch{}if(typeof n=="number"&&(t.boot_time=new Date(Date.now()-n*1e3).toISOString()),t.arch=ut.arch(),(e===!0||e.memory)&&(t.memory_size=ut.totalmem(),t.free_memory=ut.freemem()),e===!0||e.cpu){const r=ut.cpus();if(r&&r.length){const s=r[0];t.processor_count=r.length,t.cpu_description=s.model,t.processor_frequency=s.speed}}return t}const fZ={aix:"IBM AIX",freebsd:"FreeBSD",openbsd:"OpenBSD",sunos:"SunOS",win32:"Windows"},ZZ=[{name:"fedora-release",distros:["Fedora"]},{name:"redhat-release",distros:["Red Hat Linux","Centos"]},{name:"redhat_version",distros:["Red Hat Linux"]},{name:"SuSE-release",distros:["SUSE Linux"]},{name:"lsb-release",distros:["Ubuntu Linux","Arch Linux"]},{name:"debian_version",distros:["Debian"]},{name:"debian_release",distros:["Debian"]},{name:"arch-release",distros:["Arch Linux"]},{name:"gentoo-release",distros:["Gentoo Linux"]},{name:"novell-release",distros:["SUSE Linux"]},{name:"alpine-release",distros:["Alpine Linux"]}],yZ={alpine:e=>e,arch:e=>wt(/distrib_release=(.*)/,e),centos:e=>wt(/release ([^ ]+)/,e),debian:e=>e,fedora:e=>wt(/release (..)/,e),mint:e=>wt(/distrib_release=(.*)/,e),red:e=>wt(/release ([^ ]+)/,e),suse:e=>wt(/VERSION = (.*)\n/,e),ubuntu:e=>wt(/distrib_release=(.*)/,e)};function wt(e,t){const n=e.exec(t);return n?n[1]:void 0}async function GZ(){const e={kernel_version:ut.release(),name:"Mac OS X",version:`10.${Number(ut.release().split(".")[0])-4}`};try{const t=await new Promise((n,r)=>{wh.execFile("/usr/bin/sw_vers",(s,a)=>{if(s){r(s);return}n(a)})});e.name=wt(/^ProductName:\s+(.*)$/m,t),e.version=wt(/^ProductVersion:\s+(.*)$/m,t),e.build=wt(/^BuildVersion:\s+(.*)$/m,t)}catch{}return e}function wl(e){return e.split(" ")[0].toLowerCase()}async function BZ(){const e={kernel_version:ut.release(),name:"Linux"};try{const t=await uZ("/etc"),n=ZZ.find(u=>t.includes(u.name));if(!n)return e;const r=ur.join("/etc",n.name),s=(await gZ(r,{encoding:"utf-8"})).toLowerCase(),{distros:a}=n;e.name=a.find(u=>s.indexOf(wl(u))>=0)||a[0];const c=wl(e.name);e.version=yZ[c](s)}catch{}return e}function AZ(){return process.env.VERCEL?{"cloud.provider":"vercel","cloud.region":process.env.VERCEL_REGION}:process.env.AWS_REGION?{"cloud.provider":"aws","cloud.region":process.env.AWS_REGION,"cloud.platform":process.env.AWS_EXECUTION_ENV}:process.env.GCP_PROJECT?{"cloud.provider":"gcp"}:process.env.ALIYUN_REGION_ID?{"cloud.provider":"alibaba_cloud","cloud.region":process.env.ALIYUN_REGION_ID}:process.env.WEBSITE_SITE_NAME&&process.env.REGION_NAME?{"cloud.provider":"azure","cloud.region":process.env.REGION_NAME}:process.env.IBM_CLOUD_REGION?{"cloud.provider":"ibm_cloud","cloud.region":process.env.IBM_CLOUD_REGION}:process.env.TENCENTCLOUD_REGION?{"cloud.provider":"tencent_cloud","cloud.region":process.env.TENCENTCLOUD_REGION,"cloud.account.id":process.env.TENCENTCLOUD_APPID,"cloud.availability_zone":process.env.TENCENTCLOUD_ZONE}:process.env.NETLIFY?{"cloud.provider":"netlify"}:process.env.FLY_REGION?{"cloud.provider":"fly.io","cloud.region":process.env.FLY_REGION}:process.env.DYNO?{"cloud.provider":"heroku"}:void 0}const Is=new br(100),vZ=7,Gd="ContextLines";function WZ(e){return new Promise((t,n)=>{zn.readFile(e,"utf8",(r,s)=>{r?n(r):t(s)})})}const VZ=(e={})=>{const t=e.frameContextLines!==void 0?e.frameContextLines:vZ;return{name:Gd,setupOnce(){},processEvent(n){return YZ(n,t)}}},tc=VZ,RZ=nt(Gd,tc);async function YZ(e,t){const n={},r=[];if(t>0&&j([e,"access",s=>s.exception,"optionalAccess",s=>s.values])){for(const s of e.exception.values)if(j([s,"access",a=>a.stacktrace,"optionalAccess",a=>a.frames]))for(let a=s.stacktrace.frames.length-1;a>=0;a--){const c=s.stacktrace.frames[a];c.filename&&!n[c.filename]&&!Is.get(c.filename)&&(r.push(HZ(c.filename)),n[c.filename]=1)}}if(r.length>0&&await Promise.all(r),t>0&&j([e,"access",s=>s.exception,"optionalAccess",s=>s.values]))for(const s of e.exception.values)s.stacktrace&&s.stacktrace.frames&&await XZ(s.stacktrace.frames,t);return e}function XZ(e,t){for(const n of e)if(n.filename&&n.context_line===void 0){const r=Is.get(n.filename);if(r)try{mb(r,n,t)}catch{}}}async function HZ(e){const t=Is.get(e);if(t===null)return null;if(t!==void 0)return t;let n=null;try{n=(await WZ(e)).split(`
`)}catch{}return Is.set(e,n),n}const yn=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function SZ(e){const{protocol:t,hostname:n,port:r}=Ad(e),s=e.path?e.path:"/";return`${t}//${n}${r}${s}`}function Bd(e){const{protocol:t,hostname:n,port:r}=Ad(e),s=e.pathname||"/",a=e.auth?NZ(e.auth):"";return`${t}//${a}${n}${r}${s}`}function NZ(e){const[t,n]=e.split(":");return`${t?"[Filtered]":""}:${n?"[Filtered]":""}@`}function Kl(e,t,n){if(!e)return e;let[r,s]=e.split(" ");return t.host&&!t.protocol&&(t.protocol=j([n,"optionalAccess",a=>a.agent,"optionalAccess",a=>a.protocol]),s=Bd(t)),j([s,"optionalAccess",a=>a.startsWith,"call",a=>a("///")])&&(s=s.slice(2)),`${r} ${s}`}function _l(e){const t={protocol:e.protocol,hostname:typeof e.hostname=="string"&&e.hostname.startsWith("[")?e.hostname.slice(1,-1):e.hostname,hash:e.hash,search:e.search,pathname:e.pathname,path:`${e.pathname||""}${e.search||""}`,href:e.href};return e.port!==""&&(t.port=Number(e.port)),(e.username||e.password)&&(t.auth=`${e.username}:${e.password}`),t}function wZ(e,t){let n,r;if(typeof t[t.length-1]=="function"&&(n=t.pop()),typeof t[0]=="string")r=_l(new pn.URL(t[0]));else if(t[0]instanceof pn.URL)r=_l(t[0]);else{r=t[0];try{const s=new pn.URL(r.path||"",`${r.protocol||"http:"}//${r.hostname}`);r={pathname:s.pathname,search:s.search,hash:s.hash,...r}}catch{}}return t.length===2&&(r={...r,...t[1]}),r.protocol===void 0&&(Zn.major>8?r.protocol=j([j([e,"optionalAccess",s=>s.globalAgent]),"optionalAccess",s=>s.protocol])||j([r.agent,"optionalAccess",s=>s.protocol])||j([r._defaultAgent,"optionalAccess",s=>s.protocol]):r.protocol=j([r.agent,"optionalAccess",s=>s.protocol])||j([r._defaultAgent,"optionalAccess",s=>s.protocol])||j([j([e,"optionalAccess",s=>s.globalAgent]),"optionalAccess",s=>s.protocol])),n?[r,n]:[r]}function Ad(e){const t=e.protocol||"",n=e.hostname||e.host||"",r=!e.port||e.port===80||e.port===443||/^(.*):(\d+)$/.test(n)?"":`:${e.port}`;return{protocol:t,hostname:n,port:r}}const KZ=(e={})=>{const{breadcrumbs:t,tracing:n,shouldCreateSpanForRequest:r}=e,s={breadcrumbs:t,tracing:n===!1?!1:Je({enableIfHasTracingEnabled:n===!0?void 0:!0,shouldCreateSpanForRequest:r})};return new An(s)},vd=KZ;class An{static __initStatic(){this.id="Http"}__init(){this.name=An.id}constructor(t={}){An.prototype.__init.call(this),this._breadcrumbs=typeof t.breadcrumbs>"u"?!0:t.breadcrumbs,this._tracing=t.tracing?t.tracing===!0?{}:t.tracing:void 0}setupOnce(t,n){const r=j([n,"call",h=>h(),"access",h=>h.getClient,"call",h=>h(),"optionalAccess",h=>h.getOptions,"call",h=>h()]),s=JZ(this._tracing,r);if(!this._breadcrumbs&&!s)return;if(r&&r.instrumenter!=="sentry"){yn&&L.log("HTTP Integration is skipped because of instrumenter configuration.");return}const a=zZ(s,this._tracing,r),c=j([r,"optionalAccess",h=>h.tracePropagationTargets])||j([this,"access",h=>h._tracing,"optionalAccess",h=>h.tracePropagationTargets]),u=require("http"),d=Fl(u,this._breadcrumbs,a,c);if(at(u,"get",d),at(u,"request",d),Zn.major>8){const h=require("https"),m=Fl(h,this._breadcrumbs,a,c);at(h,"get",m),at(h,"request",m)}}}An.__initStatic();function Fl(e,t,n,r){const s=new br(100),a=new br(100),c=h=>{if(n===void 0)return!0;const m=s.get(h);if(m!==void 0)return m;const y=n(h);return s.set(h,y),y},u=h=>{if(r===void 0)return!0;const m=a.get(h);if(m!==void 0)return m;const y=Gr(h,r);return a.set(h,y),y};function d(h,m,y,v){Ve().getIntegration(An)&&di({category:"http",data:{status_code:v&&v.statusCode,...m},type:"http"},{event:h,request:y,response:v})}return function(m){return function(...v){const _=wZ(e,v),F=_[0],Q=SZ(F),z=Bd(F),te=Ze();if(rs(z,te))return m.apply(e,_);const ce=Se(),re=At(),Ie=vr(),fe=FZ(z,F),oe=c(Q)?j([Ie,"optionalAccess",ue=>ue.startChild,"call",ue=>ue({op:"http.client",origin:"auto.http.node.http",description:`${fe["http.method"]} ${fe.url}`,data:fe})]):void 0;if(te&&u(Q)){const{traceId:ue,spanId:Ke,sampled:Ue,dsc:dt}={...re.getPropagationContext(),...ce.getPropagationContext()},It=oe?pi(oe):_a(ue,Ke,Ue),Ee=wa(dt||(oe?Bn(oe):fi(ue,te,ce)));_Z(F,z,It,Ee)}else yn&&L.log(`[Tracing] Not adding sentry-trace header to outgoing request (${z}) due to mismatching tracePropagationTargets option.`);return m.apply(e,_).once("response",function(ue){const Ke=this;t&&d("response",fe,Ke,ue),oe&&(ue.statusCode&&xn(oe,ue.statusCode),oe.updateName(Kl(Oe(oe).description||"",F,Ke)||""),oe.end())}).once("error",function(){const ue=this;t&&d("error",fe,ue),oe&&(xn(oe,500),oe.updateName(Kl(Oe(oe).description||"",F,ue)||""),oe.end())})}}}function _Z(e,t,n,r){(e.headers||{})["sentry-trace"]||(yn&&L.log(`[Tracing] Adding sentry-trace header ${n} to outgoing request to "${t}": `),e.headers={...e.headers,"sentry-trace":n,...r&&r.length>0&&{baggage:kZ(e,r)}})}function FZ(e,t){const n=t.method||"GET",r={url:e,"http.method":n};return t.hash&&(r["http.fragment"]=t.hash.substring(1)),t.search&&(r["http.query"]=t.search.substring(1)),r}function kZ(e,t){if(!e.headers||!e.headers.baggage)return t;if(t){if(Array.isArray(e.headers.baggage))return[...e.headers.baggage,t]}else return e.headers.baggage;return[e.headers.baggage,t]}function JZ(e,t){return e===void 0?!1:e.enableIfHasTracingEnabled?Ar(t):!0}function zZ(e,t,n){return e?j([t,"optionalAccess",s=>s.shouldCreateSpanForRequest])||j([n,"optionalAccess",s=>s.shouldCreateSpanForRequest]):()=>!1}function TZ(e,t,n){let r=0,s=5,a=0;return setInterval(()=>{a===0?r>e&&(s*=2,n(s),s>86400&&(s=86400),a=s):(a-=1,a===0&&t()),r=0},1e3).unref(),()=>{r+=1}}function kl(e){return e!==void 0&&(e.length===0||e==="?"||e==="<anonymous>")}function UZ(e,t){return e===t||kl(e)&&kl(t)}function Wd(e){if(e!==void 0)return e.slice(-10).reduce((t,n)=>`${t},${n.function},${n.lineno},${n.colno}`,"")}function EZ(e,t){if(t!==void 0)return Wd(e(t,1))}function Vd(e){let t=[],n=!1;function r(c){t=[],!n&&(n=!0,e(c))}t.push(r);function s(c){t.push(c)}function a(c){const u=t.pop()||r;try{u(c)}catch{r(c)}}return{add:s,next:a}}class xZ{constructor(){const{Session:t}=require("inspector");this._session=new t}configureAndConnect(t,n){this._session.connect(),this._session.on("Debugger.paused",r=>{t(r,()=>{this._session.post("Debugger.resume")})}),this._session.post("Debugger.enable"),this._session.post("Debugger.setPauseOnExceptions",{state:n?"all":"uncaught"})}setPauseOnExceptions(t){this._session.post("Debugger.setPauseOnExceptions",{state:t?"all":"uncaught"})}getLocalVariables(t,n){this._getProperties(t,r=>{const{add:s,next:a}=Vd(n);for(const c of r)if(j([c,"optionalAccess",u=>u.value,"optionalAccess",u=>u.objectId])&&j([c,"optionalAccess",u=>u.value,"access",u=>u.className])==="Array"){const u=c.value.objectId;s(d=>this._unrollArray(u,c.name,d,a))}else if(j([c,"optionalAccess",u=>u.value,"optionalAccess",u=>u.objectId])&&j([c,"optionalAccess",u=>u.value,"optionalAccess",u=>u.className])==="Object"){const u=c.value.objectId;s(d=>this._unrollObject(u,c.name,d,a))}else(j([c,"optionalAccess",u=>u.value,"optionalAccess",u=>u.value])!=null||j([c,"optionalAccess",u=>u.value,"optionalAccess",u=>u.description])!=null)&&s(u=>this._unrollOther(c,u,a));a({})})}_getProperties(t,n){this._session.post("Runtime.getProperties",{objectId:t,ownProperties:!0},(r,s)=>{n(r?[]:s.result)})}_unrollArray(t,n,r,s){this._getProperties(t,a=>{r[n]=a.filter(c=>c.name!=="length"&&!isNaN(parseInt(c.name,10))).sort((c,u)=>parseInt(c.name,10)-parseInt(u.name,10)).map(c=>j([c,"optionalAccess",u=>u.value,"optionalAccess",u=>u.value])),s(r)})}_unrollObject(t,n,r,s){this._getProperties(t,a=>{r[n]=a.map(c=>[c.name,j([c,"optionalAccess",u=>u.value,"optionalAccess",u=>u.value])]).reduce((c,[u,d])=>(c[u]=d,c),{}),s(r)})}_unrollOther(t,n,r){j([t,"optionalAccess",s=>s.value,"optionalAccess",s=>s.value])!=null?n[t.name]=t.value.value:j([t,"optionalAccess",s=>s.value,"optionalAccess",s=>s.description])!=null&&j([t,"optionalAccess",s=>s.value,"optionalAccess",s=>s.type])!=="function"&&(n[t.name]=`<${t.value.description}>`),r(n)}}function LZ(){try{return new xZ}catch{return}}const Rd="LocalVariables",QZ=(e={},t=LZ())=>{const n=new br(20);let r,s=!1;function a(d,{params:{reason:h,data:m,callFrames:y}},v){if(h!=="exception"&&h!=="promiseRejection"){v();return}j([r,"optionalCall",z=>z()]);const _=EZ(d,j([m,"optionalAccess",z=>z.description]));if(_==null){v();return}const{add:F,next:Q}=Vd(z=>{n.set(_,z),v()});for(let z=0;z<Math.min(y.length,5);z++){const{scopeChain:te,functionName:ce,this:re}=y[z],Ie=te.find(oe=>oe.type==="local"),fe=re.className==="global"||!re.className?ce:`${re.className}.${ce}`;if(j([Ie,"optionalAccess",oe=>oe.object,"access",oe=>oe.objectId])===void 0)F(oe=>{oe[z]={function:fe},Q(oe)});else{const oe=Ie.object.objectId;F(ue=>j([t,"optionalAccess",Ke=>Ke.getLocalVariables,"call",Ke=>Ke(oe,Ue=>{ue[z]={function:fe,vars:Ue},Q(ue)})]))}}Q([])}function c(d){const h=Wd(j([d,"optionalAccess",v=>v.stacktrace,"optionalAccess",v=>v.frames]));if(h===void 0)return;const m=n.remove(h);if(m===void 0)return;const y=(j([d,"access",v=>v.stacktrace,"optionalAccess",v=>v.frames])||[]).filter(v=>v.function!=="new Promise");for(let v=0;v<y.length;v++){const _=y.length-v-1;if(!y[_]||!m[v])break;m[v].vars===void 0||y[_].in_app===!1||!UZ(y[_].function,m[v].function)||(y[_].vars=m[v].vars)}}function u(d){for(const h of j([d,"optionalAccess",m=>m.exception,"optionalAccess",m=>m.values])||[])c(h);return d}return{name:Rd,setupOnce(){const d=Ze(),h=j([d,"optionalAccess",m=>m.getOptions,"call",m=>m()]);if(t&&j([h,"optionalAccess",m=>m.includeLocalVariables])){if(Zn.major<18){L.log("The `LocalVariables` integration is only supported on Node >= v18.");return}const y=e.captureAllExceptions!==!1;if(t.configureAndConnect((v,_)=>a(h.stackParser,v,_),y),y){const v=e.maxExceptionsPerSecond||50;r=TZ(v,()=>{L.log("Local variables rate-limit lifted."),j([t,"optionalAccess",_=>_.setPauseOnExceptions,"call",_=>_(!0)])},_=>{L.log(`Local variables rate-limit exceeded. Disabling capturing of caught exceptions for ${_} seconds.`),j([t,"optionalAccess",F=>F.setPauseOnExceptions,"call",F=>F(!1)])})}s=!0}},processEvent(d){return s?u(d):d},_getCachedFramesCount(){return n.size},_getFirstCachedFrame(){return n.values()[0]}}},Yd=QZ,jZ=nt(Rd,Yd),OZ=jZ,Xd=Yd;let zo;const Hd="Modules";function MZ(){try{return require.cache?Object.keys(require.cache):[]}catch{return[]}}function PZ(){const e=require.main&&require.main.paths||[],t=MZ(),n={},r={};return t.forEach(s=>{let a=s;const c=()=>{const u=a;if(a=ur.dirname(u),!a||u===a||r[u])return;if(e.indexOf(a)<0)return c();const d=ur.join(u,"package.json");if(r[u]=!0,!zn.existsSync(d))return c();try{const h=JSON.parse(zn.readFileSync(d,"utf8"));n[h.name]=h.version}catch{}};c()}),n}function DZ(){return zo||(zo=PZ()),zo}const $Z=()=>({name:Hd,setupOnce(){},processEvent(e){return e.modules={...e.modules,...DZ()},e}}),nc=$Z,qZ=nt(Hd,nc),ey=2e3;function oa(e){Gn(()=>{console.error(e)});const t=Ze();t===void 0&&(yn&&L.warn("No NodeClient was defined, we are exiting the process now."),global.process.exit(1));const n=t.getOptions(),r=n&&n.shutdownTimeout&&n.shutdownTimeout>0&&n.shutdownTimeout||ey;t.close(r).then(s=>{s||yn&&L.warn("We reached the timeout for emptying the request buffer, still exiting now!"),global.process.exit(1)},s=>{yn&&L.error(s)})}const Sd="OnUncaughtException",ty=(e={})=>{const t={exitEvenIfOtherHandlersAreRegistered:!0,...e};return{name:Sd,setupOnce(){},setup(n){global.process.on("uncaughtException",ry(n,t))}}},rc=ty,ny=nt(Sd,rc);function ry(e,t){let r=!1,s=!1,a=!1,c;const u=e.getOptions();return Object.assign(d=>{let h=oa;t.onFatalError?h=t.onFatalError:u.onFatalError&&(h=u.onFatalError);const y=global.process.listeners("uncaughtException").reduce((_,F)=>F.name==="domainUncaughtExceptionClear"||F.tag&&F.tag==="sentry_tracingErrorCallback"||F._errorHandler?_:_+1,0)===0,v=t.exitEvenIfOtherHandlersAreRegistered||y;r?v&&(a?(yn&&L.warn("uncaught exception after calling fatal error shutdown callback - this is bad! forcing shutdown"),oa(d)):s||(s=!0,setTimeout(()=>{a||(a=!0,h(c,d))},2e3))):(c=d,r=!0,Ze()===e&&mn(d,{originalException:d,captureContext:{level:"fatal"},mechanism:{handled:!1,type:"onuncaughtexception"}}),!a&&v&&(a=!0,h(d)))},{_errorHandler:!0})}const Nd="OnUnhandledRejection",iy=(e={})=>{const t=e.mode||"warn";return{name:Nd,setupOnce(){},setup(n){global.process.on("unhandledRejection",oy(n,{mode:t}))}}},ic=iy,sy=nt(Nd,ic);function oy(e,t){return function(r,s){Ze()===e&&(mn(r,{originalException:s,captureContext:{extra:{unhandledPromiseRejection:!0}},mechanism:{handled:!1,type:"onunhandledrejection"}}),ay(r,t))}}function ay(e,t){const n="This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). The promise rejected with the reason:";t.mode==="warn"?Gn(()=>{console.warn(n),console.error(e&&e.stack?e.stack:e)}):t.mode==="strict"&&(Gn(()=>{console.warn(n)}),oa(e))}const wd="Spotlight",cy=(e={})=>{const t={sidecarUrl:e.sidecarUrl||"http://localhost:8969/stream"};return{name:wd,setupOnce(){},setup(n){typeof process=="object"&&process.env&&L.warn("[Spotlight] It seems you're not in dev mode. Do you really want to have Spotlight enabled?"),gy(n,t)}}},sc=cy,ly=nt(wd,sc);function gy(e,t){const n=uy(t.sidecarUrl);if(!n)return;let r=0;if(typeof e.on!="function"){L.warn("[Spotlight] Cannot connect to spotlight due to missing method on SDK client (`client.on`)");return}e.on("beforeEnvelope",s=>{if(r>3){L.warn("[Spotlight] Disabled Sentry -> Spotlight integration due to too many failed requests");return}const a=Su(s),u=dy()({method:"POST",path:n.pathname,hostname:n.hostname,port:n.port,headers:{"Content-Type":"application/x-sentry-envelope"}},d=>{d.on("data",()=>{}),d.on("end",()=>{}),d.setEncoding("utf8")});u.on("error",()=>{r++,L.warn("[Spotlight] Failed to send envelope to Spotlight Sidecar")}),u.write(a),u.end()})}function uy(e){try{return new pn.URL(`${e}`)}catch{L.warn(`[Spotlight] Invalid sidecar URL: ${e}`);return}}function dy(){const{request:e}=ss;return Iy(e)?e.__sentry_original__:e}function Iy(e){return"__sentry_original__"in e}var ai;(function(e){const t="undici:request:create";e.RequestCreate=t;const n="undici:request:headers";e.RequestEnd=n;const r="undici:request:error";e.RequestError=r})(ai||(ai={}));const hy=e=>new tt(e),Kd=hy;class tt{static __initStatic(){this.id="Undici"}__init(){this.name=tt.id}__init2(){this._createSpanUrlMap=new br(100)}__init3(){this._headersUrlMap=new br(100)}constructor(t={}){tt.prototype.__init.call(this),tt.prototype.__init2.call(this),tt.prototype.__init3.call(this),tt.prototype.__init4.call(this),tt.prototype.__init5.call(this),tt.prototype.__init6.call(this),this._options={breadcrumbs:t.breadcrumbs===void 0?!0:t.breadcrumbs,tracing:t.tracing,shouldCreateSpanForRequest:t.shouldCreateSpanForRequest}}setupOnce(t){if(Zn.major<16)return;let n;try{n=require("diagnostics_channel")}catch{}!n||!n.subscribe||(n.subscribe(ai.RequestCreate,this._onRequestCreate),n.subscribe(ai.RequestEnd,this._onRequestEnd),n.subscribe(ai.RequestError,this._onRequestError))}_shouldCreateSpan(t){if(this._options.tracing===!1||this._options.tracing===void 0&&!Ar())return!1;if(this._options.shouldCreateSpanForRequest===void 0)return!0;const n=this._createSpanUrlMap.get(t);if(n!==void 0)return n;const r=this._options.shouldCreateSpanForRequest(t);return this._createSpanUrlMap.set(t,r),r}__init4(){this._onRequestCreate=t=>{if(!j([Ze,"call",y=>y(),"optionalAccess",y=>y.getIntegration,"call",y=>y(tt)]))return;const{request:n}=t,r=n.origin?n.origin.toString()+n.path:n.path,s=Ze();if(!s||rs(r,s)||n.__sentry_span__!==void 0)return;const a=s.getOptions(),c=Se(),u=At(),d=vr(),h=this._shouldCreateSpan(r)?by(d,n,r):void 0;if(h&&(n.__sentry_span__=h),(y=>{if(a.tracePropagationTargets===void 0)return!0;const v=this._headersUrlMap.get(y);if(v!==void 0)return v;const _=Gr(y,a.tracePropagationTargets);return this._headersUrlMap.set(y,_),_})(r)){const{traceId:y,spanId:v,sampled:_,dsc:F}={...u.getPropagationContext(),...c.getPropagationContext()},Q=h?pi(h):_a(y,v,_),z=wa(F||(h?Bn(h):fi(y,s,c)));Cy(n,Q,z)}}}__init5(){this._onRequestEnd=t=>{if(!j([Ze,"call",c=>c(),"optionalAccess",c=>c.getIntegration,"call",c=>c(tt)]))return;const{request:n,response:r}=t,s=n.origin?n.origin.toString()+n.path:n.path;if(rs(s,Ze()))return;const a=n.__sentry_span__;a&&(xn(a,r.statusCode),a.end()),this._options.breadcrumbs&&di({category:"http",data:{method:n.method,status_code:r.statusCode,url:s},type:"http"},{event:"response",request:n,response:r})}}__init6(){this._onRequestError=t=>{if(!j([Ze,"call",a=>a(),"optionalAccess",a=>a.getIntegration,"call",a=>a(tt)]))return;const{request:n}=t,r=n.origin?n.origin.toString()+n.path:n.path;if(rs(r,Ze()))return;const s=n.__sentry_span__;s&&(s.setStatus("internal_error"),s.end()),this._options.breadcrumbs&&di({category:"http",data:{method:n.method,url:r},level:"error",type:"http"},{event:"error",request:n})}}}tt.__initStatic();function Cy(e,t,n){let r;Array.isArray(e.headers)?r=e.headers.some(s=>s==="sentry-trace"):r=e.headers.split(`\r
`).some(a=>a.startsWith("sentry-trace:")),!r&&(e.addHeader("sentry-trace",t),n&&e.addHeader("baggage",n))}function by(e,t,n){const r=Nb(n),s=t.method||"GET",a={"http.method":s};return r.search&&(a["http.query"]=r.search),r.hash&&(a["http.fragment"]=r.hash),j([e,"optionalAccess",c=>c.startChild,"call",c=>c({op:"http.client",origin:"auto.http.node.undici",description:`${s} ${wb(r)}`,data:a})])}function Jl(e){return e.replace(/^[A-Z]:/,"").replace(/\\/g,"/")}function oc(e=process.argv[1]?Yb(process.argv[1]):process.cwd(),t=ur.sep==="\\"){const n=t?Jl(e):e;return r=>{if(!r)return;const s=t?Jl(r):r;let{dir:a,base:c,ext:u}=ur.posix.parse(s);(u===".js"||u===".mjs"||u===".cjs")&&(c=c.slice(0,u.length*-1)),a||(a=".");const d=a.lastIndexOf("/node_modules");if(d>-1)return`${a.slice(d+14).replace(/\//g,".")}:${c}`;if(a.startsWith(n)){let h=a.slice(n.length+1).replace(/\//g,".");return h&&(h+=":"),h+=c,h}return c}}const _d=[Pa(),Da(),$a(),Ma(),qa(),vd(),Kd(),rc(),ic(),tc(),Xd(),ec(),nc()];function Fd(e){const t=vn(),n=j([t,"access",r=>r.__SENTRY__,"optionalAccess",r=>r.integrations])||[];return[..._d,...n]}function kd(e={}){aZ(),e.defaultIntegrations===void 0&&(e.defaultIntegrations=Fd()),e.dsn===void 0&&(e.dsn="https://55af16af94074b88844cd7e16f535fa5@o76327.ingest.sentry.io/193727");const t=process.env.SENTRY_TRACES_SAMPLE_RATE;if(e.tracesSampleRate===void 0&&t){const r=parseFloat(t);isFinite(r)&&(e.tracesSampleRate=r)}if(e.release===void 0){const r=Jd();r!==void 0?e.release=r:e.autoSessionTracking=!1}e.environment===void 0&&process.env.SENTRY_ENVIRONMENT&&(e.environment=process.env.SENTRY_ENVIRONMENT),e.autoSessionTracking===void 0&&e.dsn!==void 0&&(e.autoSessionTracking=!0),e.instrumenter===void 0&&(e.instrumenter="sentry");const n={...e,stackParser:gb(e.stackParser||zd),integrations:fm(e),transport:e.transport||md};if(Lm(e.clientClass||bd,n),e.autoSessionTracking&&py(),my(),e.spotlight){const r=Ze();if(r&&r.addIntegration){const s=r.getOptions().integrations;for(const a of s)r.addIntegration(a);r.addIntegration(sc({sidecarUrl:typeof e.spotlight=="string"?e.spotlight:void 0}))}}}function is(e){if(e===void 0)return!1;const t=e&&e.getOptions();return t&&t.autoSessionTracking!==void 0?t.autoSessionTracking:!1}function Jd(e){return process.env.SENTRY_RELEASE?process.env.SENTRY_RELEASE:ve.SENTRY_RELEASE&&ve.SENTRY_RELEASE.id?ve.SENTRY_RELEASE.id:process.env.GITHUB_SHA||process.env.COMMIT_REF||process.env.VERCEL_GIT_COMMIT_SHA||process.env.VERCEL_GITHUB_COMMIT_SHA||process.env.VERCEL_GITLAB_COMMIT_SHA||process.env.VERCEL_BITBUCKET_COMMIT_SHA||process.env.ZEIT_GITHUB_COMMIT_SHA||process.env.ZEIT_GITLAB_COMMIT_SHA||process.env.ZEIT_BITBUCKET_COMMIT_SHA||process.env.CF_PAGES_COMMIT_SHA||e}const zd=Zu(db(oc()));function py(){Tu(),process.on("beforeExit",()=>{const e=At().getSession();e&&!["exited","crashed"].includes(e.status)&&Rs()})}function my(){const e=(process.env.SENTRY_USE_ENVIRONMENT||"").toLowerCase();if(!["false","n","no","off","0"].includes(e)){const t=process.env.SENTRY_TRACE,n=process.env.SENTRY_BAGGAGE,r=Ob(t,n);Se().setPropagationContext(r)}}function fy(e){const t=No.resolve(e);if(!Qi.existsSync(t))throw new Error(`Cannot read contents of ${t}. Directory does not exist.`);if(!Qi.statSync(t).isDirectory())throw new Error(`Cannot read contents of ${t}, because it is not a directory.`);const n=r=>Qi.readdirSync(r).reduce((s,a)=>{const c=No.join(r,a);return Qi.statSync(c).isDirectory()?s.concat(n(c)):(s.push(c),s)},[]);return n(t).map(r=>No.relative(t,r))}/*! @sentry/node 7.110.0 (9a52d91) | https://github.com/getsentry/sentry-javascript */const Zy="aW1wb3J0IHsgU2Vzc2lvbiB9IGZyb20gJ2luc3BlY3Rvcic7CmltcG9ydCB7IHdvcmtlckRhdGEsIHBhcmVudFBvcnQgfSBmcm9tICd3b3JrZXJfdGhyZWFkcyc7CmltcG9ydCB7IHBvc2l4LCBzZXAgfSBmcm9tICdwYXRoJzsKaW1wb3J0ICogYXMgaHR0cCBmcm9tICdodHRwJzsKaW1wb3J0ICogYXMgaHR0cHMgZnJvbSAnaHR0cHMnOwppbXBvcnQgeyBSZWFkYWJsZSB9IGZyb20gJ3N0cmVhbSc7CmltcG9ydCB7IFVSTCB9IGZyb20gJ3VybCc7CmltcG9ydCB7IGNyZWF0ZUd6aXAgfSBmcm9tICd6bGliJzsKaW1wb3J0ICogYXMgbmV0IGZyb20gJ25ldCc7CmltcG9ydCAqIGFzIHRscyBmcm9tICd0bHMnOwoKLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC91bmJvdW5kLW1ldGhvZApjb25zdCBvYmplY3RUb1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CgovKioKICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gdmFsdWUncyB0eXBlIGlzIG9uZSBvZiBhIGZldyBFcnJvciBvciBFcnJvci1saWtlCiAqIHtAbGluayBpc0Vycm9yfS4KICoKICogQHBhcmFtIHdhdCBBIHZhbHVlIHRvIGJlIGNoZWNrZWQuCiAqIEByZXR1cm5zIEEgYm9vbGVhbiByZXByZXNlbnRpbmcgdGhlIHJlc3VsdC4KICovCmZ1bmN0aW9uIGlzRXJyb3Iod2F0KSB7CiAgc3dpdGNoIChvYmplY3RUb1N0cmluZy5jYWxsKHdhdCkpIHsKICAgIGNhc2UgJ1tvYmplY3QgRXJyb3JdJzoKICAgIGNhc2UgJ1tvYmplY3QgRXhjZXB0aW9uXSc6CiAgICBjYXNlICdbb2JqZWN0IERPTUV4Y2VwdGlvbl0nOgogICAgICByZXR1cm4gdHJ1ZTsKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiBpc0luc3RhbmNlT2Yod2F0LCBFcnJvcik7CiAgfQp9Ci8qKgogKiBDaGVja3Mgd2hldGhlciBnaXZlbiB2YWx1ZSBpcyBhbiBpbnN0YW5jZSBvZiB0aGUgZ2l2ZW4gYnVpbHQtaW4gY2xhc3MuCiAqCiAqIEBwYXJhbSB3YXQgVGhlIHZhbHVlIHRvIGJlIGNoZWNrZWQKICogQHBhcmFtIGNsYXNzTmFtZQogKiBAcmV0dXJucyBBIGJvb2xlYW4gcmVwcmVzZW50aW5nIHRoZSByZXN1bHQuCiAqLwpmdW5jdGlvbiBpc0J1aWx0aW4od2F0LCBjbGFzc05hbWUpIHsKICByZXR1cm4gb2JqZWN0VG9TdHJpbmcuY2FsbCh3YXQpID09PSBgW29iamVjdCAke2NsYXNzTmFtZX1dYDsKfQoKLyoqCiAqIENoZWNrcyB3aGV0aGVyIGdpdmVuIHZhbHVlJ3MgdHlwZSBpcyBhIHN0cmluZwogKiB7QGxpbmsgaXNTdHJpbmd9LgogKgogKiBAcGFyYW0gd2F0IEEgdmFsdWUgdG8gYmUgY2hlY2tlZC4KICogQHJldHVybnMgQSBib29sZWFuIHJlcHJlc2VudGluZyB0aGUgcmVzdWx0LgogKi8KZnVuY3Rpb24gaXNTdHJpbmcod2F0KSB7CiAgcmV0dXJuIGlzQnVpbHRpbih3YXQsICdTdHJpbmcnKTsKfQoKLyoqCiAqIENoZWNrcyB3aGV0aGVyIGdpdmVuIHZhbHVlJ3MgdHlwZSBpcyBhbiBvYmplY3QgbGl0ZXJhbCwgb3IgYSBjbGFzcyBpbnN0YW5jZS4KICoge0BsaW5rIGlzUGxhaW5PYmplY3R9LgogKgogKiBAcGFyYW0gd2F0IEEgdmFsdWUgdG8gYmUgY2hlY2tlZC4KICogQHJldHVybnMgQSBib29sZWFuIHJlcHJlc2VudGluZyB0aGUgcmVzdWx0LgogKi8KZnVuY3Rpb24gaXNQbGFpbk9iamVjdCh3YXQpIHsKICByZXR1cm4gaXNCdWlsdGluKHdhdCwgJ09iamVjdCcpOwp9CgovKioKICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gdmFsdWUncyB0eXBlIGlzIGFuIEV2ZW50IGluc3RhbmNlCiAqIHtAbGluayBpc0V2ZW50fS4KICoKICogQHBhcmFtIHdhdCBBIHZhbHVlIHRvIGJlIGNoZWNrZWQuCiAqIEByZXR1cm5zIEEgYm9vbGVhbiByZXByZXNlbnRpbmcgdGhlIHJlc3VsdC4KICovCmZ1bmN0aW9uIGlzRXZlbnQod2F0KSB7CiAgcmV0dXJuIHR5cGVvZiBFdmVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgaXNJbnN0YW5jZU9mKHdhdCwgRXZlbnQpOwp9CgovKioKICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gdmFsdWUncyB0eXBlIGlzIGFuIEVsZW1lbnQgaW5zdGFuY2UKICoge0BsaW5rIGlzRWxlbWVudH0uCiAqCiAqIEBwYXJhbSB3YXQgQSB2YWx1ZSB0byBiZSBjaGVja2VkLgogKiBAcmV0dXJucyBBIGJvb2xlYW4gcmVwcmVzZW50aW5nIHRoZSByZXN1bHQuCiAqLwpmdW5jdGlvbiBpc0VsZW1lbnQod2F0KSB7CiAgcmV0dXJuIHR5cGVvZiBFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpc0luc3RhbmNlT2Yod2F0LCBFbGVtZW50KTsKfQoKLyoqCiAqIENoZWNrcyB3aGV0aGVyIGdpdmVuIHZhbHVlIGhhcyBhIHRoZW4gZnVuY3Rpb24uCiAqIEBwYXJhbSB3YXQgQSB2YWx1ZSB0byBiZSBjaGVja2VkLgogKi8KZnVuY3Rpb24gaXNUaGVuYWJsZSh3YXQpIHsKICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1tZW1iZXItYWNjZXNzCiAgcmV0dXJuIEJvb2xlYW4od2F0ICYmIHdhdC50aGVuICYmIHR5cGVvZiB3YXQudGhlbiA9PT0gJ2Z1bmN0aW9uJyk7Cn0KCi8qKgogKiBDaGVja3Mgd2hldGhlciBnaXZlbiB2YWx1ZSdzIHR5cGUgaXMgYSBTeW50aGV0aWNFdmVudAogKiB7QGxpbmsgaXNTeW50aGV0aWNFdmVudH0uCiAqCiAqIEBwYXJhbSB3YXQgQSB2YWx1ZSB0byBiZSBjaGVja2VkLgogKiBAcmV0dXJucyBBIGJvb2xlYW4gcmVwcmVzZW50aW5nIHRoZSByZXN1bHQuCiAqLwpmdW5jdGlvbiBpc1N5bnRoZXRpY0V2ZW50KHdhdCkgewogIHJldHVybiBpc1BsYWluT2JqZWN0KHdhdCkgJiYgJ25hdGl2ZUV2ZW50JyBpbiB3YXQgJiYgJ3ByZXZlbnREZWZhdWx0JyBpbiB3YXQgJiYgJ3N0b3BQcm9wYWdhdGlvbicgaW4gd2F0Owp9CgovKioKICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gdmFsdWUgaXMgTmFOCiAqIHtAbGluayBpc05hTn0uCiAqCiAqIEBwYXJhbSB3YXQgQSB2YWx1ZSB0byBiZSBjaGVja2VkLgogKiBAcmV0dXJucyBBIGJvb2xlYW4gcmVwcmVzZW50aW5nIHRoZSByZXN1bHQuCiAqLwpmdW5jdGlvbiBpc05hTiQxKHdhdCkgewogIHJldHVybiB0eXBlb2Ygd2F0ID09PSAnbnVtYmVyJyAmJiB3YXQgIT09IHdhdDsKfQoKLyoqCiAqIENoZWNrcyB3aGV0aGVyIGdpdmVuIHZhbHVlJ3MgdHlwZSBpcyBhbiBpbnN0YW5jZSBvZiBwcm92aWRlZCBjb25zdHJ1Y3Rvci4KICoge0BsaW5rIGlzSW5zdGFuY2VPZn0uCiAqCiAqIEBwYXJhbSB3YXQgQSB2YWx1ZSB0byBiZSBjaGVja2VkLgogKiBAcGFyYW0gYmFzZSBBIGNvbnN0cnVjdG9yIHRvIGJlIHVzZWQgaW4gYSBjaGVjay4KICogQHJldHVybnMgQSBib29sZWFuIHJlcHJlc2VudGluZyB0aGUgcmVzdWx0LgogKi8KZnVuY3Rpb24gaXNJbnN0YW5jZU9mKHdhdCwgYmFzZSkgewogIHRyeSB7CiAgICByZXR1cm4gd2F0IGluc3RhbmNlb2YgYmFzZTsKICB9IGNhdGNoIChfZSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQoKLyoqCiAqIENoZWNrcyB3aGV0aGVyIGdpdmVuIHZhbHVlJ3MgdHlwZSBpcyBhIFZ1ZSBWaWV3TW9kZWwuCiAqCiAqIEBwYXJhbSB3YXQgQSB2YWx1ZSB0byBiZSBjaGVja2VkLgogKiBAcmV0dXJucyBBIGJvb2xlYW4gcmVwcmVzZW50aW5nIHRoZSByZXN1bHQuCiAqLwpmdW5jdGlvbiBpc1Z1ZVZpZXdNb2RlbCh3YXQpIHsKICAvLyBOb3QgdXNpbmcgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyBiZWNhdXNlIGluIFZ1ZSAzIGl0IHdvdWxkIHJlYWQgdGhlIGluc3RhbmNlJ3MgU3ltYm9sKFN5bWJvbC50b1N0cmluZ1RhZykgcHJvcGVydHkuCiAgcmV0dXJuICEhKHR5cGVvZiB3YXQgPT09ICdvYmplY3QnICYmIHdhdCAhPT0gbnVsbCAmJiAoKHdhdCApLl9faXNWdWUgfHwgKHdhdCApLl9pc1Z1ZSkpOwp9CgovKiogSW50ZXJuYWwgZ2xvYmFsIHdpdGggY29tbW9uIHByb3BlcnRpZXMgYW5kIFNlbnRyeSBleHRlbnNpb25zICAqLwoKLy8gVGhlIGNvZGUgYmVsb3cgZm9yICdpc0dsb2JhbE9iaicgYW5kICdHTE9CQUxfT0JKJyB3YXMgY29waWVkIGZyb20gY29yZS1qcyBiZWZvcmUgbW9kaWZpY2F0aW9uCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2Jsb2IvMWI5NDRkZjU1MjgyY2RjOTljOTBkYjVmNDllYjBiNmVkYTJjYzBhMy9wYWNrYWdlcy9jb3JlLWpzL2ludGVybmFscy9nbG9iYWwuanMKLy8gY29yZS1qcyBoYXMgdGhlIGZvbGxvd2luZyBsaWNlbmNlOgovLwovLyBDb3B5cmlnaHQgKGMpIDIwMTQtMjAyMiBEZW5pcyBQdXNoa2FyZXYKLy8KLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQovLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAovLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCi8vIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6Ci8vCi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgovLwovLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgovLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFCi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgovLyBUSEUgU09GVFdBUkUuCgovKiogUmV0dXJucyAnb2JqJyBpZiBpdCdzIHRoZSBnbG9iYWwgb2JqZWN0LCBvdGhlcndpc2UgcmV0dXJucyB1bmRlZmluZWQgKi8KZnVuY3Rpb24gaXNHbG9iYWxPYmoob2JqKSB7CiAgcmV0dXJuIG9iaiAmJiBvYmouTWF0aCA9PSBNYXRoID8gb2JqIDogdW5kZWZpbmVkOwp9CgovKiogR2V0J3MgdGhlIGdsb2JhbCBvYmplY3QgZm9yIHRoZSBjdXJyZW50IEphdmFTY3JpcHQgcnVudGltZSAqLwpjb25zdCBHTE9CQUxfT0JKID0KICAodHlwZW9mIGdsb2JhbFRoaXMgPT0gJ29iamVjdCcgJiYgaXNHbG9iYWxPYmooZ2xvYmFsVGhpcykpIHx8CiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtZ2xvYmFscwogICh0eXBlb2Ygd2luZG93ID09ICdvYmplY3QnICYmIGlzR2xvYmFsT2JqKHdpbmRvdykpIHx8CiAgKHR5cGVvZiBzZWxmID09ICdvYmplY3QnICYmIGlzR2xvYmFsT2JqKHNlbGYpKSB8fAogICh0eXBlb2YgZ2xvYmFsID09ICdvYmplY3QnICYmIGlzR2xvYmFsT2JqKGdsb2JhbCkpIHx8CiAgKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzOwogIH0pKCkgfHwKICB7fTsKCi8qKgogKiBAZGVwcmVjYXRlZCBVc2UgR0xPQkFMX09CSiBpbnN0ZWFkIG9yIFdJTkRPVyBmcm9tIEBzZW50cnkvYnJvd3Nlci4gVGhpcyB3aWxsIGJlIHJlbW92ZWQgaW4gdjgKICovCmZ1bmN0aW9uIGdldEdsb2JhbE9iamVjdCgpIHsKICByZXR1cm4gR0xPQkFMX09CSiA7Cn0KCi8qKgogKiBSZXR1cm5zIGEgZ2xvYmFsIHNpbmdsZXRvbiBjb250YWluZWQgaW4gdGhlIGdsb2JhbCBgX19TRU5UUllfX2Agb2JqZWN0LgogKgogKiBJZiB0aGUgc2luZ2xldG9uIGRvZXNuJ3QgYWxyZWFkeSBleGlzdCBpbiBgX19TRU5UUllfX2AsIGl0IHdpbGwgYmUgY3JlYXRlZCB1c2luZyB0aGUgZ2l2ZW4gZmFjdG9yeQogKiBmdW5jdGlvbiBhbmQgYWRkZWQgdG8gdGhlIGBfX1NFTlRSWV9fYCBvYmplY3QuCiAqCiAqIEBwYXJhbSBuYW1lIG5hbWUgb2YgdGhlIGdsb2JhbCBzaW5nbGV0b24gb24gX19TRU5UUllfXwogKiBAcGFyYW0gY3JlYXRvciBjcmVhdG9yIEZhY3RvcnkgZnVuY3Rpb24gdG8gY3JlYXRlIHRoZSBzaW5nbGV0b24gaWYgaXQgZG9lc24ndCBhbHJlYWR5IGV4aXN0IG9uIGBfX1NFTlRSWV9fYAogKiBAcGFyYW0gb2JqIChPcHRpb25hbCkgVGhlIGdsb2JhbCBvYmplY3Qgb24gd2hpY2ggdG8gbG9vayBmb3IgYF9fU0VOVFJZX19gLCBpZiBub3QgYEdMT0JBTF9PQkpgJ3MgcmV0dXJuIHZhbHVlCiAqIEByZXR1cm5zIHRoZSBzaW5nbGV0b24KICovCmZ1bmN0aW9uIGdldEdsb2JhbFNpbmdsZXRvbihuYW1lLCBjcmVhdG9yLCBvYmopIHsKICBjb25zdCBnYmwgPSAob2JqIHx8IEdMT0JBTF9PQkopIDsKICBjb25zdCBfX1NFTlRSWV9fID0gKGdibC5fX1NFTlRSWV9fID0gZ2JsLl9fU0VOVFJZX18gfHwge30pOwogIGNvbnN0IHNpbmdsZXRvbiA9IF9fU0VOVFJZX19bbmFtZV0gfHwgKF9fU0VOVFJZX19bbmFtZV0gPSBjcmVhdG9yKCkpOwogIHJldHVybiBzaW5nbGV0b247Cn0KCi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgpjb25zdCBXSU5ET1cgPSBnZXRHbG9iYWxPYmplY3QoKTsKCmNvbnN0IERFRkFVTFRfTUFYX1NUUklOR19MRU5HVEggPSA4MDsKCi8qKgogKiBHaXZlbiBhIGNoaWxkIERPTSBlbGVtZW50LCByZXR1cm5zIGEgcXVlcnktc2VsZWN0b3Igc3RhdGVtZW50IGRlc2NyaWJpbmcgdGhhdAogKiBhbmQgaXRzIGFuY2VzdG9ycwogKiBlLmcuIFtIVE1MRWxlbWVudF0gPT4gYm9keSA+IGRpdiA+IGlucHV0I2Zvby5idG5bbmFtZT1iYXpdCiAqIEByZXR1cm5zIGdlbmVyYXRlZCBET00gcGF0aAogKi8KZnVuY3Rpb24gaHRtbFRyZWVBc1N0cmluZygKICBlbGVtLAogIG9wdGlvbnMgPSB7fSwKKSB7CiAgaWYgKCFlbGVtKSB7CiAgICByZXR1cm4gJzx1bmtub3duPic7CiAgfQoKICAvLyB0cnkvY2F0Y2ggYm90aDoKICAvLyAtIGFjY2Vzc2luZyBldmVudC50YXJnZXQgKHNlZSBnZXRzZW50cnkvcmF2ZW4tanMjODM4LCAjNzY4KQogIC8vIC0gYGh0bWxUcmVlQXNTdHJpbmdgIGJlY2F1c2UgaXQncyBjb21wbGV4LCBhbmQganVzdCBhY2Nlc3NpbmcgdGhlIERPTSBpbmNvcnJlY3RseQogIC8vIC0gY2FuIHRocm93IGFuIGV4Y2VwdGlvbiBpbiBzb21lIGNpcmN1bXN0YW5jZXMuCiAgdHJ5IHsKICAgIGxldCBjdXJyZW50RWxlbSA9IGVsZW0gOwogICAgY29uc3QgTUFYX1RSQVZFUlNFX0hFSUdIVCA9IDU7CiAgICBjb25zdCBvdXQgPSBbXTsKICAgIGxldCBoZWlnaHQgPSAwOwogICAgbGV0IGxlbiA9IDA7CiAgICBjb25zdCBzZXBhcmF0b3IgPSAnID4gJzsKICAgIGNvbnN0IHNlcExlbmd0aCA9IHNlcGFyYXRvci5sZW5ndGg7CiAgICBsZXQgbmV4dFN0cjsKICAgIGNvbnN0IGtleUF0dHJzID0gQXJyYXkuaXNBcnJheShvcHRpb25zKSA/IG9wdGlvbnMgOiBvcHRpb25zLmtleUF0dHJzOwogICAgY29uc3QgbWF4U3RyaW5nTGVuZ3RoID0gKCFBcnJheS5pc0FycmF5KG9wdGlvbnMpICYmIG9wdGlvbnMubWF4U3RyaW5nTGVuZ3RoKSB8fCBERUZBVUxUX01BWF9TVFJJTkdfTEVOR1RIOwoKICAgIHdoaWxlIChjdXJyZW50RWxlbSAmJiBoZWlnaHQrKyA8IE1BWF9UUkFWRVJTRV9IRUlHSFQpIHsKICAgICAgbmV4dFN0ciA9IF9odG1sRWxlbWVudEFzU3RyaW5nKGN1cnJlbnRFbGVtLCBrZXlBdHRycyk7CiAgICAgIC8vIGJhaWwgb3V0IGlmCiAgICAgIC8vIC0gbmV4dFN0ciBpcyB0aGUgJ2h0bWwnIGVsZW1lbnQKICAgICAgLy8gLSB0aGUgbGVuZ3RoIG9mIHRoZSBzdHJpbmcgdGhhdCB3b3VsZCBiZSBjcmVhdGVkIGV4Y2VlZHMgbWF4U3RyaW5nTGVuZ3RoCiAgICAgIC8vICAgKGlnbm9yZSB0aGlzIGxpbWl0IGlmIHdlIGFyZSBvbiB0aGUgZmlyc3QgaXRlcmF0aW9uKQogICAgICBpZiAobmV4dFN0ciA9PT0gJ2h0bWwnIHx8IChoZWlnaHQgPiAxICYmIGxlbiArIG91dC5sZW5ndGggKiBzZXBMZW5ndGggKyBuZXh0U3RyLmxlbmd0aCA+PSBtYXhTdHJpbmdMZW5ndGgpKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIG91dC5wdXNoKG5leHRTdHIpOwoKICAgICAgbGVuICs9IG5leHRTdHIubGVuZ3RoOwogICAgICBjdXJyZW50RWxlbSA9IGN1cnJlbnRFbGVtLnBhcmVudE5vZGU7CiAgICB9CgogICAgcmV0dXJuIG91dC5yZXZlcnNlKCkuam9pbihzZXBhcmF0b3IpOwogIH0gY2F0Y2ggKF9vTykgewogICAgcmV0dXJuICc8dW5rbm93bj4nOwogIH0KfQoKLyoqCiAqIFJldHVybnMgYSBzaW1wbGUsIHF1ZXJ5LXNlbGVjdG9yIHJlcHJlc2VudGF0aW9uIG9mIGEgRE9NIGVsZW1lbnQKICogZS5nLiBbSFRNTEVsZW1lbnRdID0+IGlucHV0I2Zvby5idG5bbmFtZT1iYXpdCiAqIEByZXR1cm5zIGdlbmVyYXRlZCBET00gcGF0aAogKi8KZnVuY3Rpb24gX2h0bWxFbGVtZW50QXNTdHJpbmcoZWwsIGtleUF0dHJzKSB7CiAgY29uc3QgZWxlbSA9IGVsCgo7CgogIGNvbnN0IG91dCA9IFtdOwogIGxldCBjbGFzc05hbWU7CiAgbGV0IGNsYXNzZXM7CiAgbGV0IGtleTsKICBsZXQgYXR0cjsKICBsZXQgaTsKCiAgaWYgKCFlbGVtIHx8ICFlbGVtLnRhZ05hbWUpIHsKICAgIHJldHVybiAnJzsKICB9CgogIC8vIEB0cy1leHBlY3QtZXJyb3IgV0lORE9XIGhhcyBIVE1MRWxlbWVudAogIGlmIChXSU5ET1cuSFRNTEVsZW1lbnQpIHsKICAgIC8vIElmIHVzaW5nIHRoZSBjb21wb25lbnQgbmFtZSBhbm5vdGF0aW9uIHBsdWdpbiwgdGhpcyB2YWx1ZSBtYXkgYmUgYXZhaWxhYmxlIG9uIHRoZSBET00gbm9kZQogICAgaWYgKGVsZW0gaW5zdGFuY2VvZiBIVE1MRWxlbWVudCAmJiBlbGVtLmRhdGFzZXQgJiYgZWxlbS5kYXRhc2V0WydzZW50cnlDb21wb25lbnQnXSkgewogICAgICByZXR1cm4gZWxlbS5kYXRhc2V0WydzZW50cnlDb21wb25lbnQnXTsKICAgIH0KICB9CgogIG91dC5wdXNoKGVsZW0udGFnTmFtZS50b0xvd2VyQ2FzZSgpKTsKCiAgLy8gUGFpcnMgb2YgYXR0cmlidXRlIGtleXMgZGVmaW5lZCBpbiBgc2VyaWFsaXplQXR0cmlidXRlYCBhbmQgdGhlaXIgdmFsdWVzIG9uIGVsZW1lbnQuCiAgY29uc3Qga2V5QXR0clBhaXJzID0KICAgIGtleUF0dHJzICYmIGtleUF0dHJzLmxlbmd0aAogICAgICA/IGtleUF0dHJzLmZpbHRlcihrZXlBdHRyID0+IGVsZW0uZ2V0QXR0cmlidXRlKGtleUF0dHIpKS5tYXAoa2V5QXR0ciA9PiBba2V5QXR0ciwgZWxlbS5nZXRBdHRyaWJ1dGUoa2V5QXR0cildKQogICAgICA6IG51bGw7CgogIGlmIChrZXlBdHRyUGFpcnMgJiYga2V5QXR0clBhaXJzLmxlbmd0aCkgewogICAga2V5QXR0clBhaXJzLmZvckVhY2goa2V5QXR0clBhaXIgPT4gewogICAgICBvdXQucHVzaChgWyR7a2V5QXR0clBhaXJbMF19PSIke2tleUF0dHJQYWlyWzFdfSJdYCk7CiAgICB9KTsKICB9IGVsc2UgewogICAgaWYgKGVsZW0uaWQpIHsKICAgICAgb3V0LnB1c2goYCMke2VsZW0uaWR9YCk7CiAgICB9CgogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZWZlci1jb25zdAogICAgY2xhc3NOYW1lID0gZWxlbS5jbGFzc05hbWU7CiAgICBpZiAoY2xhc3NOYW1lICYmIGlzU3RyaW5nKGNsYXNzTmFtZSkpIHsKICAgICAgY2xhc3NlcyA9IGNsYXNzTmFtZS5zcGxpdCgvXHMrLyk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBjbGFzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgb3V0LnB1c2goYC4ke2NsYXNzZXNbaV19YCk7CiAgICAgIH0KICAgIH0KICB9CiAgY29uc3QgYWxsb3dlZEF0dHJzID0gWydhcmlhLWxhYmVsJywgJ3R5cGUnLCAnbmFtZScsICd0aXRsZScsICdhbHQnXTsKICBmb3IgKGkgPSAwOyBpIDwgYWxsb3dlZEF0dHJzLmxlbmd0aDsgaSsrKSB7CiAgICBrZXkgPSBhbGxvd2VkQXR0cnNbaV07CiAgICBhdHRyID0gZWxlbS5nZXRBdHRyaWJ1dGUoa2V5KTsKICAgIGlmIChhdHRyKSB7CiAgICAgIG91dC5wdXNoKGBbJHtrZXl9PSIke2F0dHJ9Il1gKTsKICAgIH0KICB9CiAgcmV0dXJuIG91dC5qb2luKCcnKTsKfQoKLyoqCiAqIFRoaXMgc2VydmVzIGFzIGEgYnVpbGQgdGltZSBmbGFnIHRoYXQgd2lsbCBiZSB0cnVlIGJ5IGRlZmF1bHQsIGJ1dCBmYWxzZSBpbiBub24tZGVidWcgYnVpbGRzIG9yIGlmIHVzZXJzIHJlcGxhY2UgYF9fU0VOVFJZX0RFQlVHX19gIGluIHRoZWlyIGdlbmVyYXRlZCBjb2RlLgogKgogKiBBVFRFTlRJT046IFRoaXMgY29uc3RhbnQgbXVzdCBuZXZlciBjcm9zcyBwYWNrYWdlIGJvdW5kYXJpZXMgKGkuZS4gYmUgZXhwb3J0ZWQpIHRvIGd1YXJhbnRlZSB0aGF0IGl0IGNhbiBiZSB1c2VkIGZvciB0cmVlIHNoYWtpbmcuCiAqLwpjb25zdCBERUJVR19CVUlMRCQxID0gKHR5cGVvZiBfX1NFTlRSWV9ERUJVR19fID09PSAndW5kZWZpbmVkJyB8fCBfX1NFTlRSWV9ERUJVR19fKTsKCi8qKiBQcmVmaXggZm9yIGxvZ2dpbmcgc3RyaW5ncyAqLwpjb25zdCBQUkVGSVggPSAnU2VudHJ5IExvZ2dlciAnOwoKY29uc3QgQ09OU09MRV9MRVZFTFMgPSBbCiAgJ2RlYnVnJywKICAnaW5mbycsCiAgJ3dhcm4nLAogICdlcnJvcicsCiAgJ2xvZycsCiAgJ2Fzc2VydCcsCiAgJ3RyYWNlJywKXSA7CgovKiogVGhpcyBtYXkgYmUgbXV0YXRlZCBieSB0aGUgY29uc29sZSBpbnN0cnVtZW50YXRpb24uICovCmNvbnN0IG9yaWdpbmFsQ29uc29sZU1ldGhvZHMKCiA9IHt9OwoKLyoqIEpTRG9jICovCgovKioKICogVGVtcG9yYXJpbHkgZGlzYWJsZSBzZW50cnkgY29uc29sZSBpbnN0cnVtZW50YXRpb25zLgogKgogKiBAcGFyYW0gY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIHJ1biBhZ2FpbnN0IHRoZSBvcmlnaW5hbCBgY29uc29sZWAgbWVzc2FnZXMKICogQHJldHVybnMgVGhlIHJlc3VsdHMgb2YgdGhlIGNhbGxiYWNrCiAqLwpmdW5jdGlvbiBjb25zb2xlU2FuZGJveChjYWxsYmFjaykgewogIGlmICghKCdjb25zb2xlJyBpbiBHTE9CQUxfT0JKKSkgewogICAgcmV0dXJuIGNhbGxiYWNrKCk7CiAgfQoKICBjb25zdCBjb25zb2xlID0gR0xPQkFMX09CSi5jb25zb2xlIDsKICBjb25zdCB3cmFwcGVkRnVuY3MgPSB7fTsKCiAgY29uc3Qgd3JhcHBlZExldmVscyA9IE9iamVjdC5rZXlzKG9yaWdpbmFsQ29uc29sZU1ldGhvZHMpIDsKCiAgLy8gUmVzdG9yZSBhbGwgd3JhcHBlZCBjb25zb2xlIG1ldGhvZHMKICB3cmFwcGVkTGV2ZWxzLmZvckVhY2gobGV2ZWwgPT4gewogICAgY29uc3Qgb3JpZ2luYWxDb25zb2xlTWV0aG9kID0gb3JpZ2luYWxDb25zb2xlTWV0aG9kc1tsZXZlbF0gOwogICAgd3JhcHBlZEZ1bmNzW2xldmVsXSA9IGNvbnNvbGVbbGV2ZWxdIDsKICAgIGNvbnNvbGVbbGV2ZWxdID0gb3JpZ2luYWxDb25zb2xlTWV0aG9kOwogIH0pOwoKICB0cnkgewogICAgcmV0dXJuIGNhbGxiYWNrKCk7CiAgfSBmaW5hbGx5IHsKICAgIC8vIFJldmVydCByZXN0b3JhdGlvbiB0byB3cmFwcGVkIHN0YXRlCiAgICB3cmFwcGVkTGV2ZWxzLmZvckVhY2gobGV2ZWwgPT4gewogICAgICBjb25zb2xlW2xldmVsXSA9IHdyYXBwZWRGdW5jc1tsZXZlbF0gOwogICAgfSk7CiAgfQp9CgpmdW5jdGlvbiBtYWtlTG9nZ2VyKCkgewogIGxldCBlbmFibGVkID0gZmFsc2U7CiAgY29uc3QgbG9nZ2VyID0gewogICAgZW5hYmxlOiAoKSA9PiB7CiAgICAgIGVuYWJsZWQgPSB0cnVlOwogICAgfSwKICAgIGRpc2FibGU6ICgpID0+IHsKICAgICAgZW5hYmxlZCA9IGZhbHNlOwogICAgfSwKICAgIGlzRW5hYmxlZDogKCkgPT4gZW5hYmxlZCwKICB9OwoKICBpZiAoREVCVUdfQlVJTEQkMSkgewogICAgQ09OU09MRV9MRVZFTFMuZm9yRWFjaChuYW1lID0+IHsKICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkKICAgICAgbG9nZ2VyW25hbWVdID0gKC4uLmFyZ3MpID0+IHsKICAgICAgICBpZiAoZW5hYmxlZCkgewogICAgICAgICAgY29uc29sZVNhbmRib3goKCkgPT4gewogICAgICAgICAgICBHTE9CQUxfT0JKLmNvbnNvbGVbbmFtZV0oYCR7UFJFRklYfVske25hbWV9XTpgLCAuLi5hcmdzKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKICAgIH0pOwogIH0gZWxzZSB7CiAgICBDT05TT0xFX0xFVkVMUy5mb3JFYWNoKG5hbWUgPT4gewogICAgICBsb2dnZXJbbmFtZV0gPSAoKSA9PiB1bmRlZmluZWQ7CiAgICB9KTsKICB9CgogIHJldHVybiBsb2dnZXIgOwp9Cgpjb25zdCBsb2dnZXIgPSBtYWtlTG9nZ2VyKCk7CgovKioKICogUmVuZGVycyB0aGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgRHNuLgogKgogKiBCeSBkZWZhdWx0LCB0aGlzIHdpbGwgcmVuZGVyIHRoZSBwdWJsaWMgcmVwcmVzZW50YXRpb24gd2l0aG91dCB0aGUgcGFzc3dvcmQKICogY29tcG9uZW50LiBUbyBnZXQgdGhlIGRlcHJlY2F0ZWQgcHJpdmF0ZSByZXByZXNlbnRhdGlvbiwgc2V0IGB3aXRoUGFzc3dvcmRgCiAqIHRvIHRydWUuCiAqCiAqIEBwYXJhbSB3aXRoUGFzc3dvcmQgV2hlbiBzZXQgdG8gdHJ1ZSwgdGhlIHBhc3N3b3JkIHdpbGwgYmUgaW5jbHVkZWQuCiAqLwpmdW5jdGlvbiBkc25Ub1N0cmluZyhkc24sIHdpdGhQYXNzd29yZCA9IGZhbHNlKSB7CiAgY29uc3QgeyBob3N0LCBwYXRoLCBwYXNzLCBwb3J0LCBwcm9qZWN0SWQsIHByb3RvY29sLCBwdWJsaWNLZXkgfSA9IGRzbjsKICByZXR1cm4gKAogICAgYCR7cHJvdG9jb2x9Oi8vJHtwdWJsaWNLZXl9JHt3aXRoUGFzc3dvcmQgJiYgcGFzcyA/IGA6JHtwYXNzfWAgOiAnJ31gICsKICAgIGBAJHtob3N0fSR7cG9ydCA/IGA6JHtwb3J0fWAgOiAnJ30vJHtwYXRoID8gYCR7cGF0aH0vYCA6IHBhdGh9JHtwcm9qZWN0SWR9YAogICk7Cn0KCi8qKiBBbiBlcnJvciBlbWl0dGVkIGJ5IFNlbnRyeSBTREtzIGFuZCByZWxhdGVkIHV0aWxpdGllcy4gKi8KY2xhc3MgU2VudHJ5RXJyb3IgZXh0ZW5kcyBFcnJvciB7CiAgLyoqIERpc3BsYXkgbmFtZSBvZiB0aGlzIGVycm9yIGluc3RhbmNlLiAqLwoKICAgY29uc3RydWN0b3IoIG1lc3NhZ2UsIGxvZ0xldmVsID0gJ3dhcm4nKSB7CiAgICBzdXBlcihtZXNzYWdlKTt0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwogICAgdGhpcy5uYW1lID0gbmV3LnRhcmdldC5wcm90b3R5cGUuY29uc3RydWN0b3IubmFtZTsKICAgIC8vIFRoaXMgc2V0cyB0aGUgcHJvdG90eXBlIHRvIGJlIGBFcnJvcmAsIG5vdCBgU2VudHJ5RXJyb3JgLiBJdCdzIHVuY2xlYXIgd2h5IHdlIGRvIHRoaXMsIGJ1dCBjb21tZW50aW5nIHRoaXMgbGluZQogICAgLy8gb3V0IGNhdXNlcyB2YXJpb3VzIChzZWVtaW5nbHkgdG90YWxseSB1bnJlbGF0ZWQpIHBsYXl3cmlnaHQgdGVzdHMgY29uc2lzdGVudGx5IHRpbWUgb3V0LiBGWUksIHRoaXMgbWFrZXMKICAgIC8vIGluc3RhbmNlcyBvZiBgU2VudHJ5RXJyb3JgIGZhaWwgYG9iaiBpbnN0YW5jZW9mIFNlbnRyeUVycm9yYCBjaGVja3MuCiAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcywgbmV3LnRhcmdldC5wcm90b3R5cGUpOwogICAgdGhpcy5sb2dMZXZlbCA9IGxvZ0xldmVsOwogIH0KfQoKLyoqCiAqIEVuY29kZXMgZ2l2ZW4gb2JqZWN0IGludG8gdXJsLWZyaWVuZGx5IGZvcm1hdAogKgogKiBAcGFyYW0gb2JqZWN0IEFuIG9iamVjdCB0aGF0IGNvbnRhaW5zIHNlcmlhbGl6YWJsZSB2YWx1ZXMKICogQHJldHVybnMgc3RyaW5nIEVuY29kZWQKICovCmZ1bmN0aW9uIHVybEVuY29kZShvYmplY3QpIHsKICByZXR1cm4gT2JqZWN0LmtleXMob2JqZWN0KQogICAgLm1hcChrZXkgPT4gYCR7ZW5jb2RlVVJJQ29tcG9uZW50KGtleSl9PSR7ZW5jb2RlVVJJQ29tcG9uZW50KG9iamVjdFtrZXldKX1gKQogICAgLmpvaW4oJyYnKTsKfQoKLyoqCiAqIFRyYW5zZm9ybXMgYW55IGBFcnJvcmAgb3IgYEV2ZW50YCBpbnRvIGEgcGxhaW4gb2JqZWN0IHdpdGggYWxsIG9mIHRoZWlyIGVudW1lcmFibGUgcHJvcGVydGllcywgYW5kIHNvbWUgb2YgdGhlaXIKICogbm9uLWVudW1lcmFibGUgcHJvcGVydGllcyBhdHRhY2hlZC4KICoKICogQHBhcmFtIHZhbHVlIEluaXRpYWwgc291cmNlIHRoYXQgd2UgaGF2ZSB0byB0cmFuc2Zvcm0gaW4gb3JkZXIgZm9yIGl0IHRvIGJlIHVzYWJsZSBieSB0aGUgc2VyaWFsaXplcgogKiBAcmV0dXJucyBBbiBFdmVudCBvciBFcnJvciB0dXJuZWQgaW50byBhbiBvYmplY3QgLSBvciB0aGUgdmFsdWUgYXJndXJtZW50IGl0c2VsZiwgd2hlbiB2YWx1ZSBpcyBuZWl0aGVyIGFuIEV2ZW50IG5vcgogKiAgYW4gRXJyb3IuCiAqLwpmdW5jdGlvbiBjb252ZXJ0VG9QbGFpbk9iamVjdCgKICB2YWx1ZSwKKQoKIHsKICBpZiAoaXNFcnJvcih2YWx1ZSkpIHsKICAgIHJldHVybiB7CiAgICAgIG1lc3NhZ2U6IHZhbHVlLm1lc3NhZ2UsCiAgICAgIG5hbWU6IHZhbHVlLm5hbWUsCiAgICAgIHN0YWNrOiB2YWx1ZS5zdGFjaywKICAgICAgLi4uZ2V0T3duUHJvcGVydGllcyh2YWx1ZSksCiAgICB9OwogIH0gZWxzZSBpZiAoaXNFdmVudCh2YWx1ZSkpIHsKICAgIGNvbnN0IG5ld09iagoKID0gewogICAgICB0eXBlOiB2YWx1ZS50eXBlLAogICAgICB0YXJnZXQ6IHNlcmlhbGl6ZUV2ZW50VGFyZ2V0KHZhbHVlLnRhcmdldCksCiAgICAgIGN1cnJlbnRUYXJnZXQ6IHNlcmlhbGl6ZUV2ZW50VGFyZ2V0KHZhbHVlLmN1cnJlbnRUYXJnZXQpLAogICAgICAuLi5nZXRPd25Qcm9wZXJ0aWVzKHZhbHVlKSwKICAgIH07CgogICAgaWYgKHR5cGVvZiBDdXN0b21FdmVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgaXNJbnN0YW5jZU9mKHZhbHVlLCBDdXN0b21FdmVudCkpIHsKICAgICAgbmV3T2JqLmRldGFpbCA9IHZhbHVlLmRldGFpbDsKICAgIH0KCiAgICByZXR1cm4gbmV3T2JqOwogIH0gZWxzZSB7CiAgICByZXR1cm4gdmFsdWU7CiAgfQp9CgovKiogQ3JlYXRlcyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgdGFyZ2V0IG9mIGFuIGBFdmVudGAgb2JqZWN0ICovCmZ1bmN0aW9uIHNlcmlhbGl6ZUV2ZW50VGFyZ2V0KHRhcmdldCkgewogIHRyeSB7CiAgICByZXR1cm4gaXNFbGVtZW50KHRhcmdldCkgPyBodG1sVHJlZUFzU3RyaW5nKHRhcmdldCkgOiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodGFyZ2V0KTsKICB9IGNhdGNoIChfb08pIHsKICAgIHJldHVybiAnPHVua25vd24+JzsKICB9Cn0KCi8qKiBGaWx0ZXJzIG91dCBhbGwgYnV0IGFuIG9iamVjdCdzIG93biBwcm9wZXJ0aWVzICovCmZ1bmN0aW9uIGdldE93blByb3BlcnRpZXMob2JqKSB7CiAgaWYgKHR5cGVvZiBvYmogPT09ICdvYmplY3QnICYmIG9iaiAhPT0gbnVsbCkgewogICAgY29uc3QgZXh0cmFjdGVkUHJvcHMgPSB7fTsKICAgIGZvciAoY29uc3QgcHJvcGVydHkgaW4gb2JqKSB7CiAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wZXJ0eSkpIHsKICAgICAgICBleHRyYWN0ZWRQcm9wc1twcm9wZXJ0eV0gPSAob2JqIClbcHJvcGVydHldOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZXh0cmFjdGVkUHJvcHM7CiAgfSBlbHNlIHsKICAgIHJldHVybiB7fTsKICB9Cn0KCi8qKgogKiBHaXZlbiBhbnkgb2JqZWN0LCByZXR1cm4gYSBuZXcgb2JqZWN0IGhhdmluZyByZW1vdmVkIGFsbCBmaWVsZHMgd2hvc2UgdmFsdWUgd2FzIGB1bmRlZmluZWRgLgogKiBXb3JrcyByZWN1cnNpdmVseSBvbiBvYmplY3RzIGFuZCBhcnJheXMuCiAqCiAqIEF0dGVudGlvbjogVGhpcyBmdW5jdGlvbiBrZWVwcyBjaXJjdWxhciByZWZlcmVuY2VzIGluIHRoZSByZXR1cm5lZCBvYmplY3QuCiAqLwpmdW5jdGlvbiBkcm9wVW5kZWZpbmVkS2V5cyhpbnB1dFZhbHVlKSB7CiAgLy8gVGhpcyBtYXAga2VlcHMgdHJhY2sgb2Ygd2hhdCBhbHJlYWR5IHZpc2l0ZWQgbm9kZXMgbWFwIHRvLgogIC8vIE91ciBTZXQgLSBiYXNlZCBtZW1vQnVpbGRlciBkb2Vzbid0IHdvcmsgaGVyZSBiZWNhdXNlIHdlIHdhbnQgdG8gdGhlIG91dHB1dCBvYmplY3QgdG8gaGF2ZSB0aGUgc2FtZSBjaXJjdWxhcgogIC8vIHJlZmVyZW5jZXMgYXMgdGhlIGlucHV0IG9iamVjdC4KICBjb25zdCBtZW1vaXphdGlvbk1hcCA9IG5ldyBNYXAoKTsKCiAgLy8gVGhpcyBmdW5jdGlvbiBqdXN0IHByb3hpZXMgYF9kcm9wVW5kZWZpbmVkS2V5c2AgdG8ga2VlcCB0aGUgYG1lbW9CdWlsZGVyYCBvdXQgb2YgdGhpcyBmdW5jdGlvbidzIEFQSQogIHJldHVybiBfZHJvcFVuZGVmaW5lZEtleXMoaW5wdXRWYWx1ZSwgbWVtb2l6YXRpb25NYXApOwp9CgpmdW5jdGlvbiBfZHJvcFVuZGVmaW5lZEtleXMoaW5wdXRWYWx1ZSwgbWVtb2l6YXRpb25NYXApIHsKICBpZiAoaXNQb2pvKGlucHV0VmFsdWUpKSB7CiAgICAvLyBJZiB0aGlzIG5vZGUgaGFzIGFscmVhZHkgYmVlbiB2aXNpdGVkIGR1ZSB0byBhIGNpcmN1bGFyIHJlZmVyZW5jZSwgcmV0dXJuIHRoZSBvYmplY3QgaXQgd2FzIG1hcHBlZCB0byBpbiB0aGUgbmV3IG9iamVjdAogICAgY29uc3QgbWVtb1ZhbCA9IG1lbW9pemF0aW9uTWFwLmdldChpbnB1dFZhbHVlKTsKICAgIGlmIChtZW1vVmFsICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIG1lbW9WYWwgOwogICAgfQoKICAgIGNvbnN0IHJldHVyblZhbHVlID0ge307CiAgICAvLyBTdG9yZSB0aGUgbWFwcGluZyBvZiB0aGlzIHZhbHVlIGluIGNhc2Ugd2UgdmlzaXQgaXQgYWdhaW4sIGluIGNhc2Ugb2YgY2lyY3VsYXIgZGF0YQogICAgbWVtb2l6YXRpb25NYXAuc2V0KGlucHV0VmFsdWUsIHJldHVyblZhbHVlKTsKCiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhpbnB1dFZhbHVlKSkgewogICAgICBpZiAodHlwZW9mIGlucHV0VmFsdWVba2V5XSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICByZXR1cm5WYWx1ZVtrZXldID0gX2Ryb3BVbmRlZmluZWRLZXlzKGlucHV0VmFsdWVba2V5XSwgbWVtb2l6YXRpb25NYXApOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHJldHVyblZhbHVlIDsKICB9CgogIGlmIChBcnJheS5pc0FycmF5KGlucHV0VmFsdWUpKSB7CiAgICAvLyBJZiB0aGlzIG5vZGUgaGFzIGFscmVhZHkgYmVlbiB2aXNpdGVkIGR1ZSB0byBhIGNpcmN1bGFyIHJlZmVyZW5jZSwgcmV0dXJuIHRoZSBhcnJheSBpdCB3YXMgbWFwcGVkIHRvIGluIHRoZSBuZXcgb2JqZWN0CiAgICBjb25zdCBtZW1vVmFsID0gbWVtb2l6YXRpb25NYXAuZ2V0KGlucHV0VmFsdWUpOwogICAgaWYgKG1lbW9WYWwgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gbWVtb1ZhbCA7CiAgICB9CgogICAgY29uc3QgcmV0dXJuVmFsdWUgPSBbXTsKICAgIC8vIFN0b3JlIHRoZSBtYXBwaW5nIG9mIHRoaXMgdmFsdWUgaW4gY2FzZSB3ZSB2aXNpdCBpdCBhZ2FpbiwgaW4gY2FzZSBvZiBjaXJjdWxhciBkYXRhCiAgICBtZW1vaXphdGlvbk1hcC5zZXQoaW5wdXRWYWx1ZSwgcmV0dXJuVmFsdWUpOwoKICAgIGlucHV0VmFsdWUuZm9yRWFjaCgoaXRlbSkgPT4gewogICAgICByZXR1cm5WYWx1ZS5wdXNoKF9kcm9wVW5kZWZpbmVkS2V5cyhpdGVtLCBtZW1vaXphdGlvbk1hcCkpOwogICAgfSk7CgogICAgcmV0dXJuIHJldHVyblZhbHVlIDsKICB9CgogIHJldHVybiBpbnB1dFZhbHVlOwp9CgpmdW5jdGlvbiBpc1Bvam8oaW5wdXQpIHsKICBpZiAoIWlzUGxhaW5PYmplY3QoaW5wdXQpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICB0cnkgewogICAgY29uc3QgbmFtZSA9IChPYmplY3QuZ2V0UHJvdG90eXBlT2YoaW5wdXQpICkuY29uc3RydWN0b3IubmFtZTsKICAgIHJldHVybiAhbmFtZSB8fCBuYW1lID09PSAnT2JqZWN0JzsKICB9IGNhdGNoIChlKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCi8qKgogKiBEb2VzIHRoaXMgZmlsZW5hbWUgbG9vayBsaWtlIGl0J3MgcGFydCBvZiB0aGUgYXBwIGNvZGU/CiAqLwpmdW5jdGlvbiBmaWxlbmFtZUlzSW5BcHAoZmlsZW5hbWUsIGlzTmF0aXZlID0gZmFsc2UpIHsKICBjb25zdCBpc0ludGVybmFsID0KICAgIGlzTmF0aXZlIHx8CiAgICAoZmlsZW5hbWUgJiYKICAgICAgLy8gSXQncyBub3QgaW50ZXJuYWwgaWYgaXQncyBhbiBhYnNvbHV0ZSBsaW51eCBwYXRoCiAgICAgICFmaWxlbmFtZS5zdGFydHNXaXRoKCcvJykgJiYKICAgICAgLy8gSXQncyBub3QgaW50ZXJuYWwgaWYgaXQncyBhbiBhYnNvbHV0ZSB3aW5kb3dzIHBhdGgKICAgICAgIWZpbGVuYW1lLm1hdGNoKC9eW0EtWl06LykgJiYKICAgICAgLy8gSXQncyBub3QgaW50ZXJuYWwgaWYgdGhlIHBhdGggaXMgc3RhcnRpbmcgd2l0aCBhIGRvdAogICAgICAhZmlsZW5hbWUuc3RhcnRzV2l0aCgnLicpICYmCiAgICAgIC8vIEl0J3Mgbm90IGludGVybmFsIGlmIHRoZSBmcmFtZSBoYXMgYSBwcm90b2NvbC4gSW4gbm9kZSwgdGhpcyBpcyB1c3VhbGx5IHRoZSBjYXNlIGlmIHRoZSBmaWxlIGdvdCBwcmUtcHJvY2Vzc2VkIHdpdGggYSBidW5kbGVyIGxpa2Ugd2VicGFjawogICAgICAhZmlsZW5hbWUubWF0Y2goL15bYS16QS1aXShbYS16QS1aMC05LlwtK10pKjpcL1wvLykpOyAvLyBTY2hlbWEgZnJvbTogaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzM2NDE3ODIKCiAgLy8gaW5fYXBwIGlzIGFsbCB0aGF0J3Mgbm90IGFuIGludGVybmFsIE5vZGUgZnVuY3Rpb24gb3IgYSBtb2R1bGUgd2l0aGluIG5vZGVfbW9kdWxlcwogIC8vIG5vdGUgdGhhdCBpc05hdGl2ZSBhcHBlYXJzIHRvIHJldHVybiB0cnVlIGV2ZW4gZm9yIG5vZGUgY29yZSBsaWJyYXJpZXMKICAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2dldHNlbnRyeS9yYXZlbi1ub2RlL2lzc3Vlcy8xNzYKCiAgcmV0dXJuICFpc0ludGVybmFsICYmIGZpbGVuYW1lICE9PSB1bmRlZmluZWQgJiYgIWZpbGVuYW1lLmluY2x1ZGVzKCdub2RlX21vZHVsZXMvJyk7Cn0KCmNvbnN0IFNUQUNLVFJBQ0VfRlJBTUVfTElNSVQgPSA1MDsKY29uc3QgU1RSSVBfRlJBTUVfUkVHRVhQID0gL2NhcHR1cmVNZXNzYWdlfGNhcHR1cmVFeGNlcHRpb24vOwoKLyoqCiAqIFJlbW92ZXMgU2VudHJ5IGZyYW1lcyBmcm9tIHRoZSB0b3AgYW5kIGJvdHRvbSBvZiB0aGUgc3RhY2sgaWYgcHJlc2VudCBhbmQgZW5mb3JjZXMgYSBsaW1pdCBvZiBtYXggbnVtYmVyIG9mIGZyYW1lcy4KICogQXNzdW1lcyBzdGFjayBpbnB1dCBpcyBvcmRlcmVkIGZyb20gdG9wIHRvIGJvdHRvbSBhbmQgcmV0dXJucyB0aGUgcmV2ZXJzZSByZXByZXNlbnRhdGlvbiBzbyBjYWxsIHNpdGUgb2YgdGhlCiAqIGZ1bmN0aW9uIHRoYXQgY2F1c2VkIHRoZSBjcmFzaCBpcyB0aGUgbGFzdCBmcmFtZSBpbiB0aGUgYXJyYXkuCiAqIEBoaWRkZW4KICovCmZ1bmN0aW9uIHN0cmlwU2VudHJ5RnJhbWVzQW5kUmV2ZXJzZShzdGFjaykgewogIGlmICghc3RhY2subGVuZ3RoKSB7CiAgICByZXR1cm4gW107CiAgfQoKICBjb25zdCBsb2NhbFN0YWNrID0gQXJyYXkuZnJvbShzdGFjayk7CgogIC8vIElmIHN0YWNrIHN0YXJ0cyB3aXRoIG9uZSBvZiBvdXIgQVBJIGNhbGxzLCByZW1vdmUgaXQgKHN0YXJ0cywgbWVhbmluZyBpdCdzIHRoZSB0b3Agb2YgdGhlIHN0YWNrIC0gYWthIGxhc3QgY2FsbCkKICBpZiAoL3NlbnRyeVdyYXBwZWQvLnRlc3QobG9jYWxTdGFja1tsb2NhbFN0YWNrLmxlbmd0aCAtIDFdLmZ1bmN0aW9uIHx8ICcnKSkgewogICAgbG9jYWxTdGFjay5wb3AoKTsKICB9CgogIC8vIFJldmVyc2luZyBpbiB0aGUgbWlkZGxlIG9mIHRoZSBwcm9jZWR1cmUgYWxsb3dzIHVzIHRvIGp1c3QgcG9wIHRoZSB2YWx1ZXMgb2ZmIHRoZSBzdGFjawogIGxvY2FsU3RhY2sucmV2ZXJzZSgpOwoKICAvLyBJZiBzdGFjayBlbmRzIHdpdGggb25lIG9mIG91ciBpbnRlcm5hbCBBUEkgY2FsbHMsIHJlbW92ZSBpdCAoZW5kcywgbWVhbmluZyBpdCdzIHRoZSBib3R0b20gb2YgdGhlIHN0YWNrIC0gYWthIHRvcC1tb3N0IGNhbGwpCiAgaWYgKFNUUklQX0ZSQU1FX1JFR0VYUC50ZXN0KGxvY2FsU3RhY2tbbG9jYWxTdGFjay5sZW5ndGggLSAxXS5mdW5jdGlvbiB8fCAnJykpIHsKICAgIGxvY2FsU3RhY2sucG9wKCk7CgogICAgLy8gV2hlbiB1c2luZyBzeW50aGV0aWMgZXZlbnRzLCB3ZSB3aWxsIGhhdmUgYSAyIGxldmVscyBkZWVwIHN0YWNrLCBhcyBgbmV3IEVycm9yKCdTZW50cnkgc3ludGhldGljRXhjZXB0aW9uJylgCiAgICAvLyBpcyBwcm9kdWNlZCB3aXRoaW4gdGhlIGh1YiBpdHNlbGYsIG1ha2luZyBpdDoKICAgIC8vCiAgICAvLyAgIFNlbnRyeS5jYXB0dXJlRXhjZXB0aW9uKCkKICAgIC8vICAgZ2V0Q3VycmVudEh1YigpLmNhcHR1cmVFeGNlcHRpb24oKQogICAgLy8KICAgIC8vIGluc3RlYWQgb2YganVzdCB0aGUgdG9wIGBTZW50cnlgIGNhbGwgaXRzZWxmLgogICAgLy8gVGhpcyBmb3JjZXMgdXMgdG8gcG9zc2libHkgc3RyaXAgYW4gYWRkaXRpb25hbCBmcmFtZSBpbiB0aGUgZXhhY3Qgc2FtZSB3YXMgYXMgYWJvdmUuCiAgICBpZiAoU1RSSVBfRlJBTUVfUkVHRVhQLnRlc3QobG9jYWxTdGFja1tsb2NhbFN0YWNrLmxlbmd0aCAtIDFdLmZ1bmN0aW9uIHx8ICcnKSkgewogICAgICBsb2NhbFN0YWNrLnBvcCgpOwogICAgfQogIH0KCiAgcmV0dXJuIGxvY2FsU3RhY2suc2xpY2UoMCwgU1RBQ0tUUkFDRV9GUkFNRV9MSU1JVCkubWFwKGZyYW1lID0+ICh7CiAgICAuLi5mcmFtZSwKICAgIGZpbGVuYW1lOiBmcmFtZS5maWxlbmFtZSB8fCBsb2NhbFN0YWNrW2xvY2FsU3RhY2subGVuZ3RoIC0gMV0uZmlsZW5hbWUsCiAgICBmdW5jdGlvbjogZnJhbWUuZnVuY3Rpb24gfHwgJz8nLAogIH0pKTsKfQoKY29uc3QgZGVmYXVsdEZ1bmN0aW9uTmFtZSA9ICc8YW5vbnltb3VzPic7CgovKioKICogU2FmZWx5IGV4dHJhY3QgZnVuY3Rpb24gbmFtZSBmcm9tIGl0c2VsZgogKi8KZnVuY3Rpb24gZ2V0RnVuY3Rpb25OYW1lKGZuKSB7CiAgdHJ5IHsKICAgIGlmICghZm4gfHwgdHlwZW9mIGZuICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgIHJldHVybiBkZWZhdWx0RnVuY3Rpb25OYW1lOwogICAgfQogICAgcmV0dXJuIGZuLm5hbWUgfHwgZGVmYXVsdEZ1bmN0aW9uTmFtZTsKICB9IGNhdGNoIChlKSB7CiAgICAvLyBKdXN0IGFjY2Vzc2luZyBjdXN0b20gcHJvcHMgaW4gc29tZSBTZWxlbml1bSBlbnZpcm9ubWVudHMKICAgIC8vIGNhbiBjYXVzZSBhICJQZXJtaXNzaW9uIGRlbmllZCIgZXhjZXB0aW9uIChzZWUgcmF2ZW4tanMjNDk1KS4KICAgIHJldHVybiBkZWZhdWx0RnVuY3Rpb25OYW1lOwogIH0KfQoKLyoqCiAqIFVVSUQ0IGdlbmVyYXRvcgogKgogKiBAcmV0dXJucyBzdHJpbmcgR2VuZXJhdGVkIFVVSUQ0LgogKi8KZnVuY3Rpb24gdXVpZDQoKSB7CiAgY29uc3QgZ2JsID0gR0xPQkFMX09CSiA7CiAgY29uc3QgY3J5cHRvID0gZ2JsLmNyeXB0byB8fCBnYmwubXNDcnlwdG87CgogIGxldCBnZXRSYW5kb21CeXRlID0gKCkgPT4gTWF0aC5yYW5kb20oKSAqIDE2OwogIHRyeSB7CiAgICBpZiAoY3J5cHRvICYmIGNyeXB0by5yYW5kb21VVUlEKSB7CiAgICAgIHJldHVybiBjcnlwdG8ucmFuZG9tVVVJRCgpLnJlcGxhY2UoLy0vZywgJycpOwogICAgfQogICAgaWYgKGNyeXB0byAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKSB7CiAgICAgIGdldFJhbmRvbUJ5dGUgPSAoKSA9PiB7CiAgICAgICAgLy8gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyBtaWdodCByZXR1cm4gdW5kZWZpbmVkIGluc3RlYWQgb2YgdGhlIHR5cGVkIGFycmF5CiAgICAgICAgLy8gaW4gb2xkIENocm9taXVtIHZlcnNpb25zIChlLmcuIDIzLjAuMTIzNS4wICgxNTE0MjIpKQogICAgICAgIC8vIEhvd2V2ZXIsIGB0eXBlZEFycmF5YCBpcyBzdGlsbCBmaWxsZWQgaW4tcGxhY2UuCiAgICAgICAgLy8gQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvQ3J5cHRvL2dldFJhbmRvbVZhbHVlcyN0eXBlZGFycmF5CiAgICAgICAgY29uc3QgdHlwZWRBcnJheSA9IG5ldyBVaW50OEFycmF5KDEpOwogICAgICAgIGNyeXB0by5nZXRSYW5kb21WYWx1ZXModHlwZWRBcnJheSk7CiAgICAgICAgcmV0dXJuIHR5cGVkQXJyYXlbMF07CiAgICAgIH07CiAgICB9CiAgfSBjYXRjaCAoXykgewogICAgLy8gc29tZSBydW50aW1lcyBjYW4gY3Jhc2ggaW52b2tpbmcgY3J5cHRvCiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZ2V0c2VudHJ5L3NlbnRyeS1qYXZhc2NyaXB0L2lzc3Vlcy84OTM1CiAgfQoKICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEwNTAzNC9ob3ctdG8tY3JlYXRlLWEtZ3VpZC11dWlkLWluLWphdmFzY3JpcHQvMjExNzUyMyMyMTE3NTIzCiAgLy8gQ29uY2F0ZW5hdGluZyB0aGUgZm9sbG93aW5nIG51bWJlcnMgYXMgc3RyaW5ncyByZXN1bHRzIGluICcxMDAwMDAwMDEwMDA0MDAwODAwMDEwMDAwMDAwMDAwMCcKICByZXR1cm4gKChbMWU3XSApICsgMWUzICsgNGUzICsgOGUzICsgMWUxMSkucmVwbGFjZSgvWzAxOF0vZywgYyA9PgogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2UKICAgICgoYyApIF4gKChnZXRSYW5kb21CeXRlKCkgJiAxNSkgPj4gKChjICkgLyA0KSkpLnRvU3RyaW5nKDE2KSwKICApOwp9CgovKioKICogQ2hlY2tzIHdoZXRoZXIgdGhlIGdpdmVuIGlucHV0IGlzIGFscmVhZHkgYW4gYXJyYXksIGFuZCBpZiBpdCBpc24ndCwgd3JhcHMgaXQgaW4gb25lLgogKgogKiBAcGFyYW0gbWF5YmVBcnJheSBJbnB1dCB0byB0dXJuIGludG8gYW4gYXJyYXksIGlmIG5lY2Vzc2FyeQogKiBAcmV0dXJucyBUaGUgaW5wdXQsIGlmIGFscmVhZHkgYW4gYXJyYXksIG9yIGFuIGFycmF5IHdpdGggdGhlIGlucHV0IGFzIHRoZSBvbmx5IGVsZW1lbnQsIGlmIG5vdAogKi8KZnVuY3Rpb24gYXJyYXlpZnkobWF5YmVBcnJheSkgewogIHJldHVybiBBcnJheS5pc0FycmF5KG1heWJlQXJyYXkpID8gbWF5YmVBcnJheSA6IFttYXliZUFycmF5XTsKfQoKLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1tZW1iZXItYWNjZXNzICovCi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkgKi8KCi8qKgogKiBIZWxwZXIgdG8gZGVjeWNsZSBqc29uIG9iamVjdHMKICovCmZ1bmN0aW9uIG1lbW9CdWlsZGVyKCkgewogIGNvbnN0IGhhc1dlYWtTZXQgPSB0eXBlb2YgV2Vha1NldCA9PT0gJ2Z1bmN0aW9uJzsKICBjb25zdCBpbm5lciA9IGhhc1dlYWtTZXQgPyBuZXcgV2Vha1NldCgpIDogW107CiAgZnVuY3Rpb24gbWVtb2l6ZShvYmopIHsKICAgIGlmIChoYXNXZWFrU2V0KSB7CiAgICAgIGlmIChpbm5lci5oYXMob2JqKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlubmVyLmFkZChvYmopOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3ByZWZlci1mb3Itb2YKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5uZXIubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgdmFsdWUgPSBpbm5lcltpXTsKICAgICAgaWYgKHZhbHVlID09PSBvYmopIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQogICAgaW5uZXIucHVzaChvYmopOwogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gdW5tZW1vaXplKG9iaikgewogICAgaWYgKGhhc1dlYWtTZXQpIHsKICAgICAgaW5uZXIuZGVsZXRlKG9iaik7CiAgICB9IGVsc2UgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlubmVyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGlubmVyW2ldID09PSBvYmopIHsKICAgICAgICAgIGlubmVyLnNwbGljZShpLCAxKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICByZXR1cm4gW21lbW9pemUsIHVubWVtb2l6ZV07Cn0KCi8qKgogKiBSZWN1cnNpdmVseSBub3JtYWxpemVzIHRoZSBnaXZlbiBvYmplY3QuCiAqCiAqIC0gQ3JlYXRlcyBhIGNvcHkgdG8gcHJldmVudCBvcmlnaW5hbCBpbnB1dCBtdXRhdGlvbgogKiAtIFNraXBzIG5vbi1lbnVtZXJhYmxlIHByb3BlcnRpZXMKICogLSBXaGVuIHN0cmluZ2lmeWluZywgY2FsbHMgYHRvSlNPTmAgaWYgaW1wbGVtZW50ZWQKICogLSBSZW1vdmVzIGNpcmN1bGFyIHJlZmVyZW5jZXMKICogLSBUcmFuc2xhdGVzIG5vbi1zZXJpYWxpemFibGUgdmFsdWVzIChgdW5kZWZpbmVkYC9gTmFOYC9mdW5jdGlvbnMpIHRvIHNlcmlhbGl6YWJsZSBmb3JtYXQKICogLSBUcmFuc2xhdGVzIGtub3duIGdsb2JhbCBvYmplY3RzL2NsYXNzZXMgdG8gYSBzdHJpbmcgcmVwcmVzZW50YXRpb25zCiAqIC0gVGFrZXMgY2FyZSBvZiBgRXJyb3JgIG9iamVjdCBzZXJpYWxpemF0aW9uCiAqIC0gT3B0aW9uYWxseSBsaW1pdHMgZGVwdGggb2YgZmluYWwgb3V0cHV0CiAqIC0gT3B0aW9uYWxseSBsaW1pdHMgbnVtYmVyIG9mIHByb3BlcnRpZXMvZWxlbWVudHMgaW5jbHVkZWQgaW4gYW55IHNpbmdsZSBvYmplY3QvYXJyYXkKICoKICogQHBhcmFtIGlucHV0IFRoZSBvYmplY3QgdG8gYmUgbm9ybWFsaXplZC4KICogQHBhcmFtIGRlcHRoIFRoZSBtYXggZGVwdGggdG8gd2hpY2ggdG8gbm9ybWFsaXplIHRoZSBvYmplY3QuIChBbnl0aGluZyBkZWVwZXIgc3RyaW5naWZpZWQgd2hvbGUuKQogKiBAcGFyYW0gbWF4UHJvcGVydGllcyBUaGUgbWF4IG51bWJlciBvZiBlbGVtZW50cyBvciBwcm9wZXJ0aWVzIHRvIGJlIGluY2x1ZGVkIGluIGFueSBzaW5nbGUgYXJyYXkgb3IKICogb2JqZWN0IGluIHRoZSBub3JtYWxsaXplZCBvdXRwdXQuCiAqIEByZXR1cm5zIEEgbm9ybWFsaXplZCB2ZXJzaW9uIG9mIHRoZSBvYmplY3QsIG9yIGAiKipub24tc2VyaWFsaXphYmxlKioiYCBpZiBhbnkgZXJyb3JzIGFyZSB0aHJvd24gZHVyaW5nIG5vcm1hbGl6YXRpb24uCiAqLwovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQpmdW5jdGlvbiBub3JtYWxpemUoaW5wdXQsIGRlcHRoID0gMTAwLCBtYXhQcm9wZXJ0aWVzID0gK0luZmluaXR5KSB7CiAgdHJ5IHsKICAgIC8vIHNpbmNlIHdlJ3JlIGF0IHRoZSBvdXRlcm1vc3QgbGV2ZWwsIHdlIGRvbid0IHByb3ZpZGUgYSBrZXkKICAgIHJldHVybiB2aXNpdCgnJywgaW5wdXQsIGRlcHRoLCBtYXhQcm9wZXJ0aWVzKTsKICB9IGNhdGNoIChlcnIpIHsKICAgIHJldHVybiB7IEVSUk9SOiBgKipub24tc2VyaWFsaXphYmxlKiogKCR7ZXJyfSlgIH07CiAgfQp9CgovKioKICogVmlzaXRzIGEgbm9kZSB0byBwZXJmb3JtIG5vcm1hbGl6YXRpb24gb24gaXQKICoKICogQHBhcmFtIGtleSBUaGUga2V5IGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIG5vZGUKICogQHBhcmFtIHZhbHVlIFRoZSBub2RlIHRvIGJlIHZpc2l0ZWQKICogQHBhcmFtIGRlcHRoIE9wdGlvbmFsIG51bWJlciBpbmRpY2F0aW5nIHRoZSBtYXhpbXVtIHJlY3Vyc2lvbiBkZXB0aAogKiBAcGFyYW0gbWF4UHJvcGVydGllcyBPcHRpb25hbCBtYXhpbXVtIG51bWJlciBvZiBwcm9wZXJ0aWVzL2VsZW1lbnRzIGluY2x1ZGVkIGluIGFueSBzaW5nbGUgb2JqZWN0L2FycmF5CiAqIEBwYXJhbSBtZW1vIE9wdGlvbmFsIE1lbW8gY2xhc3MgaGFuZGxpbmcgZGVjeWNsaW5nCiAqLwpmdW5jdGlvbiB2aXNpdCgKICBrZXksCiAgdmFsdWUsCiAgZGVwdGggPSArSW5maW5pdHksCiAgbWF4UHJvcGVydGllcyA9ICtJbmZpbml0eSwKICBtZW1vID0gbWVtb0J1aWxkZXIoKSwKKSB7CiAgY29uc3QgW21lbW9pemUsIHVubWVtb2l6ZV0gPSBtZW1vOwoKICAvLyBHZXQgdGhlIHNpbXBsZSBjYXNlcyBvdXQgb2YgdGhlIHdheSBmaXJzdAogIGlmICgKICAgIHZhbHVlID09IG51bGwgfHwgLy8gdGhpcyBtYXRjaGVzIG51bGwgYW5kIHVuZGVmaW5lZCAtPiBlcWVxIG5vdCBlcWVxZXEKICAgIChbJ251bWJlcicsICdib29sZWFuJywgJ3N0cmluZyddLmluY2x1ZGVzKHR5cGVvZiB2YWx1ZSkgJiYgIWlzTmFOJDEodmFsdWUpKQogICkgewogICAgcmV0dXJuIHZhbHVlIDsKICB9CgogIGNvbnN0IHN0cmluZ2lmaWVkID0gc3RyaW5naWZ5VmFsdWUoa2V5LCB2YWx1ZSk7CgogIC8vIEFueXRoaW5nIHdlIGNvdWxkIHBvdGVudGlhbGx5IGRpZyBpbnRvIG1vcmUgKG9iamVjdHMgb3IgYXJyYXlzKSB3aWxsIGhhdmUgY29tZSBiYWNrIGFzIGAiW29iamVjdCBYWFhYXSJgLgogIC8vIEV2ZXJ5dGhpbmcgZWxzZSB3aWxsIGhhdmUgYWxyZWFkeSBiZWVuIHNlcmlhbGl6ZWQsIHNvIGlmIHdlIGRvbid0IHNlZSB0aGF0IHBhdHRlcm4sIHdlJ3JlIGRvbmUuCiAgaWYgKCFzdHJpbmdpZmllZC5zdGFydHNXaXRoKCdbb2JqZWN0ICcpKSB7CiAgICByZXR1cm4gc3RyaW5naWZpZWQ7CiAgfQoKICAvLyBGcm9tIGhlcmUgb24sIHdlIGNhbiBhc3NlcnQgdGhhdCBgdmFsdWVgIGlzIGVpdGhlciBhbiBvYmplY3Qgb3IgYW4gYXJyYXkuCgogIC8vIERvIG5vdCBub3JtYWxpemUgb2JqZWN0cyB0aGF0IHdlIGtub3cgaGF2ZSBhbHJlYWR5IGJlZW4gbm9ybWFsaXplZC4gQXMgYSBnZW5lcmFsIHJ1bGUsIHRoZQogIC8vICJfX3NlbnRyeV9za2lwX25vcm1hbGl6YXRpb25fXyIgcHJvcGVydHkgc2hvdWxkIG9ubHkgYmUgdXNlZCBzcGFyaW5nbHkgYW5kIG9ubHkgc2hvdWxkIG9ubHkgYmUgc2V0IG9uIG9iamVjdHMgdGhhdAogIC8vIGhhdmUgYWxyZWFkeSBiZWVuIG5vcm1hbGl6ZWQuCiAgaWYgKCh2YWx1ZSApWydfX3NlbnRyeV9za2lwX25vcm1hbGl6YXRpb25fXyddKSB7CiAgICByZXR1cm4gdmFsdWUgOwogIH0KCiAgLy8gV2UgY2FuIHNldCBgX19zZW50cnlfb3ZlcnJpZGVfbm9ybWFsaXphdGlvbl9kZXB0aF9fYCBvbiBhbiBvYmplY3QgdG8gZW5zdXJlIHRoYXQgZnJvbSB0aGVyZQogIC8vIFdlIGtlZXAgYSBjZXJ0YWluIGFtb3VudCBvZiBkZXB0aC4KICAvLyBUaGlzIHNob3VsZCBiZSB1c2VkIHNwYXJpbmdseSwgZS5nLiB3ZSB1c2UgaXQgZm9yIHRoZSByZWR1eCBpbnRlZ3JhdGlvbiB0byBlbnN1cmUgd2UgZ2V0IGEgY2VydGFpbiBhbW91bnQgb2Ygc3RhdGUuCiAgY29uc3QgcmVtYWluaW5nRGVwdGggPQogICAgdHlwZW9mICh2YWx1ZSApWydfX3NlbnRyeV9vdmVycmlkZV9ub3JtYWxpemF0aW9uX2RlcHRoX18nXSA9PT0gJ251bWJlcicKICAgICAgPyAoKHZhbHVlIClbJ19fc2VudHJ5X292ZXJyaWRlX25vcm1hbGl6YXRpb25fZGVwdGhfXyddICkKICAgICAgOiBkZXB0aDsKCiAgLy8gV2UncmUgYWxzbyBkb25lIGlmIHdlJ3ZlIHJlYWNoZWQgdGhlIG1heCBkZXB0aAogIGlmIChyZW1haW5pbmdEZXB0aCA9PT0gMCkgewogICAgLy8gQXQgdGhpcyBwb2ludCB3ZSBrbm93IGBzZXJpYWxpemVkYCBpcyBhIHN0cmluZyBvZiB0aGUgZm9ybSBgIltvYmplY3QgWFhYWF0iYC4gQ2xlYW4gaXQgdXAgc28gaXQncyBqdXN0IGAiW1hYWFhdImAuCiAgICByZXR1cm4gc3RyaW5naWZpZWQucmVwbGFjZSgnb2JqZWN0ICcsICcnKTsKICB9CgogIC8vIElmIHdlJ3ZlIGFscmVhZHkgdmlzaXRlZCB0aGlzIGJyYW5jaCwgYmFpbCBvdXQsIGFzIGl0J3MgY2lyY3VsYXIgcmVmZXJlbmNlLiBJZiBub3QsIG5vdGUgdGhhdCB3ZSdyZSBzZWVpbmcgaXQgbm93LgogIGlmIChtZW1vaXplKHZhbHVlKSkgewogICAgcmV0dXJuICdbQ2lyY3VsYXIgfl0nOwogIH0KCiAgLy8gSWYgdGhlIHZhbHVlIGhhcyBhIGB0b0pTT05gIG1ldGhvZCwgd2UgY2FsbCBpdCB0byBleHRyYWN0IG1vcmUgaW5mb3JtYXRpb24KICBjb25zdCB2YWx1ZVdpdGhUb0pTT04gPSB2YWx1ZSA7CiAgaWYgKHZhbHVlV2l0aFRvSlNPTiAmJiB0eXBlb2YgdmFsdWVXaXRoVG9KU09OLnRvSlNPTiA9PT0gJ2Z1bmN0aW9uJykgewogICAgdHJ5IHsKICAgICAgY29uc3QganNvblZhbHVlID0gdmFsdWVXaXRoVG9KU09OLnRvSlNPTigpOwogICAgICAvLyBXZSBuZWVkIHRvIG5vcm1hbGl6ZSB0aGUgcmV0dXJuIHZhbHVlIG9mIGAudG9KU09OKClgIGluIGNhc2UgaXQgaGFzIGNpcmN1bGFyIHJlZmVyZW5jZXMKICAgICAgcmV0dXJuIHZpc2l0KCcnLCBqc29uVmFsdWUsIHJlbWFpbmluZ0RlcHRoIC0gMSwgbWF4UHJvcGVydGllcywgbWVtbyk7CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgLy8gcGFzcyAoVGhlIGJ1aWx0LWluIGB0b0pTT05gIGZhaWxlZCwgYnV0IHdlIGNhbiBzdGlsbCB0cnkgdG8gZG8gaXQgb3Vyc2VsdmVzKQogICAgfQogIH0KCiAgLy8gQXQgdGhpcyBwb2ludCB3ZSBrbm93IHdlIGVpdGhlciBoYXZlIGFuIG9iamVjdCBvciBhbiBhcnJheSwgd2UgaGF2ZW4ndCBzZWVuIGl0IGJlZm9yZSwgYW5kIHdlJ3JlIGdvaW5nIHRvIHJlY3Vyc2UKICAvLyBiZWNhdXNlIHdlIGhhdmVuJ3QgeWV0IHJlYWNoZWQgdGhlIG1heCBkZXB0aC4gQ3JlYXRlIGFuIGFjY3VtdWxhdG9yIHRvIGhvbGQgdGhlIHJlc3VsdHMgb2YgdmlzaXRpbmcgZWFjaAogIC8vIHByb3BlcnR5L2VudHJ5LCBhbmQga2VlcCB0cmFjayBvZiB0aGUgbnVtYmVyIG9mIGl0ZW1zIHdlIGFkZCB0byBpdC4KICBjb25zdCBub3JtYWxpemVkID0gKEFycmF5LmlzQXJyYXkodmFsdWUpID8gW10gOiB7fSkgOwogIGxldCBudW1BZGRlZCA9IDA7CgogIC8vIEJlZm9yZSB3ZSBiZWdpbiwgY29udmVydGBFcnJvcmAgYW5kYEV2ZW50YCBpbnN0YW5jZXMgaW50byBwbGFpbiBvYmplY3RzLCBzaW5jZSBzb21lIG9mIGVhY2ggb2YgdGhlaXIgcmVsZXZhbnQKICAvLyBwcm9wZXJ0aWVzIGFyZSBub24tZW51bWVyYWJsZSBhbmQgb3RoZXJ3aXNlIHdvdWxkIGdldCBtaXNzZWQuCiAgY29uc3QgdmlzaXRhYmxlID0gY29udmVydFRvUGxhaW5PYmplY3QodmFsdWUgKTsKCiAgZm9yIChjb25zdCB2aXNpdEtleSBpbiB2aXNpdGFibGUpIHsKICAgIC8vIEF2b2lkIGl0ZXJhdGluZyBvdmVyIGZpZWxkcyBpbiB0aGUgcHJvdG90eXBlIGlmIHRoZXkndmUgc29tZWhvdyBiZWVuIGV4cG9zZWQgdG8gZW51bWVyYXRpb24uCiAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh2aXNpdGFibGUsIHZpc2l0S2V5KSkgewogICAgICBjb250aW51ZTsKICAgIH0KCiAgICBpZiAobnVtQWRkZWQgPj0gbWF4UHJvcGVydGllcykgewogICAgICBub3JtYWxpemVkW3Zpc2l0S2V5XSA9ICdbTWF4UHJvcGVydGllcyB+XSc7CiAgICAgIGJyZWFrOwogICAgfQoKICAgIC8vIFJlY3Vyc2l2ZWx5IHZpc2l0IGFsbCB0aGUgY2hpbGQgbm9kZXMKICAgIGNvbnN0IHZpc2l0VmFsdWUgPSB2aXNpdGFibGVbdmlzaXRLZXldOwogICAgbm9ybWFsaXplZFt2aXNpdEtleV0gPSB2aXNpdCh2aXNpdEtleSwgdmlzaXRWYWx1ZSwgcmVtYWluaW5nRGVwdGggLSAxLCBtYXhQcm9wZXJ0aWVzLCBtZW1vKTsKCiAgICBudW1BZGRlZCsrOwogIH0KCiAgLy8gT25jZSB3ZSd2ZSB2aXNpdGVkIGFsbCB0aGUgYnJhbmNoZXMsIHJlbW92ZSB0aGUgcGFyZW50IGZyb20gbWVtbyBzdG9yYWdlCiAgdW5tZW1vaXplKHZhbHVlKTsKCiAgLy8gUmV0dXJuIGFjY3VtdWxhdGVkIHZhbHVlcwogIHJldHVybiBub3JtYWxpemVkOwp9CgovKiBlc2xpbnQtZGlzYWJsZSBjb21wbGV4aXR5ICovCi8qKgogKiBTdHJpbmdpZnkgdGhlIGdpdmVuIHZhbHVlLiBIYW5kbGVzIHZhcmlvdXMga25vd24gc3BlY2lhbCB2YWx1ZXMgYW5kIHR5cGVzLgogKgogKiBOb3QgbWVhbnQgdG8gYmUgdXNlZCBvbiBzaW1wbGUgcHJpbWl0aXZlcyB3aGljaCBhbHJlYWR5IGhhdmUgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24sIGFzIGl0IHdpbGwsIGZvciBleGFtcGxlLCB0dXJuCiAqIHRoZSBudW1iZXIgMTIzMSBpbnRvICJbT2JqZWN0IE51bWJlcl0iLCBub3Igb24gYG51bGxgLCBhcyBpdCB3aWxsIHRocm93LgogKgogKiBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIHRvIHN0cmluZ2lmeQogKiBAcmV0dXJucyBBIHN0cmluZ2lmaWVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBnaXZlbiB2YWx1ZQogKi8KZnVuY3Rpb24gc3RyaW5naWZ5VmFsdWUoCiAga2V5LAogIC8vIHRoaXMgdHlwZSBpcyBhIHRpbnkgYml0IG9mIGEgY2hlYXQsIHNpbmNlIHRoaXMgZnVuY3Rpb24gZG9lcyBoYW5kbGUgTmFOICh3aGljaCBpcyB0ZWNobmljYWxseSBhIG51bWJlciksIGJ1dCBmb3IKICAvLyBvdXIgaW50ZXJuYWwgdXNlLCBpdCdsbCBkbwogIHZhbHVlLAopIHsKICB0cnkgewogICAgaWYgKGtleSA9PT0gJ2RvbWFpbicgJiYgdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiAodmFsdWUgKS5fZXZlbnRzKSB7CiAgICAgIHJldHVybiAnW0RvbWFpbl0nOwogICAgfQoKICAgIGlmIChrZXkgPT09ICdkb21haW5FbWl0dGVyJykgewogICAgICByZXR1cm4gJ1tEb21haW5FbWl0dGVyXSc7CiAgICB9CgogICAgLy8gSXQncyBzYWZlIHRvIHVzZSBgZ2xvYmFsYCwgYHdpbmRvd2AsIGFuZCBgZG9jdW1lbnRgIGhlcmUgaW4gdGhpcyBtYW5uZXIsIGFzIHdlIGFyZSBhc3NlcnRpbmcgdXNpbmcgYHR5cGVvZmAgZmlyc3QKICAgIC8vIHdoaWNoIHdvbid0IHRocm93IGlmIHRoZXkgYXJlIG5vdCBwcmVzZW50LgoKICAgIGlmICh0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSA9PT0gZ2xvYmFsKSB7CiAgICAgIHJldHVybiAnW0dsb2JhbF0nOwogICAgfQoKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWdsb2JhbHMKICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSA9PT0gd2luZG93KSB7CiAgICAgIHJldHVybiAnW1dpbmRvd10nOwogICAgfQoKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWdsb2JhbHMKICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlID09PSBkb2N1bWVudCkgewogICAgICByZXR1cm4gJ1tEb2N1bWVudF0nOwogICAgfQoKICAgIGlmIChpc1Z1ZVZpZXdNb2RlbCh2YWx1ZSkpIHsKICAgICAgcmV0dXJuICdbVnVlVmlld01vZGVsXSc7CiAgICB9CgogICAgLy8gUmVhY3QncyBTeW50aGV0aWNFdmVudCB0aGluZ3kKICAgIGlmIChpc1N5bnRoZXRpY0V2ZW50KHZhbHVlKSkgewogICAgICByZXR1cm4gJ1tTeW50aGV0aWNFdmVudF0nOwogICAgfQoKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInICYmIHZhbHVlICE9PSB2YWx1ZSkgewogICAgICByZXR1cm4gJ1tOYU5dJzsKICAgIH0KCiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIHJldHVybiBgW0Z1bmN0aW9uOiAke2dldEZ1bmN0aW9uTmFtZSh2YWx1ZSl9XWA7CiAgICB9CgogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N5bWJvbCcpIHsKICAgICAgcmV0dXJuIGBbJHtTdHJpbmcodmFsdWUpfV1gOwogICAgfQoKICAgIC8vIHN0cmluZ2lmaWVkIEJpZ0ludHMgYXJlIGluZGlzdGluZ3Vpc2hhYmxlIGZyb20gcmVndWxhciBudW1iZXJzLCBzbyB3ZSBuZWVkIHRvIGxhYmVsIHRoZW0gdG8gYXZvaWQgY29uZnVzaW9uCiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnYmlnaW50JykgewogICAgICByZXR1cm4gYFtCaWdJbnQ6ICR7U3RyaW5nKHZhbHVlKX1dYDsKICAgIH0KCiAgICAvLyBOb3cgdGhhdCB3ZSd2ZSBrbm9ja2VkIG91dCBhbGwgdGhlIHNwZWNpYWwgY2FzZXMgYW5kIHRoZSBwcmltaXRpdmVzLCBhbGwgd2UgaGF2ZSBsZWZ0IGFyZSBvYmplY3RzLiBTaW1wbHkgY2FzdGluZwogICAgLy8gdGhlbSB0byBzdHJpbmdzIG1lYW5zIHRoYXQgaW5zdGFuY2VzIG9mIGNsYXNzZXMgd2hpY2ggaGF2ZW4ndCBkZWZpbmVkIHRoZWlyIGB0b1N0cmluZ1RhZ2Agd2lsbCBqdXN0IGNvbWUgb3V0IGFzCiAgICAvLyBgIltvYmplY3QgT2JqZWN0XSJgLiBJZiB3ZSBpbnN0ZWFkIGxvb2sgYXQgdGhlIGNvbnN0cnVjdG9yJ3MgbmFtZSAod2hpY2ggaXMgdGhlIHNhbWUgYXMgdGhlIG5hbWUgb2YgdGhlIGNsYXNzKSwKICAgIC8vIHdlIGNhbiBtYWtlIHN1cmUgdGhhdCBvbmx5IHBsYWluIG9iamVjdHMgY29tZSBvdXQgdGhhdCB3YXkuCiAgICBjb25zdCBvYmpOYW1lID0gZ2V0Q29uc3RydWN0b3JOYW1lKHZhbHVlKTsKCiAgICAvLyBIYW5kbGUgSFRNTCBFbGVtZW50cwogICAgaWYgKC9eSFRNTChcdyopRWxlbWVudCQvLnRlc3Qob2JqTmFtZSkpIHsKICAgICAgcmV0dXJuIGBbSFRNTEVsZW1lbnQ6ICR7b2JqTmFtZX1dYDsKICAgIH0KCiAgICByZXR1cm4gYFtvYmplY3QgJHtvYmpOYW1lfV1gOwogIH0gY2F0Y2ggKGVycikgewogICAgcmV0dXJuIGAqKm5vbi1zZXJpYWxpemFibGUqKiAoJHtlcnJ9KWA7CiAgfQp9Ci8qIGVzbGludC1lbmFibGUgY29tcGxleGl0eSAqLwoKZnVuY3Rpb24gZ2V0Q29uc3RydWN0b3JOYW1lKHZhbHVlKSB7CiAgY29uc3QgcHJvdG90eXBlID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHZhbHVlKTsKCiAgcmV0dXJuIHByb3RvdHlwZSA/IHByb3RvdHlwZS5jb25zdHJ1Y3Rvci5uYW1lIDogJ251bGwgcHJvdG90eXBlJzsKfQoKLyoqCiAqIE5vcm1hbGl6ZXMgVVJMcyBpbiBleGNlcHRpb25zIGFuZCBzdGFja3RyYWNlcyB0byBhIGJhc2UgcGF0aCBzbyBTZW50cnkgY2FuIGZpbmdlcnByaW50CiAqIGFjcm9zcyBwbGF0Zm9ybXMgYW5kIHdvcmtpbmcgZGlyZWN0b3J5LgogKgogKiBAcGFyYW0gdXJsIFRoZSBVUkwgdG8gYmUgbm9ybWFsaXplZC4KICogQHBhcmFtIGJhc2VQYXRoIFRoZSBhcHBsaWNhdGlvbiBiYXNlIHBhdGguCiAqIEByZXR1cm5zIFRoZSBub3JtYWxpemVkIFVSTC4KICovCmZ1bmN0aW9uIG5vcm1hbGl6ZVVybFRvQmFzZSh1cmwsIGJhc2VQYXRoKSB7CiAgY29uc3QgZXNjYXBlZEJhc2UgPSBiYXNlUGF0aAogICAgLy8gQmFja3NsYXNoIHRvIGZvcndhcmQKICAgIC5yZXBsYWNlKC9cXC9nLCAnLycpCiAgICAvLyBFc2NhcGUgUmVnRXhwIHNwZWNpYWwgY2hhcmFjdGVycwogICAgLnJlcGxhY2UoL1t8XFx7fSgpW1xdXiQrKj8uXS9nLCAnXFwkJicpOwoKICBsZXQgbmV3VXJsID0gdXJsOwogIHRyeSB7CiAgICBuZXdVcmwgPSBkZWNvZGVVUkkodXJsKTsKICB9IGNhdGNoIChfT28pIHsKICAgIC8vIFNvbWV0aW1lIHRoaXMgYnJlYWtzCiAgfQogIHJldHVybiAoCiAgICBuZXdVcmwKICAgICAgLnJlcGxhY2UoL1xcL2csICcvJykKICAgICAgLnJlcGxhY2UoL3dlYnBhY2s6XC8/L2csICcnKSAvLyBSZW1vdmUgaW50ZXJtZWRpYXRlIGJhc2UgcGF0aAogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHNlbnRyeS1pbnRlcm5hbC9zZGsvbm8tcmVnZXhwLWNvbnN0cnVjdG9yCiAgICAgIC5yZXBsYWNlKG5ldyBSZWdFeHAoYChmaWxlOi8vKT8vKiR7ZXNjYXBlZEJhc2V9LypgLCAnaWcnKSwgJ2FwcDovLy8nKQogICk7Cn0KCi8vIFNsaWdodGx5IG1vZGlmaWVkIChubyBJRTggc3VwcG9ydCwgRVM2KSBhbmQgdHJhbnNjcmliZWQgdG8gVHlwZVNjcmlwdAoKLy8gU3BsaXQgYSBmaWxlbmFtZSBpbnRvIFtyb290LCBkaXIsIGJhc2VuYW1lLCBleHRdLCB1bml4IHZlcnNpb24KLy8gJ3Jvb3QnIGlzIGp1c3QgYSBzbGFzaCwgb3Igbm90aGluZy4KY29uc3Qgc3BsaXRQYXRoUmUgPSAvXihcUys6XFx8XC8/KShbXHNcU10qPykoKD86XC57MSwyfXxbXi9cXF0rP3wpKFwuW14uL1xcXSp8KSkoPzpbL1xcXSopJC87Ci8qKiBKU0RvYyAqLwpmdW5jdGlvbiBzcGxpdFBhdGgoZmlsZW5hbWUpIHsKICAvLyBUcnVuY2F0ZSBmaWxlcyBuYW1lcyBncmVhdGVyIHRoYW4gMTAyNCBjaGFyYWN0ZXJzIHRvIGF2b2lkIHJlZ2V4IGRvcwogIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9nZXRzZW50cnkvc2VudHJ5LWphdmFzY3JpcHQvcHVsbC84NzM3I2Rpc2N1c3Npb25fcjEyODU3MTkxNzIKICBjb25zdCB0cnVuY2F0ZWQgPSBmaWxlbmFtZS5sZW5ndGggPiAxMDI0ID8gYDx0cnVuY2F0ZWQ+JHtmaWxlbmFtZS5zbGljZSgtMTAyNCl9YCA6IGZpbGVuYW1lOwogIGNvbnN0IHBhcnRzID0gc3BsaXRQYXRoUmUuZXhlYyh0cnVuY2F0ZWQpOwogIHJldHVybiBwYXJ0cyA/IHBhcnRzLnNsaWNlKDEpIDogW107Cn0KCi8qKiBKU0RvYyAqLwpmdW5jdGlvbiBkaXJuYW1lKHBhdGgpIHsKICBjb25zdCByZXN1bHQgPSBzcGxpdFBhdGgocGF0aCk7CiAgY29uc3Qgcm9vdCA9IHJlc3VsdFswXTsKICBsZXQgZGlyID0gcmVzdWx0WzFdOwoKICBpZiAoIXJvb3QgJiYgIWRpcikgewogICAgLy8gTm8gZGlybmFtZSB3aGF0c29ldmVyCiAgICByZXR1cm4gJy4nOwogIH0KCiAgaWYgKGRpcikgewogICAgLy8gSXQgaGFzIGEgZGlybmFtZSwgc3RyaXAgdHJhaWxpbmcgc2xhc2gKICAgIGRpciA9IGRpci5zbGljZSgwLCBkaXIubGVuZ3RoIC0gMSk7CiAgfQoKICByZXR1cm4gcm9vdCArIGRpcjsKfQoKLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L2V4cGxpY2l0LWZ1bmN0aW9uLXJldHVybi10eXBlICovCgovKiogU3luY1Byb21pc2UgaW50ZXJuYWwgc3RhdGVzICovCnZhciBTdGF0ZXM7IChmdW5jdGlvbiAoU3RhdGVzKSB7CiAgLyoqIFBlbmRpbmcgKi8KICBjb25zdCBQRU5ESU5HID0gMDsgU3RhdGVzW1N0YXRlc1siUEVORElORyJdID0gUEVORElOR10gPSAiUEVORElORyI7CiAgLyoqIFJlc29sdmVkIC8gT0sgKi8KICBjb25zdCBSRVNPTFZFRCA9IDE7IFN0YXRlc1tTdGF0ZXNbIlJFU09MVkVEIl0gPSBSRVNPTFZFRF0gPSAiUkVTT0xWRUQiOwogIC8qKiBSZWplY3RlZCAvIEVycm9yICovCiAgY29uc3QgUkVKRUNURUQgPSAyOyBTdGF0ZXNbU3RhdGVzWyJSRUpFQ1RFRCJdID0gUkVKRUNURURdID0gIlJFSkVDVEVEIjsKfSkoU3RhdGVzIHx8IChTdGF0ZXMgPSB7fSkpOwoKLy8gT3ZlcmxvYWRzIHNvIHdlIGNhbiBjYWxsIHJlc29sdmVkU3luY1Byb21pc2Ugd2l0aG91dCBhcmd1bWVudHMgYW5kIGdlbmVyaWMgYXJndW1lbnQKCi8qKgogKiBDcmVhdGVzIGEgcmVzb2x2ZWQgc3luYyBwcm9taXNlLgogKgogKiBAcGFyYW0gdmFsdWUgdGhlIHZhbHVlIHRvIHJlc29sdmUgdGhlIHByb21pc2Ugd2l0aAogKiBAcmV0dXJucyB0aGUgcmVzb2x2ZWQgc3luYyBwcm9taXNlCiAqLwpmdW5jdGlvbiByZXNvbHZlZFN5bmNQcm9taXNlKHZhbHVlKSB7CiAgcmV0dXJuIG5ldyBTeW5jUHJvbWlzZShyZXNvbHZlID0+IHsKICAgIHJlc29sdmUodmFsdWUpOwogIH0pOwp9CgovKioKICogQ3JlYXRlcyBhIHJlamVjdGVkIHN5bmMgcHJvbWlzZS4KICoKICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZSB0byByZWplY3QgdGhlIHByb21pc2Ugd2l0aAogKiBAcmV0dXJucyB0aGUgcmVqZWN0ZWQgc3luYyBwcm9taXNlCiAqLwpmdW5jdGlvbiByZWplY3RlZFN5bmNQcm9taXNlKHJlYXNvbikgewogIHJldHVybiBuZXcgU3luY1Byb21pc2UoKF8sIHJlamVjdCkgPT4gewogICAgcmVqZWN0KHJlYXNvbik7CiAgfSk7Cn0KCi8qKgogKiBUaGVuYWJsZSBjbGFzcyB0aGF0IGJlaGF2ZXMgbGlrZSBhIFByb21pc2UgYW5kIGZvbGxvd3MgaXQncyBpbnRlcmZhY2UKICogYnV0IGlzIG5vdCBhc3luYyBpbnRlcm5hbGx5CiAqLwpjbGFzcyBTeW5jUHJvbWlzZSB7CgogICBjb25zdHJ1Y3RvcigKICAgIGV4ZWN1dG9yLAogICkge1N5bmNQcm9taXNlLnByb3RvdHlwZS5fX2luaXQuY2FsbCh0aGlzKTtTeW5jUHJvbWlzZS5wcm90b3R5cGUuX19pbml0Mi5jYWxsKHRoaXMpO1N5bmNQcm9taXNlLnByb3RvdHlwZS5fX2luaXQzLmNhbGwodGhpcyk7U3luY1Byb21pc2UucHJvdG90eXBlLl9faW5pdDQuY2FsbCh0aGlzKTsKICAgIHRoaXMuX3N0YXRlID0gU3RhdGVzLlBFTkRJTkc7CiAgICB0aGlzLl9oYW5kbGVycyA9IFtdOwoKICAgIHRyeSB7CiAgICAgIGV4ZWN1dG9yKHRoaXMuX3Jlc29sdmUsIHRoaXMuX3JlamVjdCk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHRoaXMuX3JlamVjdChlKTsKICAgIH0KICB9CgogIC8qKiBKU0RvYyAqLwogICB0aGVuKAogICAgb25mdWxmaWxsZWQsCiAgICBvbnJlamVjdGVkLAogICkgewogICAgcmV0dXJuIG5ldyBTeW5jUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIHRoaXMuX2hhbmRsZXJzLnB1c2goWwogICAgICAgIGZhbHNlLAogICAgICAgIHJlc3VsdCA9PiB7CiAgICAgICAgICBpZiAoIW9uZnVsZmlsbGVkKSB7CiAgICAgICAgICAgIC8vIFRPRE86IMKvXF8o44OEKV8vwq8KICAgICAgICAgICAgLy8gVE9ETzogRklYTUUKICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQgKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShvbmZ1bGZpbGxlZChyZXN1bHQpKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcmVhc29uID0+IHsKICAgICAgICAgIGlmICghb25yZWplY3RlZCkgewogICAgICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShvbnJlamVjdGVkKHJlYXNvbikpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgXSk7CiAgICAgIHRoaXMuX2V4ZWN1dGVIYW5kbGVycygpOwogICAgfSk7CiAgfQoKICAvKiogSlNEb2MgKi8KICAgY2F0Y2goCiAgICBvbnJlamVjdGVkLAogICkgewogICAgcmV0dXJuIHRoaXMudGhlbih2YWwgPT4gdmFsLCBvbnJlamVjdGVkKTsKICB9CgogIC8qKiBKU0RvYyAqLwogICBmaW5hbGx5KG9uZmluYWxseSkgewogICAgcmV0dXJuIG5ldyBTeW5jUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIGxldCB2YWw7CiAgICAgIGxldCBpc1JlamVjdGVkOwoKICAgICAgcmV0dXJuIHRoaXMudGhlbigKICAgICAgICB2YWx1ZSA9PiB7CiAgICAgICAgICBpc1JlamVjdGVkID0gZmFsc2U7CiAgICAgICAgICB2YWwgPSB2YWx1ZTsKICAgICAgICAgIGlmIChvbmZpbmFsbHkpIHsKICAgICAgICAgICAgb25maW5hbGx5KCk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByZWFzb24gPT4gewogICAgICAgICAgaXNSZWplY3RlZCA9IHRydWU7CiAgICAgICAgICB2YWwgPSByZWFzb247CiAgICAgICAgICBpZiAob25maW5hbGx5KSB7CiAgICAgICAgICAgIG9uZmluYWxseSgpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICkudGhlbigoKSA9PiB7CiAgICAgICAgaWYgKGlzUmVqZWN0ZWQpIHsKICAgICAgICAgIHJlamVjdCh2YWwpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgcmVzb2x2ZSh2YWwgKTsKICAgICAgfSk7CiAgICB9KTsKICB9CgogIC8qKiBKU0RvYyAqLwogICAgX19pbml0KCkge3RoaXMuX3Jlc29sdmUgPSAodmFsdWUpID0+IHsKICAgIHRoaXMuX3NldFJlc3VsdChTdGF0ZXMuUkVTT0xWRUQsIHZhbHVlKTsKICB9O30KCiAgLyoqIEpTRG9jICovCiAgICBfX2luaXQyKCkge3RoaXMuX3JlamVjdCA9IChyZWFzb24pID0+IHsKICAgIHRoaXMuX3NldFJlc3VsdChTdGF0ZXMuUkVKRUNURUQsIHJlYXNvbik7CiAgfTt9CgogIC8qKiBKU0RvYyAqLwogICAgX19pbml0MygpIHt0aGlzLl9zZXRSZXN1bHQgPSAoc3RhdGUsIHZhbHVlKSA9PiB7CiAgICBpZiAodGhpcy5fc3RhdGUgIT09IFN0YXRlcy5QRU5ESU5HKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoaXNUaGVuYWJsZSh2YWx1ZSkpIHsKICAgICAgdm9pZCAodmFsdWUgKS50aGVuKHRoaXMuX3Jlc29sdmUsIHRoaXMuX3JlamVjdCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB0aGlzLl9zdGF0ZSA9IHN0YXRlOwogICAgdGhpcy5fdmFsdWUgPSB2YWx1ZTsKCiAgICB0aGlzLl9leGVjdXRlSGFuZGxlcnMoKTsKICB9O30KCiAgLyoqIEpTRG9jICovCiAgICBfX2luaXQ0KCkge3RoaXMuX2V4ZWN1dGVIYW5kbGVycyA9ICgpID0+IHsKICAgIGlmICh0aGlzLl9zdGF0ZSA9PT0gU3RhdGVzLlBFTkRJTkcpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IGNhY2hlZEhhbmRsZXJzID0gdGhpcy5faGFuZGxlcnMuc2xpY2UoKTsKICAgIHRoaXMuX2hhbmRsZXJzID0gW107CgogICAgY2FjaGVkSGFuZGxlcnMuZm9yRWFjaChoYW5kbGVyID0+IHsKICAgICAgaWYgKGhhbmRsZXJbMF0pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9zdGF0ZSA9PT0gU3RhdGVzLlJFU09MVkVEKSB7CiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlcwogICAgICAgIGhhbmRsZXJbMV0odGhpcy5fdmFsdWUgKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuX3N0YXRlID09PSBTdGF0ZXMuUkVKRUNURUQpIHsKICAgICAgICBoYW5kbGVyWzJdKHRoaXMuX3ZhbHVlKTsKICAgICAgfQoKICAgICAgaGFuZGxlclswXSA9IHRydWU7CiAgICB9KTsKICB9O30KfQoKLyoqCiAqIENyZWF0ZXMgYW4gbmV3IFByb21pc2VCdWZmZXIgb2JqZWN0IHdpdGggdGhlIHNwZWNpZmllZCBsaW1pdAogKiBAcGFyYW0gbGltaXQgbWF4IG51bWJlciBvZiBwcm9taXNlcyB0aGF0IGNhbiBiZSBzdG9yZWQgaW4gdGhlIGJ1ZmZlcgogKi8KZnVuY3Rpb24gbWFrZVByb21pc2VCdWZmZXIobGltaXQpIHsKICBjb25zdCBidWZmZXIgPSBbXTsKCiAgZnVuY3Rpb24gaXNSZWFkeSgpIHsKICAgIHJldHVybiBsaW1pdCA9PT0gdW5kZWZpbmVkIHx8IGJ1ZmZlci5sZW5ndGggPCBsaW1pdDsKICB9CgogIC8qKgogICAqIFJlbW92ZSBhIHByb21pc2UgZnJvbSB0aGUgcXVldWUuCiAgICoKICAgKiBAcGFyYW0gdGFzayBDYW4gYmUgYW55IFByb21pc2VMaWtlPFQ+CiAgICogQHJldHVybnMgUmVtb3ZlZCBwcm9taXNlLgogICAqLwogIGZ1bmN0aW9uIHJlbW92ZSh0YXNrKSB7CiAgICByZXR1cm4gYnVmZmVyLnNwbGljZShidWZmZXIuaW5kZXhPZih0YXNrKSwgMSlbMF07CiAgfQoKICAvKioKICAgKiBBZGQgYSBwcm9taXNlIChyZXByZXNlbnRpbmcgYW4gaW4tZmxpZ2h0IGFjdGlvbikgdG8gdGhlIHF1ZXVlLCBhbmQgc2V0IGl0IHRvIHJlbW92ZSBpdHNlbGYgb24gZnVsZmlsbG1lbnQuCiAgICoKICAgKiBAcGFyYW0gdGFza1Byb2R1Y2VyIEEgZnVuY3Rpb24gcHJvZHVjaW5nIGFueSBQcm9taXNlTGlrZTxUPjsgSW4gcHJldmlvdXMgdmVyc2lvbnMgdGhpcyB1c2VkIHRvIGJlIGB0YXNrOgogICAqICAgICAgICBQcm9taXNlTGlrZTxUPmAsIGJ1dCB1bmRlciB0aGF0IG1vZGVsLCBQcm9taXNlcyB3ZXJlIGluc3RhbnRseSBjcmVhdGVkIG9uIHRoZSBjYWxsLXNpdGUgYW5kIHRoZWlyIGV4ZWN1dG9yCiAgICogICAgICAgIGZ1bmN0aW9ucyB0aGVyZWZvcmUgcmFuIGltbWVkaWF0ZWx5LiBUaHVzLCBldmVuIGlmIHRoZSBidWZmZXIgd2FzIGZ1bGwsIHRoZSBhY3Rpb24gc3RpbGwgaGFwcGVuZWQuIEJ5CiAgICogICAgICAgIHJlcXVpcmluZyB0aGUgcHJvbWlzZSB0byBiZSB3cmFwcGVkIGluIGEgZnVuY3Rpb24sIHdlIGNhbiBkZWZlciBwcm9taXNlIGNyZWF0aW9uIHVudGlsIGFmdGVyIHRoZSBidWZmZXIKICAgKiAgICAgICAgbGltaXQgY2hlY2suCiAgICogQHJldHVybnMgVGhlIG9yaWdpbmFsIHByb21pc2UuCiAgICovCiAgZnVuY3Rpb24gYWRkKHRhc2tQcm9kdWNlcikgewogICAgaWYgKCFpc1JlYWR5KCkpIHsKICAgICAgcmV0dXJuIHJlamVjdGVkU3luY1Byb21pc2UobmV3IFNlbnRyeUVycm9yKCdOb3QgYWRkaW5nIFByb21pc2UgYmVjYXVzZSBidWZmZXIgbGltaXQgd2FzIHJlYWNoZWQuJykpOwogICAgfQoKICAgIC8vIHN0YXJ0IHRoZSB0YXNrIGFuZCBhZGQgaXRzIHByb21pc2UgdG8gdGhlIHF1ZXVlCiAgICBjb25zdCB0YXNrID0gdGFza1Byb2R1Y2VyKCk7CiAgICBpZiAoYnVmZmVyLmluZGV4T2YodGFzaykgPT09IC0xKSB7CiAgICAgIGJ1ZmZlci5wdXNoKHRhc2spOwogICAgfQogICAgdm9pZCB0YXNrCiAgICAgIC50aGVuKCgpID0+IHJlbW92ZSh0YXNrKSkKICAgICAgLy8gVXNlIGB0aGVuKG51bGwsIHJlamVjdGlvbkhhbmRsZXIpYCByYXRoZXIgdGhhbiBgY2F0Y2gocmVqZWN0aW9uSGFuZGxlcilgIHNvIHRoYXQgd2UgY2FuIHVzZSBgUHJvbWlzZUxpa2VgCiAgICAgIC8vIHJhdGhlciB0aGFuIGBQcm9taXNlYC4gYFByb21pc2VMaWtlYCBkb2Vzbid0IGhhdmUgYSBgLmNhdGNoYCBtZXRob2QsIG1ha2luZyBpdHMgcG9seWZpbGwgc21hbGxlci4gKEVTNSBkaWRuJ3QKICAgICAgLy8gaGF2ZSBwcm9taXNlcywgc28gVFMgaGFzIHRvIHBvbHlmaWxsIHdoZW4gZG93bi1jb21waWxpbmcuKQogICAgICAudGhlbihudWxsLCAoKSA9PgogICAgICAgIHJlbW92ZSh0YXNrKS50aGVuKG51bGwsICgpID0+IHsKICAgICAgICAgIC8vIFdlIGhhdmUgdG8gYWRkIGFub3RoZXIgY2F0Y2ggaGVyZSBiZWNhdXNlIGByZW1vdmUoKWAgc3RhcnRzIGEgbmV3IHByb21pc2UgY2hhaW4uCiAgICAgICAgfSksCiAgICAgICk7CiAgICByZXR1cm4gdGFzazsKICB9CgogIC8qKgogICAqIFdhaXQgZm9yIGFsbCBwcm9taXNlcyBpbiB0aGUgcXVldWUgdG8gcmVzb2x2ZSBvciBmb3IgdGltZW91dCB0byBleHBpcmUsIHdoaWNoZXZlciBjb21lcyBmaXJzdC4KICAgKgogICAqIEBwYXJhbSB0aW1lb3V0IFRoZSB0aW1lLCBpbiBtcywgYWZ0ZXIgd2hpY2ggdG8gcmVzb2x2ZSB0byBgZmFsc2VgIGlmIHRoZSBxdWV1ZSBpcyBzdGlsbCBub24tZW1wdHkuIFBhc3NpbmcgYDBgIChvcgogICAqIG5vdCBwYXNzaW5nIGFueXRoaW5nKSB3aWxsIG1ha2UgdGhlIHByb21pc2Ugd2FpdCBhcyBsb25nIGFzIGl0IHRha2VzIGZvciB0aGUgcXVldWUgdG8gZHJhaW4gYmVmb3JlIHJlc29sdmluZyB0bwogICAqIGB0cnVlYC4KICAgKiBAcmV0dXJucyBBIHByb21pc2Ugd2hpY2ggd2lsbCByZXNvbHZlIHRvIGB0cnVlYCBpZiB0aGUgcXVldWUgaXMgYWxyZWFkeSBlbXB0eSBvciBkcmFpbnMgYmVmb3JlIHRoZSB0aW1lb3V0LCBhbmQKICAgKiBgZmFsc2VgIG90aGVyd2lzZQogICAqLwogIGZ1bmN0aW9uIGRyYWluKHRpbWVvdXQpIHsKICAgIHJldHVybiBuZXcgU3luY1Byb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBsZXQgY291bnRlciA9IGJ1ZmZlci5sZW5ndGg7CgogICAgICBpZiAoIWNvdW50ZXIpIHsKICAgICAgICByZXR1cm4gcmVzb2x2ZSh0cnVlKTsKICAgICAgfQoKICAgICAgLy8gd2FpdCBmb3IgYHRpbWVvdXRgIG1zIGFuZCB0aGVuIHJlc29sdmUgdG8gYGZhbHNlYCAoaWYgbm90IGNhbmNlbGxlZCBmaXJzdCkKICAgICAgY29uc3QgY2FwdHVyZWRTZXRUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgaWYgKHRpbWVvdXQgJiYgdGltZW91dCA+IDApIHsKICAgICAgICAgIHJlc29sdmUoZmFsc2UpOwogICAgICAgIH0KICAgICAgfSwgdGltZW91dCk7CgogICAgICAvLyBpZiBhbGwgcHJvbWlzZXMgcmVzb2x2ZSBpbiB0aW1lLCBjYW5jZWwgdGhlIHRpbWVyIGFuZCByZXNvbHZlIHRvIGB0cnVlYAogICAgICBidWZmZXIuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICB2b2lkIHJlc29sdmVkU3luY1Byb21pc2UoaXRlbSkudGhlbigoKSA9PiB7CiAgICAgICAgICBpZiAoIS0tY291bnRlcikgewogICAgICAgICAgICBjbGVhclRpbWVvdXQoY2FwdHVyZWRTZXRUaW1lb3V0KTsKICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9LCByZWplY3QpOwogICAgICB9KTsKICAgIH0pOwogIH0KCiAgcmV0dXJuIHsKICAgICQ6IGJ1ZmZlciwKICAgIGFkZCwKICAgIGRyYWluLAogIH07Cn0KCmNvbnN0IE9ORV9TRUNPTkRfSU5fTVMgPSAxMDAwOwoKLyoqCiAqIEEgcGFydGlhbCBkZWZpbml0aW9uIG9mIHRoZSBbUGVyZm9ybWFuY2UgV2ViIEFQSV17QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1BlcmZvcm1hbmNlfQogKiBmb3IgYWNjZXNzaW5nIGEgaGlnaC1yZXNvbHV0aW9uIG1vbm90b25pYyBjbG9jay4KICovCgovKioKICogUmV0dXJucyBhIHRpbWVzdGFtcCBpbiBzZWNvbmRzIHNpbmNlIHRoZSBVTklYIGVwb2NoIHVzaW5nIHRoZSBEYXRlIEFQSS4KICoKICogVE9ETyh2OCk6IFJldHVybiB0eXBlIHNob3VsZCBiZSByb3VuZGVkLgogKi8KZnVuY3Rpb24gZGF0ZVRpbWVzdGFtcEluU2Vjb25kcygpIHsKICByZXR1cm4gRGF0ZS5ub3coKSAvIE9ORV9TRUNPTkRfSU5fTVM7Cn0KCi8qKgogKiBSZXR1cm5zIGEgd3JhcHBlciBhcm91bmQgdGhlIG5hdGl2ZSBQZXJmb3JtYW5jZSBBUEkgYnJvd3NlciBpbXBsZW1lbnRhdGlvbiwgb3IgdW5kZWZpbmVkIGZvciBicm93c2VycyB0aGF0IGRvIG5vdAogKiBzdXBwb3J0IHRoZSBBUEkuCiAqCiAqIFdyYXBwaW5nIHRoZSBuYXRpdmUgQVBJIHdvcmtzIGFyb3VuZCBkaWZmZXJlbmNlcyBpbiBiZWhhdmlvciBmcm9tIGRpZmZlcmVudCBicm93c2Vycy4KICovCmZ1bmN0aW9uIGNyZWF0ZVVuaXhUaW1lc3RhbXBJblNlY29uZHNGdW5jKCkgewogIGNvbnN0IHsgcGVyZm9ybWFuY2UgfSA9IEdMT0JBTF9PQkogOwogIGlmICghcGVyZm9ybWFuY2UgfHwgIXBlcmZvcm1hbmNlLm5vdykgewogICAgcmV0dXJuIGRhdGVUaW1lc3RhbXBJblNlY29uZHM7CiAgfQoKICAvLyBTb21lIGJyb3dzZXIgYW5kIGVudmlyb25tZW50cyBkb24ndCBoYXZlIGEgdGltZU9yaWdpbiwgc28gd2UgZmFsbGJhY2sgdG8KICAvLyB1c2luZyBEYXRlLm5vdygpIHRvIGNvbXB1dGUgdGhlIHN0YXJ0aW5nIHRpbWUuCiAgY29uc3QgYXBwcm94U3RhcnRpbmdUaW1lT3JpZ2luID0gRGF0ZS5ub3coKSAtIHBlcmZvcm1hbmNlLm5vdygpOwogIGNvbnN0IHRpbWVPcmlnaW4gPSBwZXJmb3JtYW5jZS50aW1lT3JpZ2luID09IHVuZGVmaW5lZCA/IGFwcHJveFN0YXJ0aW5nVGltZU9yaWdpbiA6IHBlcmZvcm1hbmNlLnRpbWVPcmlnaW47CgogIC8vIHBlcmZvcm1hbmNlLm5vdygpIGlzIGEgbW9ub3RvbmljIGNsb2NrLCB3aGljaCBtZWFucyBpdCBzdGFydHMgYXQgMCB3aGVuIHRoZSBwcm9jZXNzIGJlZ2lucy4gVG8gZ2V0IHRoZSBjdXJyZW50CiAgLy8gd2FsbCBjbG9jayB0aW1lIChhY3R1YWwgVU5JWCB0aW1lc3RhbXApLCB3ZSBuZWVkIHRvIGFkZCB0aGUgc3RhcnRpbmcgdGltZSBvcmlnaW4gYW5kIHRoZSBjdXJyZW50IHRpbWUgZWxhcHNlZC4KICAvLwogIC8vIFRPRE86IFRoaXMgZG9lcyBub3QgYWNjb3VudCBmb3IgdGhlIGNhc2Ugd2hlcmUgdGhlIG1vbm90b25pYyBjbG9jayB0aGF0IHBvd2VycyBwZXJmb3JtYW5jZS5ub3coKSBkcmlmdHMgZnJvbSB0aGUKICAvLyB3YWxsIGNsb2NrIHRpbWUsIHdoaWNoIGNhdXNlcyB0aGUgcmV0dXJuZWQgdGltZXN0YW1wIHRvIGJlIGluYWNjdXJhdGUuIFdlIHNob3VsZCBpbnZlc3RpZ2F0ZSBob3cgdG8gZGV0ZWN0IGFuZAogIC8vIGNvcnJlY3QgZm9yIHRoaXMuCiAgLy8gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vZ2V0c2VudHJ5L3NlbnRyeS1qYXZhc2NyaXB0L2lzc3Vlcy8yNTkwCiAgLy8gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vbWRuL2NvbnRlbnQvaXNzdWVzLzQ3MTMKICAvLyBTZWU6IGh0dHBzOi8vZGV2LnRvL25vYW1yL3doZW4tYS1taWxsaXNlY29uZC1pcy1ub3QtYS1taWxsaXNlY29uZC0zaDYKICByZXR1cm4gKCkgPT4gewogICAgcmV0dXJuICh0aW1lT3JpZ2luICsgcGVyZm9ybWFuY2Uubm93KCkpIC8gT05FX1NFQ09ORF9JTl9NUzsKICB9Owp9CgovKioKICogUmV0dXJucyBhIHRpbWVzdGFtcCBpbiBzZWNvbmRzIHNpbmNlIHRoZSBVTklYIGVwb2NoIHVzaW5nIGVpdGhlciB0aGUgUGVyZm9ybWFuY2Ugb3IgRGF0ZSBBUElzLCBkZXBlbmRpbmcgb24gdGhlCiAqIGF2YWlsYWJpbGl0eSBvZiB0aGUgUGVyZm9ybWFuY2UgQVBJLgogKgogKiBCVUc6IE5vdGUgdGhhdCBiZWNhdXNlIG9mIGhvdyBicm93c2VycyBpbXBsZW1lbnQgdGhlIFBlcmZvcm1hbmNlIEFQSSwgdGhlIGNsb2NrIG1pZ2h0IHN0b3Agd2hlbiB0aGUgY29tcHV0ZXIgaXMKICogYXNsZWVwLiBUaGlzIGNyZWF0ZXMgYSBza2V3IGJldHdlZW4gYGRhdGVUaW1lc3RhbXBJblNlY29uZHNgIGFuZCBgdGltZXN0YW1wSW5TZWNvbmRzYC4gVGhlCiAqIHNrZXcgY2FuIGdyb3cgdG8gYXJiaXRyYXJ5IGFtb3VudHMgbGlrZSBkYXlzLCB3ZWVrcyBvciBtb250aHMuCiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZ2V0c2VudHJ5L3NlbnRyeS1qYXZhc2NyaXB0L2lzc3Vlcy8yNTkwLgogKi8KY29uc3QgdGltZXN0YW1wSW5TZWNvbmRzID0gY3JlYXRlVW5peFRpbWVzdGFtcEluU2Vjb25kc0Z1bmMoKTsKCi8qKgogKiBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBzaW5jZSB0aGUgVU5JWCBlcG9jaC4gVGhpcyB2YWx1ZSBpcyBvbmx5IHVzYWJsZSBpbiBhIGJyb3dzZXIsIGFuZCBvbmx5IHdoZW4gdGhlCiAqIHBlcmZvcm1hbmNlIEFQSSBpcyBhdmFpbGFibGUuCiAqLwooKCkgPT4gewogIC8vIFVuZm9ydHVuYXRlbHkgYnJvd3NlcnMgbWF5IHJlcG9ydCBhbiBpbmFjY3VyYXRlIHRpbWUgb3JpZ2luIGRhdGEsIHRocm91Z2ggZWl0aGVyIHBlcmZvcm1hbmNlLnRpbWVPcmlnaW4gb3IKICAvLyBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0LCB3aGljaCByZXN1bHRzIGluIHBvb3IgcmVzdWx0cyBpbiBwZXJmb3JtYW5jZSBkYXRhLiBXZSBvbmx5IHRyZWF0IHRpbWUgb3JpZ2luCiAgLy8gZGF0YSBhcyByZWxpYWJsZSBpZiB0aGV5IGFyZSB3aXRoaW4gYSByZWFzb25hYmxlIHRocmVzaG9sZCBvZiB0aGUgY3VycmVudCB0aW1lLgoKICBjb25zdCB7IHBlcmZvcm1hbmNlIH0gPSBHTE9CQUxfT0JKIDsKICBpZiAoIXBlcmZvcm1hbmNlIHx8ICFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQoKICBjb25zdCB0aHJlc2hvbGQgPSAzNjAwICogMTAwMDsKICBjb25zdCBwZXJmb3JtYW5jZU5vdyA9IHBlcmZvcm1hbmNlLm5vdygpOwogIGNvbnN0IGRhdGVOb3cgPSBEYXRlLm5vdygpOwoKICAvLyBpZiB0aW1lT3JpZ2luIGlzbid0IGF2YWlsYWJsZSBzZXQgZGVsdGEgdG8gdGhyZXNob2xkIHNvIGl0IGlzbid0IHVzZWQKICBjb25zdCB0aW1lT3JpZ2luRGVsdGEgPSBwZXJmb3JtYW5jZS50aW1lT3JpZ2luCiAgICA/IE1hdGguYWJzKHBlcmZvcm1hbmNlLnRpbWVPcmlnaW4gKyBwZXJmb3JtYW5jZU5vdyAtIGRhdGVOb3cpCiAgICA6IHRocmVzaG9sZDsKICBjb25zdCB0aW1lT3JpZ2luSXNSZWxpYWJsZSA9IHRpbWVPcmlnaW5EZWx0YSA8IHRocmVzaG9sZDsKCiAgLy8gV2hpbGUgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCBpcyBkZXByZWNhdGVkIGluIGZhdm9yIG9mIHBlcmZvcm1hbmNlLnRpbWVPcmlnaW4sIHBlcmZvcm1hbmNlLnRpbWVPcmlnaW4KICAvLyBpcyBub3QgYXMgd2lkZWx5IHN1cHBvcnRlZC4gTmFtZWx5LCBwZXJmb3JtYW5jZS50aW1lT3JpZ2luIGlzIHVuZGVmaW5lZCBpbiBTYWZhcmkgYXMgb2Ygd3JpdGluZy4KICAvLyBBbHNvIGFzIG9mIHdyaXRpbmcsIHBlcmZvcm1hbmNlLnRpbWluZyBpcyBub3QgYXZhaWxhYmxlIGluIFdlYiBXb3JrZXJzIGluIG1haW5zdHJlYW0gYnJvd3NlcnMsIHNvIGl0IGlzIG5vdCBhbHdheXMKICAvLyBhIHZhbGlkIGZhbGxiYWNrLiBJbiB0aGUgYWJzZW5jZSBvZiBhbiBpbml0aWFsIHRpbWUgcHJvdmlkZWQgYnkgdGhlIGJyb3dzZXIsIGZhbGxiYWNrIHRvIHRoZSBjdXJyZW50IHRpbWUgZnJvbSB0aGUKICAvLyBEYXRlIEFQSS4KICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICBjb25zdCBuYXZpZ2F0aW9uU3RhcnQgPSBwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydDsKICBjb25zdCBoYXNOYXZpZ2F0aW9uU3RhcnQgPSB0eXBlb2YgbmF2aWdhdGlvblN0YXJ0ID09PSAnbnVtYmVyJzsKICAvLyBpZiBuYXZpZ2F0aW9uU3RhcnQgaXNuJ3QgYXZhaWxhYmxlIHNldCBkZWx0YSB0byB0aHJlc2hvbGQgc28gaXQgaXNuJ3QgdXNlZAogIGNvbnN0IG5hdmlnYXRpb25TdGFydERlbHRhID0gaGFzTmF2aWdhdGlvblN0YXJ0ID8gTWF0aC5hYnMobmF2aWdhdGlvblN0YXJ0ICsgcGVyZm9ybWFuY2VOb3cgLSBkYXRlTm93KSA6IHRocmVzaG9sZDsKICBjb25zdCBuYXZpZ2F0aW9uU3RhcnRJc1JlbGlhYmxlID0gbmF2aWdhdGlvblN0YXJ0RGVsdGEgPCB0aHJlc2hvbGQ7CgogIGlmICh0aW1lT3JpZ2luSXNSZWxpYWJsZSB8fCBuYXZpZ2F0aW9uU3RhcnRJc1JlbGlhYmxlKSB7CiAgICAvLyBVc2UgdGhlIG1vcmUgcmVsaWFibGUgdGltZSBvcmlnaW4KICAgIGlmICh0aW1lT3JpZ2luRGVsdGEgPD0gbmF2aWdhdGlvblN0YXJ0RGVsdGEpIHsKICAgICAgcmV0dXJuIHBlcmZvcm1hbmNlLnRpbWVPcmlnaW47CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gbmF2aWdhdGlvblN0YXJ0OwogICAgfQogIH0KICByZXR1cm4gZGF0ZU5vdzsKfSkoKTsKCi8qKgogKiBDcmVhdGVzIGFuIGVudmVsb3BlLgogKiBNYWtlIHN1cmUgdG8gYWx3YXlzIGV4cGxpY2l0bHkgcHJvdmlkZSB0aGUgZ2VuZXJpYyB0byB0aGlzIGZ1bmN0aW9uCiAqIHNvIHRoYXQgdGhlIGVudmVsb3BlIHR5cGVzIHJlc29sdmUgY29ycmVjdGx5LgogKi8KZnVuY3Rpb24gY3JlYXRlRW52ZWxvcGUoaGVhZGVycywgaXRlbXMgPSBbXSkgewogIHJldHVybiBbaGVhZGVycywgaXRlbXNdIDsKfQoKLyoqCiAqIENvbnZlbmllbmNlIGZ1bmN0aW9uIHRvIGxvb3AgdGhyb3VnaCB0aGUgaXRlbXMgYW5kIGl0ZW0gdHlwZXMgb2YgYW4gZW52ZWxvcGUuCiAqIChUaGlzIGZ1bmN0aW9uIHdhcyBtb3N0bHkgY3JlYXRlZCBiZWNhdXNlIHdvcmtpbmcgd2l0aCBlbnZlbG9wZSB0eXBlcyBpcyBwYWluZnVsIGF0IHRoZSBtb21lbnQpCiAqCiAqIElmIHRoZSBjYWxsYmFjayByZXR1cm5zIHRydWUsIHRoZSByZXN0IG9mIHRoZSBpdGVtcyB3aWxsIGJlIHNraXBwZWQuCiAqLwpmdW5jdGlvbiBmb3JFYWNoRW52ZWxvcGVJdGVtKAogIGVudmVsb3BlLAogIGNhbGxiYWNrLAopIHsKICBjb25zdCBlbnZlbG9wZUl0ZW1zID0gZW52ZWxvcGVbMV07CgogIGZvciAoY29uc3QgZW52ZWxvcGVJdGVtIG9mIGVudmVsb3BlSXRlbXMpIHsKICAgIGNvbnN0IGVudmVsb3BlSXRlbVR5cGUgPSBlbnZlbG9wZUl0ZW1bMF0udHlwZTsKICAgIGNvbnN0IHJlc3VsdCA9IGNhbGxiYWNrKGVudmVsb3BlSXRlbSwgZW52ZWxvcGVJdGVtVHlwZSk7CgogICAgaWYgKHJlc3VsdCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9CgogIHJldHVybiBmYWxzZTsKfQoKLyoqCiAqIEVuY29kZSBhIHN0cmluZyB0byBVVEY4LgogKi8KZnVuY3Rpb24gZW5jb2RlVVRGOChpbnB1dCwgdGV4dEVuY29kZXIpIHsKICBjb25zdCB1dGY4ID0gdGV4dEVuY29kZXIgfHwgbmV3IFRleHRFbmNvZGVyKCk7CiAgcmV0dXJuIHV0ZjguZW5jb2RlKGlucHV0KTsKfQoKLyoqCiAqIFNlcmlhbGl6ZXMgYW4gZW52ZWxvcGUuCiAqLwpmdW5jdGlvbiBzZXJpYWxpemVFbnZlbG9wZShlbnZlbG9wZSwgdGV4dEVuY29kZXIpIHsKICBjb25zdCBbZW52SGVhZGVycywgaXRlbXNdID0gZW52ZWxvcGU7CgogIC8vIEluaXRpYWxseSB3ZSBjb25zdHJ1Y3Qgb3VyIGVudmVsb3BlIGFzIGEgc3RyaW5nIGFuZCBvbmx5IGNvbnZlcnQgdG8gYmluYXJ5IGNodW5rcyBpZiB3ZSBlbmNvdW50ZXIgYmluYXJ5IGRhdGEKICBsZXQgcGFydHMgPSBKU09OLnN0cmluZ2lmeShlbnZIZWFkZXJzKTsKCiAgZnVuY3Rpb24gYXBwZW5kKG5leHQpIHsKICAgIGlmICh0eXBlb2YgcGFydHMgPT09ICdzdHJpbmcnKSB7CiAgICAgIHBhcnRzID0gdHlwZW9mIG5leHQgPT09ICdzdHJpbmcnID8gcGFydHMgKyBuZXh0IDogW2VuY29kZVVURjgocGFydHMsIHRleHRFbmNvZGVyKSwgbmV4dF07CiAgICB9IGVsc2UgewogICAgICBwYXJ0cy5wdXNoKHR5cGVvZiBuZXh0ID09PSAnc3RyaW5nJyA/IGVuY29kZVVURjgobmV4dCwgdGV4dEVuY29kZXIpIDogbmV4dCk7CiAgICB9CiAgfQoKICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHsKICAgIGNvbnN0IFtpdGVtSGVhZGVycywgcGF5bG9hZF0gPSBpdGVtOwoKICAgIGFwcGVuZChgXG4ke0pTT04uc3RyaW5naWZ5KGl0ZW1IZWFkZXJzKX1cbmApOwoKICAgIGlmICh0eXBlb2YgcGF5bG9hZCA9PT0gJ3N0cmluZycgfHwgcGF5bG9hZCBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHsKICAgICAgYXBwZW5kKHBheWxvYWQpOwogICAgfSBlbHNlIHsKICAgICAgbGV0IHN0cmluZ2lmaWVkUGF5bG9hZDsKICAgICAgdHJ5IHsKICAgICAgICBzdHJpbmdpZmllZFBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShwYXlsb2FkKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8vIEluIGNhc2UsIGRlc3BpdGUgYWxsIG91ciBlZmZvcnRzIHRvIGtlZXAgYHBheWxvYWRgIGNpcmN1bGFyLWRlcGVuZGVuY3ktZnJlZSwgYEpTT04uc3RyaW5pZnkoKWAgc3RpbGwKICAgICAgICAvLyBmYWlscywgd2UgdHJ5IGFnYWluIGFmdGVyIG5vcm1hbGl6aW5nIGl0IGFnYWluIHdpdGggaW5maW5pdGUgbm9ybWFsaXphdGlvbiBkZXB0aC4gVGhpcyBvZiBjb3Vyc2UgaGFzIGEKICAgICAgICAvLyBwZXJmb3JtYW5jZSBpbXBhY3QgYnV0IGluIHRoaXMgY2FzZSBhIHBlcmZvcm1hbmNlIGhpdCBpcyBiZXR0ZXIgdGhhbiB0aHJvd2luZy4KICAgICAgICBzdHJpbmdpZmllZFBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShub3JtYWxpemUocGF5bG9hZCkpOwogICAgICB9CiAgICAgIGFwcGVuZChzdHJpbmdpZmllZFBheWxvYWQpOwogICAgfQogIH0KCiAgcmV0dXJuIHR5cGVvZiBwYXJ0cyA9PT0gJ3N0cmluZycgPyBwYXJ0cyA6IGNvbmNhdEJ1ZmZlcnMocGFydHMpOwp9CgpmdW5jdGlvbiBjb25jYXRCdWZmZXJzKGJ1ZmZlcnMpIHsKICBjb25zdCB0b3RhbExlbmd0aCA9IGJ1ZmZlcnMucmVkdWNlKChhY2MsIGJ1ZikgPT4gYWNjICsgYnVmLmxlbmd0aCwgMCk7CgogIGNvbnN0IG1lcmdlZCA9IG5ldyBVaW50OEFycmF5KHRvdGFsTGVuZ3RoKTsKICBsZXQgb2Zmc2V0ID0gMDsKICBmb3IgKGNvbnN0IGJ1ZmZlciBvZiBidWZmZXJzKSB7CiAgICBtZXJnZWQuc2V0KGJ1ZmZlciwgb2Zmc2V0KTsKICAgIG9mZnNldCArPSBidWZmZXIubGVuZ3RoOwogIH0KCiAgcmV0dXJuIG1lcmdlZDsKfQoKY29uc3QgSVRFTV9UWVBFX1RPX0RBVEFfQ0FURUdPUllfTUFQID0gewogIHNlc3Npb246ICdzZXNzaW9uJywKICBzZXNzaW9uczogJ3Nlc3Npb24nLAogIGF0dGFjaG1lbnQ6ICdhdHRhY2htZW50JywKICB0cmFuc2FjdGlvbjogJ3RyYW5zYWN0aW9uJywKICBldmVudDogJ2Vycm9yJywKICBjbGllbnRfcmVwb3J0OiAnaW50ZXJuYWwnLAogIHVzZXJfcmVwb3J0OiAnZGVmYXVsdCcsCiAgcHJvZmlsZTogJ3Byb2ZpbGUnLAogIHJlcGxheV9ldmVudDogJ3JlcGxheScsCiAgcmVwbGF5X3JlY29yZGluZzogJ3JlcGxheScsCiAgY2hlY2tfaW46ICdtb25pdG9yJywKICBmZWVkYmFjazogJ2ZlZWRiYWNrJywKICBzcGFuOiAnc3BhbicsCiAgc3RhdHNkOiAnbWV0cmljX2J1Y2tldCcsCn07CgovKioKICogTWFwcyB0aGUgdHlwZSBvZiBhbiBlbnZlbG9wZSBpdGVtIHRvIGEgZGF0YSBjYXRlZ29yeS4KICovCmZ1bmN0aW9uIGVudmVsb3BlSXRlbVR5cGVUb0RhdGFDYXRlZ29yeSh0eXBlKSB7CiAgcmV0dXJuIElURU1fVFlQRV9UT19EQVRBX0NBVEVHT1JZX01BUFt0eXBlXTsKfQoKLyoqIEV4dHJhY3RzIHRoZSBtaW5pbWFsIFNESyBpbmZvIGZyb20gdGhlIG1ldGFkYXRhIG9yIGFuIGV2ZW50cyAqLwpmdW5jdGlvbiBnZXRTZGtNZXRhZGF0YUZvckVudmVsb3BlSGVhZGVyKG1ldGFkYXRhT3JFdmVudCkgewogIGlmICghbWV0YWRhdGFPckV2ZW50IHx8ICFtZXRhZGF0YU9yRXZlbnQuc2RrKSB7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IHsgbmFtZSwgdmVyc2lvbiB9ID0gbWV0YWRhdGFPckV2ZW50LnNkazsKICByZXR1cm4geyBuYW1lLCB2ZXJzaW9uIH07Cn0KCi8qKgogKiBDcmVhdGVzIGV2ZW50IGVudmVsb3BlIGhlYWRlcnMsIGJhc2VkIG9uIGV2ZW50LCBzZGsgaW5mbyBhbmQgdHVubmVsCiAqIE5vdGU6IFRoaXMgZnVuY3Rpb24gd2FzIGV4dHJhY3RlZCBmcm9tIHRoZSBjb3JlIHBhY2thZ2UgdG8gbWFrZSBpdCBhdmFpbGFibGUgaW4gUmVwbGF5CiAqLwpmdW5jdGlvbiBjcmVhdGVFdmVudEVudmVsb3BlSGVhZGVycygKICBldmVudCwKICBzZGtJbmZvLAogIHR1bm5lbCwKICBkc24sCikgewogIGNvbnN0IGR5bmFtaWNTYW1wbGluZ0NvbnRleHQgPSBldmVudC5zZGtQcm9jZXNzaW5nTWV0YWRhdGEgJiYgZXZlbnQuc2RrUHJvY2Vzc2luZ01ldGFkYXRhLmR5bmFtaWNTYW1wbGluZ0NvbnRleHQ7CiAgcmV0dXJuIHsKICAgIGV2ZW50X2lkOiBldmVudC5ldmVudF9pZCAsCiAgICBzZW50X2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAuLi4oc2RrSW5mbyAmJiB7IHNkazogc2RrSW5mbyB9KSwKICAgIC4uLighIXR1bm5lbCAmJiBkc24gJiYgeyBkc246IGRzblRvU3RyaW5nKGRzbikgfSksCiAgICAuLi4oZHluYW1pY1NhbXBsaW5nQ29udGV4dCAmJiB7CiAgICAgIHRyYWNlOiBkcm9wVW5kZWZpbmVkS2V5cyh7IC4uLmR5bmFtaWNTYW1wbGluZ0NvbnRleHQgfSksCiAgICB9KSwKICB9Owp9CgovLyBJbnRlbnRpb25hbGx5IGtlZXBpbmcgdGhlIGtleSBicm9hZCwgYXMgd2UgZG9uJ3Qga25vdyBmb3Igc3VyZSB3aGF0IHJhdGUgbGltaXQgaGVhZGVycyBnZXQgcmV0dXJuZWQgZnJvbSBiYWNrZW5kCgpjb25zdCBERUZBVUxUX1JFVFJZX0FGVEVSID0gNjAgKiAxMDAwOyAvLyA2MCBzZWNvbmRzCgovKioKICogRXh0cmFjdHMgUmV0cnktQWZ0ZXIgdmFsdWUgZnJvbSB0aGUgcmVxdWVzdCBoZWFkZXIgb3IgcmV0dXJucyBkZWZhdWx0IHZhbHVlCiAqIEBwYXJhbSBoZWFkZXIgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mICdSZXRyeS1BZnRlcicgaGVhZGVyCiAqIEBwYXJhbSBub3cgY3VycmVudCB1bml4IHRpbWVzdGFtcAogKgogKi8KZnVuY3Rpb24gcGFyc2VSZXRyeUFmdGVySGVhZGVyKGhlYWRlciwgbm93ID0gRGF0ZS5ub3coKSkgewogIGNvbnN0IGhlYWRlckRlbGF5ID0gcGFyc2VJbnQoYCR7aGVhZGVyfWAsIDEwKTsKICBpZiAoIWlzTmFOKGhlYWRlckRlbGF5KSkgewogICAgcmV0dXJuIGhlYWRlckRlbGF5ICogMTAwMDsKICB9CgogIGNvbnN0IGhlYWRlckRhdGUgPSBEYXRlLnBhcnNlKGAke2hlYWRlcn1gKTsKICBpZiAoIWlzTmFOKGhlYWRlckRhdGUpKSB7CiAgICByZXR1cm4gaGVhZGVyRGF0ZSAtIG5vdzsKICB9CgogIHJldHVybiBERUZBVUxUX1JFVFJZX0FGVEVSOwp9CgovKioKICogR2V0cyB0aGUgdGltZSB0aGF0IHRoZSBnaXZlbiBjYXRlZ29yeSBpcyBkaXNhYmxlZCB1bnRpbCBmb3IgcmF0ZSBsaW1pdGluZy4KICogSW4gY2FzZSBubyBjYXRlZ29yeS1zcGVjaWZpYyBsaW1pdCBpcyBzZXQgYnV0IGEgZ2VuZXJhbCByYXRlIGxpbWl0IGFjcm9zcyBhbGwgY2F0ZWdvcmllcyBpcyBhY3RpdmUsCiAqIHRoYXQgdGltZSBpcyByZXR1cm5lZC4KICoKICogQHJldHVybiB0aGUgdGltZSBpbiBtcyB0aGF0IHRoZSBjYXRlZ29yeSBpcyBkaXNhYmxlZCB1bnRpbCBvciAwIGlmIHRoZXJlJ3Mgbm8gYWN0aXZlIHJhdGUgbGltaXQuCiAqLwpmdW5jdGlvbiBkaXNhYmxlZFVudGlsKGxpbWl0cywgZGF0YUNhdGVnb3J5KSB7CiAgcmV0dXJuIGxpbWl0c1tkYXRhQ2F0ZWdvcnldIHx8IGxpbWl0cy5hbGwgfHwgMDsKfQoKLyoqCiAqIENoZWNrcyBpZiBhIGNhdGVnb3J5IGlzIHJhdGUgbGltaXRlZAogKi8KZnVuY3Rpb24gaXNSYXRlTGltaXRlZChsaW1pdHMsIGRhdGFDYXRlZ29yeSwgbm93ID0gRGF0ZS5ub3coKSkgewogIHJldHVybiBkaXNhYmxlZFVudGlsKGxpbWl0cywgZGF0YUNhdGVnb3J5KSA+IG5vdzsKfQoKLyoqCiAqIFVwZGF0ZSByYXRlbGltaXRzIGZyb20gaW5jb21pbmcgaGVhZGVycy4KICoKICogQHJldHVybiB0aGUgdXBkYXRlZCBSYXRlTGltaXRzIG9iamVjdC4KICovCmZ1bmN0aW9uIHVwZGF0ZVJhdGVMaW1pdHMoCiAgbGltaXRzLAogIHsgc3RhdHVzQ29kZSwgaGVhZGVycyB9LAogIG5vdyA9IERhdGUubm93KCksCikgewogIGNvbnN0IHVwZGF0ZWRSYXRlTGltaXRzID0gewogICAgLi4ubGltaXRzLAogIH07CgogIC8vICJUaGUgbmFtZSBpcyBjYXNlLWluc2Vuc2l0aXZlLiIKICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvSGVhZGVycy9nZXQKICBjb25zdCByYXRlTGltaXRIZWFkZXIgPSBoZWFkZXJzICYmIGhlYWRlcnNbJ3gtc2VudHJ5LXJhdGUtbGltaXRzJ107CiAgY29uc3QgcmV0cnlBZnRlckhlYWRlciA9IGhlYWRlcnMgJiYgaGVhZGVyc1sncmV0cnktYWZ0ZXInXTsKCiAgaWYgKHJhdGVMaW1pdEhlYWRlcikgewogICAgLyoqCiAgICAgKiByYXRlIGxpbWl0IGhlYWRlcnMgYXJlIG9mIHRoZSBmb3JtCiAgICAgKiAgICAgPGhlYWRlcj4sPGhlYWRlcj4sLi4KICAgICAqIHdoZXJlIGVhY2ggPGhlYWRlcj4gaXMgb2YgdGhlIGZvcm0KICAgICAqICAgICA8cmV0cnlfYWZ0ZXI+OiA8Y2F0ZWdvcmllcz46IDxzY29wZT46IDxyZWFzb25fY29kZT46IDxuYW1lc3BhY2VzPgogICAgICogd2hlcmUKICAgICAqICAgICA8cmV0cnlfYWZ0ZXI+IGlzIGEgZGVsYXkgaW4gc2Vjb25kcwogICAgICogICAgIDxjYXRlZ29yaWVzPiBpcyB0aGUgZXZlbnQgdHlwZShzKSAoZXJyb3IsIHRyYW5zYWN0aW9uLCBldGMpIGJlaW5nIHJhdGUgbGltaXRlZCBhbmQgaXMgb2YgdGhlIGZvcm0KICAgICAqICAgICAgICAgPGNhdGVnb3J5Pjs8Y2F0ZWdvcnk+Oy4uLgogICAgICogICAgIDxzY29wZT4gaXMgd2hhdCdzIGJlaW5nIGxpbWl0ZWQgKG9yZywgcHJvamVjdCwgb3Iga2V5KSAtIGlnbm9yZWQgYnkgU0RLCiAgICAgKiAgICAgPHJlYXNvbl9jb2RlPiBpcyBhbiBhcmJpdHJhcnkgc3RyaW5nIGxpa2UgIm9yZ19xdW90YSIgLSBpZ25vcmVkIGJ5IFNESwogICAgICogICAgIDxuYW1lc3BhY2VzPiBTZW1pY29sb24tc2VwYXJhdGVkIGxpc3Qgb2YgbWV0cmljIG5hbWVzcGFjZSBpZGVudGlmaWVycy4gRGVmaW5lcyB3aGljaCBuYW1lc3BhY2Uocykgd2lsbCBiZSBhZmZlY3RlZC4KICAgICAqICAgICAgICAgT25seSBwcmVzZW50IGlmIHJhdGUgbGltaXQgYXBwbGllcyB0byB0aGUgbWV0cmljX2J1Y2tldCBkYXRhIGNhdGVnb3J5LgogICAgICovCiAgICBmb3IgKGNvbnN0IGxpbWl0IG9mIHJhdGVMaW1pdEhlYWRlci50cmltKCkuc3BsaXQoJywnKSkgewogICAgICBjb25zdCBbcmV0cnlBZnRlciwgY2F0ZWdvcmllcywgLCAsIG5hbWVzcGFjZXNdID0gbGltaXQuc3BsaXQoJzonLCA1KTsKICAgICAgY29uc3QgaGVhZGVyRGVsYXkgPSBwYXJzZUludChyZXRyeUFmdGVyLCAxMCk7CiAgICAgIGNvbnN0IGRlbGF5ID0gKCFpc05hTihoZWFkZXJEZWxheSkgPyBoZWFkZXJEZWxheSA6IDYwKSAqIDEwMDA7IC8vIDYwc2VjIGRlZmF1bHQKICAgICAgaWYgKCFjYXRlZ29yaWVzKSB7CiAgICAgICAgdXBkYXRlZFJhdGVMaW1pdHMuYWxsID0gbm93ICsgZGVsYXk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChjb25zdCBjYXRlZ29yeSBvZiBjYXRlZ29yaWVzLnNwbGl0KCc7JykpIHsKICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gJ21ldHJpY19idWNrZXQnKSB7CiAgICAgICAgICAgIC8vIG5hbWVzcGFjZXMgd2lsbCBiZSBwcmVzZW50IHdoZW4gY2F0ZWdvcnkgPT09ICdtZXRyaWNfYnVja2V0JwogICAgICAgICAgICBpZiAoIW5hbWVzcGFjZXMgfHwgbmFtZXNwYWNlcy5zcGxpdCgnOycpLmluY2x1ZGVzKCdjdXN0b20nKSkgewogICAgICAgICAgICAgIHVwZGF0ZWRSYXRlTGltaXRzW2NhdGVnb3J5XSA9IG5vdyArIGRlbGF5OwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1cGRhdGVkUmF0ZUxpbWl0c1tjYXRlZ29yeV0gPSBub3cgKyBkZWxheTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9IGVsc2UgaWYgKHJldHJ5QWZ0ZXJIZWFkZXIpIHsKICAgIHVwZGF0ZWRSYXRlTGltaXRzLmFsbCA9IG5vdyArIHBhcnNlUmV0cnlBZnRlckhlYWRlcihyZXRyeUFmdGVySGVhZGVyLCBub3cpOwogIH0gZWxzZSBpZiAoc3RhdHVzQ29kZSA9PT0gNDI5KSB7CiAgICB1cGRhdGVkUmF0ZUxpbWl0cy5hbGwgPSBub3cgKyA2MCAqIDEwMDA7CiAgfQoKICByZXR1cm4gdXBkYXRlZFJhdGVMaW1pdHM7Cn0KCi8qKgogKiBBIG5vZGUuanMgd2F0Y2hkb2cgdGltZXIKICogQHBhcmFtIHBvbGxJbnRlcnZhbCBUaGUgaW50ZXJ2YWwgdGhhdCB3ZSBleHBlY3QgdG8gZ2V0IHBvbGxlZCBhdAogKiBAcGFyYW0gYW5yVGhyZXNob2xkIFRoZSB0aHJlc2hvbGQgZm9yIHdoZW4gd2UgY29uc2lkZXIgQU5SCiAqIEBwYXJhbSBjYWxsYmFjayBUaGUgY2FsbGJhY2sgdG8gY2FsbCBmb3IgQU5SCiAqIEByZXR1cm5zIEFuIG9iamVjdCB3aXRoIGBwb2xsYCBhbmQgYGVuYWJsZWRgIGZ1bmN0aW9ucyB7QGxpbmsgV2F0Y2hkb2dSZXR1cm59CiAqLwpmdW5jdGlvbiB3YXRjaGRvZ1RpbWVyKAogIGNyZWF0ZVRpbWVyLAogIHBvbGxJbnRlcnZhbCwKICBhbnJUaHJlc2hvbGQsCiAgY2FsbGJhY2ssCikgewogIGNvbnN0IHRpbWVyID0gY3JlYXRlVGltZXIoKTsKICBsZXQgdHJpZ2dlcmVkID0gZmFsc2U7CiAgbGV0IGVuYWJsZWQgPSB0cnVlOwoKICBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICBjb25zdCBkaWZmTXMgPSB0aW1lci5nZXRUaW1lTXMoKTsKCiAgICBpZiAodHJpZ2dlcmVkID09PSBmYWxzZSAmJiBkaWZmTXMgPiBwb2xsSW50ZXJ2YWwgKyBhbnJUaHJlc2hvbGQpIHsKICAgICAgdHJpZ2dlcmVkID0gdHJ1ZTsKICAgICAgaWYgKGVuYWJsZWQpIHsKICAgICAgICBjYWxsYmFjaygpOwogICAgICB9CiAgICB9CgogICAgaWYgKGRpZmZNcyA8IHBvbGxJbnRlcnZhbCArIGFuclRocmVzaG9sZCkgewogICAgICB0cmlnZ2VyZWQgPSBmYWxzZTsKICAgIH0KICB9LCAyMCk7CgogIHJldHVybiB7CiAgICBwb2xsOiAoKSA9PiB7CiAgICAgIHRpbWVyLnJlc2V0KCk7CiAgICB9LAogICAgZW5hYmxlZDogKHN0YXRlKSA9PiB7CiAgICAgIGVuYWJsZWQgPSBzdGF0ZTsKICAgIH0sCiAgfTsKfQoKLy8gdHlwZXMgY29waWVkIGZyb20gaW5zcGVjdG9yLmQudHMKCi8qKgogKiBDb252ZXJ0cyBEZWJ1Z2dlci5DYWxsRnJhbWUgdG8gU2VudHJ5IFN0YWNrRnJhbWUKICovCmZ1bmN0aW9uIGNhbGxGcmFtZVRvU3RhY2tGcmFtZSgKICBmcmFtZSwKICB1cmwsCiAgZ2V0TW9kdWxlRnJvbUZpbGVuYW1lLAopIHsKICBjb25zdCBmaWxlbmFtZSA9IHVybCA/IHVybC5yZXBsYWNlKC9eZmlsZTpcL1wvLywgJycpIDogdW5kZWZpbmVkOwoKICAvLyBDYWxsRnJhbWUgcm93L2NvbCBhcmUgMCBiYXNlZCwgd2hlcmVhcyBTdGFja0ZyYW1lIGFyZSAxIGJhc2VkCiAgY29uc3QgY29sbm8gPSBmcmFtZS5sb2NhdGlvbi5jb2x1bW5OdW1iZXIgPyBmcmFtZS5sb2NhdGlvbi5jb2x1bW5OdW1iZXIgKyAxIDogdW5kZWZpbmVkOwogIGNvbnN0IGxpbmVubyA9IGZyYW1lLmxvY2F0aW9uLmxpbmVOdW1iZXIgPyBmcmFtZS5sb2NhdGlvbi5saW5lTnVtYmVyICsgMSA6IHVuZGVmaW5lZDsKCiAgcmV0dXJuIGRyb3BVbmRlZmluZWRLZXlzKHsKICAgIGZpbGVuYW1lLAogICAgbW9kdWxlOiBnZXRNb2R1bGVGcm9tRmlsZW5hbWUoZmlsZW5hbWUpLAogICAgZnVuY3Rpb246IGZyYW1lLmZ1bmN0aW9uTmFtZSB8fCAnPycsCiAgICBjb2xubywKICAgIGxpbmVubywKICAgIGluX2FwcDogZmlsZW5hbWUgPyBmaWxlbmFtZUlzSW5BcHAoZmlsZW5hbWUpIDogdW5kZWZpbmVkLAogIH0pOwp9CgovKioKICogVGhpcyBzZXJ2ZXMgYXMgYSBidWlsZCB0aW1lIGZsYWcgdGhhdCB3aWxsIGJlIHRydWUgYnkgZGVmYXVsdCwgYnV0IGZhbHNlIGluIG5vbi1kZWJ1ZyBidWlsZHMgb3IgaWYgdXNlcnMgcmVwbGFjZSBgX19TRU5UUllfREVCVUdfX2AgaW4gdGhlaXIgZ2VuZXJhdGVkIGNvZGUuCiAqCiAqIEFUVEVOVElPTjogVGhpcyBjb25zdGFudCBtdXN0IG5ldmVyIGNyb3NzIHBhY2thZ2UgYm91bmRhcmllcyAoaS5lLiBiZSBleHBvcnRlZCkgdG8gZ3VhcmFudGVlIHRoYXQgaXQgY2FuIGJlIHVzZWQgZm9yIHRyZWUgc2hha2luZy4KICovCmNvbnN0IERFQlVHX0JVSUxEID0gKHR5cGVvZiBfX1NFTlRSWV9ERUJVR19fID09PSAndW5kZWZpbmVkJyB8fCBfX1NFTlRSWV9ERUJVR19fKTsKCmNvbnN0IERFRkFVTFRfRU5WSVJPTk1FTlQgPSAncHJvZHVjdGlvbic7CgovKioKICogUmV0dXJucyB0aGUgZ2xvYmFsIGV2ZW50IHByb2Nlc3NvcnMuCiAqIEBkZXByZWNhdGVkIEdsb2JhbCBldmVudCBwcm9jZXNzb3JzIHdpbGwgYmUgcmVtb3ZlZCBpbiB2OC4KICovCmZ1bmN0aW9uIGdldEdsb2JhbEV2ZW50UHJvY2Vzc29ycygpIHsKICByZXR1cm4gZ2V0R2xvYmFsU2luZ2xldG9uKCdnbG9iYWxFdmVudFByb2Nlc3NvcnMnLCAoKSA9PiBbXSk7Cn0KCi8qKgogKiBQcm9jZXNzIGFuIGFycmF5IG9mIGV2ZW50IHByb2Nlc3NvcnMsIHJldHVybmluZyB0aGUgcHJvY2Vzc2VkIGV2ZW50IChvciBgbnVsbGAgaWYgdGhlIGV2ZW50IHdhcyBkcm9wcGVkKS4KICovCmZ1bmN0aW9uIG5vdGlmeUV2ZW50UHJvY2Vzc29ycygKICBwcm9jZXNzb3JzLAogIGV2ZW50LAogIGhpbnQsCiAgaW5kZXggPSAwLAopIHsKICByZXR1cm4gbmV3IFN5bmNQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgIGNvbnN0IHByb2Nlc3NvciA9IHByb2Nlc3NvcnNbaW5kZXhdOwogICAgaWYgKGV2ZW50ID09PSBudWxsIHx8IHR5cGVvZiBwcm9jZXNzb3IgIT09ICdmdW5jdGlvbicpIHsKICAgICAgcmVzb2x2ZShldmVudCk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCByZXN1bHQgPSBwcm9jZXNzb3IoeyAuLi5ldmVudCB9LCBoaW50KSA7CgogICAgICBERUJVR19CVUlMRCAmJiBwcm9jZXNzb3IuaWQgJiYgcmVzdWx0ID09PSBudWxsICYmIGxvZ2dlci5sb2coYEV2ZW50IHByb2Nlc3NvciAiJHtwcm9jZXNzb3IuaWR9IiBkcm9wcGVkIGV2ZW50YCk7CgogICAgICBpZiAoaXNUaGVuYWJsZShyZXN1bHQpKSB7CiAgICAgICAgdm9pZCByZXN1bHQKICAgICAgICAgIC50aGVuKGZpbmFsID0+IG5vdGlmeUV2ZW50UHJvY2Vzc29ycyhwcm9jZXNzb3JzLCBmaW5hbCwgaGludCwgaW5kZXggKyAxKS50aGVuKHJlc29sdmUpKQogICAgICAgICAgLnRoZW4obnVsbCwgcmVqZWN0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2b2lkIG5vdGlmeUV2ZW50UHJvY2Vzc29ycyhwcm9jZXNzb3JzLCByZXN1bHQsIGhpbnQsIGluZGV4ICsgMSkKICAgICAgICAgIC50aGVuKHJlc29sdmUpCiAgICAgICAgICAudGhlbihudWxsLCByZWplY3QpOwogICAgICB9CiAgICB9CiAgfSk7Cn0KCi8qKgogKiBDcmVhdGVzIGEgbmV3IGBTZXNzaW9uYCBvYmplY3QgYnkgc2V0dGluZyBjZXJ0YWluIGRlZmF1bHQgcGFyYW1ldGVycy4gSWYgb3B0aW9uYWwgQHBhcmFtIGNvbnRleHQKICogaXMgcGFzc2VkLCB0aGUgcGFzc2VkIHByb3BlcnRpZXMgYXJlIGFwcGxpZWQgdG8gdGhlIHNlc3Npb24gb2JqZWN0LgogKgogKiBAcGFyYW0gY29udGV4dCAob3B0aW9uYWwpIGFkZGl0aW9uYWwgcHJvcGVydGllcyB0byBiZSBhcHBsaWVkIHRvIHRoZSByZXR1cm5lZCBzZXNzaW9uIG9iamVjdAogKgogKiBAcmV0dXJucyBhIG5ldyBgU2Vzc2lvbmAgb2JqZWN0CiAqLwpmdW5jdGlvbiBtYWtlU2Vzc2lvbihjb250ZXh0KSB7CiAgLy8gQm90aCB0aW1lc3RhbXAgYW5kIHN0YXJ0ZWQgYXJlIGluIHNlY29uZHMgc2luY2UgdGhlIFVOSVggZXBvY2guCiAgY29uc3Qgc3RhcnRpbmdUaW1lID0gdGltZXN0YW1wSW5TZWNvbmRzKCk7CgogIGNvbnN0IHNlc3Npb24gPSB7CiAgICBzaWQ6IHV1aWQ0KCksCiAgICBpbml0OiB0cnVlLAogICAgdGltZXN0YW1wOiBzdGFydGluZ1RpbWUsCiAgICBzdGFydGVkOiBzdGFydGluZ1RpbWUsCiAgICBkdXJhdGlvbjogMCwKICAgIHN0YXR1czogJ29rJywKICAgIGVycm9yczogMCwKICAgIGlnbm9yZUR1cmF0aW9uOiBmYWxzZSwKICAgIHRvSlNPTjogKCkgPT4gc2Vzc2lvblRvSlNPTihzZXNzaW9uKSwKICB9OwoKICBpZiAoY29udGV4dCkgewogICAgdXBkYXRlU2Vzc2lvbihzZXNzaW9uLCBjb250ZXh0KTsKICB9CgogIHJldHVybiBzZXNzaW9uOwp9CgovKioKICogVXBkYXRlcyBhIHNlc3Npb24gb2JqZWN0IHdpdGggdGhlIHByb3BlcnRpZXMgcGFzc2VkIGluIHRoZSBjb250ZXh0LgogKgogKiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbiBtdXRhdGVzIHRoZSBwYXNzZWQgb2JqZWN0IGFuZCByZXR1cm5zIHZvaWQuCiAqIChIYWQgdG8gZG8gdGhpcyBpbnN0ZWFkIG9mIHJldHVybmluZyBhIG5ldyBhbmQgdXBkYXRlZCBzZXNzaW9uIGJlY2F1c2UgY2xvc2luZyBhbmQgc2VuZGluZyBhIHNlc3Npb24KICogbWFrZXMgYW4gdXBkYXRlIHRvIHRoZSBzZXNzaW9uIGFmdGVyIGl0IHdhcyBwYXNzZWQgdG8gdGhlIHNlbmRpbmcgbG9naWMuCiAqIEBzZWUgQmFzZUNsaWVudC5jYXB0dXJlU2Vzc2lvbiApCiAqCiAqIEBwYXJhbSBzZXNzaW9uIHRoZSBgU2Vzc2lvbmAgdG8gdXBkYXRlCiAqIEBwYXJhbSBjb250ZXh0IHRoZSBgU2Vzc2lvbkNvbnRleHRgIGhvbGRpbmcgdGhlIHByb3BlcnRpZXMgdGhhdCBzaG91bGQgYmUgdXBkYXRlZCBpbiBAcGFyYW0gc2Vzc2lvbgogKi8KLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBsZXhpdHkKZnVuY3Rpb24gdXBkYXRlU2Vzc2lvbihzZXNzaW9uLCBjb250ZXh0ID0ge30pIHsKICBpZiAoY29udGV4dC51c2VyKSB7CiAgICBpZiAoIXNlc3Npb24uaXBBZGRyZXNzICYmIGNvbnRleHQudXNlci5pcF9hZGRyZXNzKSB7CiAgICAgIHNlc3Npb24uaXBBZGRyZXNzID0gY29udGV4dC51c2VyLmlwX2FkZHJlc3M7CiAgICB9CgogICAgaWYgKCFzZXNzaW9uLmRpZCAmJiAhY29udGV4dC5kaWQpIHsKICAgICAgc2Vzc2lvbi5kaWQgPSBjb250ZXh0LnVzZXIuaWQgfHwgY29udGV4dC51c2VyLmVtYWlsIHx8IGNvbnRleHQudXNlci51c2VybmFtZTsKICAgIH0KICB9CgogIHNlc3Npb24udGltZXN0YW1wID0gY29udGV4dC50aW1lc3RhbXAgfHwgdGltZXN0YW1wSW5TZWNvbmRzKCk7CgogIGlmIChjb250ZXh0LmFibm9ybWFsX21lY2hhbmlzbSkgewogICAgc2Vzc2lvbi5hYm5vcm1hbF9tZWNoYW5pc20gPSBjb250ZXh0LmFibm9ybWFsX21lY2hhbmlzbTsKICB9CgogIGlmIChjb250ZXh0Lmlnbm9yZUR1cmF0aW9uKSB7CiAgICBzZXNzaW9uLmlnbm9yZUR1cmF0aW9uID0gY29udGV4dC5pZ25vcmVEdXJhdGlvbjsKICB9CiAgaWYgKGNvbnRleHQuc2lkKSB7CiAgICAvLyBHb29kIGVub3VnaCB1dWlkIHZhbGlkYXRpb24uIOKAlCBLYW1pbAogICAgc2Vzc2lvbi5zaWQgPSBjb250ZXh0LnNpZC5sZW5ndGggPT09IDMyID8gY29udGV4dC5zaWQgOiB1dWlkNCgpOwogIH0KICBpZiAoY29udGV4dC5pbml0ICE9PSB1bmRlZmluZWQpIHsKICAgIHNlc3Npb24uaW5pdCA9IGNvbnRleHQuaW5pdDsKICB9CiAgaWYgKCFzZXNzaW9uLmRpZCAmJiBjb250ZXh0LmRpZCkgewogICAgc2Vzc2lvbi5kaWQgPSBgJHtjb250ZXh0LmRpZH1gOwogIH0KICBpZiAodHlwZW9mIGNvbnRleHQuc3RhcnRlZCA9PT0gJ251bWJlcicpIHsKICAgIHNlc3Npb24uc3RhcnRlZCA9IGNvbnRleHQuc3RhcnRlZDsKICB9CiAgaWYgKHNlc3Npb24uaWdub3JlRHVyYXRpb24pIHsKICAgIHNlc3Npb24uZHVyYXRpb24gPSB1bmRlZmluZWQ7CiAgfSBlbHNlIGlmICh0eXBlb2YgY29udGV4dC5kdXJhdGlvbiA9PT0gJ251bWJlcicpIHsKICAgIHNlc3Npb24uZHVyYXRpb24gPSBjb250ZXh0LmR1cmF0aW9uOwogIH0gZWxzZSB7CiAgICBjb25zdCBkdXJhdGlvbiA9IHNlc3Npb24udGltZXN0YW1wIC0gc2Vzc2lvbi5zdGFydGVkOwogICAgc2Vzc2lvbi5kdXJhdGlvbiA9IGR1cmF0aW9uID49IDAgPyBkdXJhdGlvbiA6IDA7CiAgfQogIGlmIChjb250ZXh0LnJlbGVhc2UpIHsKICAgIHNlc3Npb24ucmVsZWFzZSA9IGNvbnRleHQucmVsZWFzZTsKICB9CiAgaWYgKGNvbnRleHQuZW52aXJvbm1lbnQpIHsKICAgIHNlc3Npb24uZW52aXJvbm1lbnQgPSBjb250ZXh0LmVudmlyb25tZW50OwogIH0KICBpZiAoIXNlc3Npb24uaXBBZGRyZXNzICYmIGNvbnRleHQuaXBBZGRyZXNzKSB7CiAgICBzZXNzaW9uLmlwQWRkcmVzcyA9IGNvbnRleHQuaXBBZGRyZXNzOwogIH0KICBpZiAoIXNlc3Npb24udXNlckFnZW50ICYmIGNvbnRleHQudXNlckFnZW50KSB7CiAgICBzZXNzaW9uLnVzZXJBZ2VudCA9IGNvbnRleHQudXNlckFnZW50OwogIH0KICBpZiAodHlwZW9mIGNvbnRleHQuZXJyb3JzID09PSAnbnVtYmVyJykgewogICAgc2Vzc2lvbi5lcnJvcnMgPSBjb250ZXh0LmVycm9yczsKICB9CiAgaWYgKGNvbnRleHQuc3RhdHVzKSB7CiAgICBzZXNzaW9uLnN0YXR1cyA9IGNvbnRleHQuc3RhdHVzOwogIH0KfQoKLyoqCiAqIENsb3NlcyBhIHNlc3Npb24gYnkgc2V0dGluZyBpdHMgc3RhdHVzIGFuZCB1cGRhdGluZyB0aGUgc2Vzc2lvbiBvYmplY3Qgd2l0aCBpdC4KICogSW50ZXJuYWxseSBjYWxscyBgdXBkYXRlU2Vzc2lvbmAgdG8gdXBkYXRlIHRoZSBwYXNzZWQgc2Vzc2lvbiBvYmplY3QuCiAqCiAqIE5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIG11dGF0ZXMgdGhlIHBhc3NlZCBzZXNzaW9uIChAc2VlIHVwZGF0ZVNlc3Npb24gZm9yIGV4cGxhbmF0aW9uKS4KICoKICogQHBhcmFtIHNlc3Npb24gdGhlIGBTZXNzaW9uYCBvYmplY3QgdG8gYmUgY2xvc2VkCiAqIEBwYXJhbSBzdGF0dXMgdGhlIGBTZXNzaW9uU3RhdHVzYCB3aXRoIHdoaWNoIHRoZSBzZXNzaW9uIHdhcyBjbG9zZWQuIElmIHlvdSBkb24ndCBwYXNzIGEgc3RhdHVzLAogKiAgICAgICAgICAgICAgIHRoaXMgZnVuY3Rpb24gd2lsbCBrZWVwIHRoZSBwcmV2aW91c2x5IHNldCBzdGF0dXMsIHVubGVzcyBpdCB3YXMgYCdvaydgIGluIHdoaWNoIGNhc2UKICogICAgICAgICAgICAgICBpdCBpcyBjaGFuZ2VkIHRvIGAnZXhpdGVkJ2AuCiAqLwpmdW5jdGlvbiBjbG9zZVNlc3Npb24oc2Vzc2lvbiwgc3RhdHVzKSB7CiAgbGV0IGNvbnRleHQgPSB7fTsKICBpZiAoc3RhdHVzKSB7CiAgICBjb250ZXh0ID0geyBzdGF0dXMgfTsKICB9IGVsc2UgaWYgKHNlc3Npb24uc3RhdHVzID09PSAnb2snKSB7CiAgICBjb250ZXh0ID0geyBzdGF0dXM6ICdleGl0ZWQnIH07CiAgfQoKICB1cGRhdGVTZXNzaW9uKHNlc3Npb24sIGNvbnRleHQpOwp9CgovKioKICogU2VyaWFsaXplcyBhIHBhc3NlZCBzZXNzaW9uIG9iamVjdCB0byBhIEpTT04gb2JqZWN0IHdpdGggYSBzbGlnaHRseSBkaWZmZXJlbnQgc3RydWN0dXJlLgogKiBUaGlzIGlzIG5lY2Vzc2FyeSBiZWNhdXNlIHRoZSBTZW50cnkgYmFja2VuZCByZXF1aXJlcyBhIHNsaWdodGx5IGRpZmZlcmVudCBzY2hlbWEgb2YgYSBzZXNzaW9uCiAqIHRoYW4gdGhlIG9uZSB0aGUgSlMgU0RLcyB1c2UgaW50ZXJuYWxseS4KICoKICogQHBhcmFtIHNlc3Npb24gdGhlIHNlc3Npb24gdG8gYmUgY29udmVydGVkCiAqCiAqIEByZXR1cm5zIGEgSlNPTiBvYmplY3Qgb2YgdGhlIHBhc3NlZCBzZXNzaW9uCiAqLwpmdW5jdGlvbiBzZXNzaW9uVG9KU09OKHNlc3Npb24pIHsKICByZXR1cm4gZHJvcFVuZGVmaW5lZEtleXMoewogICAgc2lkOiBgJHtzZXNzaW9uLnNpZH1gLAogICAgaW5pdDogc2Vzc2lvbi5pbml0LAogICAgLy8gTWFrZSBzdXJlIHRoYXQgc2VjIGlzIGNvbnZlcnRlZCB0byBtcyBmb3IgZGF0ZSBjb25zdHJ1Y3RvcgogICAgc3RhcnRlZDogbmV3IERhdGUoc2Vzc2lvbi5zdGFydGVkICogMTAwMCkudG9JU09TdHJpbmcoKSwKICAgIHRpbWVzdGFtcDogbmV3IERhdGUoc2Vzc2lvbi50aW1lc3RhbXAgKiAxMDAwKS50b0lTT1N0cmluZygpLAogICAgc3RhdHVzOiBzZXNzaW9uLnN0YXR1cywKICAgIGVycm9yczogc2Vzc2lvbi5lcnJvcnMsCiAgICBkaWQ6IHR5cGVvZiBzZXNzaW9uLmRpZCA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHNlc3Npb24uZGlkID09PSAnc3RyaW5nJyA/IGAke3Nlc3Npb24uZGlkfWAgOiB1bmRlZmluZWQsCiAgICBkdXJhdGlvbjogc2Vzc2lvbi5kdXJhdGlvbiwKICAgIGFibm9ybWFsX21lY2hhbmlzbTogc2Vzc2lvbi5hYm5vcm1hbF9tZWNoYW5pc20sCiAgICBhdHRyczogewogICAgICByZWxlYXNlOiBzZXNzaW9uLnJlbGVhc2UsCiAgICAgIGVudmlyb25tZW50OiBzZXNzaW9uLmVudmlyb25tZW50LAogICAgICBpcF9hZGRyZXNzOiBzZXNzaW9uLmlwQWRkcmVzcywKICAgICAgdXNlcl9hZ2VudDogc2Vzc2lvbi51c2VyQWdlbnQsCiAgICB9LAogIH0pOwp9Cgpjb25zdCBUUkFDRV9GTEFHX1NBTVBMRUQgPSAweDE7CgovKioKICogQ29udmVydCBhIHNwYW4gdG8gYSB0cmFjZSBjb250ZXh0LCB3aGljaCBjYW4gYmUgc2VudCBhcyB0aGUgYHRyYWNlYCBjb250ZXh0IGluIGFuIGV2ZW50LgogKi8KZnVuY3Rpb24gc3BhblRvVHJhY2VDb250ZXh0KHNwYW4pIHsKICBjb25zdCB7IHNwYW5JZDogc3Bhbl9pZCwgdHJhY2VJZDogdHJhY2VfaWQgfSA9IHNwYW4uc3BhbkNvbnRleHQoKTsKICBjb25zdCB7IGRhdGEsIG9wLCBwYXJlbnRfc3Bhbl9pZCwgc3RhdHVzLCB0YWdzLCBvcmlnaW4gfSA9IHNwYW5Ub0pTT04oc3Bhbik7CgogIHJldHVybiBkcm9wVW5kZWZpbmVkS2V5cyh7CiAgICBkYXRhLAogICAgb3AsCiAgICBwYXJlbnRfc3Bhbl9pZCwKICAgIHNwYW5faWQsCiAgICBzdGF0dXMsCiAgICB0YWdzLAogICAgdHJhY2VfaWQsCiAgICBvcmlnaW4sCiAgfSk7Cn0KCi8qKgogKiBDb252ZXJ0IGEgc3BhbiB0byBhIEpTT04gcmVwcmVzZW50YXRpb24uCiAqIE5vdGUgdGhhdCBhbGwgZmllbGRzIHJldHVybmVkIGhlcmUgYXJlIG9wdGlvbmFsIGFuZCBuZWVkIHRvIGJlIGd1YXJkZWQgYWdhaW5zdC4KICoKICogTm90ZTogQmVjYXVzZSBvZiB0aGlzLCB3ZSBjdXJyZW50bHkgaGF2ZSBhIGNpcmN1bGFyIHR5cGUgZGVwZW5kZW5jeSAod2hpY2ggd2Ugb3B0ZWQgb3V0IG9mIGluIHBhY2thZ2UuanNvbikuCiAqIFRoaXMgaXMgbm90IGF2b2lkYWJsZSBhcyB3ZSBuZWVkIGBzcGFuVG9KU09OYCBpbiBgc3BhblV0aWxzLnRzYCwgd2hpY2ggaW4gdHVybiBpcyBuZWVkZWQgYnkgYHNwYW4udHNgIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS4KICogQW5kIGBzcGFuVG9KU09OYCBuZWVkcyB0aGUgU3BhbiBjbGFzcyBmcm9tIGBzcGFuLnRzYCB0byBjaGVjayBoZXJlLgogKiBUT0RPIHY4OiBXaGVuIHdlIHJlbW92ZSB0aGUgZGVwcmVjYXRlZCBzdHVmZiBmcm9tIGBzcGFuLnRzYCwgd2UgY2FuIHJlbW92ZSB0aGUgY2lyY3VsYXIgZGVwZW5kZW5jeSBhZ2Fpbi4KICovCmZ1bmN0aW9uIHNwYW5Ub0pTT04oc3BhbikgewogIGlmIChzcGFuSXNTcGFuQ2xhc3Moc3BhbikpIHsKICAgIHJldHVybiBzcGFuLmdldFNwYW5KU09OKCk7CiAgfQoKICAvLyBGYWxsYmFjazogV2UgYWxzbyBjaGVjayBmb3IgYC50b0pTT04oKWAgaGVyZS4uLgogIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogIGlmICh0eXBlb2Ygc3Bhbi50b0pTT04gPT09ICdmdW5jdGlvbicpIHsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgcmV0dXJuIHNwYW4udG9KU09OKCk7CiAgfQoKICByZXR1cm4ge307Cn0KCi8qKgogKiBTYWRseSwgZHVlIHRvIGNpcmN1bGFyIGRlcGVuZGVuY3kgY2hlY2tzIHdlIGNhbm5vdCBhY3R1YWxseSBpbXBvcnQgdGhlIFNwYW4gY2xhc3MgaGVyZSBhbmQgY2hlY2sgZm9yIGluc3RhbmNlb2YuCiAqIDooIFNvIGluc3RlYWQgd2UgYXBwcm94aW1hdGUgdGhpcyBieSBjaGVja2luZyBpZiBpdCBoYXMgdGhlIGBnZXRTcGFuSlNPTmAgbWV0aG9kLgogKi8KZnVuY3Rpb24gc3BhbklzU3BhbkNsYXNzKHNwYW4pIHsKICByZXR1cm4gdHlwZW9mIChzcGFuICkuZ2V0U3BhbkpTT04gPT09ICdmdW5jdGlvbic7Cn0KCi8qKgogKiBSZXR1cm5zIHRydWUgaWYgYSBzcGFuIGlzIHNhbXBsZWQuCiAqIEluIG1vc3QgY2FzZXMsIHlvdSBzaG91bGQganVzdCB1c2UgYHNwYW4uaXNSZWNvcmRpbmcoKWAgaW5zdGVhZC4KICogSG93ZXZlciwgdGhpcyBoYXMgYSBzbGlnaHRseSBkaWZmZXJlbnQgc2VtYW50aWMsIGFzIGl0IGFsc28gcmV0dXJucyBmYWxzZSBpZiB0aGUgc3BhbiBpcyBmaW5pc2hlZC4KICogU28gaW4gdGhlIGNhc2Ugd2hlcmUgdGhpcyBkaXN0aW5jdGlvbiBpcyBpbXBvcnRhbnQsIHVzZSB0aGlzIG1ldGhvZC4KICovCmZ1bmN0aW9uIHNwYW5Jc1NhbXBsZWQoc3BhbikgewogIC8vIFdlIGFsaWduIG91ciB0cmFjZSBmbGFncyB3aXRoIHRoZSBvbmVzIE9wZW5UZWxlbWV0cnkgdXNlCiAgLy8gU28gd2UgYWxzbyBjaGVjayBmb3Igc2FtcGxlZCB0aGUgc2FtZSB3YXkgdGhleSBkby4KICBjb25zdCB7IHRyYWNlRmxhZ3MgfSA9IHNwYW4uc3BhbkNvbnRleHQoKTsKICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZQogIHJldHVybiBCb29sZWFuKHRyYWNlRmxhZ3MgJiBUUkFDRV9GTEFHX1NBTVBMRUQpOwp9CgovKioKICogR2V0IHRoZSBjdXJyZW50bHkgYWN0aXZlIGNsaWVudC4KICovCmZ1bmN0aW9uIGdldENsaWVudCgpIHsKICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICByZXR1cm4gZ2V0Q3VycmVudEh1YigpLmdldENsaWVudCgpOwp9CgovKioKICogR2V0IHRoZSBjdXJyZW50bHkgYWN0aXZlIHNjb3BlLgogKi8KZnVuY3Rpb24gZ2V0Q3VycmVudFNjb3BlKCkgewogIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogIHJldHVybiBnZXRDdXJyZW50SHViKCkuZ2V0U2NvcGUoKTsKfQoKLyoqCiAqIFJldHVybnMgdGhlIHJvb3Qgc3BhbiBvZiBhIGdpdmVuIHNwYW4uCiAqCiAqIEFzIGxvbmcgYXMgd2UgdXNlIGBUcmFuc2FjdGlvbmBzIGludGVybmFsbHksIHRoZSByZXR1cm5lZCByb290IHNwYW4KICogd2lsbCBiZSBhIGBUcmFuc2FjdGlvbmAgYnV0IGJlIGF3YXJlIHRoYXQgdGhpcyBtaWdodCBjaGFuZ2UgaW4gdGhlIGZ1dHVyZS4KICoKICogSWYgdGhlIGdpdmVuIHNwYW4gaGFzIG5vIHJvb3Qgc3BhbiBvciB0cmFuc2FjdGlvbiwgYHVuZGVmaW5lZGAgaXMgcmV0dXJuZWQuCiAqLwpmdW5jdGlvbiBnZXRSb290U3BhbihzcGFuKSB7CiAgLy8gVE9ETyAodjgpOiBSZW1vdmUgdGhpcyBjaGVjayBhbmQganVzdCByZXR1cm4gc3BhbgogIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogIHJldHVybiBzcGFuLnRyYW5zYWN0aW9uOwp9CgovKioKICogQ3JlYXRlcyBhIGR5bmFtaWMgc2FtcGxpbmcgY29udGV4dCBmcm9tIGEgY2xpZW50LgogKgogKiBEaXNwYXRjaGVzIHRoZSBgY3JlYXRlRHNjYCBsaWZlY3ljbGUgaG9vayBhcyBhIHNpZGUgZWZmZWN0LgogKi8KZnVuY3Rpb24gZ2V0RHluYW1pY1NhbXBsaW5nQ29udGV4dEZyb21DbGllbnQoCiAgdHJhY2VfaWQsCiAgY2xpZW50LAogIHNjb3BlLAopIHsKICBjb25zdCBvcHRpb25zID0gY2xpZW50LmdldE9wdGlvbnMoKTsKCiAgY29uc3QgeyBwdWJsaWNLZXk6IHB1YmxpY19rZXkgfSA9IGNsaWVudC5nZXREc24oKSB8fCB7fTsKICAvLyBUT0RPKHY4KTogUmVtb3ZlIHNlZ21lbnQgZnJvbSBVc2VyCiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgY29uc3QgeyBzZWdtZW50OiB1c2VyX3NlZ21lbnQgfSA9IChzY29wZSAmJiBzY29wZS5nZXRVc2VyKCkpIHx8IHt9OwoKICBjb25zdCBkc2MgPSBkcm9wVW5kZWZpbmVkS2V5cyh7CiAgICBlbnZpcm9ubWVudDogb3B0aW9ucy5lbnZpcm9ubWVudCB8fCBERUZBVUxUX0VOVklST05NRU5ULAogICAgcmVsZWFzZTogb3B0aW9ucy5yZWxlYXNlLAogICAgdXNlcl9zZWdtZW50LAogICAgcHVibGljX2tleSwKICAgIHRyYWNlX2lkLAogIH0pIDsKCiAgY2xpZW50LmVtaXQgJiYgY2xpZW50LmVtaXQoJ2NyZWF0ZURzYycsIGRzYyk7CgogIHJldHVybiBkc2M7Cn0KCi8qKgogKiBBIFNwYW4gd2l0aCBhIGZyb3plbiBkeW5hbWljIHNhbXBsaW5nIGNvbnRleHQuCiAqLwoKLyoqCiAqIENyZWF0ZXMgYSBkeW5hbWljIHNhbXBsaW5nIGNvbnRleHQgZnJvbSBhIHNwYW4gKGFuZCBjbGllbnQgYW5kIHNjb3BlKQogKgogKiBAcGFyYW0gc3BhbiB0aGUgc3BhbiBmcm9tIHdoaWNoIGEgZmV3IHZhbHVlcyBsaWtlIHRoZSByb290IHNwYW4gbmFtZSBhbmQgc2FtcGxlIHJhdGUgYXJlIGV4dHJhY3RlZC4KICoKICogQHJldHVybnMgYSBkeW5hbWljIHNhbXBsaW5nIGNvbnRleHQKICovCmZ1bmN0aW9uIGdldER5bmFtaWNTYW1wbGluZ0NvbnRleHRGcm9tU3BhbihzcGFuKSB7CiAgY29uc3QgY2xpZW50ID0gZ2V0Q2xpZW50KCk7CiAgaWYgKCFjbGllbnQpIHsKICAgIHJldHVybiB7fTsKICB9CgogIC8vIHBhc3NpbmcgZW1pdD1mYWxzZSBoZXJlIHRvIG9ubHkgZW1pdCBsYXRlciBvbmNlIHRoZSBEU0MgaXMgYWN0dWFsbHkgcG9wdWxhdGVkCiAgY29uc3QgZHNjID0gZ2V0RHluYW1pY1NhbXBsaW5nQ29udGV4dEZyb21DbGllbnQoc3BhblRvSlNPTihzcGFuKS50cmFjZV9pZCB8fCAnJywgY2xpZW50LCBnZXRDdXJyZW50U2NvcGUoKSk7CgogIC8vIFRPRE8gKHY4KTogUmVtb3ZlIHY3RnJvemVuRHNjIGFzIGEgVHJhbnNhY3Rpb24gd2lsbCBubyBsb25nZXIgaGF2ZSBfZnJvemVuRHluYW1pY1NhbXBsaW5nQ29udGV4dAogIGNvbnN0IHR4biA9IGdldFJvb3RTcGFuKHNwYW4pIDsKICBpZiAoIXR4bikgewogICAgcmV0dXJuIGRzYzsKICB9CgogIC8vIFRPRE8gKHY4KTogUmVtb3ZlIHY3RnJvemVuRHNjIGFzIGEgVHJhbnNhY3Rpb24gd2lsbCBubyBsb25nZXIgaGF2ZSBfZnJvemVuRHluYW1pY1NhbXBsaW5nQ29udGV4dAogIC8vIEZvciBub3cgd2UgbmVlZCB0byBhdm9pZCBicmVha2luZyB1c2VycyB3aG8gZGlyZWN0bHkgY3JlYXRlZCBhIHR4biB3aXRoIGEgRFNDLCB3aGVyZSB0aGlzIGZpZWxkIGlzIHN0aWxsIHNldC4KICAvLyBAc2VlIFRyYW5zYWN0aW9uIGNsYXNzIGNvbnN0cnVjdG9yCiAgY29uc3QgdjdGcm96ZW5Ec2MgPSB0eG4gJiYgdHhuLl9mcm96ZW5EeW5hbWljU2FtcGxpbmdDb250ZXh0OwogIGlmICh2N0Zyb3plbkRzYykgewogICAgcmV0dXJuIHY3RnJvemVuRHNjOwogIH0KCiAgLy8gVE9ETyAodjgpOiBSZXBsYWNlIHR4bi5tZXRhZGF0YSB3aXRoIHR4bi5hdHRyaWJ1dGVzW10KICAvLyBXZSBjYW4ndCBkbyB0aGlzIHlldCBiZWNhdXNlIGF0dHJpYnV0ZXMgYXJlbid0IGFsd2F5cyBzZXQgeWV0LgogIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogIGNvbnN0IHsgc2FtcGxlUmF0ZTogbWF5YmVTYW1wbGVSYXRlLCBzb3VyY2UgfSA9IHR4bi5tZXRhZGF0YTsKICBpZiAobWF5YmVTYW1wbGVSYXRlICE9IG51bGwpIHsKICAgIGRzYy5zYW1wbGVfcmF0ZSA9IGAke21heWJlU2FtcGxlUmF0ZX1gOwogIH0KCiAgLy8gV2UgZG9uJ3Qgd2FudCB0byBoYXZlIGEgdHJhbnNhY3Rpb24gbmFtZSBpbiB0aGUgRFNDIGlmIHRoZSBzb3VyY2UgaXMgInVybCIgYmVjYXVzZSBVUkxzIG1pZ2h0IGNvbnRhaW4gUElJCiAgY29uc3QganNvblNwYW4gPSBzcGFuVG9KU09OKHR4bik7CgogIC8vIGFmdGVyIEpTT04gY29udmVyc2lvbiwgdHhuLm5hbWUgYmVjb21lcyBqc29uU3Bhbi5kZXNjcmlwdGlvbgogIGlmIChzb3VyY2UgJiYgc291cmNlICE9PSAndXJsJykgewogICAgZHNjLnRyYW5zYWN0aW9uID0ganNvblNwYW4uZGVzY3JpcHRpb247CiAgfQoKICBkc2Muc2FtcGxlZCA9IFN0cmluZyhzcGFuSXNTYW1wbGVkKHR4bikpOwoKICBjbGllbnQuZW1pdCAmJiBjbGllbnQuZW1pdCgnY3JlYXRlRHNjJywgZHNjKTsKCiAgcmV0dXJuIGRzYzsKfQoKLyoqCiAqIEFwcGxpZXMgZGF0YSBmcm9tIHRoZSBzY29wZSB0byB0aGUgZXZlbnQgYW5kIHJ1bnMgYWxsIGV2ZW50IHByb2Nlc3NvcnMgb24gaXQuCiAqLwpmdW5jdGlvbiBhcHBseVNjb3BlRGF0YVRvRXZlbnQoZXZlbnQsIGRhdGEpIHsKICBjb25zdCB7IGZpbmdlcnByaW50LCBzcGFuLCBicmVhZGNydW1icywgc2RrUHJvY2Vzc2luZ01ldGFkYXRhIH0gPSBkYXRhOwoKICAvLyBBcHBseSBnZW5lcmFsIGRhdGEKICBhcHBseURhdGFUb0V2ZW50KGV2ZW50LCBkYXRhKTsKCiAgLy8gV2Ugd2FudCB0byBzZXQgdGhlIHRyYWNlIGNvbnRleHQgZm9yIG5vcm1hbCBldmVudHMgb25seSBpZiB0aGVyZSBpc24ndCBhbHJlYWR5CiAgLy8gYSB0cmFjZSBjb250ZXh0IG9uIHRoZSBldmVudC4gVGhlcmUgaXMgYSBwcm9kdWN0IGZlYXR1cmUgaW4gcGxhY2Ugd2hlcmUgd2UgbGluawogIC8vIGVycm9ycyB3aXRoIHRyYW5zYWN0aW9uIGFuZCBpdCByZWxpZXMgb24gdGhhdC4KICBpZiAoc3BhbikgewogICAgYXBwbHlTcGFuVG9FdmVudChldmVudCwgc3Bhbik7CiAgfQoKICBhcHBseUZpbmdlcnByaW50VG9FdmVudChldmVudCwgZmluZ2VycHJpbnQpOwogIGFwcGx5QnJlYWRjcnVtYnNUb0V2ZW50KGV2ZW50LCBicmVhZGNydW1icyk7CiAgYXBwbHlTZGtNZXRhZGF0YVRvRXZlbnQoZXZlbnQsIHNka1Byb2Nlc3NpbmdNZXRhZGF0YSk7Cn0KCmZ1bmN0aW9uIGFwcGx5RGF0YVRvRXZlbnQoZXZlbnQsIGRhdGEpIHsKICBjb25zdCB7CiAgICBleHRyYSwKICAgIHRhZ3MsCiAgICB1c2VyLAogICAgY29udGV4dHMsCiAgICBsZXZlbCwKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgdHJhbnNhY3Rpb25OYW1lLAogIH0gPSBkYXRhOwoKICBjb25zdCBjbGVhbmVkRXh0cmEgPSBkcm9wVW5kZWZpbmVkS2V5cyhleHRyYSk7CiAgaWYgKGNsZWFuZWRFeHRyYSAmJiBPYmplY3Qua2V5cyhjbGVhbmVkRXh0cmEpLmxlbmd0aCkgewogICAgZXZlbnQuZXh0cmEgPSB7IC4uLmNsZWFuZWRFeHRyYSwgLi4uZXZlbnQuZXh0cmEgfTsKICB9CgogIGNvbnN0IGNsZWFuZWRUYWdzID0gZHJvcFVuZGVmaW5lZEtleXModGFncyk7CiAgaWYgKGNsZWFuZWRUYWdzICYmIE9iamVjdC5rZXlzKGNsZWFuZWRUYWdzKS5sZW5ndGgpIHsKICAgIGV2ZW50LnRhZ3MgPSB7IC4uLmNsZWFuZWRUYWdzLCAuLi5ldmVudC50YWdzIH07CiAgfQoKICBjb25zdCBjbGVhbmVkVXNlciA9IGRyb3BVbmRlZmluZWRLZXlzKHVzZXIpOwogIGlmIChjbGVhbmVkVXNlciAmJiBPYmplY3Qua2V5cyhjbGVhbmVkVXNlcikubGVuZ3RoKSB7CiAgICBldmVudC51c2VyID0geyAuLi5jbGVhbmVkVXNlciwgLi4uZXZlbnQudXNlciB9OwogIH0KCiAgY29uc3QgY2xlYW5lZENvbnRleHRzID0gZHJvcFVuZGVmaW5lZEtleXMoY29udGV4dHMpOwogIGlmIChjbGVhbmVkQ29udGV4dHMgJiYgT2JqZWN0LmtleXMoY2xlYW5lZENvbnRleHRzKS5sZW5ndGgpIHsKICAgIGV2ZW50LmNvbnRleHRzID0geyAuLi5jbGVhbmVkQ29udGV4dHMsIC4uLmV2ZW50LmNvbnRleHRzIH07CiAgfQoKICBpZiAobGV2ZWwpIHsKICAgIGV2ZW50LmxldmVsID0gbGV2ZWw7CiAgfQoKICBpZiAodHJhbnNhY3Rpb25OYW1lKSB7CiAgICBldmVudC50cmFuc2FjdGlvbiA9IHRyYW5zYWN0aW9uTmFtZTsKICB9Cn0KCmZ1bmN0aW9uIGFwcGx5QnJlYWRjcnVtYnNUb0V2ZW50KGV2ZW50LCBicmVhZGNydW1icykgewogIGNvbnN0IG1lcmdlZEJyZWFkY3J1bWJzID0gWy4uLihldmVudC5icmVhZGNydW1icyB8fCBbXSksIC4uLmJyZWFkY3J1bWJzXTsKICBldmVudC5icmVhZGNydW1icyA9IG1lcmdlZEJyZWFkY3J1bWJzLmxlbmd0aCA/IG1lcmdlZEJyZWFkY3J1bWJzIDogdW5kZWZpbmVkOwp9CgpmdW5jdGlvbiBhcHBseVNka01ldGFkYXRhVG9FdmVudChldmVudCwgc2RrUHJvY2Vzc2luZ01ldGFkYXRhKSB7CiAgZXZlbnQuc2RrUHJvY2Vzc2luZ01ldGFkYXRhID0gewogICAgLi4uZXZlbnQuc2RrUHJvY2Vzc2luZ01ldGFkYXRhLAogICAgLi4uc2RrUHJvY2Vzc2luZ01ldGFkYXRhLAogIH07Cn0KCmZ1bmN0aW9uIGFwcGx5U3BhblRvRXZlbnQoZXZlbnQsIHNwYW4pIHsKICBldmVudC5jb250ZXh0cyA9IHsgdHJhY2U6IHNwYW5Ub1RyYWNlQ29udGV4dChzcGFuKSwgLi4uZXZlbnQuY29udGV4dHMgfTsKICBjb25zdCByb290U3BhbiA9IGdldFJvb3RTcGFuKHNwYW4pOwogIGlmIChyb290U3BhbikgewogICAgZXZlbnQuc2RrUHJvY2Vzc2luZ01ldGFkYXRhID0gewogICAgICBkeW5hbWljU2FtcGxpbmdDb250ZXh0OiBnZXREeW5hbWljU2FtcGxpbmdDb250ZXh0RnJvbVNwYW4oc3BhbiksCiAgICAgIC4uLmV2ZW50LnNka1Byb2Nlc3NpbmdNZXRhZGF0YSwKICAgIH07CiAgICBjb25zdCB0cmFuc2FjdGlvbk5hbWUgPSBzcGFuVG9KU09OKHJvb3RTcGFuKS5kZXNjcmlwdGlvbjsKICAgIGlmICh0cmFuc2FjdGlvbk5hbWUpIHsKICAgICAgZXZlbnQudGFncyA9IHsgdHJhbnNhY3Rpb246IHRyYW5zYWN0aW9uTmFtZSwgLi4uZXZlbnQudGFncyB9OwogICAgfQogIH0KfQoKLyoqCiAqIEFwcGxpZXMgZmluZ2VycHJpbnQgZnJvbSB0aGUgc2NvcGUgdG8gdGhlIGV2ZW50IGlmIHRoZXJlJ3Mgb25lLAogKiB1c2VzIG1lc3NhZ2UgaWYgdGhlcmUncyBvbmUgaW5zdGVhZCBvciBnZXQgcmlkIG9mIGVtcHR5IGZpbmdlcnByaW50CiAqLwpmdW5jdGlvbiBhcHBseUZpbmdlcnByaW50VG9FdmVudChldmVudCwgZmluZ2VycHJpbnQpIHsKICAvLyBNYWtlIHN1cmUgaXQncyBhbiBhcnJheSBmaXJzdCBhbmQgd2UgYWN0dWFsbHkgaGF2ZSBzb21ldGhpbmcgaW4gcGxhY2UKICBldmVudC5maW5nZXJwcmludCA9IGV2ZW50LmZpbmdlcnByaW50ID8gYXJyYXlpZnkoZXZlbnQuZmluZ2VycHJpbnQpIDogW107CgogIC8vIElmIHdlIGhhdmUgc29tZXRoaW5nIG9uIHRoZSBzY29wZSwgdGhlbiBtZXJnZSBpdCB3aXRoIGV2ZW50CiAgaWYgKGZpbmdlcnByaW50KSB7CiAgICBldmVudC5maW5nZXJwcmludCA9IGV2ZW50LmZpbmdlcnByaW50LmNvbmNhdChmaW5nZXJwcmludCk7CiAgfQoKICAvLyBJZiB3ZSBoYXZlIG5vIGRhdGEgYXQgYWxsLCByZW1vdmUgZW1wdHkgYXJyYXkgZGVmYXVsdAogIGlmIChldmVudC5maW5nZXJwcmludCAmJiAhZXZlbnQuZmluZ2VycHJpbnQubGVuZ3RoKSB7CiAgICBkZWxldGUgZXZlbnQuZmluZ2VycHJpbnQ7CiAgfQp9CgovKioKICogRGVmYXVsdCB2YWx1ZSBmb3IgbWF4aW11bSBudW1iZXIgb2YgYnJlYWRjcnVtYnMgYWRkZWQgdG8gYW4gZXZlbnQuCiAqLwpjb25zdCBERUZBVUxUX01BWF9CUkVBRENSVU1CUyA9IDEwMDsKCi8qKgogKiBIb2xkcyBhZGRpdGlvbmFsIGV2ZW50IGluZm9ybWF0aW9uLiB7QGxpbmsgU2NvcGUuYXBwbHlUb0V2ZW50fSB3aWxsIGJlCiAqIGNhbGxlZCBieSB0aGUgY2xpZW50IGJlZm9yZSBhbiBldmVudCB3aWxsIGJlIHNlbnQuCiAqLwpjbGFzcyBTY29wZSAgewogIC8qKiBGbGFnIGlmIG5vdGlmeWluZyBpcyBoYXBwZW5pbmcuICovCgogIC8qKiBDYWxsYmFjayBmb3IgY2xpZW50IHRvIHJlY2VpdmUgc2NvcGUgY2hhbmdlcy4gKi8KCiAgLyoqIENhbGxiYWNrIGxpc3QgdGhhdCB3aWxsIGJlIGNhbGxlZCBhZnRlciB7QGxpbmsgYXBwbHlUb0V2ZW50fS4gKi8KCiAgLyoqIEFycmF5IG9mIGJyZWFkY3J1bWJzLiAqLwoKICAvKiogVXNlciAqLwoKICAvKiogVGFncyAqLwoKICAvKiogRXh0cmEgKi8KCiAgLyoqIENvbnRleHRzICovCgogIC8qKiBBdHRhY2htZW50cyAqLwoKICAvKiogUHJvcGFnYXRpb24gQ29udGV4dCBmb3IgZGlzdHJpYnV0ZWQgdHJhY2luZyAqLwoKICAvKioKICAgKiBBIHBsYWNlIHRvIHN0YXNoIGRhdGEgd2hpY2ggaXMgbmVlZGVkIGF0IHNvbWUgcG9pbnQgaW4gdGhlIFNESydzIGV2ZW50IHByb2Nlc3NpbmcgcGlwZWxpbmUgYnV0IHdoaWNoIHNob3VsZG4ndCBnZXQKICAgKiBzZW50IHRvIFNlbnRyeQogICAqLwoKICAvKiogRmluZ2VycHJpbnQgKi8KCiAgLyoqIFNldmVyaXR5ICovCiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCgogIC8qKgogICAqIFRyYW5zYWN0aW9uIE5hbWUKICAgKi8KCiAgLyoqIFNwYW4gKi8KCiAgLyoqIFNlc3Npb24gKi8KCiAgLyoqIFJlcXVlc3QgTW9kZSBTZXNzaW9uIFN0YXR1cyAqLwoKICAvKiogVGhlIGNsaWVudCBvbiB0aGlzIHNjb3BlICovCgogIC8vIE5PVEU6IEFueSBmaWVsZCB3aGljaCBnZXRzIGFkZGVkIGhlcmUgc2hvdWxkIGdldCBhZGRlZCBub3Qgb25seSB0byB0aGUgY29uc3RydWN0b3IgYnV0IGFsc28gdG8gdGhlIGBjbG9uZWAgbWV0aG9kLgoKICAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLl9ub3RpZnlpbmdMaXN0ZW5lcnMgPSBmYWxzZTsKICAgIHRoaXMuX3Njb3BlTGlzdGVuZXJzID0gW107CiAgICB0aGlzLl9ldmVudFByb2Nlc3NvcnMgPSBbXTsKICAgIHRoaXMuX2JyZWFkY3J1bWJzID0gW107CiAgICB0aGlzLl9hdHRhY2htZW50cyA9IFtdOwogICAgdGhpcy5fdXNlciA9IHt9OwogICAgdGhpcy5fdGFncyA9IHt9OwogICAgdGhpcy5fZXh0cmEgPSB7fTsKICAgIHRoaXMuX2NvbnRleHRzID0ge307CiAgICB0aGlzLl9zZGtQcm9jZXNzaW5nTWV0YWRhdGEgPSB7fTsKICAgIHRoaXMuX3Byb3BhZ2F0aW9uQ29udGV4dCA9IGdlbmVyYXRlUHJvcGFnYXRpb25Db250ZXh0KCk7CiAgfQoKICAvKioKICAgKiBJbmhlcml0IHZhbHVlcyBmcm9tIHRoZSBwYXJlbnQgc2NvcGUuCiAgICogQGRlcHJlY2F0ZWQgVXNlIGBzY29wZS5jbG9uZSgpYCBhbmQgYG5ldyBTY29wZSgpYCBpbnN0ZWFkLgogICAqLwogICBzdGF0aWMgY2xvbmUoc2NvcGUpIHsKICAgIHJldHVybiBzY29wZSA/IHNjb3BlLmNsb25lKCkgOiBuZXcgU2NvcGUoKTsKICB9CgogIC8qKgogICAqIENsb25lIHRoaXMgc2NvcGUgaW5zdGFuY2UuCiAgICovCiAgIGNsb25lKCkgewogICAgY29uc3QgbmV3U2NvcGUgPSBuZXcgU2NvcGUoKTsKICAgIG5ld1Njb3BlLl9icmVhZGNydW1icyA9IFsuLi50aGlzLl9icmVhZGNydW1ic107CiAgICBuZXdTY29wZS5fdGFncyA9IHsgLi4udGhpcy5fdGFncyB9OwogICAgbmV3U2NvcGUuX2V4dHJhID0geyAuLi50aGlzLl9leHRyYSB9OwogICAgbmV3U2NvcGUuX2NvbnRleHRzID0geyAuLi50aGlzLl9jb250ZXh0cyB9OwogICAgbmV3U2NvcGUuX3VzZXIgPSB0aGlzLl91c2VyOwogICAgbmV3U2NvcGUuX2xldmVsID0gdGhpcy5fbGV2ZWw7CiAgICBuZXdTY29wZS5fc3BhbiA9IHRoaXMuX3NwYW47CiAgICBuZXdTY29wZS5fc2Vzc2lvbiA9IHRoaXMuX3Nlc3Npb247CiAgICBuZXdTY29wZS5fdHJhbnNhY3Rpb25OYW1lID0gdGhpcy5fdHJhbnNhY3Rpb25OYW1lOwogICAgbmV3U2NvcGUuX2ZpbmdlcnByaW50ID0gdGhpcy5fZmluZ2VycHJpbnQ7CiAgICBuZXdTY29wZS5fZXZlbnRQcm9jZXNzb3JzID0gWy4uLnRoaXMuX2V2ZW50UHJvY2Vzc29yc107CiAgICBuZXdTY29wZS5fcmVxdWVzdFNlc3Npb24gPSB0aGlzLl9yZXF1ZXN0U2Vzc2lvbjsKICAgIG5ld1Njb3BlLl9hdHRhY2htZW50cyA9IFsuLi50aGlzLl9hdHRhY2htZW50c107CiAgICBuZXdTY29wZS5fc2RrUHJvY2Vzc2luZ01ldGFkYXRhID0geyAuLi50aGlzLl9zZGtQcm9jZXNzaW5nTWV0YWRhdGEgfTsKICAgIG5ld1Njb3BlLl9wcm9wYWdhdGlvbkNvbnRleHQgPSB7IC4uLnRoaXMuX3Byb3BhZ2F0aW9uQ29udGV4dCB9OwogICAgbmV3U2NvcGUuX2NsaWVudCA9IHRoaXMuX2NsaWVudDsKCiAgICByZXR1cm4gbmV3U2NvcGU7CiAgfQoKICAvKiogVXBkYXRlIHRoZSBjbGllbnQgb24gdGhlIHNjb3BlLiAqLwogICBzZXRDbGllbnQoY2xpZW50KSB7CiAgICB0aGlzLl9jbGllbnQgPSBjbGllbnQ7CiAgfQoKICAvKioKICAgKiBHZXQgdGhlIGNsaWVudCBhc3NpZ25lZCB0byB0aGlzIHNjb3BlLgogICAqCiAgICogSXQgaXMgZ2VuZXJhbGx5IHJlY29tbWVuZGVkIHRvIHVzZSB0aGUgZ2xvYmFsIGZ1bmN0aW9uIGBTZW50cnkuZ2V0Q2xpZW50KClgIGluc3RlYWQsIHVubGVzcyB5b3Uga25vdyB3aGF0IHlvdSBhcmUgZG9pbmcuCiAgICovCiAgIGdldENsaWVudCgpIHsKICAgIHJldHVybiB0aGlzLl9jbGllbnQ7CiAgfQoKICAvKioKICAgKiBBZGQgaW50ZXJuYWwgb24gY2hhbmdlIGxpc3RlbmVyLiBVc2VkIGZvciBzdWIgU0RLcyB0aGF0IG5lZWQgdG8gc3RvcmUgdGhlIHNjb3BlLgogICAqIEBoaWRkZW4KICAgKi8KICAgYWRkU2NvcGVMaXN0ZW5lcihjYWxsYmFjaykgewogICAgdGhpcy5fc2NvcGVMaXN0ZW5lcnMucHVzaChjYWxsYmFjayk7CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwogICBhZGRFdmVudFByb2Nlc3NvcihjYWxsYmFjaykgewogICAgdGhpcy5fZXZlbnRQcm9jZXNzb3JzLnB1c2goY2FsbGJhY2spOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwogICBzZXRVc2VyKHVzZXIpIHsKICAgIC8vIElmIG51bGwgaXMgcGFzc2VkIHdlIHdhbnQgdG8gdW5zZXQgZXZlcnl0aGluZywgYnV0IHN0aWxsIGRlZmluZSBrZXlzLAogICAgLy8gc28gdGhhdCBsYXRlciBkb3duIGluIHRoZSBwaXBlbGluZSBhbnkgZXhpc3RpbmcgdmFsdWVzIGFyZSBjbGVhcmVkLgogICAgdGhpcy5fdXNlciA9IHVzZXIgfHwgewogICAgICBlbWFpbDogdW5kZWZpbmVkLAogICAgICBpZDogdW5kZWZpbmVkLAogICAgICBpcF9hZGRyZXNzOiB1bmRlZmluZWQsCiAgICAgIHNlZ21lbnQ6IHVuZGVmaW5lZCwKICAgICAgdXNlcm5hbWU6IHVuZGVmaW5lZCwKICAgIH07CgogICAgaWYgKHRoaXMuX3Nlc3Npb24pIHsKICAgICAgdXBkYXRlU2Vzc2lvbih0aGlzLl9zZXNzaW9uLCB7IHVzZXIgfSk7CiAgICB9CgogICAgdGhpcy5fbm90aWZ5U2NvcGVMaXN0ZW5lcnMoKTsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KICAgZ2V0VXNlcigpIHsKICAgIHJldHVybiB0aGlzLl91c2VyOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KICAgZ2V0UmVxdWVzdFNlc3Npb24oKSB7CiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdFNlc3Npb247CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwogICBzZXRSZXF1ZXN0U2Vzc2lvbihyZXF1ZXN0U2Vzc2lvbikgewogICAgdGhpcy5fcmVxdWVzdFNlc3Npb24gPSByZXF1ZXN0U2Vzc2lvbjsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KICAgc2V0VGFncyh0YWdzKSB7CiAgICB0aGlzLl90YWdzID0gewogICAgICAuLi50aGlzLl90YWdzLAogICAgICAuLi50YWdzLAogICAgfTsKICAgIHRoaXMuX25vdGlmeVNjb3BlTGlzdGVuZXJzKCk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICovCiAgIHNldFRhZyhrZXksIHZhbHVlKSB7CiAgICB0aGlzLl90YWdzID0geyAuLi50aGlzLl90YWdzLCBba2V5XTogdmFsdWUgfTsKICAgIHRoaXMuX25vdGlmeVNjb3BlTGlzdGVuZXJzKCk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICovCiAgIHNldEV4dHJhcyhleHRyYXMpIHsKICAgIHRoaXMuX2V4dHJhID0gewogICAgICAuLi50aGlzLl9leHRyYSwKICAgICAgLi4uZXh0cmFzLAogICAgfTsKICAgIHRoaXMuX25vdGlmeVNjb3BlTGlzdGVuZXJzKCk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICovCiAgIHNldEV4dHJhKGtleSwgZXh0cmEpIHsKICAgIHRoaXMuX2V4dHJhID0geyAuLi50aGlzLl9leHRyYSwgW2tleV06IGV4dHJhIH07CiAgICB0aGlzLl9ub3RpZnlTY29wZUxpc3RlbmVycygpOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwogICBzZXRGaW5nZXJwcmludChmaW5nZXJwcmludCkgewogICAgdGhpcy5fZmluZ2VycHJpbnQgPSBmaW5nZXJwcmludDsKICAgIHRoaXMuX25vdGlmeVNjb3BlTGlzdGVuZXJzKCk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICovCiAgIHNldExldmVsKAogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICBsZXZlbCwKICApIHsKICAgIHRoaXMuX2xldmVsID0gbGV2ZWw7CiAgICB0aGlzLl9ub3RpZnlTY29wZUxpc3RlbmVycygpOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICAvKioKICAgKiBTZXRzIHRoZSB0cmFuc2FjdGlvbiBuYW1lIG9uIHRoZSBzY29wZSBmb3IgZnV0dXJlIGV2ZW50cy4KICAgKi8KICAgc2V0VHJhbnNhY3Rpb25OYW1lKG5hbWUpIHsKICAgIHRoaXMuX3RyYW5zYWN0aW9uTmFtZSA9IG5hbWU7CiAgICB0aGlzLl9ub3RpZnlTY29wZUxpc3RlbmVycygpOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwogICBzZXRDb250ZXh0KGtleSwgY29udGV4dCkgewogICAgaWYgKGNvbnRleHQgPT09IG51bGwpIHsKICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1keW5hbWljLWRlbGV0ZQogICAgICBkZWxldGUgdGhpcy5fY29udGV4dHNba2V5XTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuX2NvbnRleHRzW2tleV0gPSBjb250ZXh0OwogICAgfQoKICAgIHRoaXMuX25vdGlmeVNjb3BlTGlzdGVuZXJzKCk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8qKgogICAqIFNldHMgdGhlIFNwYW4gb24gdGhlIHNjb3BlLgogICAqIEBwYXJhbSBzcGFuIFNwYW4KICAgKiBAZGVwcmVjYXRlZCBJbnN0ZWFkIG9mIHNldHRpbmcgYSBzcGFuIG9uIGEgc2NvcGUsIHVzZSBgc3RhcnRTcGFuKClgL2BzdGFydFNwYW5NYW51YWwoKWAgaW5zdGVhZC4KICAgKi8KICAgc2V0U3BhbihzcGFuKSB7CiAgICB0aGlzLl9zcGFuID0gc3BhbjsKICAgIHRoaXMuX25vdGlmeVNjb3BlTGlzdGVuZXJzKCk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8qKgogICAqIFJldHVybnMgdGhlIGBTcGFuYCBpZiB0aGVyZSBpcyBvbmUuCiAgICogQGRlcHJlY2F0ZWQgVXNlIGBnZXRBY3RpdmVTcGFuKClgIGluc3RlYWQuCiAgICovCiAgIGdldFNwYW4oKSB7CiAgICByZXR1cm4gdGhpcy5fc3BhbjsKICB9CgogIC8qKgogICAqIFJldHVybnMgdGhlIGBUcmFuc2FjdGlvbmAgYXR0YWNoZWQgdG8gdGhlIHNjb3BlIChpZiB0aGVyZSBpcyBvbmUpLgogICAqIEBkZXByZWNhdGVkIFlvdSBzaG91bGQgbm90IHJlbHkgb24gdGhlIHRyYW5zYWN0aW9uLCBidXQganVzdCB1c2UgYHN0YXJ0U3BhbigpYCBBUElzIGluc3RlYWQuCiAgICovCiAgIGdldFRyYW5zYWN0aW9uKCkgewogICAgLy8gT2Z0ZW4sIHRoaXMgc3BhbiAoaWYgaXQgZXhpc3RzIGF0IGFsbCkgd2lsbCBiZSBhIHRyYW5zYWN0aW9uLCBidXQgaXQncyBub3QgZ3VhcmFudGVlZCB0byBiZS4gUmVnYXJkbGVzcywgaXQgd2lsbAogICAgLy8gaGF2ZSBhIHBvaW50ZXIgdG8gdGhlIGN1cnJlbnRseS1hY3RpdmUgdHJhbnNhY3Rpb24uCiAgICBjb25zdCBzcGFuID0gdGhpcy5fc3BhbjsKICAgIC8vIENhbm5vdCByZXBsYWNlIHdpdGggZ2V0Um9vdFNwYW4gYmVjYXVzZSBnZXRSb290U3BhbiByZXR1cm5zIGEgc3Bhbiwgbm90IGEgdHJhbnNhY3Rpb24KICAgIC8vIEFsc28sIHRoaXMgbWV0aG9kIHdpbGwgYmUgcmVtb3ZlZCBhbnl3YXkuCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgIHJldHVybiBzcGFuICYmIHNwYW4udHJhbnNhY3Rpb247CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwogICBzZXRTZXNzaW9uKHNlc3Npb24pIHsKICAgIGlmICghc2Vzc2lvbikgewogICAgICBkZWxldGUgdGhpcy5fc2Vzc2lvbjsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuX3Nlc3Npb24gPSBzZXNzaW9uOwogICAgfQogICAgdGhpcy5fbm90aWZ5U2NvcGVMaXN0ZW5lcnMoKTsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KICAgZ2V0U2Vzc2lvbigpIHsKICAgIHJldHVybiB0aGlzLl9zZXNzaW9uOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KICAgdXBkYXRlKGNhcHR1cmVDb250ZXh0KSB7CiAgICBpZiAoIWNhcHR1cmVDb250ZXh0KSB7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIGNvbnN0IHNjb3BlVG9NZXJnZSA9IHR5cGVvZiBjYXB0dXJlQ29udGV4dCA9PT0gJ2Z1bmN0aW9uJyA/IGNhcHR1cmVDb250ZXh0KHRoaXMpIDogY2FwdHVyZUNvbnRleHQ7CgogICAgaWYgKHNjb3BlVG9NZXJnZSBpbnN0YW5jZW9mIFNjb3BlKSB7CiAgICAgIGNvbnN0IHNjb3BlRGF0YSA9IHNjb3BlVG9NZXJnZS5nZXRTY29wZURhdGEoKTsKCiAgICAgIHRoaXMuX3RhZ3MgPSB7IC4uLnRoaXMuX3RhZ3MsIC4uLnNjb3BlRGF0YS50YWdzIH07CiAgICAgIHRoaXMuX2V4dHJhID0geyAuLi50aGlzLl9leHRyYSwgLi4uc2NvcGVEYXRhLmV4dHJhIH07CiAgICAgIHRoaXMuX2NvbnRleHRzID0geyAuLi50aGlzLl9jb250ZXh0cywgLi4uc2NvcGVEYXRhLmNvbnRleHRzIH07CiAgICAgIGlmIChzY29wZURhdGEudXNlciAmJiBPYmplY3Qua2V5cyhzY29wZURhdGEudXNlcikubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5fdXNlciA9IHNjb3BlRGF0YS51c2VyOwogICAgICB9CiAgICAgIGlmIChzY29wZURhdGEubGV2ZWwpIHsKICAgICAgICB0aGlzLl9sZXZlbCA9IHNjb3BlRGF0YS5sZXZlbDsKICAgICAgfQogICAgICBpZiAoc2NvcGVEYXRhLmZpbmdlcnByaW50Lmxlbmd0aCkgewogICAgICAgIHRoaXMuX2ZpbmdlcnByaW50ID0gc2NvcGVEYXRhLmZpbmdlcnByaW50OwogICAgICB9CiAgICAgIGlmIChzY29wZVRvTWVyZ2UuZ2V0UmVxdWVzdFNlc3Npb24oKSkgewogICAgICAgIHRoaXMuX3JlcXVlc3RTZXNzaW9uID0gc2NvcGVUb01lcmdlLmdldFJlcXVlc3RTZXNzaW9uKCk7CiAgICAgIH0KICAgICAgaWYgKHNjb3BlRGF0YS5wcm9wYWdhdGlvbkNvbnRleHQpIHsKICAgICAgICB0aGlzLl9wcm9wYWdhdGlvbkNvbnRleHQgPSBzY29wZURhdGEucHJvcGFnYXRpb25Db250ZXh0OwogICAgICB9CiAgICB9IGVsc2UgaWYgKGlzUGxhaW5PYmplY3Qoc2NvcGVUb01lcmdlKSkgewogICAgICBjb25zdCBzY29wZUNvbnRleHQgPSBjYXB0dXJlQ29udGV4dCA7CiAgICAgIHRoaXMuX3RhZ3MgPSB7IC4uLnRoaXMuX3RhZ3MsIC4uLnNjb3BlQ29udGV4dC50YWdzIH07CiAgICAgIHRoaXMuX2V4dHJhID0geyAuLi50aGlzLl9leHRyYSwgLi4uc2NvcGVDb250ZXh0LmV4dHJhIH07CiAgICAgIHRoaXMuX2NvbnRleHRzID0geyAuLi50aGlzLl9jb250ZXh0cywgLi4uc2NvcGVDb250ZXh0LmNvbnRleHRzIH07CiAgICAgIGlmIChzY29wZUNvbnRleHQudXNlcikgewogICAgICAgIHRoaXMuX3VzZXIgPSBzY29wZUNvbnRleHQudXNlcjsKICAgICAgfQogICAgICBpZiAoc2NvcGVDb250ZXh0LmxldmVsKSB7CiAgICAgICAgdGhpcy5fbGV2ZWwgPSBzY29wZUNvbnRleHQubGV2ZWw7CiAgICAgIH0KICAgICAgaWYgKHNjb3BlQ29udGV4dC5maW5nZXJwcmludCkgewogICAgICAgIHRoaXMuX2ZpbmdlcnByaW50ID0gc2NvcGVDb250ZXh0LmZpbmdlcnByaW50OwogICAgICB9CiAgICAgIGlmIChzY29wZUNvbnRleHQucmVxdWVzdFNlc3Npb24pIHsKICAgICAgICB0aGlzLl9yZXF1ZXN0U2Vzc2lvbiA9IHNjb3BlQ29udGV4dC5yZXF1ZXN0U2Vzc2lvbjsKICAgICAgfQogICAgICBpZiAoc2NvcGVDb250ZXh0LnByb3BhZ2F0aW9uQ29udGV4dCkgewogICAgICAgIHRoaXMuX3Byb3BhZ2F0aW9uQ29udGV4dCA9IHNjb3BlQ29udGV4dC5wcm9wYWdhdGlvbkNvbnRleHQ7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICovCiAgIGNsZWFyKCkgewogICAgdGhpcy5fYnJlYWRjcnVtYnMgPSBbXTsKICAgIHRoaXMuX3RhZ3MgPSB7fTsKICAgIHRoaXMuX2V4dHJhID0ge307CiAgICB0aGlzLl91c2VyID0ge307CiAgICB0aGlzLl9jb250ZXh0cyA9IHt9OwogICAgdGhpcy5fbGV2ZWwgPSB1bmRlZmluZWQ7CiAgICB0aGlzLl90cmFuc2FjdGlvbk5hbWUgPSB1bmRlZmluZWQ7CiAgICB0aGlzLl9maW5nZXJwcmludCA9IHVuZGVmaW5lZDsKICAgIHRoaXMuX3JlcXVlc3RTZXNzaW9uID0gdW5kZWZpbmVkOwogICAgdGhpcy5fc3BhbiA9IHVuZGVmaW5lZDsKICAgIHRoaXMuX3Nlc3Npb24gPSB1bmRlZmluZWQ7CiAgICB0aGlzLl9ub3RpZnlTY29wZUxpc3RlbmVycygpOwogICAgdGhpcy5fYXR0YWNobWVudHMgPSBbXTsKICAgIHRoaXMuX3Byb3BhZ2F0aW9uQ29udGV4dCA9IGdlbmVyYXRlUHJvcGFnYXRpb25Db250ZXh0KCk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICovCiAgIGFkZEJyZWFkY3J1bWIoYnJlYWRjcnVtYiwgbWF4QnJlYWRjcnVtYnMpIHsKICAgIGNvbnN0IG1heENydW1icyA9IHR5cGVvZiBtYXhCcmVhZGNydW1icyA9PT0gJ251bWJlcicgPyBtYXhCcmVhZGNydW1icyA6IERFRkFVTFRfTUFYX0JSRUFEQ1JVTUJTOwoKICAgIC8vIE5vIGRhdGEgaGFzIGJlZW4gY2hhbmdlZCwgc28gZG9uJ3Qgbm90aWZ5IHNjb3BlIGxpc3RlbmVycwogICAgaWYgKG1heENydW1icyA8PSAwKSB7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIGNvbnN0IG1lcmdlZEJyZWFkY3J1bWIgPSB7CiAgICAgIHRpbWVzdGFtcDogZGF0ZVRpbWVzdGFtcEluU2Vjb25kcygpLAogICAgICAuLi5icmVhZGNydW1iLAogICAgfTsKCiAgICBjb25zdCBicmVhZGNydW1icyA9IHRoaXMuX2JyZWFkY3J1bWJzOwogICAgYnJlYWRjcnVtYnMucHVzaChtZXJnZWRCcmVhZGNydW1iKTsKICAgIHRoaXMuX2JyZWFkY3J1bWJzID0gYnJlYWRjcnVtYnMubGVuZ3RoID4gbWF4Q3J1bWJzID8gYnJlYWRjcnVtYnMuc2xpY2UoLW1heENydW1icykgOiBicmVhZGNydW1iczsKCiAgICB0aGlzLl9ub3RpZnlTY29wZUxpc3RlbmVycygpOwoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KICAgZ2V0TGFzdEJyZWFkY3J1bWIoKSB7CiAgICByZXR1cm4gdGhpcy5fYnJlYWRjcnVtYnNbdGhpcy5fYnJlYWRjcnVtYnMubGVuZ3RoIC0gMV07CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwogICBjbGVhckJyZWFkY3J1bWJzKCkgewogICAgdGhpcy5fYnJlYWRjcnVtYnMgPSBbXTsKICAgIHRoaXMuX25vdGlmeVNjb3BlTGlzdGVuZXJzKCk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICovCiAgIGFkZEF0dGFjaG1lbnQoYXR0YWNobWVudCkgewogICAgdGhpcy5fYXR0YWNobWVudHMucHVzaChhdHRhY2htZW50KTsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKiBAZGVwcmVjYXRlZCBVc2UgYGdldFNjb3BlRGF0YSgpYCBpbnN0ZWFkLgogICAqLwogICBnZXRBdHRhY2htZW50cygpIHsKICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldFNjb3BlRGF0YSgpOwoKICAgIHJldHVybiBkYXRhLmF0dGFjaG1lbnRzOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KICAgY2xlYXJBdHRhY2htZW50cygpIHsKICAgIHRoaXMuX2F0dGFjaG1lbnRzID0gW107CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8qKiBAaW5oZXJpdERvYyAqLwogICBnZXRTY29wZURhdGEoKSB7CiAgICBjb25zdCB7CiAgICAgIF9icmVhZGNydW1icywKICAgICAgX2F0dGFjaG1lbnRzLAogICAgICBfY29udGV4dHMsCiAgICAgIF90YWdzLAogICAgICBfZXh0cmEsCiAgICAgIF91c2VyLAogICAgICBfbGV2ZWwsCiAgICAgIF9maW5nZXJwcmludCwKICAgICAgX2V2ZW50UHJvY2Vzc29ycywKICAgICAgX3Byb3BhZ2F0aW9uQ29udGV4dCwKICAgICAgX3Nka1Byb2Nlc3NpbmdNZXRhZGF0YSwKICAgICAgX3RyYW5zYWN0aW9uTmFtZSwKICAgICAgX3NwYW4sCiAgICB9ID0gdGhpczsKCiAgICByZXR1cm4gewogICAgICBicmVhZGNydW1iczogX2JyZWFkY3J1bWJzLAogICAgICBhdHRhY2htZW50czogX2F0dGFjaG1lbnRzLAogICAgICBjb250ZXh0czogX2NvbnRleHRzLAogICAgICB0YWdzOiBfdGFncywKICAgICAgZXh0cmE6IF9leHRyYSwKICAgICAgdXNlcjogX3VzZXIsCiAgICAgIGxldmVsOiBfbGV2ZWwsCiAgICAgIGZpbmdlcnByaW50OiBfZmluZ2VycHJpbnQgfHwgW10sCiAgICAgIGV2ZW50UHJvY2Vzc29yczogX2V2ZW50UHJvY2Vzc29ycywKICAgICAgcHJvcGFnYXRpb25Db250ZXh0OiBfcHJvcGFnYXRpb25Db250ZXh0LAogICAgICBzZGtQcm9jZXNzaW5nTWV0YWRhdGE6IF9zZGtQcm9jZXNzaW5nTWV0YWRhdGEsCiAgICAgIHRyYW5zYWN0aW9uTmFtZTogX3RyYW5zYWN0aW9uTmFtZSwKICAgICAgc3BhbjogX3NwYW4sCiAgICB9OwogIH0KCiAgLyoqCiAgICogQXBwbGllcyBkYXRhIGZyb20gdGhlIHNjb3BlIHRvIHRoZSBldmVudCBhbmQgcnVucyBhbGwgZXZlbnQgcHJvY2Vzc29ycyBvbiBpdC4KICAgKgogICAqIEBwYXJhbSBldmVudCBFdmVudAogICAqIEBwYXJhbSBoaW50IE9iamVjdCBjb250YWluaW5nIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9yaWdpbmFsIGV4Y2VwdGlvbiwgZm9yIHVzZSBieSB0aGUgZXZlbnQgcHJvY2Vzc29ycy4KICAgKiBAaGlkZGVuCiAgICogQGRlcHJlY2F0ZWQgVXNlIGBhcHBseVNjb3BlRGF0YVRvRXZlbnQoKWAgZGlyZWN0bHkKICAgKi8KICAgYXBwbHlUb0V2ZW50KAogICAgZXZlbnQsCiAgICBoaW50ID0ge30sCiAgICBhZGRpdGlvbmFsRXZlbnRQcm9jZXNzb3JzID0gW10sCiAgKSB7CiAgICBhcHBseVNjb3BlRGF0YVRvRXZlbnQoZXZlbnQsIHRoaXMuZ2V0U2NvcGVEYXRhKCkpOwoKICAgIC8vIFRPRE8gKHY4KTogVXBkYXRlIHRoaXMgb3JkZXIgdG8gYmU6IEdsb2JhbCA+IENsaWVudCA+IFNjb3BlCiAgICBjb25zdCBldmVudFByb2Nlc3NvcnMgPSBbCiAgICAgIC4uLmFkZGl0aW9uYWxFdmVudFByb2Nlc3NvcnMsCiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgICAuLi5nZXRHbG9iYWxFdmVudFByb2Nlc3NvcnMoKSwKICAgICAgLi4udGhpcy5fZXZlbnRQcm9jZXNzb3JzLAogICAgXTsKCiAgICByZXR1cm4gbm90aWZ5RXZlbnRQcm9jZXNzb3JzKGV2ZW50UHJvY2Vzc29ycywgZXZlbnQsIGhpbnQpOwogIH0KCiAgLyoqCiAgICogQWRkIGRhdGEgd2hpY2ggd2lsbCBiZSBhY2Nlc3NpYmxlIGR1cmluZyBldmVudCBwcm9jZXNzaW5nIGJ1dCB3b24ndCBnZXQgc2VudCB0byBTZW50cnkKICAgKi8KICAgc2V0U0RLUHJvY2Vzc2luZ01ldGFkYXRhKG5ld0RhdGEpIHsKICAgIHRoaXMuX3Nka1Byb2Nlc3NpbmdNZXRhZGF0YSA9IHsgLi4udGhpcy5fc2RrUHJvY2Vzc2luZ01ldGFkYXRhLCAuLi5uZXdEYXRhIH07CgogICAgcmV0dXJuIHRoaXM7CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwogICBzZXRQcm9wYWdhdGlvbkNvbnRleHQoY29udGV4dCkgewogICAgdGhpcy5fcHJvcGFnYXRpb25Db250ZXh0ID0gY29udGV4dDsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KICAgZ2V0UHJvcGFnYXRpb25Db250ZXh0KCkgewogICAgcmV0dXJuIHRoaXMuX3Byb3BhZ2F0aW9uQ29udGV4dDsKICB9CgogIC8qKgogICAqIENhcHR1cmUgYW4gZXhjZXB0aW9uIGZvciB0aGlzIHNjb3BlLgogICAqCiAgICogQHBhcmFtIGV4Y2VwdGlvbiBUaGUgZXhjZXB0aW9uIHRvIGNhcHR1cmUuCiAgICogQHBhcmFtIGhpbnQgT3B0aW5hbCBhZGRpdGlvbmFsIGRhdGEgdG8gYXR0YWNoIHRvIHRoZSBTZW50cnkgZXZlbnQuCiAgICogQHJldHVybnMgdGhlIGlkIG9mIHRoZSBjYXB0dXJlZCBTZW50cnkgZXZlbnQuCiAgICovCiAgIGNhcHR1cmVFeGNlcHRpb24oZXhjZXB0aW9uLCBoaW50KSB7CiAgICBjb25zdCBldmVudElkID0gaGludCAmJiBoaW50LmV2ZW50X2lkID8gaGludC5ldmVudF9pZCA6IHV1aWQ0KCk7CgogICAgaWYgKCF0aGlzLl9jbGllbnQpIHsKICAgICAgbG9nZ2VyLndhcm4oJ05vIGNsaWVudCBjb25maWd1cmVkIG9uIHNjb3BlIC0gd2lsbCBub3QgY2FwdHVyZSBleGNlcHRpb24hJyk7CiAgICAgIHJldHVybiBldmVudElkOwogICAgfQoKICAgIGNvbnN0IHN5bnRoZXRpY0V4Y2VwdGlvbiA9IG5ldyBFcnJvcignU2VudHJ5IHN5bnRoZXRpY0V4Y2VwdGlvbicpOwoKICAgIHRoaXMuX2NsaWVudC5jYXB0dXJlRXhjZXB0aW9uKAogICAgICBleGNlcHRpb24sCiAgICAgIHsKICAgICAgICBvcmlnaW5hbEV4Y2VwdGlvbjogZXhjZXB0aW9uLAogICAgICAgIHN5bnRoZXRpY0V4Y2VwdGlvbiwKICAgICAgICAuLi5oaW50LAogICAgICAgIGV2ZW50X2lkOiBldmVudElkLAogICAgICB9LAogICAgICB0aGlzLAogICAgKTsKCiAgICByZXR1cm4gZXZlbnRJZDsKICB9CgogIC8qKgogICAqIENhcHR1cmUgYSBtZXNzYWdlIGZvciB0aGlzIHNjb3BlLgogICAqCiAgICogQHBhcmFtIG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gY2FwdHVyZS4KICAgKiBAcGFyYW0gbGV2ZWwgQW4gb3B0aW9uYWwgc2V2ZXJpdHkgbGV2ZWwgdG8gcmVwb3J0IHRoZSBtZXNzYWdlIHdpdGguCiAgICogQHBhcmFtIGhpbnQgT3B0aW9uYWwgYWRkaXRpb25hbCBkYXRhIHRvIGF0dGFjaCB0byB0aGUgU2VudHJ5IGV2ZW50LgogICAqIEByZXR1cm5zIHRoZSBpZCBvZiB0aGUgY2FwdHVyZWQgbWVzc2FnZS4KICAgKi8KICAgY2FwdHVyZU1lc3NhZ2UobWVzc2FnZSwgbGV2ZWwsIGhpbnQpIHsKICAgIGNvbnN0IGV2ZW50SWQgPSBoaW50ICYmIGhpbnQuZXZlbnRfaWQgPyBoaW50LmV2ZW50X2lkIDogdXVpZDQoKTsKCiAgICBpZiAoIXRoaXMuX2NsaWVudCkgewogICAgICBsb2dnZXIud2FybignTm8gY2xpZW50IGNvbmZpZ3VyZWQgb24gc2NvcGUgLSB3aWxsIG5vdCBjYXB0dXJlIG1lc3NhZ2UhJyk7CiAgICAgIHJldHVybiBldmVudElkOwogICAgfQoKICAgIGNvbnN0IHN5bnRoZXRpY0V4Y2VwdGlvbiA9IG5ldyBFcnJvcihtZXNzYWdlKTsKCiAgICB0aGlzLl9jbGllbnQuY2FwdHVyZU1lc3NhZ2UoCiAgICAgIG1lc3NhZ2UsCiAgICAgIGxldmVsLAogICAgICB7CiAgICAgICAgb3JpZ2luYWxFeGNlcHRpb246IG1lc3NhZ2UsCiAgICAgICAgc3ludGhldGljRXhjZXB0aW9uLAogICAgICAgIC4uLmhpbnQsCiAgICAgICAgZXZlbnRfaWQ6IGV2ZW50SWQsCiAgICAgIH0sCiAgICAgIHRoaXMsCiAgICApOwoKICAgIHJldHVybiBldmVudElkOwogIH0KCiAgLyoqCiAgICogQ2FwdHVyZXMgYSBtYW51YWxseSBjcmVhdGVkIGV2ZW50IGZvciB0aGlzIHNjb3BlIGFuZCBzZW5kcyBpdCB0byBTZW50cnkuCiAgICoKICAgKiBAcGFyYW0gZXhjZXB0aW9uIFRoZSBldmVudCB0byBjYXB0dXJlLgogICAqIEBwYXJhbSBoaW50IE9wdGlvbmFsIGFkZGl0aW9uYWwgZGF0YSB0byBhdHRhY2ggdG8gdGhlIFNlbnRyeSBldmVudC4KICAgKiBAcmV0dXJucyB0aGUgaWQgb2YgdGhlIGNhcHR1cmVkIGV2ZW50LgogICAqLwogICBjYXB0dXJlRXZlbnQoZXZlbnQsIGhpbnQpIHsKICAgIGNvbnN0IGV2ZW50SWQgPSBoaW50ICYmIGhpbnQuZXZlbnRfaWQgPyBoaW50LmV2ZW50X2lkIDogdXVpZDQoKTsKCiAgICBpZiAoIXRoaXMuX2NsaWVudCkgewogICAgICBsb2dnZXIud2FybignTm8gY2xpZW50IGNvbmZpZ3VyZWQgb24gc2NvcGUgLSB3aWxsIG5vdCBjYXB0dXJlIGV2ZW50IScpOwogICAgICByZXR1cm4gZXZlbnRJZDsKICAgIH0KCiAgICB0aGlzLl9jbGllbnQuY2FwdHVyZUV2ZW50KGV2ZW50LCB7IC4uLmhpbnQsIGV2ZW50X2lkOiBldmVudElkIH0sIHRoaXMpOwoKICAgIHJldHVybiBldmVudElkOwogIH0KCiAgLyoqCiAgICogVGhpcyB3aWxsIGJlIGNhbGxlZCBvbiBldmVyeSBzZXQgY2FsbC4KICAgKi8KICAgX25vdGlmeVNjb3BlTGlzdGVuZXJzKCkgewogICAgLy8gV2UgbmVlZCB0aGlzIGNoZWNrIGZvciB0aGlzLl9ub3RpZnlpbmdMaXN0ZW5lcnMgdG8gYmUgYWJsZSB0byB3b3JrIG9uIHNjb3BlIGR1cmluZyB1cGRhdGVzCiAgICAvLyBJZiB0aGlzIGNoZWNrIGlzIG5vdCBoZXJlIHdlJ2xsIHByb2R1Y2UgZW5kbGVzcyByZWN1cnNpb24gd2hlbiBzb21ldGhpbmcgaXMgZG9uZSB3aXRoIHRoZSBzY29wZQogICAgLy8gZHVyaW5nIHRoZSBjYWxsYmFjay4KICAgIGlmICghdGhpcy5fbm90aWZ5aW5nTGlzdGVuZXJzKSB7CiAgICAgIHRoaXMuX25vdGlmeWluZ0xpc3RlbmVycyA9IHRydWU7CiAgICAgIHRoaXMuX3Njb3BlTGlzdGVuZXJzLmZvckVhY2goY2FsbGJhY2sgPT4gewogICAgICAgIGNhbGxiYWNrKHRoaXMpOwogICAgICB9KTsKICAgICAgdGhpcy5fbm90aWZ5aW5nTGlzdGVuZXJzID0gZmFsc2U7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBnZW5lcmF0ZVByb3BhZ2F0aW9uQ29udGV4dCgpIHsKICByZXR1cm4gewogICAgdHJhY2VJZDogdXVpZDQoKSwKICAgIHNwYW5JZDogdXVpZDQoKS5zdWJzdHJpbmcoMTYpLAogIH07Cn0KCmNvbnN0IFNES19WRVJTSU9OID0gJzcuMTEwLjAnOwoKLyoqCiAqIEFQSSBjb21wYXRpYmlsaXR5IHZlcnNpb24gb2YgdGhpcyBodWIuCiAqCiAqIFdBUk5JTkc6IFRoaXMgbnVtYmVyIHNob3VsZCBvbmx5IGJlIGluY3JlYXNlZCB3aGVuIHRoZSBnbG9iYWwgaW50ZXJmYWNlCiAqIGNoYW5nZXMgYW5kIG5ldyBtZXRob2RzIGFyZSBpbnRyb2R1Y2VkLgogKgogKiBAaGlkZGVuCiAqLwpjb25zdCBBUElfVkVSU0lPTiA9IHBhcnNlRmxvYXQoU0RLX1ZFUlNJT04pOwoKLyoqCiAqIERlZmF1bHQgbWF4aW11bSBudW1iZXIgb2YgYnJlYWRjcnVtYnMgYWRkZWQgdG8gYW4gZXZlbnQuIENhbiBiZSBvdmVyd3JpdHRlbgogKiB3aXRoIHtAbGluayBPcHRpb25zLm1heEJyZWFkY3J1bWJzfS4KICovCmNvbnN0IERFRkFVTFRfQlJFQURDUlVNQlMgPSAxMDA7CgovKioKICogQGRlcHJlY2F0ZWQgVGhlIGBIdWJgIGNsYXNzIHdpbGwgYmUgcmVtb3ZlZCBpbiB2ZXJzaW9uIDggb2YgdGhlIFNESyBpbiBmYXZvdXIgb2YgYFNjb3BlYCBhbmQgYENsaWVudGAgb2JqZWN0cy4KICoKICogSWYgeW91IHByZXZpb3VzbHkgdXNlZCB0aGUgYEh1YmAgY2xhc3MgZGlyZWN0bHksIHJlcGxhY2UgaXQgd2l0aCBgU2NvcGVgIGFuZCBgQ2xpZW50YCBvYmplY3RzLiBNb3JlIGluZm9ybWF0aW9uOgogKiAtIFtNdWx0aXBsZSBTZW50cnkgSW5zdGFuY2VzXShodHRwczovL2RvY3Muc2VudHJ5LmlvL3BsYXRmb3Jtcy9qYXZhc2NyaXB0L2Jlc3QtcHJhY3RpY2VzL211bHRpcGxlLXNlbnRyeS1pbnN0YW5jZXMvKQogKiAtIFtCcm93c2VyIEV4dGVuc2lvbnNdKGh0dHBzOi8vZG9jcy5zZW50cnkuaW8vcGxhdGZvcm1zL2phdmFzY3JpcHQvYmVzdC1wcmFjdGljZXMvYnJvd3Nlci1leHRlbnNpb25zLykKICoKICogU29tZSBvZiBvdXIgQVBJcyBhcmUgdHlwZWQgd2l0aCB0aGUgSHViIGNsYXNzIGluc3RlYWQgb2YgdGhlIGludGVyZmFjZSAoZS5nLiBgZ2V0Q3VycmVudEh1YmApLiBNb3N0IG9mIHRoZW0gYXJlIGRlcHJlY2F0ZWQKICogdGhlbXNlbHZlcyBhbmQgd2lsbCBhbHNvIGJlIHJlbW92ZWQgaW4gdmVyc2lvbiA4LiBNb3JlIGluZm9ybWF0aW9uOgogKiAtIFtNaWdyYXRpb24gR3VpZGVdKGh0dHBzOi8vZ2l0aHViLmNvbS9nZXRzZW50cnkvc2VudHJ5LWphdmFzY3JpcHQvYmxvYi9kZXZlbG9wL01JR1JBVElPTi5tZCNkZXByZWNhdGUtaHViKQogKi8KLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCmNsYXNzIEh1YiAgewogIC8qKiBJcyBhIHtAbGluayBMYXllcn1bXSBjb250YWluaW5nIHRoZSBjbGllbnQgYW5kIHNjb3BlICovCgogIC8qKiBDb250YWlucyB0aGUgbGFzdCBldmVudCBpZCBvZiBhIGNhcHR1cmVkIGV2ZW50LiAgKi8KCiAgLyoqCiAgICogQ3JlYXRlcyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgaHViLCB3aWxsIHB1c2ggb25lIHtAbGluayBMYXllcn0gaW50byB0aGUKICAgKiBpbnRlcm5hbCBzdGFjayBvbiBjcmVhdGlvbi4KICAgKgogICAqIEBwYXJhbSBjbGllbnQgYm91bmQgdG8gdGhlIGh1Yi4KICAgKiBAcGFyYW0gc2NvcGUgYm91bmQgdG8gdGhlIGh1Yi4KICAgKiBAcGFyYW0gdmVyc2lvbiBudW1iZXIsIGhpZ2hlciBudW1iZXIgbWVhbnMgaGlnaGVyIHByaW9yaXR5LgogICAqCiAgICogQGRlcHJlY2F0ZWQgSW5zdGFudGlhdGlvbiBvZiBIdWIgb2JqZWN0cyBpcyBkZXByZWNhdGVkIGFuZCB0aGUgY29uc3RydWN0b3Igd2lsbCBiZSByZW1vdmVkIGluIHZlcnNpb24gOCBvZiB0aGUgU0RLLgogICAqCiAgICogSWYgeW91IGFyZSBjdXJyZW50bHkgdXNpbmcgdGhlIEh1YiBmb3IgbXVsdGktY2xpZW50IHVzZSBsaWtlIHNvOgogICAqCiAgICogYGBgCiAgICogLy8gT0xECiAgICogY29uc3QgaHViID0gbmV3IEh1YigpOwogICAqIGh1Yi5iaW5kQ2xpZW50KGNsaWVudCk7CiAgICogbWFrZU1haW4oaHViKQogICAqIGBgYAogICAqCiAgICogaW5zdGVhZCBpbml0aWFsaXplIHRoZSBjbGllbnQgYXMgZm9sbG93czoKICAgKgogICAqIGBgYAogICAqIC8vIE5FVwogICAqIFNlbnRyeS53aXRoSXNvbGF0aW9uU2NvcGUoKCkgPT4gewogICAqICAgIFNlbnRyeS5zZXRDdXJyZW50Q2xpZW50KGNsaWVudCk7CiAgICogICAgY2xpZW50LmluaXQoKTsKICAgKiB9KTsKICAgKiBgYGAKICAgKgogICAqIElmIHlvdSBhcmUgdXNpbmcgdGhlIEh1YiB0byBjYXB0dXJlIGV2ZW50cyBsaWtlIHNvOgogICAqCiAgICogYGBgCiAgICogLy8gT0xECiAgICogY29uc3QgY2xpZW50ID0gbmV3IENsaWVudCgpOwogICAqIGNvbnN0IGh1YiA9IG5ldyBIdWIoY2xpZW50KTsKICAgKiBodWIuY2FwdHVyZUV4Y2VwdGlvbigpCiAgICogYGBgCiAgICoKICAgKiBpbnN0ZWFkIGNhcHR1cmUgaXNvbGF0ZWQgZXZlbnRzIGFzIGZvbGxvd3M6CiAgICoKICAgKiBgYGAKICAgKiAvLyBORVcKICAgKiBjb25zdCBjbGllbnQgPSBuZXcgQ2xpZW50KCk7CiAgICogY29uc3Qgc2NvcGUgPSBuZXcgU2NvcGUoKTsKICAgKiBzY29wZS5zZXRDbGllbnQoY2xpZW50KTsKICAgKiBzY29wZS5jYXB0dXJlRXhjZXB0aW9uKCk7CiAgICogYGBgCiAgICovCiAgIGNvbnN0cnVjdG9yKAogICAgY2xpZW50LAogICAgc2NvcGUsCiAgICBpc29sYXRpb25TY29wZSwKICAgICAgX3ZlcnNpb24gPSBBUElfVkVSU0lPTiwKICApIHt0aGlzLl92ZXJzaW9uID0gX3ZlcnNpb247CiAgICBsZXQgYXNzaWduZWRTY29wZTsKICAgIGlmICghc2NvcGUpIHsKICAgICAgYXNzaWduZWRTY29wZSA9IG5ldyBTY29wZSgpOwogICAgICBhc3NpZ25lZFNjb3BlLnNldENsaWVudChjbGllbnQpOwogICAgfSBlbHNlIHsKICAgICAgYXNzaWduZWRTY29wZSA9IHNjb3BlOwogICAgfQoKICAgIGxldCBhc3NpZ25lZElzb2xhdGlvblNjb3BlOwogICAgaWYgKCFpc29sYXRpb25TY29wZSkgewogICAgICBhc3NpZ25lZElzb2xhdGlvblNjb3BlID0gbmV3IFNjb3BlKCk7CiAgICAgIGFzc2lnbmVkSXNvbGF0aW9uU2NvcGUuc2V0Q2xpZW50KGNsaWVudCk7CiAgICB9IGVsc2UgewogICAgICBhc3NpZ25lZElzb2xhdGlvblNjb3BlID0gaXNvbGF0aW9uU2NvcGU7CiAgICB9CgogICAgdGhpcy5fc3RhY2sgPSBbeyBzY29wZTogYXNzaWduZWRTY29wZSB9XTsKCiAgICBpZiAoY2xpZW50KSB7CiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgICB0aGlzLmJpbmRDbGllbnQoY2xpZW50KTsKICAgIH0KCiAgICB0aGlzLl9pc29sYXRpb25TY29wZSA9IGFzc2lnbmVkSXNvbGF0aW9uU2NvcGU7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgdGhpcyBodWIncyB2ZXJzaW9uIGlzIG9sZGVyIHRoYW4gdGhlIGdpdmVuIHZlcnNpb24uCiAgICoKICAgKiBAcGFyYW0gdmVyc2lvbiBBIHZlcnNpb24gbnVtYmVyIHRvIGNvbXBhcmUgdG8uCiAgICogQHJldHVybiBUcnVlIGlmIHRoZSBnaXZlbiB2ZXJzaW9uIGlzIG5ld2VyOyBvdGhlcndpc2UgZmFsc2UuCiAgICoKICAgKiBAZGVwcmVjYXRlZCBUaGlzIHdpbGwgYmUgcmVtb3ZlZCBpbiB2OC4KICAgKi8KICAgaXNPbGRlclRoYW4odmVyc2lvbikgewogICAgcmV0dXJuIHRoaXMuX3ZlcnNpb24gPCB2ZXJzaW9uOwogIH0KCiAgLyoqCiAgICogVGhpcyBiaW5kcyB0aGUgZ2l2ZW4gY2xpZW50IHRvIHRoZSBjdXJyZW50IHNjb3BlLgogICAqIEBwYXJhbSBjbGllbnQgQW4gU0RLIGNsaWVudCAoY2xpZW50KSBpbnN0YW5jZS4KICAgKgogICAqIEBkZXByZWNhdGVkIFVzZSBgaW5pdEFuZEJpbmQoKWAgZGlyZWN0bHksIG9yIGBzZXRDdXJyZW50Q2xpZW50KClgIGFuZC9vciBgY2xpZW50LmluaXQoKWAgaW5zdGVhZC4KICAgKi8KICAgYmluZENsaWVudChjbGllbnQpIHsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgY29uc3QgdG9wID0gdGhpcy5nZXRTdGFja1RvcCgpOwogICAgdG9wLmNsaWVudCA9IGNsaWVudDsKICAgIHRvcC5zY29wZS5zZXRDbGllbnQoY2xpZW50KTsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgaWYgKGNsaWVudCAmJiBjbGllbnQuc2V0dXBJbnRlZ3JhdGlvbnMpIHsKICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICAgIGNsaWVudC5zZXR1cEludGVncmF0aW9ucygpOwogICAgfQogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKgogICAqIEBkZXByZWNhdGVkIFVzZSBgd2l0aFNjb3BlYCBpbnN0ZWFkLgogICAqLwogICBwdXNoU2NvcGUoKSB7CiAgICAvLyBXZSB3YW50IHRvIGNsb25lIHRoZSBjb250ZW50IG9mIHByZXYgc2NvcGUKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgY29uc3Qgc2NvcGUgPSB0aGlzLmdldFNjb3BlKCkuY2xvbmUoKTsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgdGhpcy5nZXRTdGFjaygpLnB1c2goewogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgICAgY2xpZW50OiB0aGlzLmdldENsaWVudCgpLAogICAgICBzY29wZSwKICAgIH0pOwogICAgcmV0dXJuIHNjb3BlOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKgogICAqIEBkZXByZWNhdGVkIFVzZSBgd2l0aFNjb3BlYCBpbnN0ZWFkLgogICAqLwogICBwb3BTY29wZSgpIHsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgaWYgKHRoaXMuZ2V0U3RhY2soKS5sZW5ndGggPD0gMSkgcmV0dXJuIGZhbHNlOwogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICByZXR1cm4gISF0aGlzLmdldFN0YWNrKCkucG9wKCk7CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqCiAgICogQGRlcHJlY2F0ZWQgVXNlIGBTZW50cnkud2l0aFNjb3BlKClgIGluc3RlYWQuCiAgICovCiAgIHdpdGhTY29wZShjYWxsYmFjaykgewogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICBjb25zdCBzY29wZSA9IHRoaXMucHVzaFNjb3BlKCk7CgogICAgbGV0IG1heWJlUHJvbWlzZVJlc3VsdDsKICAgIHRyeSB7CiAgICAgIG1heWJlUHJvbWlzZVJlc3VsdCA9IGNhbGxiYWNrKHNjb3BlKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICAgIHRoaXMucG9wU2NvcGUoKTsKICAgICAgdGhyb3cgZTsKICAgIH0KCiAgICBpZiAoaXNUaGVuYWJsZShtYXliZVByb21pc2VSZXN1bHQpKSB7CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgLSBpc1RoZW5hYmxlIHJldHVybnMgdGhlIHdyb25nIHR5cGUKICAgICAgcmV0dXJuIG1heWJlUHJvbWlzZVJlc3VsdC50aGVuKAogICAgICAgIHJlcyA9PiB7CiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgICAgICAgIHRoaXMucG9wU2NvcGUoKTsKICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfSwKICAgICAgICBlID0+IHsKICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgICAgICAgdGhpcy5wb3BTY29wZSgpOwogICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9LAogICAgICApOwogICAgfQoKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgdGhpcy5wb3BTY29wZSgpOwogICAgcmV0dXJuIG1heWJlUHJvbWlzZVJlc3VsdDsKICB9CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICoKICAgKiBAZGVwcmVjYXRlZCBVc2UgYFNlbnRyeS5nZXRDbGllbnQoKWAgaW5zdGVhZC4KICAgKi8KICAgZ2V0Q2xpZW50KCkgewogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICByZXR1cm4gdGhpcy5nZXRTdGFja1RvcCgpLmNsaWVudCA7CiAgfQoKICAvKioKICAgKiBSZXR1cm5zIHRoZSBzY29wZSBvZiB0aGUgdG9wIHN0YWNrLgogICAqCiAgICogQGRlcHJlY2F0ZWQgVXNlIGBTZW50cnkuZ2V0Q3VycmVudFNjb3BlKClgIGluc3RlYWQuCiAgICovCiAgIGdldFNjb3BlKCkgewogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICByZXR1cm4gdGhpcy5nZXRTdGFja1RvcCgpLnNjb3BlOwogIH0KCiAgLyoqCiAgICogQGRlcHJlY2F0ZWQgVXNlIGBTZW50cnkuZ2V0SXNvbGF0aW9uU2NvcGUoKWAgaW5zdGVhZC4KICAgKi8KICAgZ2V0SXNvbGF0aW9uU2NvcGUoKSB7CiAgICByZXR1cm4gdGhpcy5faXNvbGF0aW9uU2NvcGU7CiAgfQoKICAvKioKICAgKiBSZXR1cm5zIHRoZSBzY29wZSBzdGFjayBmb3IgZG9tYWlucyBvciB0aGUgcHJvY2Vzcy4KICAgKiBAZGVwcmVjYXRlZCBUaGlzIHdpbGwgYmUgcmVtb3ZlZCBpbiB2OC4KICAgKi8KICAgZ2V0U3RhY2soKSB7CiAgICByZXR1cm4gdGhpcy5fc3RhY2s7CiAgfQoKICAvKioKICAgKiBSZXR1cm5zIHRoZSB0b3Btb3N0IHNjb3BlIGxheWVyIGluIHRoZSBvcmRlciBkb21haW4gPiBsb2NhbCA+IHByb2Nlc3MuCiAgICogQGRlcHJlY2F0ZWQgVGhpcyB3aWxsIGJlIHJlbW92ZWQgaW4gdjguCiAgICovCiAgIGdldFN0YWNrVG9wKCkgewogICAgcmV0dXJuIHRoaXMuX3N0YWNrW3RoaXMuX3N0YWNrLmxlbmd0aCAtIDFdOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKgogICAqIEBkZXByZWNhdGVkIFVzZSBgU2VudHJ5LmNhcHR1cmVFeGNlcHRpb24oKWAgaW5zdGVhZC4KICAgKi8KICAgY2FwdHVyZUV4Y2VwdGlvbihleGNlcHRpb24sIGhpbnQpIHsKICAgIGNvbnN0IGV2ZW50SWQgPSAodGhpcy5fbGFzdEV2ZW50SWQgPSBoaW50ICYmIGhpbnQuZXZlbnRfaWQgPyBoaW50LmV2ZW50X2lkIDogdXVpZDQoKSk7CiAgICBjb25zdCBzeW50aGV0aWNFeGNlcHRpb24gPSBuZXcgRXJyb3IoJ1NlbnRyeSBzeW50aGV0aWNFeGNlcHRpb24nKTsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgdGhpcy5nZXRTY29wZSgpLmNhcHR1cmVFeGNlcHRpb24oZXhjZXB0aW9uLCB7CiAgICAgIG9yaWdpbmFsRXhjZXB0aW9uOiBleGNlcHRpb24sCiAgICAgIHN5bnRoZXRpY0V4Y2VwdGlvbiwKICAgICAgLi4uaGludCwKICAgICAgZXZlbnRfaWQ6IGV2ZW50SWQsCiAgICB9KTsKCiAgICByZXR1cm4gZXZlbnRJZDsKICB9CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICoKICAgKiBAZGVwcmVjYXRlZCBVc2UgIGBTZW50cnkuY2FwdHVyZU1lc3NhZ2UoKWAgaW5zdGVhZC4KICAgKi8KICAgY2FwdHVyZU1lc3NhZ2UoCiAgICBtZXNzYWdlLAogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICBsZXZlbCwKICAgIGhpbnQsCiAgKSB7CiAgICBjb25zdCBldmVudElkID0gKHRoaXMuX2xhc3RFdmVudElkID0gaGludCAmJiBoaW50LmV2ZW50X2lkID8gaGludC5ldmVudF9pZCA6IHV1aWQ0KCkpOwogICAgY29uc3Qgc3ludGhldGljRXhjZXB0aW9uID0gbmV3IEVycm9yKG1lc3NhZ2UpOwogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICB0aGlzLmdldFNjb3BlKCkuY2FwdHVyZU1lc3NhZ2UobWVzc2FnZSwgbGV2ZWwsIHsKICAgICAgb3JpZ2luYWxFeGNlcHRpb246IG1lc3NhZ2UsCiAgICAgIHN5bnRoZXRpY0V4Y2VwdGlvbiwKICAgICAgLi4uaGludCwKICAgICAgZXZlbnRfaWQ6IGV2ZW50SWQsCiAgICB9KTsKCiAgICByZXR1cm4gZXZlbnRJZDsKICB9CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICoKICAgKiBAZGVwcmVjYXRlZCBVc2UgYFNlbnRyeS5jYXB0dXJlRXZlbnQoKWAgaW5zdGVhZC4KICAgKi8KICAgY2FwdHVyZUV2ZW50KGV2ZW50LCBoaW50KSB7CiAgICBjb25zdCBldmVudElkID0gaGludCAmJiBoaW50LmV2ZW50X2lkID8gaGludC5ldmVudF9pZCA6IHV1aWQ0KCk7CiAgICBpZiAoIWV2ZW50LnR5cGUpIHsKICAgICAgdGhpcy5fbGFzdEV2ZW50SWQgPSBldmVudElkOwogICAgfQogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICB0aGlzLmdldFNjb3BlKCkuY2FwdHVyZUV2ZW50KGV2ZW50LCB7IC4uLmhpbnQsIGV2ZW50X2lkOiBldmVudElkIH0pOwogICAgcmV0dXJuIGV2ZW50SWQ7CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqCiAgICogQGRlcHJlY2F0ZWQgVGhpcyB3aWxsIGJlIHJlbW92ZWQgaW4gdjguCiAgICovCiAgIGxhc3RFdmVudElkKCkgewogICAgcmV0dXJuIHRoaXMuX2xhc3RFdmVudElkOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKgogICAqIEBkZXByZWNhdGVkIFVzZSBgU2VudHJ5LmFkZEJyZWFkY3J1bWIoKWAgaW5zdGVhZC4KICAgKi8KICAgYWRkQnJlYWRjcnVtYihicmVhZGNydW1iLCBoaW50KSB7CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgIGNvbnN0IHsgc2NvcGUsIGNsaWVudCB9ID0gdGhpcy5nZXRTdGFja1RvcCgpOwoKICAgIGlmICghY2xpZW50KSByZXR1cm47CgogICAgY29uc3QgeyBiZWZvcmVCcmVhZGNydW1iID0gbnVsbCwgbWF4QnJlYWRjcnVtYnMgPSBERUZBVUxUX0JSRUFEQ1JVTUJTIH0gPQogICAgICAoY2xpZW50LmdldE9wdGlvbnMgJiYgY2xpZW50LmdldE9wdGlvbnMoKSkgfHwge307CgogICAgaWYgKG1heEJyZWFkY3J1bWJzIDw9IDApIHJldHVybjsKCiAgICBjb25zdCB0aW1lc3RhbXAgPSBkYXRlVGltZXN0YW1wSW5TZWNvbmRzKCk7CiAgICBjb25zdCBtZXJnZWRCcmVhZGNydW1iID0geyB0aW1lc3RhbXAsIC4uLmJyZWFkY3J1bWIgfTsKICAgIGNvbnN0IGZpbmFsQnJlYWRjcnVtYiA9IGJlZm9yZUJyZWFkY3J1bWIKICAgICAgPyAoY29uc29sZVNhbmRib3goKCkgPT4gYmVmb3JlQnJlYWRjcnVtYihtZXJnZWRCcmVhZGNydW1iLCBoaW50KSkgKQogICAgICA6IG1lcmdlZEJyZWFkY3J1bWI7CgogICAgaWYgKGZpbmFsQnJlYWRjcnVtYiA9PT0gbnVsbCkgcmV0dXJuOwoKICAgIGlmIChjbGllbnQuZW1pdCkgewogICAgICBjbGllbnQuZW1pdCgnYmVmb3JlQWRkQnJlYWRjcnVtYicsIGZpbmFsQnJlYWRjcnVtYiwgaGludCk7CiAgICB9CgogICAgLy8gVE9ETyh2OCk6IEkga25vdyB0aGlzIGNvbW1lbnQgZG9lc24ndCBtYWtlIG11Y2ggc2Vuc2UgYmVjYXVzZSB0aGUgaHViIHdpbGwgYmUgZGVwcmVjYXRlZCBidXQgSSBzdGlsbCB3YW50ZWQgdG8KICAgIC8vIHdyaXRlIGl0IGRvd24uIEluIHRoZW9yeSwgd2Ugd291bGQgaGF2ZSB0byBhZGQgdGhlIGJyZWFkY3J1bWJzIHRvIHRoZSBpc29sYXRpb24gc2NvcGUgaGVyZSwgaG93ZXZlciwgdGhhdCB3b3VsZAogICAgLy8gZHVwbGljYXRlIGFsbCBvZiB0aGUgYnJlYWRjcnVtYnMuIFRoZXJlIHdhcyB0aGUgcG9zc2liaWxpdHkgb2YgYWRkaW5nIGJyZWFkY3J1bWJzIHRvIGJvdGgsIHRoZSBpc29sYXRpb24gc2NvcGUKICAgIC8vIGFuZCB0aGUgbm9ybWFsIHNjb3BlLCBhbmQgZGVkdXBsaWNhdGluZyBpdCBkb3duIHRoZSBsaW5lIGluIHRoZSBldmVudCBwcm9jZXNzaW5nIHBpcGVsaW5lLiBIb3dldmVyLCB0aGF0IHdvdWxkCiAgICAvLyBoYXZlIGJlZW4gdmVyeSBmcmFnaWxlLCBiZWNhdXNlIHRoZSBicmVhZGNydW1iIG9iamVjdHMgd291bGQgaGF2ZSBuZWVkZWQgdG8ga2VlcCB0aGVpciBpZGVudGl0eSBhbGwgdGhyb3VnaG91dAogICAgLy8gdGhlIGV2ZW50IHByb2Nlc3NpbmcgcGlwZWxpbmUuCiAgICAvLyBJbiB0aGUgbmV3IGltcGxlbWVudGF0aW9uLCB0aGUgdG9wIGxldmVsIGBTZW50cnkuYWRkQnJlYWRjcnVtYigpYCBzaG91bGQgT05MWSB3cml0ZSB0byB0aGUgaXNvbGF0aW9uIHNjb3BlLgoKICAgIHNjb3BlLmFkZEJyZWFkY3J1bWIoZmluYWxCcmVhZGNydW1iLCBtYXhCcmVhZGNydW1icyk7CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqIEBkZXByZWNhdGVkIFVzZSBgU2VudHJ5LnNldFVzZXIoKWAgaW5zdGVhZC4KICAgKi8KICAgc2V0VXNlcih1c2VyKSB7CiAgICAvLyBUT0RPKHY4KTogVGhlIHRvcCBsZXZlbCBgU2VudHJ5LnNldFVzZXIoKWAgZnVuY3Rpb24gc2hvdWxkIHdyaXRlIE9OTFkgdG8gdGhlIGlzb2xhdGlvbiBzY29wZS4KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgdGhpcy5nZXRTY29wZSgpLnNldFVzZXIodXNlcik7CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgIHRoaXMuZ2V0SXNvbGF0aW9uU2NvcGUoKS5zZXRVc2VyKHVzZXIpOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKiBAZGVwcmVjYXRlZCBVc2UgYFNlbnRyeS5zZXRUYWdzKClgIGluc3RlYWQuCiAgICovCiAgIHNldFRhZ3ModGFncykgewogICAgLy8gVE9ETyh2OCk6IFRoZSB0b3AgbGV2ZWwgYFNlbnRyeS5zZXRUYWdzKClgIGZ1bmN0aW9uIHNob3VsZCB3cml0ZSBPTkxZIHRvIHRoZSBpc29sYXRpb24gc2NvcGUuCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgIHRoaXMuZ2V0U2NvcGUoKS5zZXRUYWdzKHRhZ3MpOwogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICB0aGlzLmdldElzb2xhdGlvblNjb3BlKCkuc2V0VGFncyh0YWdzKTsKICB9CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICogQGRlcHJlY2F0ZWQgVXNlIGBTZW50cnkuc2V0RXh0cmFzKClgIGluc3RlYWQuCiAgICovCiAgIHNldEV4dHJhcyhleHRyYXMpIHsKICAgIC8vIFRPRE8odjgpOiBUaGUgdG9wIGxldmVsIGBTZW50cnkuc2V0RXh0cmFzKClgIGZ1bmN0aW9uIHNob3VsZCB3cml0ZSBPTkxZIHRvIHRoZSBpc29sYXRpb24gc2NvcGUuCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgIHRoaXMuZ2V0U2NvcGUoKS5zZXRFeHRyYXMoZXh0cmFzKTsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgdGhpcy5nZXRJc29sYXRpb25TY29wZSgpLnNldEV4dHJhcyhleHRyYXMpOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKiBAZGVwcmVjYXRlZCBVc2UgYFNlbnRyeS5zZXRUYWcoKWAgaW5zdGVhZC4KICAgKi8KICAgc2V0VGFnKGtleSwgdmFsdWUpIHsKICAgIC8vIFRPRE8odjgpOiBUaGUgdG9wIGxldmVsIGBTZW50cnkuc2V0VGFnKClgIGZ1bmN0aW9uIHNob3VsZCB3cml0ZSBPTkxZIHRvIHRoZSBpc29sYXRpb24gc2NvcGUuCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgIHRoaXMuZ2V0U2NvcGUoKS5zZXRUYWcoa2V5LCB2YWx1ZSk7CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgIHRoaXMuZ2V0SXNvbGF0aW9uU2NvcGUoKS5zZXRUYWcoa2V5LCB2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqIEBkZXByZWNhdGVkIFVzZSBgU2VudHJ5LnNldEV4dHJhKClgIGluc3RlYWQuCiAgICovCiAgIHNldEV4dHJhKGtleSwgZXh0cmEpIHsKICAgIC8vIFRPRE8odjgpOiBUaGUgdG9wIGxldmVsIGBTZW50cnkuc2V0RXh0cmEoKWAgZnVuY3Rpb24gc2hvdWxkIHdyaXRlIE9OTFkgdG8gdGhlIGlzb2xhdGlvbiBzY29wZS4KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgdGhpcy5nZXRTY29wZSgpLnNldEV4dHJhKGtleSwgZXh0cmEpOwogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICB0aGlzLmdldElzb2xhdGlvblNjb3BlKCkuc2V0RXh0cmEoa2V5LCBleHRyYSk7CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqIEBkZXByZWNhdGVkIFVzZSBgU2VudHJ5LnNldENvbnRleHQoKWAgaW5zdGVhZC4KICAgKi8KICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQogICBzZXRDb250ZXh0KG5hbWUsIGNvbnRleHQpIHsKICAgIC8vIFRPRE8odjgpOiBUaGUgdG9wIGxldmVsIGBTZW50cnkuc2V0Q29udGV4dCgpYCBmdW5jdGlvbiBzaG91bGQgd3JpdGUgT05MWSB0byB0aGUgaXNvbGF0aW9uIHNjb3BlLgogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICB0aGlzLmdldFNjb3BlKCkuc2V0Q29udGV4dChuYW1lLCBjb250ZXh0KTsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgdGhpcy5nZXRJc29sYXRpb25TY29wZSgpLnNldENvbnRleHQobmFtZSwgY29udGV4dCk7CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqCiAgICogQGRlcHJlY2F0ZWQgVXNlIGBnZXRTY29wZSgpYCBkaXJlY3RseS4KICAgKi8KICAgY29uZmlndXJlU2NvcGUoY2FsbGJhY2spIHsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgY29uc3QgeyBzY29wZSwgY2xpZW50IH0gPSB0aGlzLmdldFN0YWNrVG9wKCk7CiAgICBpZiAoY2xpZW50KSB7CiAgICAgIGNhbGxiYWNrKHNjb3BlKTsKICAgIH0KICB9CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICovCiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgIHJ1bihjYWxsYmFjaykgewogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICBjb25zdCBvbGRIdWIgPSBtYWtlTWFpbih0aGlzKTsKICAgIHRyeSB7CiAgICAgIGNhbGxiYWNrKHRoaXMpOwogICAgfSBmaW5hbGx5IHsKICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICAgIG1ha2VNYWluKG9sZEh1Yik7CiAgICB9CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqIEBkZXByZWNhdGVkIFVzZSBgU2VudHJ5LmdldENsaWVudCgpLmdldEludGVncmF0aW9uQnlOYW1lKClgIGluc3RlYWQuCiAgICovCiAgIGdldEludGVncmF0aW9uKGludGVncmF0aW9uKSB7CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgIGNvbnN0IGNsaWVudCA9IHRoaXMuZ2V0Q2xpZW50KCk7CiAgICBpZiAoIWNsaWVudCkgcmV0dXJuIG51bGw7CiAgICB0cnkgewogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgICAgcmV0dXJuIGNsaWVudC5nZXRJbnRlZ3JhdGlvbihpbnRlZ3JhdGlvbik7CiAgICB9IGNhdGNoIChfb08pIHsKICAgICAgREVCVUdfQlVJTEQgJiYgbG9nZ2VyLndhcm4oYENhbm5vdCByZXRyaWV2ZSBpbnRlZ3JhdGlvbiAke2ludGVncmF0aW9uLmlkfSBmcm9tIHRoZSBjdXJyZW50IEh1YmApOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9CgogIC8qKgogICAqIFN0YXJ0cyBhIG5ldyBgVHJhbnNhY3Rpb25gIGFuZCByZXR1cm5zIGl0LiBUaGlzIGlzIHRoZSBlbnRyeSBwb2ludCB0byBtYW51YWwgdHJhY2luZyBpbnN0cnVtZW50YXRpb24uCiAgICoKICAgKiBBIHRyZWUgc3RydWN0dXJlIGNhbiBiZSBidWlsdCBieSBhZGRpbmcgY2hpbGQgc3BhbnMgdG8gdGhlIHRyYW5zYWN0aW9uLCBhbmQgY2hpbGQgc3BhbnMgdG8gb3RoZXIgc3BhbnMuIFRvIHN0YXJ0IGEKICAgKiBuZXcgY2hpbGQgc3BhbiB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uIG9yIGFueSBzcGFuLCBjYWxsIHRoZSByZXNwZWN0aXZlIGAuc3RhcnRDaGlsZCgpYCBtZXRob2QuCiAgICoKICAgKiBFdmVyeSBjaGlsZCBzcGFuIG11c3QgYmUgZmluaXNoZWQgYmVmb3JlIHRoZSB0cmFuc2FjdGlvbiBpcyBmaW5pc2hlZCwgb3RoZXJ3aXNlIHRoZSB1bmZpbmlzaGVkIHNwYW5zIGFyZSBkaXNjYXJkZWQuCiAgICoKICAgKiBUaGUgdHJhbnNhY3Rpb24gbXVzdCBiZSBmaW5pc2hlZCB3aXRoIGEgY2FsbCB0byBpdHMgYC5lbmQoKWAgbWV0aG9kLCBhdCB3aGljaCBwb2ludCB0aGUgdHJhbnNhY3Rpb24gd2l0aCBhbGwgaXRzCiAgICogZmluaXNoZWQgY2hpbGQgc3BhbnMgd2lsbCBiZSBzZW50IHRvIFNlbnRyeS4KICAgKgogICAqIEBwYXJhbSBjb250ZXh0IFByb3BlcnRpZXMgb2YgdGhlIG5ldyBgVHJhbnNhY3Rpb25gLgogICAqIEBwYXJhbSBjdXN0b21TYW1wbGluZ0NvbnRleHQgSW5mb3JtYXRpb24gZ2l2ZW4gdG8gdGhlIHRyYW5zYWN0aW9uIHNhbXBsaW5nIGZ1bmN0aW9uIChhbG9uZyB3aXRoIGNvbnRleHQtZGVwZW5kZW50CiAgICogZGVmYXVsdCB2YWx1ZXMpLiBTZWUge0BsaW5rIE9wdGlvbnMudHJhY2VzU2FtcGxlcn0uCiAgICoKICAgKiBAcmV0dXJucyBUaGUgdHJhbnNhY3Rpb24gd2hpY2ggd2FzIGp1c3Qgc3RhcnRlZAogICAqCiAgICogQGRlcHJlY2F0ZWQgVXNlIGBzdGFydFNwYW4oKWAsIGBzdGFydFNwYW5NYW51YWwoKWAgb3IgYHN0YXJ0SW5hY3RpdmVTcGFuKClgIGluc3RlYWQuCiAgICovCiAgIHN0YXJ0VHJhbnNhY3Rpb24oY29udGV4dCwgY3VzdG9tU2FtcGxpbmdDb250ZXh0KSB7CiAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9jYWxsRXh0ZW5zaW9uTWV0aG9kKCdzdGFydFRyYW5zYWN0aW9uJywgY29udGV4dCwgY3VzdG9tU2FtcGxpbmdDb250ZXh0KTsKCiAgICBpZiAoREVCVUdfQlVJTEQgJiYgIXJlc3VsdCkgewogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgICAgY29uc3QgY2xpZW50ID0gdGhpcy5nZXRDbGllbnQoKTsKICAgICAgaWYgKCFjbGllbnQpIHsKICAgICAgICBsb2dnZXIud2FybigKICAgICAgICAgICJUcmFjaW5nIGV4dGVuc2lvbiAnc3RhcnRUcmFuc2FjdGlvbicgaXMgbWlzc2luZy4gWW91IHNob3VsZCAnaW5pdCcgdGhlIFNESyBiZWZvcmUgY2FsbGluZyAnc3RhcnRUcmFuc2FjdGlvbiciLAogICAgICAgICk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbG9nZ2VyLndhcm4oYFRyYWNpbmcgZXh0ZW5zaW9uICdzdGFydFRyYW5zYWN0aW9uJyBoYXMgbm90IGJlZW4gYWRkZWQuIENhbGwgJ2FkZFRyYWNpbmdFeHRlbnNpb25zJyBiZWZvcmUgY2FsbGluZyAnaW5pdCc6ClNlbnRyeS5hZGRUcmFjaW5nRXh0ZW5zaW9ucygpOwpTZW50cnkuaW5pdCh7Li4ufSk7CmApOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICogQGRlcHJlY2F0ZWQgVXNlIGBzcGFuVG9UcmFjZUhlYWRlcigpYCBpbnN0ZWFkLgogICAqLwogICB0cmFjZUhlYWRlcnMoKSB7CiAgICByZXR1cm4gdGhpcy5fY2FsbEV4dGVuc2lvbk1ldGhvZCgndHJhY2VIZWFkZXJzJyk7CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqCiAgICogQGRlcHJlY2F0ZWQgVXNlIHRvcCBsZXZlbCBgY2FwdHVyZVNlc3Npb25gIGluc3RlYWQuCiAgICovCiAgIGNhcHR1cmVTZXNzaW9uKGVuZFNlc3Npb24gPSBmYWxzZSkgewogICAgLy8gYm90aCBzZW5kIHRoZSB1cGRhdGUgYW5kIHB1bGwgdGhlIHNlc3Npb24gZnJvbSB0aGUgc2NvcGUKICAgIGlmIChlbmRTZXNzaW9uKSB7CiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgICByZXR1cm4gdGhpcy5lbmRTZXNzaW9uKCk7CiAgICB9CgogICAgLy8gb25seSBzZW5kIHRoZSB1cGRhdGUKICAgIHRoaXMuX3NlbmRTZXNzaW9uVXBkYXRlKCk7CiAgfQoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqIEBkZXByZWNhdGVkIFVzZSB0b3AgbGV2ZWwgYGVuZFNlc3Npb25gIGluc3RlYWQuCiAgICovCiAgIGVuZFNlc3Npb24oKSB7CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgIGNvbnN0IGxheWVyID0gdGhpcy5nZXRTdGFja1RvcCgpOwogICAgY29uc3Qgc2NvcGUgPSBsYXllci5zY29wZTsKICAgIGNvbnN0IHNlc3Npb24gPSBzY29wZS5nZXRTZXNzaW9uKCk7CiAgICBpZiAoc2Vzc2lvbikgewogICAgICBjbG9zZVNlc3Npb24oc2Vzc2lvbik7CiAgICB9CiAgICB0aGlzLl9zZW5kU2Vzc2lvblVwZGF0ZSgpOwoKICAgIC8vIHRoZSBzZXNzaW9uIGlzIG92ZXI7IHRha2UgaXQgb2ZmIG9mIHRoZSBzY29wZQogICAgc2NvcGUuc2V0U2Vzc2lvbigpOwogIH0KCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKiBAZGVwcmVjYXRlZCBVc2UgdG9wIGxldmVsIGBzdGFydFNlc3Npb25gIGluc3RlYWQuCiAgICovCiAgIHN0YXJ0U2Vzc2lvbihjb250ZXh0KSB7CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVwcmVjYXRpb24vZGVwcmVjYXRpb24KICAgIGNvbnN0IHsgc2NvcGUsIGNsaWVudCB9ID0gdGhpcy5nZXRTdGFja1RvcCgpOwogICAgY29uc3QgeyByZWxlYXNlLCBlbnZpcm9ubWVudCA9IERFRkFVTFRfRU5WSVJPTk1FTlQgfSA9IChjbGllbnQgJiYgY2xpZW50LmdldE9wdGlvbnMoKSkgfHwge307CgogICAgLy8gV2lsbCBmZXRjaCB1c2VyQWdlbnQgaWYgY2FsbGVkIGZyb20gYnJvd3NlciBzZGsKICAgIGNvbnN0IHsgdXNlckFnZW50IH0gPSBHTE9CQUxfT0JKLm5hdmlnYXRvciB8fCB7fTsKCiAgICBjb25zdCBzZXNzaW9uID0gbWFrZVNlc3Npb24oewogICAgICByZWxlYXNlLAogICAgICBlbnZpcm9ubWVudCwKICAgICAgdXNlcjogc2NvcGUuZ2V0VXNlcigpLAogICAgICAuLi4odXNlckFnZW50ICYmIHsgdXNlckFnZW50IH0pLAogICAgICAuLi5jb250ZXh0LAogICAgfSk7CgogICAgLy8gRW5kIGV4aXN0aW5nIHNlc3Npb24gaWYgdGhlcmUncyBvbmUKICAgIGNvbnN0IGN1cnJlbnRTZXNzaW9uID0gc2NvcGUuZ2V0U2Vzc2lvbiAmJiBzY29wZS5nZXRTZXNzaW9uKCk7CiAgICBpZiAoY3VycmVudFNlc3Npb24gJiYgY3VycmVudFNlc3Npb24uc3RhdHVzID09PSAnb2snKSB7CiAgICAgIHVwZGF0ZVNlc3Npb24oY3VycmVudFNlc3Npb24sIHsgc3RhdHVzOiAnZXhpdGVkJyB9KTsKICAgIH0KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgdGhpcy5lbmRTZXNzaW9uKCk7CgogICAgLy8gQWZ0ZXJ3YXJkcyB3ZSBzZXQgdGhlIG5ldyBzZXNzaW9uIG9uIHRoZSBzY29wZQogICAgc2NvcGUuc2V0U2Vzc2lvbihzZXNzaW9uKTsKCiAgICByZXR1cm4gc2Vzc2lvbjsKICB9CgogIC8qKgogICAqIFJldHVybnMgaWYgZGVmYXVsdCBQSUkgc2hvdWxkIGJlIHNlbnQgdG8gU2VudHJ5IGFuZCBwcm9wYWdhdGVkIGluIG91cmdvaW5nIHJlcXVlc3RzCiAgICogd2hlbiBUcmFjaW5nIGlzIHVzZWQuCiAgICoKICAgKiBAZGVwcmVjYXRlZCBVc2UgdG9wLWxldmVsIGBnZXRDbGllbnQoKS5nZXRPcHRpb25zKCkuc2VuZERlZmF1bHRQaWlgIGluc3RlYWQuIFRoaXMgZnVuY3Rpb24KICAgKiBvbmx5IHVubmVjZXNzYXJpbHkgaW5jcmVhc2VkIEFQSSBzdXJmYWNlIGJ1dCBvbmx5IHdyYXBwZWQgYWNjZXNzaW5nIHRoZSBvcHRpb24uCiAgICovCiAgIHNob3VsZFNlbmREZWZhdWx0UGlpKCkgewogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICBjb25zdCBjbGllbnQgPSB0aGlzLmdldENsaWVudCgpOwogICAgY29uc3Qgb3B0aW9ucyA9IGNsaWVudCAmJiBjbGllbnQuZ2V0T3B0aW9ucygpOwogICAgcmV0dXJuIEJvb2xlYW4ob3B0aW9ucyAmJiBvcHRpb25zLnNlbmREZWZhdWx0UGlpKTsKICB9CgogIC8qKgogICAqIFNlbmRzIHRoZSBjdXJyZW50IFNlc3Npb24gb24gdGhlIHNjb3BlCiAgICovCiAgIF9zZW5kU2Vzc2lvblVwZGF0ZSgpIHsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgY29uc3QgeyBzY29wZSwgY2xpZW50IH0gPSB0aGlzLmdldFN0YWNrVG9wKCk7CgogICAgY29uc3Qgc2Vzc2lvbiA9IHNjb3BlLmdldFNlc3Npb24oKTsKICAgIGlmIChzZXNzaW9uICYmIGNsaWVudCAmJiBjbGllbnQuY2FwdHVyZVNlc3Npb24pIHsKICAgICAgY2xpZW50LmNhcHR1cmVTZXNzaW9uKHNlc3Npb24pOwogICAgfQogIH0KCiAgLyoqCiAgICogQ2FsbHMgZ2xvYmFsIGV4dGVuc2lvbiBtZXRob2QgYW5kIGJpbmRpbmcgY3VycmVudCBpbnN0YW5jZSB0byB0aGUgZnVuY3Rpb24gY2FsbAogICAqLwogIC8vIEB0cy1leHBlY3QtZXJyb3IgRnVuY3Rpb24gbGFja3MgZW5kaW5nIHJldHVybiBzdGF0ZW1lbnQgYW5kIHJldHVybiB0eXBlIGRvZXMgbm90IGluY2x1ZGUgJ3VuZGVmaW5lZCcuIHRzKDIzNjYpCiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkKICAgX2NhbGxFeHRlbnNpb25NZXRob2QobWV0aG9kLCAuLi5hcmdzKSB7CiAgICBjb25zdCBjYXJyaWVyID0gZ2V0TWFpbkNhcnJpZXIoKTsKICAgIGNvbnN0IHNlbnRyeSA9IGNhcnJpZXIuX19TRU5UUllfXzsKICAgIGlmIChzZW50cnkgJiYgc2VudHJ5LmV4dGVuc2lvbnMgJiYgdHlwZW9mIHNlbnRyeS5leHRlbnNpb25zW21ldGhvZF0gPT09ICdmdW5jdGlvbicpIHsKICAgICAgcmV0dXJuIHNlbnRyeS5leHRlbnNpb25zW21ldGhvZF0uYXBwbHkodGhpcywgYXJncyk7CiAgICB9CiAgICBERUJVR19CVUlMRCAmJiBsb2dnZXIud2FybihgRXh0ZW5zaW9uIG1ldGhvZCAke21ldGhvZH0gY291bGRuJ3QgYmUgZm91bmQsIGRvaW5nIG5vdGhpbmcuYCk7CiAgfQp9CgovKioKICogUmV0dXJucyB0aGUgZ2xvYmFsIHNoaW0gcmVnaXN0cnkuCiAqCiAqIEZJWE1FOiBUaGlzIGZ1bmN0aW9uIGlzIHByb2JsZW1hdGljLCBiZWNhdXNlIGRlc3BpdGUgYWx3YXlzIHJldHVybmluZyBhIHZhbGlkIENhcnJpZXIsCiAqIGl0IGhhcyBhbiBvcHRpb25hbCBgX19TRU5UUllfX2AgcHJvcGVydHksIHdoaWNoIHRoZW4gaW4gdHVybiByZXF1aXJlcyB1cyB0byBhbHdheXMgcGVyZm9ybSBhbiB1bm5lY2Vzc2FyeSBjaGVjawogKiBhdCB0aGUgY2FsbC1zaXRlLiBXZSBhbHdheXMgYWNjZXNzIHRoZSBjYXJyaWVyIHRocm91Z2ggdGhpcyBmdW5jdGlvbiwgc28gd2UgY2FuIGd1YXJhbnRlZSB0aGF0IGBfX1NFTlRSWV9fYCBpcyB0aGVyZS4KICoqLwpmdW5jdGlvbiBnZXRNYWluQ2FycmllcigpIHsKICBHTE9CQUxfT0JKLl9fU0VOVFJZX18gPSBHTE9CQUxfT0JKLl9fU0VOVFJZX18gfHwgewogICAgZXh0ZW5zaW9uczoge30sCiAgICBodWI6IHVuZGVmaW5lZCwKICB9OwogIHJldHVybiBHTE9CQUxfT0JKOwp9CgovKioKICogUmVwbGFjZXMgdGhlIGN1cnJlbnQgbWFpbiBodWIgd2l0aCB0aGUgcGFzc2VkIG9uZSBvbiB0aGUgZ2xvYmFsIG9iamVjdAogKgogKiBAcmV0dXJucyBUaGUgb2xkIHJlcGxhY2VkIGh1YgogKgogKiBAZGVwcmVjYXRlZCBVc2UgYHNldEN1cnJlbnRDbGllbnQoKWAgaW5zdGVhZC4KICovCi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgpmdW5jdGlvbiBtYWtlTWFpbihodWIpIHsKICBjb25zdCByZWdpc3RyeSA9IGdldE1haW5DYXJyaWVyKCk7CiAgY29uc3Qgb2xkSHViID0gZ2V0SHViRnJvbUNhcnJpZXIocmVnaXN0cnkpOwogIHNldEh1Yk9uQ2FycmllcihyZWdpc3RyeSwgaHViKTsKICByZXR1cm4gb2xkSHViOwp9CgovKioKICogUmV0dXJucyB0aGUgZGVmYXVsdCBodWIgaW5zdGFuY2UuCiAqCiAqIElmIGEgaHViIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCBpbiB0aGUgZ2xvYmFsIGNhcnJpZXIgYnV0IHRoaXMgbW9kdWxlCiAqIGNvbnRhaW5zIGEgbW9yZSByZWNlbnQgdmVyc2lvbiwgaXQgcmVwbGFjZXMgdGhlIHJlZ2lzdGVyZWQgdmVyc2lvbi4KICogT3RoZXJ3aXNlLCB0aGUgY3VycmVudGx5IHJlZ2lzdGVyZWQgaHViIHdpbGwgYmUgcmV0dXJuZWQuCiAqCiAqIEBkZXByZWNhdGVkIFVzZSB0aGUgcmVzcGVjdGl2ZSByZXBsYWNlbWVudCBtZXRob2QgZGlyZWN0bHkgaW5zdGVhZC4KICovCi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgpmdW5jdGlvbiBnZXRDdXJyZW50SHViKCkgewogIC8vIEdldCBtYWluIGNhcnJpZXIgKGdsb2JhbCBmb3IgZXZlcnkgZW52aXJvbm1lbnQpCiAgY29uc3QgcmVnaXN0cnkgPSBnZXRNYWluQ2FycmllcigpOwoKICBpZiAocmVnaXN0cnkuX19TRU5UUllfXyAmJiByZWdpc3RyeS5fX1NFTlRSWV9fLmFjcykgewogICAgY29uc3QgaHViID0gcmVnaXN0cnkuX19TRU5UUllfXy5hY3MuZ2V0Q3VycmVudEh1YigpOwoKICAgIGlmIChodWIpIHsKICAgICAgcmV0dXJuIGh1YjsKICAgIH0KICB9CgogIC8vIFJldHVybiBodWIgdGhhdCBsaXZlcyBvbiBhIGdsb2JhbCBvYmplY3QKICByZXR1cm4gZ2V0R2xvYmFsSHViKHJlZ2lzdHJ5KTsKfQoKLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCmZ1bmN0aW9uIGdldEdsb2JhbEh1YihyZWdpc3RyeSA9IGdldE1haW5DYXJyaWVyKCkpIHsKICAvLyBJZiB0aGVyZSdzIG5vIGh1Yiwgb3IgaXRzIGFuIG9sZCBBUEksIGFzc2lnbiBhIG5ldyBvbmUKCiAgaWYgKAogICAgIWhhc0h1Yk9uQ2FycmllcihyZWdpc3RyeSkgfHwKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgogICAgZ2V0SHViRnJvbUNhcnJpZXIocmVnaXN0cnkpLmlzT2xkZXJUaGFuKEFQSV9WRVJTSU9OKQogICkgewogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgICBzZXRIdWJPbkNhcnJpZXIocmVnaXN0cnksIG5ldyBIdWIoKSk7CiAgfQoKICAvLyBSZXR1cm4gaHViIHRoYXQgbGl2ZXMgb24gYSBnbG9iYWwgb2JqZWN0CiAgcmV0dXJuIGdldEh1YkZyb21DYXJyaWVyKHJlZ2lzdHJ5KTsKfQoKLyoqCiAqIFRoaXMgd2lsbCB0ZWxsIHdoZXRoZXIgYSBjYXJyaWVyIGhhcyBhIGh1YiBvbiBpdCBvciBub3QKICogQHBhcmFtIGNhcnJpZXIgb2JqZWN0CiAqLwpmdW5jdGlvbiBoYXNIdWJPbkNhcnJpZXIoY2FycmllcikgewogIHJldHVybiAhIShjYXJyaWVyICYmIGNhcnJpZXIuX19TRU5UUllfXyAmJiBjYXJyaWVyLl9fU0VOVFJZX18uaHViKTsKfQoKLyoqCiAqIFRoaXMgd2lsbCBjcmVhdGUgYSBuZXcge0BsaW5rIEh1Yn0gYW5kIGFkZCB0byB0aGUgcGFzc2VkIG9iamVjdCBvbgogKiBfX1NFTlRSWV9fLmh1Yi4KICogQHBhcmFtIGNhcnJpZXIgb2JqZWN0CiAqIEBoaWRkZW4KICovCi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgpmdW5jdGlvbiBnZXRIdWJGcm9tQ2FycmllcihjYXJyaWVyKSB7CiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlcHJlY2F0aW9uL2RlcHJlY2F0aW9uCiAgcmV0dXJuIGdldEdsb2JhbFNpbmdsZXRvbignaHViJywgKCkgPT4gbmV3IEh1YigpLCBjYXJyaWVyKTsKfQoKLyoqCiAqIFRoaXMgd2lsbCBzZXQgcGFzc2VkIHtAbGluayBIdWJ9IG9uIHRoZSBwYXNzZWQgb2JqZWN0J3MgX19TRU5UUllfXy5odWIgYXR0cmlidXRlCiAqIEBwYXJhbSBjYXJyaWVyIG9iamVjdAogKiBAcGFyYW0gaHViIEh1YgogKiBAcmV0dXJucyBBIGJvb2xlYW4gaW5kaWNhdGluZyBzdWNjZXNzIG9yIGZhaWx1cmUKICovCi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZXByZWNhdGlvbi9kZXByZWNhdGlvbgpmdW5jdGlvbiBzZXRIdWJPbkNhcnJpZXIoY2FycmllciwgaHViKSB7CiAgaWYgKCFjYXJyaWVyKSByZXR1cm4gZmFsc2U7CiAgY29uc3QgX19TRU5UUllfXyA9IChjYXJyaWVyLl9fU0VOVFJZX18gPSBjYXJyaWVyLl9fU0VOVFJZX18gfHwge30pOwogIF9fU0VOVFJZX18uaHViID0gaHViOwogIHJldHVybiB0cnVlOwp9CgovKioKICogQXBwbHkgU2RrSW5mbyAobmFtZSwgdmVyc2lvbiwgcGFja2FnZXMsIGludGVncmF0aW9ucykgdG8gdGhlIGNvcnJlc3BvbmRpbmcgZXZlbnQga2V5LgogKiBNZXJnZSB3aXRoIGV4aXN0aW5nIGRhdGEgaWYgYW55LgogKiovCmZ1bmN0aW9uIGVuaGFuY2VFdmVudFdpdGhTZGtJbmZvKGV2ZW50LCBzZGtJbmZvKSB7CiAgaWYgKCFzZGtJbmZvKSB7CiAgICByZXR1cm4gZXZlbnQ7CiAgfQogIGV2ZW50LnNkayA9IGV2ZW50LnNkayB8fCB7fTsKICBldmVudC5zZGsubmFtZSA9IGV2ZW50LnNkay5uYW1lIHx8IHNka0luZm8ubmFtZTsKICBldmVudC5zZGsudmVyc2lvbiA9IGV2ZW50LnNkay52ZXJzaW9uIHx8IHNka0luZm8udmVyc2lvbjsKICBldmVudC5zZGsuaW50ZWdyYXRpb25zID0gWy4uLihldmVudC5zZGsuaW50ZWdyYXRpb25zIHx8IFtdKSwgLi4uKHNka0luZm8uaW50ZWdyYXRpb25zIHx8IFtdKV07CiAgZXZlbnQuc2RrLnBhY2thZ2VzID0gWy4uLihldmVudC5zZGsucGFja2FnZXMgfHwgW10pLCAuLi4oc2RrSW5mby5wYWNrYWdlcyB8fCBbXSldOwogIHJldHVybiBldmVudDsKfQoKLyoqIENyZWF0ZXMgYW4gZW52ZWxvcGUgZnJvbSBhIFNlc3Npb24gKi8KZnVuY3Rpb24gY3JlYXRlU2Vzc2lvbkVudmVsb3BlKAogIHNlc3Npb24sCiAgZHNuLAogIG1ldGFkYXRhLAogIHR1bm5lbCwKKSB7CiAgY29uc3Qgc2RrSW5mbyA9IGdldFNka01ldGFkYXRhRm9yRW52ZWxvcGVIZWFkZXIobWV0YWRhdGEpOwogIGNvbnN0IGVudmVsb3BlSGVhZGVycyA9IHsKICAgIHNlbnRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgIC4uLihzZGtJbmZvICYmIHsgc2RrOiBzZGtJbmZvIH0pLAogICAgLi4uKCEhdHVubmVsICYmIGRzbiAmJiB7IGRzbjogZHNuVG9TdHJpbmcoZHNuKSB9KSwKICB9OwoKICBjb25zdCBlbnZlbG9wZUl0ZW0gPQogICAgJ2FnZ3JlZ2F0ZXMnIGluIHNlc3Npb24gPyBbeyB0eXBlOiAnc2Vzc2lvbnMnIH0sIHNlc3Npb25dIDogW3sgdHlwZTogJ3Nlc3Npb24nIH0sIHNlc3Npb24udG9KU09OKCldOwoKICByZXR1cm4gY3JlYXRlRW52ZWxvcGUoZW52ZWxvcGVIZWFkZXJzLCBbZW52ZWxvcGVJdGVtXSk7Cn0KCi8qKgogKiBDcmVhdGUgYW4gRW52ZWxvcGUgZnJvbSBhbiBldmVudC4KICovCmZ1bmN0aW9uIGNyZWF0ZUV2ZW50RW52ZWxvcGUoCiAgZXZlbnQsCiAgZHNuLAogIG1ldGFkYXRhLAogIHR1bm5lbCwKKSB7CiAgY29uc3Qgc2RrSW5mbyA9IGdldFNka01ldGFkYXRhRm9yRW52ZWxvcGVIZWFkZXIobWV0YWRhdGEpOwoKICAvKgogICAgTm90ZTogRHVlIHRvIFRTLCBldmVudC50eXBlIG1heSBiZSBgcmVwbGF5X2V2ZW50YCwgdGhlb3JldGljYWxseS4KICAgIEluIHByYWN0aWNlLCB3ZSBuZXZlciBjYWxsIGBjcmVhdGVFdmVudEVudmVsb3BlYCB3aXRoIGByZXBsYXlfZXZlbnRgIHR5cGUsCiAgICBhbmQgd2UnZCBoYXZlIHRvIGFkanV0IGEgbG9vb3Qgb2YgdHlwZXMgdG8gbWFrZSB0aGlzIHdvcmsgcHJvcGVybHkuCiAgICBXZSB3YW50IHRvIGF2b2lkIGNhc3RpbmcgdGhpcyBhcm91bmQsIGFzIHRoYXQgY291bGQgbGVhZCB0byBidWdzIChlLmcuIHdoZW4gd2UgYWRkIGFub3RoZXIgdHlwZSkKICAgIFNvIHRoZSBzYWZlIGNob2ljZSBpcyB0byByZWFsbHkgZ3VhcmQgYWdhaW5zdCB0aGUgcmVwbGF5X2V2ZW50IHR5cGUgaGVyZS4KICAqLwogIGNvbnN0IGV2ZW50VHlwZSA9IGV2ZW50LnR5cGUgJiYgZXZlbnQudHlwZSAhPT0gJ3JlcGxheV9ldmVudCcgPyBldmVudC50eXBlIDogJ2V2ZW50JzsKCiAgZW5oYW5jZUV2ZW50V2l0aFNka0luZm8oZXZlbnQsIG1ldGFkYXRhICYmIG1ldGFkYXRhLnNkayk7CgogIGNvbnN0IGVudmVsb3BlSGVhZGVycyA9IGNyZWF0ZUV2ZW50RW52ZWxvcGVIZWFkZXJzKGV2ZW50LCBzZGtJbmZvLCB0dW5uZWwsIGRzbik7CgogIC8vIFByZXZlbnQgdGhpcyBkYXRhICh3aGljaCwgaWYgaXQgZXhpc3RzLCB3YXMgdXNlZCBpbiBlYXJsaWVyIHN0ZXBzIGluIHRoZSBwcm9jZXNzaW5nIHBpcGVsaW5lKSBmcm9tIGJlaW5nIHNlbnQgdG8KICAvLyBzZW50cnkuIChOb3RlOiBPdXIgdXNlIG9mIHRoaXMgcHJvcGVydHkgY29tZXMgYW5kIGdvZXMgd2l0aCB3aGF0ZXZlciB3ZSBtaWdodCBiZSBkZWJ1Z2dpbmcsIHdoYXRldmVyIGhhY2tzIHdlIG1heQogIC8vIGhhdmUgdGVtcG9yYXJpbHkgYWRkZWQsIGV0Yy4gRXZlbiBpZiB3ZSBkb24ndCBoYXBwZW4gdG8gYmUgdXNpbmcgaXQgYXQgc29tZSBwb2ludCBpbiB0aGUgZnV0dXJlLCBsZXQncyBub3QgZ2V0IHJpZAogIC8vIG9mIHRoaXMgYGRlbGV0ZWAsIGxlc3Qgd2UgbWlzcyBwdXR0aW5nIGl0IGJhY2sgaW4gdGhlIG5leHQgdGltZSB0aGUgcHJvcGVydHkgaXMgaW4gdXNlLikKICBkZWxldGUgZXZlbnQuc2RrUHJvY2Vzc2luZ01ldGFkYXRhOwoKICBjb25zdCBldmVudEl0ZW0gPSBbeyB0eXBlOiBldmVudFR5cGUgfSwgZXZlbnRdOwogIHJldHVybiBjcmVhdGVFbnZlbG9wZShlbnZlbG9wZUhlYWRlcnMsIFtldmVudEl0ZW1dKTsKfQoKY29uc3QgU0VOVFJZX0FQSV9WRVJTSU9OID0gJzcnOwoKLyoqIFJldHVybnMgdGhlIHByZWZpeCB0byBjb25zdHJ1Y3QgU2VudHJ5IGluZ2VzdGlvbiBBUEkgZW5kcG9pbnRzLiAqLwpmdW5jdGlvbiBnZXRCYXNlQXBpRW5kcG9pbnQoZHNuKSB7CiAgY29uc3QgcHJvdG9jb2wgPSBkc24ucHJvdG9jb2wgPyBgJHtkc24ucHJvdG9jb2x9OmAgOiAnJzsKICBjb25zdCBwb3J0ID0gZHNuLnBvcnQgPyBgOiR7ZHNuLnBvcnR9YCA6ICcnOwogIHJldHVybiBgJHtwcm90b2NvbH0vLyR7ZHNuLmhvc3R9JHtwb3J0fSR7ZHNuLnBhdGggPyBgLyR7ZHNuLnBhdGh9YCA6ICcnfS9hcGkvYDsKfQoKLyoqIFJldHVybnMgdGhlIGluZ2VzdCBBUEkgZW5kcG9pbnQgZm9yIHRhcmdldC4gKi8KZnVuY3Rpb24gX2dldEluZ2VzdEVuZHBvaW50KGRzbikgewogIHJldHVybiBgJHtnZXRCYXNlQXBpRW5kcG9pbnQoZHNuKX0ke2Rzbi5wcm9qZWN0SWR9L2VudmVsb3BlL2A7Cn0KCi8qKiBSZXR1cm5zIGEgVVJMLWVuY29kZWQgc3RyaW5nIHdpdGggYXV0aCBjb25maWcgc3VpdGFibGUgZm9yIGEgcXVlcnkgc3RyaW5nLiAqLwpmdW5jdGlvbiBfZW5jb2RlZEF1dGgoZHNuLCBzZGtJbmZvKSB7CiAgcmV0dXJuIHVybEVuY29kZSh7CiAgICAvLyBXZSBzZW5kIG9ubHkgdGhlIG1pbmltdW0gc2V0IG9mIHJlcXVpcmVkIGluZm9ybWF0aW9uLiBTZWUKICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9nZXRzZW50cnkvc2VudHJ5LWphdmFzY3JpcHQvaXNzdWVzLzI1NzIuCiAgICBzZW50cnlfa2V5OiBkc24ucHVibGljS2V5LAogICAgc2VudHJ5X3ZlcnNpb246IFNFTlRSWV9BUElfVkVSU0lPTiwKICAgIC4uLihzZGtJbmZvICYmIHsgc2VudHJ5X2NsaWVudDogYCR7c2RrSW5mby5uYW1lfS8ke3Nka0luZm8udmVyc2lvbn1gIH0pLAogIH0pOwp9CgovKioKICogUmV0dXJucyB0aGUgZW52ZWxvcGUgZW5kcG9pbnQgVVJMIHdpdGggYXV0aCBpbiB0aGUgcXVlcnkgc3RyaW5nLgogKgogKiBTZW5kaW5nIGF1dGggYXMgcGFydCBvZiB0aGUgcXVlcnkgc3RyaW5nIGFuZCBub3QgYXMgY3VzdG9tIEhUVFAgaGVhZGVycyBhdm9pZHMgQ09SUyBwcmVmbGlnaHQgcmVxdWVzdHMuCiAqLwpmdW5jdGlvbiBnZXRFbnZlbG9wZUVuZHBvaW50V2l0aFVybEVuY29kZWRBdXRoKAogIGRzbiwKICAvLyBUT0RPICh2OCk6IFJlbW92ZSBgdHVubmVsT3JPcHRpb25zYCBpbiBmYXZvciBvZiBgb3B0aW9uc2AsIGFuZCB1c2UgdGhlIHN1YnN0aXR1dGUgY29kZSBiZWxvdwogIC8vIG9wdGlvbnM6IENsaWVudE9wdGlvbnMgPSB7fSBhcyBDbGllbnRPcHRpb25zLAogIHR1bm5lbE9yT3B0aW9ucyA9IHt9ICwKKSB7CiAgLy8gVE9ETyAodjgpOiBVc2UgdGhpcyBjb2RlIGluc3RlYWQKICAvLyBjb25zdCB7IHR1bm5lbCwgX21ldGFkYXRhID0ge30gfSA9IG9wdGlvbnM7CiAgLy8gcmV0dXJuIHR1bm5lbCA/IHR1bm5lbCA6IGAke19nZXRJbmdlc3RFbmRwb2ludChkc24pfT8ke19lbmNvZGVkQXV0aChkc24sIF9tZXRhZGF0YS5zZGspfWA7CgogIGNvbnN0IHR1bm5lbCA9IHR5cGVvZiB0dW5uZWxPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gdHVubmVsT3JPcHRpb25zIDogdHVubmVsT3JPcHRpb25zLnR1bm5lbDsKICBjb25zdCBzZGtJbmZvID0KICAgIHR5cGVvZiB0dW5uZWxPck9wdGlvbnMgPT09ICdzdHJpbmcnIHx8ICF0dW5uZWxPck9wdGlvbnMuX21ldGFkYXRhID8gdW5kZWZpbmVkIDogdHVubmVsT3JPcHRpb25zLl9tZXRhZGF0YS5zZGs7CgogIHJldHVybiB0dW5uZWwgPyB0dW5uZWwgOiBgJHtfZ2V0SW5nZXN0RW5kcG9pbnQoZHNuKX0/JHtfZW5jb2RlZEF1dGgoZHNuLCBzZGtJbmZvKX1gOwp9Cgpjb25zdCBERUZBVUxUX1RSQU5TUE9SVF9CVUZGRVJfU0laRSA9IDMwOwoKLyoqCiAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgYSBTZW50cnkgYFRyYW5zcG9ydGAKICoKICogQHBhcmFtIG9wdGlvbnMKICogQHBhcmFtIG1ha2VSZXF1ZXN0CiAqLwpmdW5jdGlvbiBjcmVhdGVUcmFuc3BvcnQoCiAgb3B0aW9ucywKICBtYWtlUmVxdWVzdCwKICBidWZmZXIgPSBtYWtlUHJvbWlzZUJ1ZmZlcigKICAgIG9wdGlvbnMuYnVmZmVyU2l6ZSB8fCBERUZBVUxUX1RSQU5TUE9SVF9CVUZGRVJfU0laRSwKICApLAopIHsKICBsZXQgcmF0ZUxpbWl0cyA9IHt9OwogIGNvbnN0IGZsdXNoID0gKHRpbWVvdXQpID0+IGJ1ZmZlci5kcmFpbih0aW1lb3V0KTsKCiAgZnVuY3Rpb24gc2VuZChlbnZlbG9wZSkgewogICAgY29uc3QgZmlsdGVyZWRFbnZlbG9wZUl0ZW1zID0gW107CgogICAgLy8gRHJvcCByYXRlIGxpbWl0ZWQgaXRlbXMgZnJvbSBlbnZlbG9wZQogICAgZm9yRWFjaEVudmVsb3BlSXRlbShlbnZlbG9wZSwgKGl0ZW0sIHR5cGUpID0+IHsKICAgICAgY29uc3QgZGF0YUNhdGVnb3J5ID0gZW52ZWxvcGVJdGVtVHlwZVRvRGF0YUNhdGVnb3J5KHR5cGUpOwogICAgICBpZiAoaXNSYXRlTGltaXRlZChyYXRlTGltaXRzLCBkYXRhQ2F0ZWdvcnkpKSB7CiAgICAgICAgY29uc3QgZXZlbnQgPSBnZXRFdmVudEZvckVudmVsb3BlSXRlbShpdGVtLCB0eXBlKTsKICAgICAgICBvcHRpb25zLnJlY29yZERyb3BwZWRFdmVudCgncmF0ZWxpbWl0X2JhY2tvZmYnLCBkYXRhQ2F0ZWdvcnksIGV2ZW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmaWx0ZXJlZEVudmVsb3BlSXRlbXMucHVzaChpdGVtKTsKICAgICAgfQogICAgfSk7CgogICAgLy8gU2tpcCBzZW5kaW5nIGlmIGVudmVsb3BlIGlzIGVtcHR5IGFmdGVyIGZpbHRlcmluZyBvdXQgcmF0ZSBsaW1pdGVkIGV2ZW50cwogICAgaWYgKGZpbHRlcmVkRW52ZWxvcGVJdGVtcy5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHJlc29sdmVkU3luY1Byb21pc2UoKTsKICAgIH0KCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQogICAgY29uc3QgZmlsdGVyZWRFbnZlbG9wZSA9IGNyZWF0ZUVudmVsb3BlKGVudmVsb3BlWzBdLCBmaWx0ZXJlZEVudmVsb3BlSXRlbXMgKTsKCiAgICAvLyBDcmVhdGVzIGNsaWVudCByZXBvcnQgZm9yIGVhY2ggaXRlbSBpbiBhbiBlbnZlbG9wZQogICAgY29uc3QgcmVjb3JkRW52ZWxvcGVMb3NzID0gKHJlYXNvbikgPT4gewogICAgICBmb3JFYWNoRW52ZWxvcGVJdGVtKGZpbHRlcmVkRW52ZWxvcGUsIChpdGVtLCB0eXBlKSA9PiB7CiAgICAgICAgY29uc3QgZXZlbnQgPSBnZXRFdmVudEZvckVudmVsb3BlSXRlbShpdGVtLCB0eXBlKTsKICAgICAgICBvcHRpb25zLnJlY29yZERyb3BwZWRFdmVudChyZWFzb24sIGVudmVsb3BlSXRlbVR5cGVUb0RhdGFDYXRlZ29yeSh0eXBlKSwgZXZlbnQpOwogICAgICB9KTsKICAgIH07CgogICAgY29uc3QgcmVxdWVzdFRhc2sgPSAoKSA9PgogICAgICBtYWtlUmVxdWVzdCh7IGJvZHk6IHNlcmlhbGl6ZUVudmVsb3BlKGZpbHRlcmVkRW52ZWxvcGUsIG9wdGlvbnMudGV4dEVuY29kZXIpIH0pLnRoZW4oCiAgICAgICAgcmVzcG9uc2UgPT4gewogICAgICAgICAgLy8gV2UgZG9uJ3Qgd2FudCB0byB0aHJvdyBvbiBOT0sgcmVzcG9uc2VzLCBidXQgd2Ugd2FudCB0byBhdCBsZWFzdCBsb2cgdGhlbQogICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgIT09IHVuZGVmaW5lZCAmJiAocmVzcG9uc2Uuc3RhdHVzQ29kZSA8IDIwMCB8fCByZXNwb25zZS5zdGF0dXNDb2RlID49IDMwMCkpIHsKICAgICAgICAgICAgREVCVUdfQlVJTEQgJiYgbG9nZ2VyLndhcm4oYFNlbnRyeSByZXNwb25kZWQgd2l0aCBzdGF0dXMgY29kZSAke3Jlc3BvbnNlLnN0YXR1c0NvZGV9IHRvIHNlbnQgZXZlbnQuYCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmF0ZUxpbWl0cyA9IHVwZGF0ZVJhdGVMaW1pdHMocmF0ZUxpbWl0cywgcmVzcG9uc2UpOwogICAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICAgIH0sCiAgICAgICAgZXJyb3IgPT4gewogICAgICAgICAgcmVjb3JkRW52ZWxvcGVMb3NzKCduZXR3b3JrX2Vycm9yJyk7CiAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICB9LAogICAgICApOwoKICAgIHJldHVybiBidWZmZXIuYWRkKHJlcXVlc3RUYXNrKS50aGVuKAogICAgICByZXN1bHQgPT4gcmVzdWx0LAogICAgICBlcnJvciA9PiB7CiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgU2VudHJ5RXJyb3IpIHsKICAgICAgICAgIERFQlVHX0JVSUxEICYmIGxvZ2dlci5lcnJvcignU2tpcHBlZCBzZW5kaW5nIGV2ZW50IGJlY2F1c2UgYnVmZmVyIGlzIGZ1bGwuJyk7CiAgICAgICAgICByZWNvcmRFbnZlbG9wZUxvc3MoJ3F1ZXVlX292ZXJmbG93Jyk7CiAgICAgICAgICByZXR1cm4gcmVzb2x2ZWRTeW5jUHJvbWlzZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICB9CiAgICAgIH0sCiAgICApOwogIH0KCiAgLy8gV2UgdXNlIHRoaXMgdG8gaWRlbnRpZmlmeSBpZiB0aGUgdHJhbnNwb3J0IGlzIHRoZSBiYXNlIHRyYW5zcG9ydAogIC8vIFRPRE8gKHY4KTogUmVtb3ZlIHRoaXMgYWdhaW4gYXMgd2UnbGwgbm8gbG9uZ2VyIG5lZWQgaXQKICBzZW5kLl9fc2VudHJ5X19iYXNlVHJhbnNwb3J0X18gPSB0cnVlOwoKICByZXR1cm4gewogICAgc2VuZCwKICAgIGZsdXNoLAogIH07Cn0KCmZ1bmN0aW9uIGdldEV2ZW50Rm9yRW52ZWxvcGVJdGVtKGl0ZW0sIHR5cGUpIHsKICBpZiAodHlwZSAhPT0gJ2V2ZW50JyAmJiB0eXBlICE9PSAndHJhbnNhY3Rpb24nKSB7CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KCiAgcmV0dXJuIEFycmF5LmlzQXJyYXkoaXRlbSkgPyAoaXRlbSApWzFdIDogdW5kZWZpbmVkOwp9CgovKiogbm9ybWFsaXplcyBXaW5kb3dzIHBhdGhzICovCmZ1bmN0aW9uIG5vcm1hbGl6ZVdpbmRvd3NQYXRoKHBhdGgpIHsKICByZXR1cm4gcGF0aAogICAgLnJlcGxhY2UoL15bQS1aXTovLCAnJykgLy8gcmVtb3ZlIFdpbmRvd3Mtc3R5bGUgcHJlZml4CiAgICAucmVwbGFjZSgvXFwvZywgJy8nKTsgLy8gcmVwbGFjZSBhbGwgYFxgIGluc3RhbmNlcyB3aXRoIGAvYAp9CgovKiogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgZ2V0cyB0aGUgbW9kdWxlIG5hbWUgZnJvbSBhIGZpbGVuYW1lICovCmZ1bmN0aW9uIGNyZWF0ZUdldE1vZHVsZUZyb21GaWxlbmFtZSgKICBiYXNlUGF0aCA9IHByb2Nlc3MuYXJndlsxXSA/IGRpcm5hbWUocHJvY2Vzcy5hcmd2WzFdKSA6IHByb2Nlc3MuY3dkKCksCiAgaXNXaW5kb3dzID0gc2VwID09PSAnXFwnLAopIHsKICBjb25zdCBub3JtYWxpemVkQmFzZSA9IGlzV2luZG93cyA/IG5vcm1hbGl6ZVdpbmRvd3NQYXRoKGJhc2VQYXRoKSA6IGJhc2VQYXRoOwoKICByZXR1cm4gKGZpbGVuYW1lKSA9PiB7CiAgICBpZiAoIWZpbGVuYW1lKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBub3JtYWxpemVkRmlsZW5hbWUgPSBpc1dpbmRvd3MgPyBub3JtYWxpemVXaW5kb3dzUGF0aChmaWxlbmFtZSkgOiBmaWxlbmFtZTsKCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWNvbnN0CiAgICBsZXQgeyBkaXIsIGJhc2U6IGZpbGUsIGV4dCB9ID0gcG9zaXgucGFyc2Uobm9ybWFsaXplZEZpbGVuYW1lKTsKCiAgICBpZiAoZXh0ID09PSAnLmpzJyB8fCBleHQgPT09ICcubWpzJyB8fCBleHQgPT09ICcuY2pzJykgewogICAgICBmaWxlID0gZmlsZS5zbGljZSgwLCBleHQubGVuZ3RoICogLTEpOwogICAgfQoKICAgIGlmICghZGlyKSB7CiAgICAgIC8vIE5vIGRpcm5hbWUgd2hhdHNvZXZlcgogICAgICBkaXIgPSAnLic7CiAgICB9CgogICAgY29uc3QgbiA9IGRpci5sYXN0SW5kZXhPZignL25vZGVfbW9kdWxlcycpOwogICAgaWYgKG4gPiAtMSkgewogICAgICByZXR1cm4gYCR7ZGlyLnNsaWNlKG4gKyAxNCkucmVwbGFjZSgvXC8vZywgJy4nKX06JHtmaWxlfWA7CiAgICB9CgogICAgLy8gTGV0J3Mgc2VlIGlmIGl0J3MgYSBwYXJ0IG9mIHRoZSBtYWluIG1vZHVsZQogICAgLy8gVG8gYmUgYSBwYXJ0IG9mIG1haW4gbW9kdWxlLCBpdCBoYXMgdG8gc2hhcmUgdGhlIHNhbWUgYmFzZQogICAgaWYgKGRpci5zdGFydHNXaXRoKG5vcm1hbGl6ZWRCYXNlKSkgewogICAgICBsZXQgbW9kdWxlTmFtZSA9IGRpci5zbGljZShub3JtYWxpemVkQmFzZS5sZW5ndGggKyAxKS5yZXBsYWNlKC9cLy9nLCAnLicpOwoKICAgICAgaWYgKG1vZHVsZU5hbWUpIHsKICAgICAgICBtb2R1bGVOYW1lICs9ICc6JzsKICAgICAgfQogICAgICBtb2R1bGVOYW1lICs9IGZpbGU7CgogICAgICByZXR1cm4gbW9kdWxlTmFtZTsKICAgIH0KCiAgICByZXR1cm4gZmlsZTsKICB9Owp9CgpmdW5jdGlvbiBfbnVsbGlzaENvYWxlc2NlJDIobGhzLCByaHNGbikgeyBpZiAobGhzICE9IG51bGwpIHsgcmV0dXJuIGxoczsgfSBlbHNlIHsgcmV0dXJuIHJoc0ZuKCk7IH0gfS8qKgogKiBUaGlzIGNvZGUgd2FzIG9yaWdpbmFsbHkgZm9ya2VkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL1Rvb1RhbGxOYXRlL3Byb3h5LWFnZW50cy90cmVlL2IxMzMyOTVmZDE2ZjY0NzU1NzhiNmIxNWJkOWI0ZTMzZWNiMGQwYjcKICogV2l0aCB0aGUgZm9sbG93aW5nIGxpY2VuY2U6CiAqCiAqIChUaGUgTUlUIExpY2Vuc2UpCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMyBOYXRoYW4gUmFqbGljaCA8bmF0aGFuQHRvb3RhbGxuYXRlLm5ldD4qCiAqCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZwogKiBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUKICogJ1NvZnR3YXJlJyksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZwogKiB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsCiAqIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0bwogKiBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8KICogdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOioKICoKICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKICogaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuKgogKgogKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgJ0FTIElTJywgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwKICogRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GCiAqIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4KICogSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkKICogQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwKICogVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUKICogU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCiAqLwoKY29uc3QgSU5URVJOQUwgPSBTeW1ib2woJ0FnZW50QmFzZUludGVybmFsU3RhdGUnKTsKCmNsYXNzIEFnZW50IGV4dGVuZHMgaHR0cC5BZ2VudCB7CgogIC8vIFNldCBieSBgaHR0cC5BZ2VudGAgLSBtaXNzaW5nIGZyb20gYEB0eXBlcy9ub2RlYAoKICBjb25zdHJ1Y3RvcihvcHRzKSB7CiAgICBzdXBlcihvcHRzKTsKICAgIHRoaXNbSU5URVJOQUxdID0ge307CiAgfQoKICAvKioKICAgKiBEZXRlcm1pbmUgd2hldGhlciB0aGlzIGlzIGFuIGBodHRwYCBvciBgaHR0cHNgIHJlcXVlc3QuCiAgICovCiAgaXNTZWN1cmVFbmRwb2ludChvcHRpb25zKSB7CiAgICBpZiAob3B0aW9ucykgewogICAgICAvLyBGaXJzdCBjaGVjayB0aGUgYHNlY3VyZUVuZHBvaW50YCBwcm9wZXJ0eSBleHBsaWNpdGx5LCBzaW5jZSB0aGlzCiAgICAgIC8vIG1lYW5zIHRoYXQgYSBwYXJlbnQgYEFnZW50YCBpcyAicGFzc2luZyB0aHJvdWdoIiB0byB0aGlzIGluc3RhbmNlLgogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueSwgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1tZW1iZXItYWNjZXNzCiAgICAgIGlmICh0eXBlb2YgKG9wdGlvbnMgKS5zZWN1cmVFbmRwb2ludCA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgcmV0dXJuIG9wdGlvbnMuc2VjdXJlRW5kcG9pbnQ7CiAgICAgIH0KCiAgICAgIC8vIElmIG5vIGV4cGxpY2l0IGBzZWN1cmVgIGVuZHBvaW50LCBjaGVjayBpZiBgcHJvdG9jb2xgIHByb3BlcnR5IGlzCiAgICAgIC8vIHNldC4gVGhpcyB3aWxsIHVzdWFsbHkgYmUgdGhlIGNhc2Ugc2luY2UgdXNpbmcgYSBmdWxsIHN0cmluZyBVUkwKICAgICAgLy8gb3IgYFVSTGAgaW5zdGFuY2Ugc2hvdWxkIGJlIHRoZSBtb3N0IGNvbW1vbiB1c2FnZS4KICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnByb3RvY29sID09PSAnc3RyaW5nJykgewogICAgICAgIHJldHVybiBvcHRpb25zLnByb3RvY29sID09PSAnaHR0cHM6JzsKICAgICAgfQogICAgfQoKICAgIC8vIEZpbmFsbHksIGlmIG5vIGBwcm90b2NvbGAgcHJvcGVydHkgd2FzIHNldCwgdGhlbiBmYWxsIGJhY2sgdG8KICAgIC8vIGNoZWNraW5nIHRoZSBzdGFjayB0cmFjZSBvZiB0aGUgY3VycmVudCBjYWxsIHN0YWNrLCBhbmQgdHJ5IHRvCiAgICAvLyBkZXRlY3QgdGhlICJodHRwcyIgbW9kdWxlLgogICAgY29uc3QgeyBzdGFjayB9ID0gbmV3IEVycm9yKCk7CiAgICBpZiAodHlwZW9mIHN0YWNrICE9PSAnc3RyaW5nJykgcmV0dXJuIGZhbHNlOwogICAgcmV0dXJuIHN0YWNrLnNwbGl0KCdcbicpLnNvbWUobCA9PiBsLmluZGV4T2YoJyhodHRwcy5qczonKSAhPT0gLTEgfHwgbC5pbmRleE9mKCdub2RlOmh0dHBzOicpICE9PSAtMSk7CiAgfQoKICBjcmVhdGVTb2NrZXQocmVxLCBvcHRpb25zLCBjYikgewogICAgY29uc3QgY29ubmVjdE9wdHMgPSB7CiAgICAgIC4uLm9wdGlvbnMsCiAgICAgIHNlY3VyZUVuZHBvaW50OiB0aGlzLmlzU2VjdXJlRW5kcG9pbnQob3B0aW9ucyksCiAgICB9OwogICAgUHJvbWlzZS5yZXNvbHZlKCkKICAgICAgLnRoZW4oKCkgPT4gdGhpcy5jb25uZWN0KHJlcSwgY29ubmVjdE9wdHMpKQogICAgICAudGhlbihzb2NrZXQgPT4gewogICAgICAgIGlmIChzb2NrZXQgaW5zdGFuY2VvZiBodHRwLkFnZW50KSB7CiAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIGBhZGRSZXF1ZXN0KClgIGlzbid0IGRlZmluZWQgaW4gYEB0eXBlcy9ub2RlYAogICAgICAgICAgcmV0dXJuIHNvY2tldC5hZGRSZXF1ZXN0KHJlcSwgY29ubmVjdE9wdHMpOwogICAgICAgIH0KICAgICAgICB0aGlzW0lOVEVSTkFMXS5jdXJyZW50U29ja2V0ID0gc29ja2V0OwogICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgYGNyZWF0ZVNvY2tldCgpYCBpc24ndCBkZWZpbmVkIGluIGBAdHlwZXMvbm9kZWAKICAgICAgICBzdXBlci5jcmVhdGVTb2NrZXQocmVxLCBvcHRpb25zLCBjYik7CiAgICAgIH0sIGNiKTsKICB9CgogIGNyZWF0ZUNvbm5lY3Rpb24oKSB7CiAgICBjb25zdCBzb2NrZXQgPSB0aGlzW0lOVEVSTkFMXS5jdXJyZW50U29ja2V0OwogICAgdGhpc1tJTlRFUk5BTF0uY3VycmVudFNvY2tldCA9IHVuZGVmaW5lZDsKICAgIGlmICghc29ja2V0KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gc29ja2V0IHdhcyByZXR1cm5lZCBpbiB0aGUgYGNvbm5lY3QoKWAgZnVuY3Rpb24nKTsKICAgIH0KICAgIHJldHVybiBzb2NrZXQ7CiAgfQoKICBnZXQgZGVmYXVsdFBvcnQoKSB7CiAgICByZXR1cm4gX251bGxpc2hDb2FsZXNjZSQyKHRoaXNbSU5URVJOQUxdLmRlZmF1bHRQb3J0LCAoKSA9PiAoICh0aGlzLnByb3RvY29sID09PSAnaHR0cHM6JyA/IDQ0MyA6IDgwKSkpOwogIH0KCiAgc2V0IGRlZmF1bHRQb3J0KHYpIHsKICAgIGlmICh0aGlzW0lOVEVSTkFMXSkgewogICAgICB0aGlzW0lOVEVSTkFMXS5kZWZhdWx0UG9ydCA9IHY7CiAgICB9CiAgfQoKICBnZXQgcHJvdG9jb2woKSB7CiAgICByZXR1cm4gX251bGxpc2hDb2FsZXNjZSQyKHRoaXNbSU5URVJOQUxdLnByb3RvY29sLCAoKSA9PiAoICh0aGlzLmlzU2VjdXJlRW5kcG9pbnQoKSA/ICdodHRwczonIDogJ2h0dHA6JykpKTsKICB9CgogIHNldCBwcm90b2NvbCh2KSB7CiAgICBpZiAodGhpc1tJTlRFUk5BTF0pIHsKICAgICAgdGhpc1tJTlRFUk5BTF0ucHJvdG9jb2wgPSB2OwogICAgfQogIH0KfQoKZnVuY3Rpb24gZGVidWckMSguLi5hcmdzKSB7CiAgbG9nZ2VyLmxvZygnW2h0dHBzLXByb3h5LWFnZW50OnBhcnNlLXByb3h5LXJlc3BvbnNlXScsIC4uLmFyZ3MpOwp9CgpmdW5jdGlvbiBwYXJzZVByb3h5UmVzcG9uc2Uoc29ja2V0KSB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgIC8vIHdlIG5lZWQgdG8gYnVmZmVyIGFueSBIVFRQIHRyYWZmaWMgdGhhdCBoYXBwZW5zIHdpdGggdGhlIHByb3h5IGJlZm9yZSB3ZSBnZXQKICAgIC8vIHRoZSBDT05ORUNUIHJlc3BvbnNlLCBzbyB0aGF0IGlmIHRoZSByZXNwb25zZSBpcyBhbnl0aGluZyBvdGhlciB0aGFuIGFuICIyMDAiCiAgICAvLyByZXNwb25zZSBjb2RlLCB0aGVuIHdlIGNhbiByZS1wbGF5IHRoZSAiZGF0YSIgZXZlbnRzIG9uIHRoZSBzb2NrZXQgb25jZSB0aGUKICAgIC8vIEhUVFAgcGFyc2VyIGlzIGhvb2tlZCB1cC4uLgogICAgbGV0IGJ1ZmZlcnNMZW5ndGggPSAwOwogICAgY29uc3QgYnVmZmVycyA9IFtdOwoKICAgIGZ1bmN0aW9uIHJlYWQoKSB7CiAgICAgIGNvbnN0IGIgPSBzb2NrZXQucmVhZCgpOwogICAgICBpZiAoYikgb25kYXRhKGIpOwogICAgICBlbHNlIHNvY2tldC5vbmNlKCdyZWFkYWJsZScsIHJlYWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNsZWFudXAoKSB7CiAgICAgIHNvY2tldC5yZW1vdmVMaXN0ZW5lcignZW5kJywgb25lbmQpOwogICAgICBzb2NrZXQucmVtb3ZlTGlzdGVuZXIoJ2Vycm9yJywgb25lcnJvcik7CiAgICAgIHNvY2tldC5yZW1vdmVMaXN0ZW5lcigncmVhZGFibGUnLCByZWFkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvbmVuZCgpIHsKICAgICAgY2xlYW51cCgpOwogICAgICBkZWJ1ZyQxKCdvbmVuZCcpOwogICAgICByZWplY3QobmV3IEVycm9yKCdQcm94eSBjb25uZWN0aW9uIGVuZGVkIGJlZm9yZSByZWNlaXZpbmcgQ09OTkVDVCByZXNwb25zZScpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvbmVycm9yKGVycikgewogICAgICBjbGVhbnVwKCk7CiAgICAgIGRlYnVnJDEoJ29uZXJyb3IgJW8nLCBlcnIpOwogICAgICByZWplY3QoZXJyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvbmRhdGEoYikgewogICAgICBidWZmZXJzLnB1c2goYik7CiAgICAgIGJ1ZmZlcnNMZW5ndGggKz0gYi5sZW5ndGg7CgogICAgICBjb25zdCBidWZmZXJlZCA9IEJ1ZmZlci5jb25jYXQoYnVmZmVycywgYnVmZmVyc0xlbmd0aCk7CiAgICAgIGNvbnN0IGVuZE9mSGVhZGVycyA9IGJ1ZmZlcmVkLmluZGV4T2YoJ1xyXG5cclxuJyk7CgogICAgICBpZiAoZW5kT2ZIZWFkZXJzID09PSAtMSkgewogICAgICAgIC8vIGtlZXAgYnVmZmVyaW5nCiAgICAgICAgZGVidWckMSgnaGF2ZSBub3QgcmVjZWl2ZWQgZW5kIG9mIEhUVFAgaGVhZGVycyB5ZXQuLi4nKTsKICAgICAgICByZWFkKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBoZWFkZXJQYXJ0cyA9IGJ1ZmZlcmVkLnNsaWNlKDAsIGVuZE9mSGVhZGVycykudG9TdHJpbmcoJ2FzY2lpJykuc3BsaXQoJ1xyXG4nKTsKICAgICAgY29uc3QgZmlyc3RMaW5lID0gaGVhZGVyUGFydHMuc2hpZnQoKTsKICAgICAgaWYgKCFmaXJzdExpbmUpIHsKICAgICAgICBzb2NrZXQuZGVzdHJveSgpOwogICAgICAgIHJldHVybiByZWplY3QobmV3IEVycm9yKCdObyBoZWFkZXIgcmVjZWl2ZWQgZnJvbSBwcm94eSBDT05ORUNUIHJlc3BvbnNlJykpOwogICAgICB9CiAgICAgIGNvbnN0IGZpcnN0TGluZVBhcnRzID0gZmlyc3RMaW5lLnNwbGl0KCcgJyk7CiAgICAgIGNvbnN0IHN0YXR1c0NvZGUgPSArZmlyc3RMaW5lUGFydHNbMV07CiAgICAgIGNvbnN0IHN0YXR1c1RleHQgPSBmaXJzdExpbmVQYXJ0cy5zbGljZSgyKS5qb2luKCcgJyk7CiAgICAgIGNvbnN0IGhlYWRlcnMgPSB7fTsKICAgICAgZm9yIChjb25zdCBoZWFkZXIgb2YgaGVhZGVyUGFydHMpIHsKICAgICAgICBpZiAoIWhlYWRlcikgY29udGludWU7CiAgICAgICAgY29uc3QgZmlyc3RDb2xvbiA9IGhlYWRlci5pbmRleE9mKCc6Jyk7CiAgICAgICAgaWYgKGZpcnN0Q29sb24gPT09IC0xKSB7CiAgICAgICAgICBzb2NrZXQuZGVzdHJveSgpOwogICAgICAgICAgcmV0dXJuIHJlamVjdChuZXcgRXJyb3IoYEludmFsaWQgaGVhZGVyIGZyb20gcHJveHkgQ09OTkVDVCByZXNwb25zZTogIiR7aGVhZGVyfSJgKSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGtleSA9IGhlYWRlci5zbGljZSgwLCBmaXJzdENvbG9uKS50b0xvd2VyQ2FzZSgpOwogICAgICAgIGNvbnN0IHZhbHVlID0gaGVhZGVyLnNsaWNlKGZpcnN0Q29sb24gKyAxKS50cmltU3RhcnQoKTsKICAgICAgICBjb25zdCBjdXJyZW50ID0gaGVhZGVyc1trZXldOwogICAgICAgIGlmICh0eXBlb2YgY3VycmVudCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIGhlYWRlcnNba2V5XSA9IFtjdXJyZW50LCB2YWx1ZV07CiAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGN1cnJlbnQpKSB7CiAgICAgICAgICBjdXJyZW50LnB1c2godmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoZWFkZXJzW2tleV0gPSB2YWx1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZGVidWckMSgnZ290IHByb3h5IHNlcnZlciByZXNwb25zZTogJW8gJW8nLCBmaXJzdExpbmUsIGhlYWRlcnMpOwogICAgICBjbGVhbnVwKCk7CiAgICAgIHJlc29sdmUoewogICAgICAgIGNvbm5lY3Q6IHsKICAgICAgICAgIHN0YXR1c0NvZGUsCiAgICAgICAgICBzdGF0dXNUZXh0LAogICAgICAgICAgaGVhZGVycywKICAgICAgICB9LAogICAgICAgIGJ1ZmZlcmVkLAogICAgICB9KTsKICAgIH0KCiAgICBzb2NrZXQub24oJ2Vycm9yJywgb25lcnJvcik7CiAgICBzb2NrZXQub24oJ2VuZCcsIG9uZW5kKTsKCiAgICByZWFkKCk7CiAgfSk7Cn0KCmZ1bmN0aW9uIF9udWxsaXNoQ29hbGVzY2UkMShsaHMsIHJoc0ZuKSB7IGlmIChsaHMgIT0gbnVsbCkgeyByZXR1cm4gbGhzOyB9IGVsc2UgeyByZXR1cm4gcmhzRm4oKTsgfSB9IGZ1bmN0aW9uIF9vcHRpb25hbENoYWluJDEob3BzKSB7IGxldCBsYXN0QWNjZXNzTEhTID0gdW5kZWZpbmVkOyBsZXQgdmFsdWUgPSBvcHNbMF07IGxldCBpID0gMTsgd2hpbGUgKGkgPCBvcHMubGVuZ3RoKSB7IGNvbnN0IG9wID0gb3BzW2ldOyBjb25zdCBmbiA9IG9wc1tpICsgMV07IGkgKz0gMjsgaWYgKChvcCA9PT0gJ29wdGlvbmFsQWNjZXNzJyB8fCBvcCA9PT0gJ29wdGlvbmFsQ2FsbCcpICYmIHZhbHVlID09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBpZiAob3AgPT09ICdhY2Nlc3MnIHx8IG9wID09PSAnb3B0aW9uYWxBY2Nlc3MnKSB7IGxhc3RBY2Nlc3NMSFMgPSB2YWx1ZTsgdmFsdWUgPSBmbih2YWx1ZSk7IH0gZWxzZSBpZiAob3AgPT09ICdjYWxsJyB8fCBvcCA9PT0gJ29wdGlvbmFsQ2FsbCcpIHsgdmFsdWUgPSBmbigoLi4uYXJncykgPT4gdmFsdWUuY2FsbChsYXN0QWNjZXNzTEhTLCAuLi5hcmdzKSk7IGxhc3RBY2Nlc3NMSFMgPSB1bmRlZmluZWQ7IH0gfSByZXR1cm4gdmFsdWU7IH0KCmZ1bmN0aW9uIGRlYnVnKC4uLmFyZ3MpIHsKICBsb2dnZXIubG9nKCdbaHR0cHMtcHJveHktYWdlbnRdJywgLi4uYXJncyk7Cn0KCi8qKgogKiBUaGUgYEh0dHBzUHJveHlBZ2VudGAgaW1wbGVtZW50cyBhbiBIVFRQIEFnZW50IHN1YmNsYXNzIHRoYXQgY29ubmVjdHMgdG8KICogdGhlIHNwZWNpZmllZCAiSFRUUChzKSBwcm94eSBzZXJ2ZXIiIGluIG9yZGVyIHRvIHByb3h5IEhUVFBTIHJlcXVlc3RzLgogKgogKiBPdXRnb2luZyBIVFRQIHJlcXVlc3RzIGFyZSBmaXJzdCB0dW5uZWxlZCB0aHJvdWdoIHRoZSBwcm94eSBzZXJ2ZXIgdXNpbmcgdGhlCiAqIGBDT05ORUNUYCBIVFRQIHJlcXVlc3QgbWV0aG9kIHRvIGVzdGFibGlzaCBhIGNvbm5lY3Rpb24gdG8gdGhlIHByb3h5IHNlcnZlciwKICogYW5kIHRoZW4gdGhlIHByb3h5IHNlcnZlciBjb25uZWN0cyB0byB0aGUgZGVzdGluYXRpb24gdGFyZ2V0IGFuZCBpc3N1ZXMgdGhlCiAqIEhUVFAgcmVxdWVzdCBmcm9tIHRoZSBwcm94eSBzZXJ2ZXIuCiAqCiAqIGBodHRwczpgIHJlcXVlc3RzIGhhdmUgdGhlaXIgc29ja2V0IGNvbm5lY3Rpb24gdXBncmFkZWQgdG8gVExTIG9uY2UKICogdGhlIGNvbm5lY3Rpb24gdG8gdGhlIHByb3h5IHNlcnZlciBoYXMgYmVlbiBlc3RhYmxpc2hlZC4KICovCmNsYXNzIEh0dHBzUHJveHlBZ2VudCBleHRlbmRzIEFnZW50IHsKICBzdGF0aWMgX19pbml0U3RhdGljKCkge3RoaXMucHJvdG9jb2xzID0gWydodHRwJywgJ2h0dHBzJ107IH0KCiAgY29uc3RydWN0b3IocHJveHksIG9wdHMpIHsKICAgIHN1cGVyKG9wdHMpOwogICAgdGhpcy5vcHRpb25zID0ge307CiAgICB0aGlzLnByb3h5ID0gdHlwZW9mIHByb3h5ID09PSAnc3RyaW5nJyA/IG5ldyBVUkwocHJveHkpIDogcHJveHk7CiAgICB0aGlzLnByb3h5SGVhZGVycyA9IF9udWxsaXNoQ29hbGVzY2UkMShfb3B0aW9uYWxDaGFpbiQxKFtvcHRzLCAnb3B0aW9uYWxBY2Nlc3MnLCBfMiA9PiBfMi5oZWFkZXJzXSksICgpID0+ICgge30pKTsKICAgIGRlYnVnKCdDcmVhdGluZyBuZXcgSHR0cHNQcm94eUFnZW50IGluc3RhbmNlOiAlbycsIHRoaXMucHJveHkuaHJlZik7CgogICAgLy8gVHJpbSBvZmYgdGhlIGJyYWNrZXRzIGZyb20gSVB2NiBhZGRyZXNzZXMKICAgIGNvbnN0IGhvc3QgPSAodGhpcy5wcm94eS5ob3N0bmFtZSB8fCB0aGlzLnByb3h5Lmhvc3QpLnJlcGxhY2UoL15cW3xcXSQvZywgJycpOwogICAgY29uc3QgcG9ydCA9IHRoaXMucHJveHkucG9ydCA/IHBhcnNlSW50KHRoaXMucHJveHkucG9ydCwgMTApIDogdGhpcy5wcm94eS5wcm90b2NvbCA9PT0gJ2h0dHBzOicgPyA0NDMgOiA4MDsKICAgIHRoaXMuY29ubmVjdE9wdHMgPSB7CiAgICAgIC8vIEF0dGVtcHQgdG8gbmVnb3RpYXRlIGh0dHAvMS4xIGZvciBwcm94eSBzZXJ2ZXJzIHRoYXQgc3VwcG9ydCBodHRwLzIKICAgICAgQUxQTlByb3RvY29sczogWydodHRwLzEuMSddLAogICAgICAuLi4ob3B0cyA/IG9taXQob3B0cywgJ2hlYWRlcnMnKSA6IG51bGwpLAogICAgICBob3N0LAogICAgICBwb3J0LAogICAgfTsKICB9CgogIC8qKgogICAqIENhbGxlZCB3aGVuIHRoZSBub2RlLWNvcmUgSFRUUCBjbGllbnQgbGlicmFyeSBpcyBjcmVhdGluZyBhCiAgICogbmV3IEhUVFAgcmVxdWVzdC4KICAgKi8KICBhc3luYyBjb25uZWN0KHJlcSwgb3B0cykgewogICAgY29uc3QgeyBwcm94eSB9ID0gdGhpczsKCiAgICBpZiAoIW9wdHMuaG9zdCkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdObyAiaG9zdCIgcHJvdmlkZWQnKTsKICAgIH0KCiAgICAvLyBDcmVhdGUgYSBzb2NrZXQgY29ubmVjdGlvbiB0byB0aGUgcHJveHkgc2VydmVyLgogICAgbGV0IHNvY2tldDsKICAgIGlmIChwcm94eS5wcm90b2NvbCA9PT0gJ2h0dHBzOicpIHsKICAgICAgZGVidWcoJ0NyZWF0aW5nIGB0bHMuU29ja2V0YDogJW8nLCB0aGlzLmNvbm5lY3RPcHRzKTsKICAgICAgY29uc3Qgc2VydmVybmFtZSA9IHRoaXMuY29ubmVjdE9wdHMuc2VydmVybmFtZSB8fCB0aGlzLmNvbm5lY3RPcHRzLmhvc3Q7CiAgICAgIHNvY2tldCA9IHRscy5jb25uZWN0KHsKICAgICAgICAuLi50aGlzLmNvbm5lY3RPcHRzLAogICAgICAgIHNlcnZlcm5hbWU6IHNlcnZlcm5hbWUgJiYgbmV0LmlzSVAoc2VydmVybmFtZSkgPyB1bmRlZmluZWQgOiBzZXJ2ZXJuYW1lLAogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGRlYnVnKCdDcmVhdGluZyBgbmV0LlNvY2tldGA6ICVvJywgdGhpcy5jb25uZWN0T3B0cyk7CiAgICAgIHNvY2tldCA9IG5ldC5jb25uZWN0KHRoaXMuY29ubmVjdE9wdHMpOwogICAgfQoKICAgIGNvbnN0IGhlYWRlcnMgPQogICAgICB0eXBlb2YgdGhpcy5wcm94eUhlYWRlcnMgPT09ICdmdW5jdGlvbicgPyB0aGlzLnByb3h5SGVhZGVycygpIDogeyAuLi50aGlzLnByb3h5SGVhZGVycyB9OwogICAgY29uc3QgaG9zdCA9IG5ldC5pc0lQdjYob3B0cy5ob3N0KSA/IGBbJHtvcHRzLmhvc3R9XWAgOiBvcHRzLmhvc3Q7CiAgICBsZXQgcGF5bG9hZCA9IGBDT05ORUNUICR7aG9zdH06JHtvcHRzLnBvcnR9IEhUVFAvMS4xXHJcbmA7CgogICAgLy8gSW5qZWN0IHRoZSBgUHJveHktQXV0aG9yaXphdGlvbmAgaGVhZGVyIGlmIG5lY2Vzc2FyeS4KICAgIGlmIChwcm94eS51c2VybmFtZSB8fCBwcm94eS5wYXNzd29yZCkgewogICAgICBjb25zdCBhdXRoID0gYCR7ZGVjb2RlVVJJQ29tcG9uZW50KHByb3h5LnVzZXJuYW1lKX06JHtkZWNvZGVVUklDb21wb25lbnQocHJveHkucGFzc3dvcmQpfWA7CiAgICAgIGhlYWRlcnNbJ1Byb3h5LUF1dGhvcml6YXRpb24nXSA9IGBCYXNpYyAke0J1ZmZlci5mcm9tKGF1dGgpLnRvU3RyaW5nKCdiYXNlNjQnKX1gOwogICAgfQoKICAgIGhlYWRlcnMuSG9zdCA9IGAke2hvc3R9OiR7b3B0cy5wb3J0fWA7CgogICAgaWYgKCFoZWFkZXJzWydQcm94eS1Db25uZWN0aW9uJ10pIHsKICAgICAgaGVhZGVyc1snUHJveHktQ29ubmVjdGlvbiddID0gdGhpcy5rZWVwQWxpdmUgPyAnS2VlcC1BbGl2ZScgOiAnY2xvc2UnOwogICAgfQogICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5rZXlzKGhlYWRlcnMpKSB7CiAgICAgIHBheWxvYWQgKz0gYCR7bmFtZX06ICR7aGVhZGVyc1tuYW1lXX1cclxuYDsKICAgIH0KCiAgICBjb25zdCBwcm94eVJlc3BvbnNlUHJvbWlzZSA9IHBhcnNlUHJveHlSZXNwb25zZShzb2NrZXQpOwoKICAgIHNvY2tldC53cml0ZShgJHtwYXlsb2FkfVxyXG5gKTsKCiAgICBjb25zdCB7IGNvbm5lY3QsIGJ1ZmZlcmVkIH0gPSBhd2FpdCBwcm94eVJlc3BvbnNlUHJvbWlzZTsKICAgIHJlcS5lbWl0KCdwcm94eUNvbm5lY3QnLCBjb25uZWN0KTsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnQKICAgIC8vIEB0cy1pZ25vcmUgTm90IEV2ZW50RW1pdHRlciBpbiBOb2RlIHR5cGVzCiAgICB0aGlzLmVtaXQoJ3Byb3h5Q29ubmVjdCcsIGNvbm5lY3QsIHJlcSk7CgogICAgaWYgKGNvbm5lY3Quc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgIHJlcS5vbmNlKCdzb2NrZXQnLCByZXN1bWUpOwoKICAgICAgaWYgKG9wdHMuc2VjdXJlRW5kcG9pbnQpIHsKICAgICAgICAvLyBUaGUgcHJveHkgaXMgY29ubmVjdGluZyB0byBhIFRMUyBzZXJ2ZXIsIHNvIHVwZ3JhZGUKICAgICAgICAvLyB0aGlzIHNvY2tldCBjb25uZWN0aW9uIHRvIGEgVExTIGNvbm5lY3Rpb24uCiAgICAgICAgZGVidWcoJ1VwZ3JhZGluZyBzb2NrZXQgY29ubmVjdGlvbiB0byBUTFMnKTsKICAgICAgICBjb25zdCBzZXJ2ZXJuYW1lID0gb3B0cy5zZXJ2ZXJuYW1lIHx8IG9wdHMuaG9zdDsKICAgICAgICByZXR1cm4gdGxzLmNvbm5lY3QoewogICAgICAgICAgLi4ub21pdChvcHRzLCAnaG9zdCcsICdwYXRoJywgJ3BvcnQnKSwKICAgICAgICAgIHNvY2tldCwKICAgICAgICAgIHNlcnZlcm5hbWU6IG5ldC5pc0lQKHNlcnZlcm5hbWUpID8gdW5kZWZpbmVkIDogc2VydmVybmFtZSwKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHNvY2tldDsKICAgIH0KCiAgICAvLyBTb21lIG90aGVyIHN0YXR1cyBjb2RlIHRoYXQncyBub3QgMjAwLi4uIG5lZWQgdG8gcmUtcGxheSB0aGUgSFRUUAogICAgLy8gaGVhZGVyICJkYXRhIiBldmVudHMgb250byB0aGUgc29ja2V0IG9uY2UgdGhlIEhUVFAgbWFjaGluZXJ5IGlzCiAgICAvLyBhdHRhY2hlZCBzbyB0aGF0IHRoZSBub2RlIGNvcmUgYGh0dHBgIGNhbiBwYXJzZSBhbmQgaGFuZGxlIHRoZQogICAgLy8gZXJyb3Igc3RhdHVzIGNvZGUuCgogICAgLy8gQ2xvc2UgdGhlIG9yaWdpbmFsIHNvY2tldCwgYW5kIGEgbmV3ICJmYWtlIiBzb2NrZXQgaXMgcmV0dXJuZWQKICAgIC8vIGluc3RlYWQsIHNvIHRoYXQgdGhlIHByb3h5IGRvZXNuJ3QgZ2V0IHRoZSBIVFRQIHJlcXVlc3QKICAgIC8vIHdyaXR0ZW4gdG8gaXQgKHdoaWNoIG1heSBjb250YWluIGBBdXRob3JpemF0aW9uYCBoZWFkZXJzIG9yIG90aGVyCiAgICAvLyBzZW5zaXRpdmUgZGF0YSkuCiAgICAvLwogICAgLy8gU2VlOiBodHRwczovL2hhY2tlcm9uZS5jb20vcmVwb3J0cy81NDE1MDIKICAgIHNvY2tldC5kZXN0cm95KCk7CgogICAgY29uc3QgZmFrZVNvY2tldCA9IG5ldyBuZXQuU29ja2V0KHsgd3JpdGFibGU6IGZhbHNlIH0pOwogICAgZmFrZVNvY2tldC5yZWFkYWJsZSA9IHRydWU7CgogICAgLy8gTmVlZCB0byB3YWl0IGZvciB0aGUgInNvY2tldCIgZXZlbnQgdG8gcmUtcGxheSB0aGUgImRhdGEiIGV2ZW50cy4KICAgIHJlcS5vbmNlKCdzb2NrZXQnLCAocykgPT4gewogICAgICBkZWJ1ZygnUmVwbGF5aW5nIHByb3h5IGJ1ZmZlciBmb3IgZmFpbGVkIHJlcXVlc3QnKTsKICAgICAgLy8gUmVwbGF5IHRoZSAiYnVmZmVyZWQiIEJ1ZmZlciBvbnRvIHRoZSBmYWtlIGBzb2NrZXRgLCBzaW5jZSBhdAogICAgICAvLyB0aGlzIHBvaW50IHRoZSBIVFRQIG1vZHVsZSBtYWNoaW5lcnkgaGFzIGJlZW4gaG9va2VkIHVwIGZvcgogICAgICAvLyB0aGUgdXNlci4KICAgICAgcy5wdXNoKGJ1ZmZlcmVkKTsKICAgICAgcy5wdXNoKG51bGwpOwogICAgfSk7CgogICAgcmV0dXJuIGZha2VTb2NrZXQ7CiAgfQp9IEh0dHBzUHJveHlBZ2VudC5fX2luaXRTdGF0aWMoKTsKCmZ1bmN0aW9uIHJlc3VtZShzb2NrZXQpIHsKICBzb2NrZXQucmVzdW1lKCk7Cn0KCmZ1bmN0aW9uIG9taXQoCiAgb2JqLAogIC4uLmtleXMKKQoKIHsKICBjb25zdCByZXQgPSB7fQoKOwogIGxldCBrZXk7CiAgZm9yIChrZXkgaW4gb2JqKSB7CiAgICBpZiAoIWtleXMuaW5jbHVkZXMoa2V5KSkgewogICAgICByZXRba2V5XSA9IG9ialtrZXldOwogICAgfQogIH0KICByZXR1cm4gcmV0Owp9CgpmdW5jdGlvbiBfbnVsbGlzaENvYWxlc2NlKGxocywgcmhzRm4pIHsgaWYgKGxocyAhPSBudWxsKSB7IHJldHVybiBsaHM7IH0gZWxzZSB7IHJldHVybiByaHNGbigpOyB9IH0KLy8gRXN0aW1hdGVkIG1heGltdW0gc2l6ZSBmb3IgcmVhc29uYWJsZSBzdGFuZGFsb25lIGV2ZW50CmNvbnN0IEdaSVBfVEhSRVNIT0xEID0gMTAyNCAqIDMyOwoKLyoqCiAqIEdldHMgYSBzdHJlYW0gZnJvbSBhIFVpbnQ4QXJyYXkgb3Igc3RyaW5nCiAqIFJlYWRhYmxlLmZyb20gaXMgaWRlYWwgYnV0IHdhcyBhZGRlZCBpbiBub2RlLmpzIHYxMi4zLjAgYW5kIHYxMC4xNy4wCiAqLwpmdW5jdGlvbiBzdHJlYW1Gcm9tQm9keShib2R5KSB7CiAgcmV0dXJuIG5ldyBSZWFkYWJsZSh7CiAgICByZWFkKCkgewogICAgICB0aGlzLnB1c2goYm9keSk7CiAgICAgIHRoaXMucHVzaChudWxsKTsKICAgIH0sCiAgfSk7Cn0KCi8qKgogKiBDcmVhdGVzIGEgVHJhbnNwb3J0IHRoYXQgdXNlcyBuYXRpdmUgdGhlIG5hdGl2ZSAnaHR0cCcgYW5kICdodHRwcycgbW9kdWxlcyB0byBzZW5kIGV2ZW50cyB0byBTZW50cnkuCiAqLwpmdW5jdGlvbiBtYWtlTm9kZVRyYW5zcG9ydChvcHRpb25zKSB7CiAgbGV0IHVybFNlZ21lbnRzOwoKICB0cnkgewogICAgdXJsU2VnbWVudHMgPSBuZXcgVVJMKG9wdGlvbnMudXJsKTsKICB9IGNhdGNoIChlKSB7CiAgICBjb25zb2xlU2FuZGJveCgoKSA9PiB7CiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlCiAgICAgIGNvbnNvbGUud2FybigKICAgICAgICAnW0BzZW50cnkvbm9kZV06IEludmFsaWQgZHNuIG9yIHR1bm5lbCBvcHRpb24sIHdpbGwgbm90IHNlbmQgYW55IGV2ZW50cy4gVGhlIHR1bm5lbCBvcHRpb24gbXVzdCBiZSBhIGZ1bGwgVVJMIHdoZW4gdXNlZC4nLAogICAgICApOwogICAgfSk7CiAgICByZXR1cm4gY3JlYXRlVHJhbnNwb3J0KG9wdGlvbnMsICgpID0+IFByb21pc2UucmVzb2x2ZSh7fSkpOwogIH0KCiAgY29uc3QgaXNIdHRwcyA9IHVybFNlZ21lbnRzLnByb3RvY29sID09PSAnaHR0cHM6JzsKCiAgLy8gUHJveHkgcHJpb3JpdGl6YXRpb246IGh0dHAgPT4gYG9wdGlvbnMucHJveHlgIHwgYHByb2Nlc3MuZW52Lmh0dHBfcHJveHlgCiAgLy8gUHJveHkgcHJpb3JpdGl6YXRpb246IGh0dHBzID0+IGBvcHRpb25zLnByb3h5YCB8IGBwcm9jZXNzLmVudi5odHRwc19wcm94eWAgfCBgcHJvY2Vzcy5lbnYuaHR0cF9wcm94eWAKICBjb25zdCBwcm94eSA9IGFwcGx5Tm9Qcm94eU9wdGlvbigKICAgIHVybFNlZ21lbnRzLAogICAgb3B0aW9ucy5wcm94eSB8fCAoaXNIdHRwcyA/IHByb2Nlc3MuZW52Lmh0dHBzX3Byb3h5IDogdW5kZWZpbmVkKSB8fCBwcm9jZXNzLmVudi5odHRwX3Byb3h5LAogICk7CgogIGNvbnN0IG5hdGl2ZUh0dHBNb2R1bGUgPSBpc0h0dHBzID8gaHR0cHMgOiBodHRwOwogIGNvbnN0IGtlZXBBbGl2ZSA9IG9wdGlvbnMua2VlcEFsaXZlID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IG9wdGlvbnMua2VlcEFsaXZlOwoKICAvLyBUT0RPKHY3KTogRXZhbHVhdGUgaWYgd2UgY2FuIHNldCBrZWVwQWxpdmUgdG8gdHJ1ZS4gVGhpcyB3b3VsZCBpbnZvbHZlIHRlc3RpbmcgZm9yIG1lbW9yeSBsZWFrcyBpbiBvbGRlciBub2RlCiAgLy8gdmVyc2lvbnMoPj0gOCkgYXMgdGhleSBoYWQgbWVtb3J5IGxlYWtzIHdoZW4gdXNpbmcgaXQ6ICMyNTU1CiAgY29uc3QgYWdlbnQgPSBwcm94eQogICAgPyAobmV3IEh0dHBzUHJveHlBZ2VudChwcm94eSkgKQogICAgOiBuZXcgbmF0aXZlSHR0cE1vZHVsZS5BZ2VudCh7IGtlZXBBbGl2ZSwgbWF4U29ja2V0czogMzAsIHRpbWVvdXQ6IDIwMDAgfSk7CgogIGNvbnN0IHJlcXVlc3RFeGVjdXRvciA9IGNyZWF0ZVJlcXVlc3RFeGVjdXRvcihvcHRpb25zLCBfbnVsbGlzaENvYWxlc2NlKG9wdGlvbnMuaHR0cE1vZHVsZSwgKCkgPT4gKCBuYXRpdmVIdHRwTW9kdWxlKSksIGFnZW50KTsKICByZXR1cm4gY3JlYXRlVHJhbnNwb3J0KG9wdGlvbnMsIHJlcXVlc3RFeGVjdXRvcik7Cn0KCi8qKgogKiBIb25vcnMgdGhlIGBub19wcm94eWAgZW52IHZhcmlhYmxlIHdpdGggdGhlIGhpZ2hlc3QgcHJpb3JpdHkgdG8gYWxsb3cgZm9yIGhvc3RzIGV4Y2x1c2lvbi4KICoKICogQHBhcmFtIHRyYW5zcG9ydFVybCBUaGUgVVJMIHRoZSB0cmFuc3BvcnQgaW50ZW5kcyB0byBzZW5kIGV2ZW50cyB0by4KICogQHBhcmFtIHByb3h5IFRoZSBjbGllbnQgY29uZmlndXJlZCBwcm94eS4KICogQHJldHVybnMgQSBwcm94eSB0aGUgdHJhbnNwb3J0IHNob3VsZCB1c2UuCiAqLwpmdW5jdGlvbiBhcHBseU5vUHJveHlPcHRpb24odHJhbnNwb3J0VXJsU2VnbWVudHMsIHByb3h5KSB7CiAgY29uc3QgeyBub19wcm94eSB9ID0gcHJvY2Vzcy5lbnY7CgogIGNvbnN0IHVybElzRXhlbXB0RnJvbVByb3h5ID0KICAgIG5vX3Byb3h5ICYmCiAgICBub19wcm94eQogICAgICAuc3BsaXQoJywnKQogICAgICAuc29tZSgKICAgICAgICBleGVtcHRpb24gPT4gdHJhbnNwb3J0VXJsU2VnbWVudHMuaG9zdC5lbmRzV2l0aChleGVtcHRpb24pIHx8IHRyYW5zcG9ydFVybFNlZ21lbnRzLmhvc3RuYW1lLmVuZHNXaXRoKGV4ZW1wdGlvbiksCiAgICAgICk7CgogIGlmICh1cmxJc0V4ZW1wdEZyb21Qcm94eSkgewogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9IGVsc2UgewogICAgcmV0dXJuIHByb3h5OwogIH0KfQoKLyoqCiAqIENyZWF0ZXMgYSBSZXF1ZXN0RXhlY3V0b3IgdG8gYmUgdXNlZCB3aXRoIGBjcmVhdGVUcmFuc3BvcnRgLgogKi8KZnVuY3Rpb24gY3JlYXRlUmVxdWVzdEV4ZWN1dG9yKAogIG9wdGlvbnMsCiAgaHR0cE1vZHVsZSwKICBhZ2VudCwKKSB7CiAgY29uc3QgeyBob3N0bmFtZSwgcGF0aG5hbWUsIHBvcnQsIHByb3RvY29sLCBzZWFyY2ggfSA9IG5ldyBVUkwob3B0aW9ucy51cmwpOwogIHJldHVybiBmdW5jdGlvbiBtYWtlUmVxdWVzdChyZXF1ZXN0KSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBsZXQgYm9keSA9IHN0cmVhbUZyb21Cb2R5KHJlcXVlc3QuYm9keSk7CgogICAgICBjb25zdCBoZWFkZXJzID0geyAuLi5vcHRpb25zLmhlYWRlcnMgfTsKCiAgICAgIGlmIChyZXF1ZXN0LmJvZHkubGVuZ3RoID4gR1pJUF9USFJFU0hPTEQpIHsKICAgICAgICBoZWFkZXJzWydjb250ZW50LWVuY29kaW5nJ10gPSAnZ3ppcCc7CiAgICAgICAgYm9keSA9IGJvZHkucGlwZShjcmVhdGVHemlwKCkpOwogICAgICB9CgogICAgICBjb25zdCByZXEgPSBodHRwTW9kdWxlLnJlcXVlc3QoCiAgICAgICAgewogICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICBhZ2VudCwKICAgICAgICAgIGhlYWRlcnMsCiAgICAgICAgICBob3N0bmFtZSwKICAgICAgICAgIHBhdGg6IGAke3BhdGhuYW1lfSR7c2VhcmNofWAsCiAgICAgICAgICBwb3J0LAogICAgICAgICAgcHJvdG9jb2wsCiAgICAgICAgICBjYTogb3B0aW9ucy5jYUNlcnRzLAogICAgICAgIH0sCiAgICAgICAgcmVzID0+IHsKICAgICAgICAgIHJlcy5vbignZGF0YScsICgpID0+IHsKICAgICAgICAgICAgLy8gRHJhaW4gc29ja2V0CiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXMub24oJ2VuZCcsICgpID0+IHsKICAgICAgICAgICAgLy8gRHJhaW4gc29ja2V0CiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXMuc2V0RW5jb2RpbmcoJ3V0ZjgnKTsKCiAgICAgICAgICAvLyAiS2V5LXZhbHVlIHBhaXJzIG9mIGhlYWRlciBuYW1lcyBhbmQgdmFsdWVzLiBIZWFkZXIgbmFtZXMgYXJlIGxvd2VyLWNhc2VkLiIKICAgICAgICAgIC8vIGh0dHBzOi8vbm9kZWpzLm9yZy9hcGkvaHR0cC5odG1sI2h0dHBfbWVzc2FnZV9oZWFkZXJzCiAgICAgICAgICBjb25zdCByZXRyeUFmdGVySGVhZGVyID0gX251bGxpc2hDb2FsZXNjZShyZXMuaGVhZGVyc1sncmV0cnktYWZ0ZXInXSwgKCkgPT4gKCBudWxsKSk7CiAgICAgICAgICBjb25zdCByYXRlTGltaXRzSGVhZGVyID0gX251bGxpc2hDb2FsZXNjZShyZXMuaGVhZGVyc1sneC1zZW50cnktcmF0ZS1saW1pdHMnXSwgKCkgPT4gKCBudWxsKSk7CgogICAgICAgICAgcmVzb2x2ZSh7CiAgICAgICAgICAgIHN0YXR1c0NvZGU6IHJlcy5zdGF0dXNDb2RlLAogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgJ3JldHJ5LWFmdGVyJzogcmV0cnlBZnRlckhlYWRlciwKICAgICAgICAgICAgICAneC1zZW50cnktcmF0ZS1saW1pdHMnOiBBcnJheS5pc0FycmF5KHJhdGVMaW1pdHNIZWFkZXIpID8gcmF0ZUxpbWl0c0hlYWRlclswXSA6IHJhdGVMaW1pdHNIZWFkZXIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICApOwoKICAgICAgcmVxLm9uKCdlcnJvcicsIHJlamVjdCk7CiAgICAgIGJvZHkucGlwZShyZXEpOwogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gX29wdGlvbmFsQ2hhaW4ob3BzKSB7IGxldCBsYXN0QWNjZXNzTEhTID0gdW5kZWZpbmVkOyBsZXQgdmFsdWUgPSBvcHNbMF07IGxldCBpID0gMTsgd2hpbGUgKGkgPCBvcHMubGVuZ3RoKSB7IGNvbnN0IG9wID0gb3BzW2ldOyBjb25zdCBmbiA9IG9wc1tpICsgMV07IGkgKz0gMjsgaWYgKChvcCA9PT0gJ29wdGlvbmFsQWNjZXNzJyB8fCBvcCA9PT0gJ29wdGlvbmFsQ2FsbCcpICYmIHZhbHVlID09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBpZiAob3AgPT09ICdhY2Nlc3MnIHx8IG9wID09PSAnb3B0aW9uYWxBY2Nlc3MnKSB7IGxhc3RBY2Nlc3NMSFMgPSB2YWx1ZTsgdmFsdWUgPSBmbih2YWx1ZSk7IH0gZWxzZSBpZiAob3AgPT09ICdjYWxsJyB8fCBvcCA9PT0gJ29wdGlvbmFsQ2FsbCcpIHsgdmFsdWUgPSBmbigoLi4uYXJncykgPT4gdmFsdWUuY2FsbChsYXN0QWNjZXNzTEhTLCAuLi5hcmdzKSk7IGxhc3RBY2Nlc3NMSFMgPSB1bmRlZmluZWQ7IH0gfSByZXR1cm4gdmFsdWU7IH0KY29uc3Qgb3B0aW9ucyA9IHdvcmtlckRhdGE7CmxldCBzZXNzaW9uOwpsZXQgaGFzU2VudEFuckV2ZW50ID0gZmFsc2U7CgpmdW5jdGlvbiBsb2cobXNnKSB7CiAgaWYgKG9wdGlvbnMuZGVidWcpIHsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlCiAgICBjb25zb2xlLmxvZyhgW0FOUiBXb3JrZXJdICR7bXNnfWApOwogIH0KfQoKY29uc3QgdXJsID0gZ2V0RW52ZWxvcGVFbmRwb2ludFdpdGhVcmxFbmNvZGVkQXV0aChvcHRpb25zLmRzbik7CmNvbnN0IHRyYW5zcG9ydCA9IG1ha2VOb2RlVHJhbnNwb3J0KHsKICB1cmwsCiAgcmVjb3JkRHJvcHBlZEV2ZW50OiAoKSA9PiB7CiAgICAvLwogIH0sCn0pOwoKYXN5bmMgZnVuY3Rpb24gc2VuZEFibm9ybWFsU2Vzc2lvbigpIHsKICAvLyBvZiB3ZSBoYXZlIGFuIGV4aXN0aW5nIHNlc3Npb24gcGFzc2VkIGZyb20gdGhlIG1haW4gdGhyZWFkLCBzZW5kIGl0IGFzIGFibm9ybWFsCiAgaWYgKHNlc3Npb24pIHsKICAgIGxvZygnU2VuZGluZyBhYm5vcm1hbCBzZXNzaW9uJyk7CiAgICB1cGRhdGVTZXNzaW9uKHNlc3Npb24sIHsgc3RhdHVzOiAnYWJub3JtYWwnLCBhYm5vcm1hbF9tZWNoYW5pc206ICdhbnJfZm9yZWdyb3VuZCcgfSk7CgogICAgY29uc3QgZW52ZWxvcGUgPSBjcmVhdGVTZXNzaW9uRW52ZWxvcGUoc2Vzc2lvbiwgb3B0aW9ucy5kc24sIG9wdGlvbnMuc2RrTWV0YWRhdGEpOwogICAgLy8gTG9nIHRoZSBlbnZlbG9wZSBzbyB0byBhaWQgaW4gdGVzdGluZwogICAgbG9nKEpTT04uc3RyaW5naWZ5KGVudmVsb3BlKSk7CgogICAgYXdhaXQgdHJhbnNwb3J0LnNlbmQoZW52ZWxvcGUpOwoKICAgIHRyeSB7CiAgICAgIC8vIE5vdGlmeSB0aGUgbWFpbiBwcm9jZXNzIHRoYXQgdGhlIHNlc3Npb24gaGFzIGVuZGVkIHNvIHRoZSBzZXNzaW9uIGNhbiBiZSBjbGVhcmVkIGZyb20gdGhlIHNjb3BlCiAgICAgIF9vcHRpb25hbENoYWluKFtwYXJlbnRQb3J0LCAnb3B0aW9uYWxBY2Nlc3MnLCBfMiA9PiBfMi5wb3N0TWVzc2FnZSwgJ2NhbGwnLCBfMyA9PiBfMygnc2Vzc2lvbi1lbmRlZCcpXSk7CiAgICB9IGNhdGNoIChfKSB7CiAgICAgIC8vIGlnbm9yZQogICAgfQogIH0KfQoKbG9nKCdTdGFydGVkJyk7CgpmdW5jdGlvbiBwcmVwYXJlU3RhY2tGcmFtZXMoc3RhY2tGcmFtZXMpIHsKICBpZiAoIXN0YWNrRnJhbWVzKSB7CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KCiAgLy8gU3RyaXAgU2VudHJ5IGZyYW1lcyBhbmQgcmV2ZXJzZSB0aGUgc3RhY2sgZnJhbWVzIHNvIHRoZXkgYXJlIGluIHRoZSBjb3JyZWN0IG9yZGVyCiAgY29uc3Qgc3RyaXBwZWRGcmFtZXMgPSBzdHJpcFNlbnRyeUZyYW1lc0FuZFJldmVyc2Uoc3RhY2tGcmFtZXMpOwoKICAvLyBJZiB3ZSBoYXZlIGFuIGFwcCByb290IHBhdGgsIHJld3JpdGUgdGhlIGZpbGVuYW1lcyB0byBiZSByZWxhdGl2ZSB0byB0aGUgYXBwIHJvb3QKICBpZiAob3B0aW9ucy5hcHBSb290UGF0aCkgewogICAgZm9yIChjb25zdCBmcmFtZSBvZiBzdHJpcHBlZEZyYW1lcykgewogICAgICBpZiAoIWZyYW1lLmZpbGVuYW1lKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIGZyYW1lLmZpbGVuYW1lID0gbm9ybWFsaXplVXJsVG9CYXNlKGZyYW1lLmZpbGVuYW1lLCBvcHRpb25zLmFwcFJvb3RQYXRoKTsKICAgIH0KICB9CgogIHJldHVybiBzdHJpcHBlZEZyYW1lczsKfQoKZnVuY3Rpb24gYXBwbHlTY29wZVRvRXZlbnQoZXZlbnQsIHNjb3BlKSB7CiAgYXBwbHlTY29wZURhdGFUb0V2ZW50KGV2ZW50LCBzY29wZSk7CgogIGlmICghX29wdGlvbmFsQ2hhaW4oW2V2ZW50LCAnYWNjZXNzJywgXzQgPT4gXzQuY29udGV4dHMsICdvcHRpb25hbEFjY2VzcycsIF81ID0+IF81LnRyYWNlXSkpIHsKICAgIGNvbnN0IHsgdHJhY2VJZCwgc3BhbklkLCBwYXJlbnRTcGFuSWQgfSA9IHNjb3BlLnByb3BhZ2F0aW9uQ29udGV4dDsKICAgIGV2ZW50LmNvbnRleHRzID0gewogICAgICB0cmFjZTogewogICAgICAgIHRyYWNlX2lkOiB0cmFjZUlkLAogICAgICAgIHNwYW5faWQ6IHNwYW5JZCwKICAgICAgICBwYXJlbnRfc3Bhbl9pZDogcGFyZW50U3BhbklkLAogICAgICB9LAogICAgICAuLi5ldmVudC5jb250ZXh0cywKICAgIH07CiAgfQp9Cgphc3luYyBmdW5jdGlvbiBzZW5kQW5yRXZlbnQoZnJhbWVzLCBzY29wZSkgewogIGlmIChoYXNTZW50QW5yRXZlbnQpIHsKICAgIHJldHVybjsKICB9CgogIGhhc1NlbnRBbnJFdmVudCA9IHRydWU7CgogIGF3YWl0IHNlbmRBYm5vcm1hbFNlc3Npb24oKTsKCiAgbG9nKCdTZW5kaW5nIGV2ZW50Jyk7CgogIGNvbnN0IGV2ZW50ID0gewogICAgZXZlbnRfaWQ6IHV1aWQ0KCksCiAgICBjb250ZXh0czogb3B0aW9ucy5jb250ZXh0cywKICAgIHJlbGVhc2U6IG9wdGlvbnMucmVsZWFzZSwKICAgIGVudmlyb25tZW50OiBvcHRpb25zLmVudmlyb25tZW50LAogICAgZGlzdDogb3B0aW9ucy5kaXN0LAogICAgcGxhdGZvcm06ICdub2RlJywKICAgIGxldmVsOiAnZXJyb3InLAogICAgZXhjZXB0aW9uOiB7CiAgICAgIHZhbHVlczogWwogICAgICAgIHsKICAgICAgICAgIHR5cGU6ICdBcHBsaWNhdGlvbk5vdFJlc3BvbmRpbmcnLAogICAgICAgICAgdmFsdWU6IGBBcHBsaWNhdGlvbiBOb3QgUmVzcG9uZGluZyBmb3IgYXQgbGVhc3QgJHtvcHRpb25zLmFuclRocmVzaG9sZH0gbXNgLAogICAgICAgICAgc3RhY2t0cmFjZTogeyBmcmFtZXM6IHByZXBhcmVTdGFja0ZyYW1lcyhmcmFtZXMpIH0sCiAgICAgICAgICAvLyBUaGlzIGVuc3VyZXMgdGhlIFVJIGRvZXNuJ3Qgc2F5ICdDcmFzaGVkIGluJyBmb3IgdGhlIHN0YWNrIHRyYWNlCiAgICAgICAgICBtZWNoYW5pc206IHsgdHlwZTogJ0FOUicgfSwKICAgICAgICB9LAogICAgICBdLAogICAgfSwKICAgIHRhZ3M6IG9wdGlvbnMuc3RhdGljVGFncywKICB9OwoKICBpZiAoc2NvcGUpIHsKICAgIGFwcGx5U2NvcGVUb0V2ZW50KGV2ZW50LCBzY29wZSk7CiAgfQoKICBjb25zdCBlbnZlbG9wZSA9IGNyZWF0ZUV2ZW50RW52ZWxvcGUoZXZlbnQsIG9wdGlvbnMuZHNuLCBvcHRpb25zLnNka01ldGFkYXRhKTsKICAvLyBMb2cgdGhlIGVudmVsb3BlIHRvIGFpZCBpbiB0ZXN0aW5nCiAgbG9nKEpTT04uc3RyaW5naWZ5KGVudmVsb3BlKSk7CgogIGF3YWl0IHRyYW5zcG9ydC5zZW5kKGVudmVsb3BlKTsKICBhd2FpdCB0cmFuc3BvcnQuZmx1c2goMjAwMCk7CgogIC8vIERlbGF5IGZvciA1IHNlY29uZHMgc28gdGhhdCBzdGRpbyBjYW4gZmx1c2ggaW4gdGhlIG1haW4gZXZlbnQgbG9vcCBldmVyIHJlc3RhcnRzLgogIC8vIFRoaXMgaXMgbWFpbmx5IGZvciB0aGUgYmVuZWZpdCBvZiBsb2dnaW5nL2RlYnVnZ2luZyBpc3N1ZXMuCiAgc2V0VGltZW91dCgoKSA9PiB7CiAgICBwcm9jZXNzLmV4aXQoMCk7CiAgfSwgNTAwMCk7Cn0KCmxldCBkZWJ1Z2dlclBhdXNlOwoKaWYgKG9wdGlvbnMuY2FwdHVyZVN0YWNrVHJhY2UpIHsKICBsb2coJ0Nvbm5lY3RpbmcgdG8gZGVidWdnZXInKTsKCiAgY29uc3Qgc2Vzc2lvbiA9IG5ldyBTZXNzaW9uKCkgOwogIHNlc3Npb24uY29ubmVjdFRvTWFpblRocmVhZCgpOwoKICBsb2coJ0Nvbm5lY3RlZCB0byBkZWJ1Z2dlcicpOwoKICAvLyBDb2xsZWN0IHNjcmlwdElkIC0+IHVybCBtYXAgc28gd2UgY2FuIGxvb2sgdXAgdGhlIGZpbGVuYW1lcyBsYXRlcgogIGNvbnN0IHNjcmlwdHMgPSBuZXcgTWFwKCk7CgogIHNlc3Npb24ub24oJ0RlYnVnZ2VyLnNjcmlwdFBhcnNlZCcsIGV2ZW50ID0+IHsKICAgIHNjcmlwdHMuc2V0KGV2ZW50LnBhcmFtcy5zY3JpcHRJZCwgZXZlbnQucGFyYW1zLnVybCk7CiAgfSk7CgogIHNlc3Npb24ub24oJ0RlYnVnZ2VyLnBhdXNlZCcsIGV2ZW50ID0+IHsKICAgIGlmIChldmVudC5wYXJhbXMucmVhc29uICE9PSAnb3RoZXInKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB0cnkgewogICAgICBsb2coJ0RlYnVnZ2VyIHBhdXNlZCcpOwoKICAgICAgLy8gY29weSB0aGUgZnJhbWVzCiAgICAgIGNvbnN0IGNhbGxGcmFtZXMgPSBbLi4uZXZlbnQucGFyYW1zLmNhbGxGcmFtZXNdOwoKICAgICAgY29uc3QgZ2V0TW9kdWxlTmFtZSA9IG9wdGlvbnMuYXBwUm9vdFBhdGggPyBjcmVhdGVHZXRNb2R1bGVGcm9tRmlsZW5hbWUob3B0aW9ucy5hcHBSb290UGF0aCkgOiAoKSA9PiB1bmRlZmluZWQ7CiAgICAgIGNvbnN0IHN0YWNrRnJhbWVzID0gY2FsbEZyYW1lcy5tYXAoZnJhbWUgPT4KICAgICAgICBjYWxsRnJhbWVUb1N0YWNrRnJhbWUoZnJhbWUsIHNjcmlwdHMuZ2V0KGZyYW1lLmxvY2F0aW9uLnNjcmlwdElkKSwgZ2V0TW9kdWxlTmFtZSksCiAgICAgICk7CgogICAgICAvLyBFdmFsdWF0ZSBhIHNjcmlwdCBpbiB0aGUgY3VycmVudGx5IHBhdXNlZCBjb250ZXh0CiAgICAgIHNlc3Npb24ucG9zdCgKICAgICAgICAnUnVudGltZS5ldmFsdWF0ZScsCiAgICAgICAgewogICAgICAgICAgLy8gR3JhYiB0aGUgdHJhY2UgY29udGV4dCBmcm9tIHRoZSBjdXJyZW50IHNjb3BlCiAgICAgICAgICBleHByZXNzaW9uOiAnZ2xvYmFsLl9fU0VOVFJZX0dFVF9TQ09QRVNfXygpOycsCiAgICAgICAgICAvLyBEb24ndCByZS10cmlnZ2VyIHRoZSBkZWJ1Z2dlciBpZiB0aGlzIGNhdXNlcyBhbiBlcnJvcgogICAgICAgICAgc2lsZW50OiB0cnVlLAogICAgICAgICAgLy8gU2VyaWFsaXplIHRoZSByZXN1bHQgdG8ganNvbiBvdGhlcndpc2Ugb25seSBwcmltaXRpdmVzIGFyZSBzdXBwb3J0ZWQKICAgICAgICAgIHJldHVybkJ5VmFsdWU6IHRydWUsCiAgICAgICAgfSwKICAgICAgICAoZXJyLCBwYXJhbSkgPT4gewogICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICBsb2coYEVycm9yIGV4ZWN1dGluZyBzY3JpcHQ6ICcke2Vyci5tZXNzYWdlfSdgKTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBzY29wZXMgPSBwYXJhbSAmJiBwYXJhbS5yZXN1bHQgPyAocGFyYW0ucmVzdWx0LnZhbHVlICkgOiB1bmRlZmluZWQ7CgogICAgICAgICAgc2Vzc2lvbi5wb3N0KCdEZWJ1Z2dlci5yZXN1bWUnKTsKICAgICAgICAgIHNlc3Npb24ucG9zdCgnRGVidWdnZXIuZGlzYWJsZScpOwoKICAgICAgICAgIHNlbmRBbnJFdmVudChzdGFja0ZyYW1lcywgc2NvcGVzKS50aGVuKG51bGwsICgpID0+IHsKICAgICAgICAgICAgbG9nKCdTZW5kaW5nIEFOUiBldmVudCBmYWlsZWQuJyk7CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICApOwogICAgfSBjYXRjaCAoZSkgewogICAgICBzZXNzaW9uLnBvc3QoJ0RlYnVnZ2VyLnJlc3VtZScpOwogICAgICBzZXNzaW9uLnBvc3QoJ0RlYnVnZ2VyLmRpc2FibGUnKTsKICAgICAgdGhyb3cgZTsKICAgIH0KICB9KTsKCiAgZGVidWdnZXJQYXVzZSA9ICgpID0+IHsKICAgIHRyeSB7CiAgICAgIHNlc3Npb24ucG9zdCgnRGVidWdnZXIuZW5hYmxlJywgKCkgPT4gewogICAgICAgIHNlc3Npb24ucG9zdCgnRGVidWdnZXIucGF1c2UnKTsKICAgICAgfSk7CiAgICB9IGNhdGNoIChfKSB7CiAgICAgIC8vCiAgICB9CiAgfTsKfQoKZnVuY3Rpb24gY3JlYXRlSHJUaW1lcigpIHsKICAvLyBUT0RPICh2OCk6IFdlIGNhbiB1c2UgcHJvY2Vzcy5ocnRpbWUuYmlnaW50KCkgYWZ0ZXIgd2UgZHJvcCBub2RlIHY4CiAgbGV0IGxhc3RQb2xsID0gcHJvY2Vzcy5ocnRpbWUoKTsKCiAgcmV0dXJuIHsKICAgIGdldFRpbWVNczogKCkgPT4gewogICAgICBjb25zdCBbc2Vjb25kcywgbmFub1NlY29uZHNdID0gcHJvY2Vzcy5ocnRpbWUobGFzdFBvbGwpOwogICAgICByZXR1cm4gTWF0aC5mbG9vcihzZWNvbmRzICogMWUzICsgbmFub1NlY29uZHMgLyAxZTYpOwogICAgfSwKICAgIHJlc2V0OiAoKSA9PiB7CiAgICAgIGxhc3RQb2xsID0gcHJvY2Vzcy5ocnRpbWUoKTsKICAgIH0sCiAgfTsKfQoKZnVuY3Rpb24gd2F0Y2hkb2dUaW1lb3V0KCkgewogIGxvZygnV2F0Y2hkb2cgdGltZW91dCcpOwoKICBpZiAoZGVidWdnZXJQYXVzZSkgewogICAgbG9nKCdQYXVzaW5nIGRlYnVnZ2VyIHRvIGNhcHR1cmUgc3RhY2sgdHJhY2UnKTsKICAgIGRlYnVnZ2VyUGF1c2UoKTsKICB9IGVsc2UgewogICAgbG9nKCdDYXB0dXJpbmcgZXZlbnQgd2l0aG91dCBhIHN0YWNrIHRyYWNlJyk7CiAgICBzZW5kQW5yRXZlbnQoKS50aGVuKG51bGwsICgpID0+IHsKICAgICAgbG9nKCdTZW5kaW5nIEFOUiBldmVudCBmYWlsZWQgb24gd2F0Y2hkb2cgdGltZW91dC4nKTsKICAgIH0pOwogIH0KfQoKY29uc3QgeyBwb2xsIH0gPSB3YXRjaGRvZ1RpbWVyKGNyZWF0ZUhyVGltZXIsIG9wdGlvbnMucG9sbEludGVydmFsLCBvcHRpb25zLmFuclRocmVzaG9sZCwgd2F0Y2hkb2dUaW1lb3V0KTsKCl9vcHRpb25hbENoYWluKFtwYXJlbnRQb3J0LCAnb3B0aW9uYWxBY2Nlc3MnLCBfNiA9PiBfNi5vbiwgJ2NhbGwnLCBfNyA9PiBfNygnbWVzc2FnZScsIChtc2cpID0+IHsKICBpZiAobXNnLnNlc3Npb24pIHsKICAgIHNlc3Npb24gPSBtYWtlU2Vzc2lvbihtc2cuc2Vzc2lvbik7CiAgfQoKICBwb2xsKCk7Cn0pXSk7",yy=50,Gy=5e3;function To(e,...t){L.log(`[ANR] ${e}`,...t)}function By(){return ve}function Ay(){const e=Ta().getScopeData();return us(e,At().getScopeData()),us(e,Se().getScopeData()),e.attachments=[],e.eventProcessors=[],e}function vy(){return Gt(module,"worker_threads")}async function Wy(e){let t={message:"ANR"};const n={};for(const r of e.getEventProcessors()){if(t===null)break;t=await r(t,n)}return j([t,"optionalAccess",r=>r.contexts])||{}}const Td="Anr",Vy=(e={})=>{if(Zn.major<16||Zn.major===16&&Zn.minor<17)throw new Error("ANR detection requires Node 16.17.0 or later");let t,n;const r=By();return r.__SENTRY_GET_SCOPES__=Ay,{name:Td,setupOnce(){},startWorker:()=>{t||n&&(t=Ry(n,e))},stopWorker:()=>{t&&t.then(s=>{s(),t=void 0})},setup(s){n=s,setImmediate(()=>this.startWorker())}}},Ud=Vy,Ed=nt(Td,Ud);async function Ry(e,t){const n=e.getDsn();if(!n)return()=>{};const r=await Wy(e);ml([r,"access",m=>m.app,"optionalAccess",m=>delete m.app_memory]),ml([r,"access",m=>m.device,"optionalAccess",m=>delete m.free_memory]);const s=e.getOptions(),a=e.getSdkMetadata()||{};a.sdk&&(a.sdk.integrations=s.integrations.map(m=>m.name));const c={debug:L.isEnabled(),dsn:n,environment:s.environment||"production",release:s.release,dist:s.dist,sdkMetadata:a,appRootPath:t.appRootPath,pollInterval:t.pollInterval||yy,anrThreshold:t.anrThreshold||Gy,captureStackTrace:!!t.captureStackTrace,staticTags:t.staticTags||{},contexts:r};if(c.captureStackTrace){const m=require("inspector");m.url()||m.open(0)}const{Worker:u}=vy(),d=new u(new pn.URL(`data:application/javascript;base64,${Zy}`),{workerData:c});process.on("exit",()=>{d.terminate()});const h=setInterval(()=>{try{const m=Se().getSession(),y=m?{...m,toJSON:void 0}:void 0;d.postMessage({session:y})}catch{}},c.pollInterval);return h.unref(),d.on("message",m=>{m==="session-ended"&&(To("ANR event sent from ANR worker. Clearing session in this thread."),Se().setSession(void 0))}),d.once("error",m=>{clearInterval(h),To("ANR worker error",m)}),d.once("exit",m=>{clearInterval(h),To("ANR worker exit",m)}),d.unref(),()=>{d.terminate(),clearInterval(h)}}function Yy(e){const t=Ze();return new Ed(e).setup(t),Promise.resolve()}function xd(e={}){return function({path:t,type:n,next:r,rawInput:s}){const a=j([Ze,"call",h=>h(),"optionalAccess",h=>h.getOptions,"call",h=>h()]),c=Se().getTransaction();if(c){c.updateName(`trpc/${t}`),c.setAttribute(fn,"route"),c.op="rpc.server";const h={procedure_type:n};(e.attachRpcInput!==void 0?e.attachRpcInput:j([a,"optionalAccess",m=>m.sendDefaultPii]))&&(h.input=Kt(s)),c.setContext("trpc",h)}function u(h){h.ok||mn(h.error,{mechanism:{handled:!1,data:{function:"trpcMiddleware"}}})}let d;try{d=r()}catch(h){throw mn(h,{mechanism:{handled:!1,data:{function:"trpcMiddleware"}}}),h}return Bt(d)?Promise.resolve(d).then(h=>{u(h)},h=>{mn(h,{mechanism:{handled:!1,data:{function:"trpcMiddleware"}}})}):u(d),d}}function Xy(e,t){return ui(e,{include:t})}function Hy(e,t,n={}){return Na(e,t,{include:n})}function Sy(){return function(t,n,r){const s=j([Ze,"call",m=>m(),"optionalAccess",m=>m.getOptions,"call",m=>m()]);if(!s||s.instrumenter!=="sentry"||j([t,"access",m=>m.method,"optionalAccess",m=>m.toUpperCase,"call",m=>m()])==="OPTIONS"||j([t,"access",m=>m.method,"optionalAccess",m=>m.toUpperCase,"call",m=>m()])==="HEAD")return r();const a=t.headers&&dr(t.headers["sentry-trace"])?t.headers["sentry-trace"]:void 0,c=j([t,"access",m=>m.headers,"optionalAccess",m=>m.baggage]);if(!Ar(s))return r();const[u,d]=Cr(t,{path:!0,method:!0}),h=ja({sentryTrace:a,baggage:c},m=>za({name:u,op:"http.server",origin:"auto.http.node.tracingHandler",...m,data:{[fn]:d},metadata:{...m.metadata,request:t}},{request:ui(t)}));Se().setSpan(h),n.__sentry_transaction=h,n.once("finish",()=>{setImmediate(()=>{Fb(h,t),xn(h,n.statusCode),h.end()})}),r()}}function Ny(e={}){let t;if("include"in e)t={include:e.include};else{const{ip:n,request:r,transaction:s,user:a}=e;(n||r||s||a)&&(t={include:Je({ip:n,request:r,transaction:s,user:a})})}return t}function wy(e){const t=Ny(e),n=Ze();if(n&&is(n)){n.initSessionFlusher();const r=Se();r.getSession()&&r.setSession()}return function(s,a,c){if(e&&e.flushTimeout&&e.flushTimeout>0){const u=a.end;a.end=function(d,h,m){zu(e.flushTimeout).then(()=>{u.call(this,d,h,m)}).then(null,y=>{yn&&L.error(y),u.call(this,d,h,m)})}}Br(()=>{const u=Se();u.setSDKProcessingMetadata({request:s,requestDataOptionsFromExpressHandler:t});const d=Ze();is(d)&&u.setRequestSession({status:"ok"}),a.once("finish",()=>{const h=Ze();is(h)&&setImmediate(()=>{h&&h._captureRequestSession&&h._captureRequestSession()})}),c()})}}function Ky(e){const t=e.status||e.statusCode||e.status_code||e.output&&e.output.statusCode;return t?parseInt(t,10):500}function _y(e){return Ky(e)>=500}function Fy(e){return function(n,r,s,a){if((e&&e.shouldHandleError||_y)(n)){mi(u=>{u.setSDKProcessingMetadata({request:r});const d=s.__sentry_transaction;d&&!vr()&&u.setSpan(d);const h=Ze();if(h&&is(h)&&h._sessionFlusher!==void 0){const v=u.getRequestSession();v&&v.status!==void 0&&(v.status="crashed")}const m=mn(n,{mechanism:{type:"middleware",handled:!1}});s.sentry=m,a(n)});return}a(n)}}const ky=xd,Jy=Object.freeze(Object.defineProperty({__proto__:null,errorHandler:Fy,extractRequestData:Xy,parseRequest:Hy,requestHandler:wy,tracingHandler:Sy,trpcMiddleware:ky},Symbol.toStringTag,{value:"Module"}));function zl(e){return e&&e.statusCode!==void 0}function zy(e){return e&&e.error!==void 0}function Ty(e){mn(e,{mechanism:{type:"hapi",handled:!1,data:{function:"hapiErrorPlugin"}}})}const Ld={name:"SentryHapiErrorPlugin",version:mr,register:async function(e){e.events.on("request",(n,r)=>{const s=fr();zy(r)&&Ty(r.error),s&&(s.setStatus("internal_error"),s.end())})}},Uy={name:"SentryHapiTracingPlugin",version:mr,register:async function(e){const t=e;t.ext("onPreHandler",(n,r)=>{const s=ja({sentryTrace:n.headers["sentry-trace"]||void 0,baggage:n.headers.baggage||void 0},a=>za({...a,op:"hapi.request",name:n.route.path,description:`${n.route.method} ${n.path}`}));return Se().setSpan(s),r.continue}),t.ext("onPreResponse",(n,r)=>{const s=fr();if(n.response&&zl(n.response)&&s){const a=n.response;a.header("sentry-trace",pi(s));const c=wa(Bn(s));c&&a.header("baggage",c)}return r.continue}),t.ext("onPostHandler",(n,r)=>{const s=fr();return s&&(n.response&&zl(n.response)&&xn(s,n.response.statusCode),s.end()),r.continue})}},Qd="Hapi",Ey=(e={})=>{const t=e.server;return{name:Qd,setupOnce(){t&&at(t,"start",n=>async function(){return await this.register(Uy),await this.register(Ld),n.apply(this)})}}},jd=Ey,xy=nt(Qd,jd),Ly=Object.freeze(Object.defineProperty({__proto__:null,Anr:Ed,Console:lZ,Context:IZ,ContextLines:RZ,Hapi:xy,Http:An,LocalVariables:OZ,Modules:qZ,OnUncaughtException:ny,OnUnhandledRejection:sy,RequestData:ef,Spotlight:ly,Undici:tt},Symbol.toStringTag,{value:"Module"})),Qy=Object.freeze(Object.defineProperty({__proto__:null,Apollo:Ts,Express:Ks,GraphQL:zs,Mongo:ks,Mysql:Fs,Postgres:_s,Prisma:Js},Symbol.toStringTag,{value:"Module"})),jy=[["january","1"],["february","2"],["march","3"],["april","4"],["may","5"],["june","6"],["july","7"],["august","8"],["september","9"],["october","10"],["november","11"],["december","12"],["jan","1"],["feb","2"],["mar","3"],["apr","4"],["may","5"],["jun","6"],["jul","7"],["aug","8"],["sep","9"],["oct","10"],["nov","11"],["dec","12"],["sunday","0"],["monday","1"],["tuesday","2"],["wednesday","3"],["thursday","4"],["friday","5"],["saturday","6"],["sun","0"],["mon","1"],["tue","2"],["wed","3"],["thu","4"],["fri","5"],["sat","6"]];function hs(e){return jy.reduce((t,[n,r])=>t.replace(new RegExp(n,"gi"),r),e)}const Tl="Automatic instrumentation of CronJob only supports crontab string";function Oy(e,t){let n=!1;return new Proxy(e,{construct(r,s){const[a,c,u,d,h,...m]=s;if(typeof a!="string")throw new Error(Tl);if(n)throw new Error(`A job named '${t}' has already been scheduled`);n=!0;const y=hs(a);function v(_,F){return Ii(t,()=>c(_,F),{schedule:{type:"crontab",value:y},timezone:h||void 0})}return new r(a,v,u,d,h,...m)},get(r,s){return s==="from"?a=>{const{cronTime:c,onTick:u,timeZone:d}=a;if(typeof c!="string")throw new Error(Tl);if(n)throw new Error(`A job named '${t}' has already been scheduled`);n=!0;const h=hs(c);return a.onTick=(m,y)=>Ii(t,()=>u(m,y),{schedule:{type:"crontab",value:h},timezone:d||void 0}),r.from(a)}:r[s]}})}function My(e){return new Proxy(e,{get(t,n){return n==="schedule"&&t.schedule?new Proxy(t.schedule,{apply(r,s,a){const[c,,u]=a;if(!j([u,"optionalAccess",d=>d.name]))throw new Error('Missing "name" for scheduled job. A name is required for Sentry check-in monitoring.');return Ii(u.name,()=>r.apply(s,a),{schedule:{type:"crontab",value:hs(c)},timezone:j([u,"optionalAccess",d=>d.timezone])})}}):t[n]}})}function Py(e){return new Proxy(e,{get(t,n){return n==="scheduleJob"?new Proxy(t.scheduleJob,{apply(r,s,a){const[c,u]=a;if(typeof c!="string"||typeof u!="string")throw new Error("Automatic instrumentation of 'node-schedule' requires the first parameter of 'scheduleJob' to be a job name string and the second parameter to be a crontab string");return Ii(c,()=>r.apply(s,a),{schedule:{type:"crontab",value:hs(u)}})}}):t[n]}})}const Dy=oc(),$y={...Sf,...Ly,...Qy},qy={instrumentCron:Oy,instrumentNodeCron:My,instrumentNodeSchedule:Py},eG=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_USER_INCLUDES:Vu,Handlers:Jy,Http:An,Hub:Ys,Integrations:$y,NodeClient:bd,SDK_VERSION:mr,SEMANTIC_ATTRIBUTE_SENTRY_OP:ii,SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN:cr,SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE:Jn,SEMANTIC_ATTRIBUTE_SENTRY_SOURCE:fn,Scope:kt,Undici:tt,addBreadcrumb:di,addEventProcessor:wm,addGlobalEventProcessor:_u,addIntegration:ym,addRequestDataToEvent:Na,anrIntegration:Ud,autoDiscoverNodePerformanceMonitoringIntegrations:Of,captureCheckIn:na,captureEvent:Bp,captureException:mn,captureMessage:Gp,captureSession:_p,close:Np,configureScope:Ap,consoleIntegration:qa,contextLinesIntegration:tc,continueTrace:ja,createGetModuleFromFilename:oc,createTransport:sa,cron:qy,deepReadDirSync:fy,defaultIntegrations:_d,defaultStackParser:zd,enableAnrDetection:Yy,endSession:Rs,extractRequestData:ui,extractTraceparentData:xp,flush:zu,functionToStringIntegration:Da,getActiveSpan:vr,getActiveTransaction:fr,getClient:Ze,getCurrentHub:Ve,getCurrentScope:Se,getDefaultIntegrations:Fd,getGlobalScope:Ta,getHubFromCarrier:Dt,getIsolationScope:At,getModuleFromFilename:Dy,getSentryRelease:Jd,getSpanStatusFromHttpCode:xa,hapiErrorPlugin:Ld,hapiIntegration:jd,httpIntegration:vd,inboundFiltersIntegration:Pa,init:kd,isInitialized:Kp,lastEventId:wp,linkedErrorsIntegration:$a,localVariablesIntegration:Xd,makeMain:ra,makeNodeTransport:md,metrics:Hf,modulesIntegration:nc,nativeNodeFetchintegration:Kd,nodeContextIntegration:ec,onUncaughtExceptionIntegration:rc,onUnhandledRejectionIntegration:ic,parameterize:Dm,requestDataIntegration:Ma,runWithAsyncContext:Br,setContext:vp,setCurrentClient:ld,setExtra:Vp,setExtras:Wp,setHttpStatus:xn,setMeasurement:cm,setTag:Yp,setTags:Rp,setUser:Xp,spanStatusfromHttpCode:Qp,spotlightIntegration:sc,startActiveSpan:Mp,startInactiveSpan:Dp,startSession:Tu,startSpan:Qa,startSpanManual:Pp,startTransaction:za,trace:Op,trpcMiddleware:xd,withActiveSpan:Sp,withIsolationScope:Hp,withMonitor:Ii,withScope:mi},Symbol.toStringTag,{value:"Module"}));function tG(e,t){let n=0;for(let r=e.length-1;r>=0;r--){const s=e[r];s==="."?e.splice(r,1):s===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}const nG=/^(\S+:\\|\/?)([\s\S]*?)((?:\.{1,2}|[^/\\]+?|)(\.[^./\\]*|))(?:[/\\]*)$/;function rG(e){const t=e.length>1024?`<truncated>${e.slice(-1024)}`:e,n=nG.exec(t);return n?n.slice(1):[]}function Ul(...e){let t="",n=!1;for(let r=e.length-1;r>=-1&&!n;r--){const s=r>=0?e[r]:"/";s&&(t=`${s}/${t}`,n=s.charAt(0)==="/")}return t=tG(t.split("/").filter(r=>!!r),!n).join("/"),(n?"/":"")+t||"."}function El(e){let t=0;for(;t<e.length&&e[t]==="";t++);let n=e.length-1;for(;n>=0&&e[n]==="";n--);return t>n?[]:e.slice(t,n-t+1)}function iG(e,t){e=Ul(e).slice(1),t=Ul(t).slice(1);const n=El(e.split("/")),r=El(t.split("/")),s=Math.min(n.length,r.length);let a=s;for(let u=0;u<s;u++)if(n[u]!==r[u]){a=u;break}let c=[];for(let u=a;u<n.length;u++)c.push("..");return c=c.concat(r.slice(a)),c.join("/")}function sG(e,t){let n=rG(e)[2];return t&&n.slice(t.length*-1)===t&&(n=n.slice(0,n.length-t.length)),n}function oG(e,t){return Object.assign(function(...r){return t(...r)},{id:e})}const Od="RewriteFrames",aG=(e={})=>{const t=e.root,n=e.prefix||"app:///",r=e.iteratee||(c=>{if(!c.filename)return c;const u=/^[a-zA-Z]:\\/.test(c.filename)||c.filename.includes("\\")&&!c.filename.includes("/"),d=/^\//.test(c.filename);if(u||d){const h=u?c.filename.replace(/^[a-zA-Z]:/,"").replace(/\\/g,"/"):c.filename,m=t?iG(t,h):sG(h);c.filename=`${n}${m}`}return c});function s(c){try{return{...c,exception:{...c.exception,values:c.exception.values.map(u=>({...u,...u.stacktrace&&{stacktrace:a(u.stacktrace)}}))}}}catch{return c}}function a(c){return{...c,frames:c&&c.frames&&c.frames.map(u=>r(u))}}return{name:Od,setupOnce(){},processEvent(c){let u=c;return c.exception&&Array.isArray(c.exception.values)&&(u=s(u)),u}}},Md=aG;oG(Od,Md);var Pd={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(We,function(){var n=function(i,o){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,I){l.__proto__=I}||function(l,I){for(var C in I)Object.prototype.hasOwnProperty.call(I,C)&&(l[C]=I[C])})(i,o)},r=function(){return(r=Object.assign||function(i){for(var o,l=1,I=arguments.length;l<I;l++)for(var C in o=arguments[l])Object.prototype.hasOwnProperty.call(o,C)&&(i[C]=o[C]);return i}).apply(this,arguments)};function s(i,o,l){if(l||arguments.length===2)for(var I,C=0,p=o.length;C<p;C++)!I&&C in o||((I=I||Array.prototype.slice.call(o,0,C))[C]=o[C]);return i.concat(I||Array.prototype.slice.call(o))}var a=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:We,c=Object.keys,u=Array.isArray;function d(i,o){return typeof o!="object"||c(o).forEach(function(l){i[l]=o[l]}),i}typeof Promise>"u"||a.Promise||(a.Promise=Promise);var h=Object.getPrototypeOf,m={}.hasOwnProperty;function y(i,o){return m.call(i,o)}function v(i,o){typeof o=="function"&&(o=o(h(i))),(typeof Reflect>"u"?c:Reflect.ownKeys)(o).forEach(function(l){F(i,l,o[l])})}var _=Object.defineProperty;function F(i,o,l,I){_(i,o,d(l&&y(l,"get")&&typeof l.get=="function"?{get:l.get,set:l.set,configurable:!0}:{value:l,configurable:!0,writable:!0},I))}function Q(i){return{from:function(o){return i.prototype=Object.create(o.prototype),F(i.prototype,"constructor",i),{extend:v.bind(null,i.prototype)}}}}var z=Object.getOwnPropertyDescriptor,te=[].slice;function ce(i,o,l){return te.call(i,o,l)}function re(i,o){return o(i)}function Ie(i){if(!i)throw new Error("Assertion Failed")}function fe(i){a.setImmediate?setImmediate(i):setTimeout(i,0)}function oe(i,o){if(typeof o=="string"&&y(i,o))return i[o];if(!o)return i;if(typeof o!="string"){for(var l=[],I=0,C=o.length;I<C;++I){var p=oe(i,o[I]);l.push(p)}return l}var Z=o.indexOf(".");if(Z!==-1){var B=i[o.substr(0,Z)];return B==null?void 0:oe(B,o.substr(Z+1))}}function ue(i,o,l){if(i&&o!==void 0&&!("isFrozen"in Object&&Object.isFrozen(i)))if(typeof o!="string"&&"length"in o){Ie(typeof l!="string"&&"length"in l);for(var I=0,C=o.length;I<C;++I)ue(i,o[I],l[I])}else{var p,Z,B=o.indexOf(".");B!==-1?(p=o.substr(0,B),(Z=o.substr(B+1))===""?l===void 0?u(i)&&!isNaN(parseInt(p))?i.splice(p,1):delete i[p]:i[p]=l:ue(B=!(B=i[p])||!y(i,p)?i[p]={}:B,Z,l)):l===void 0?u(i)&&!isNaN(parseInt(o))?i.splice(o,1):delete i[o]:i[o]=l}}function Ke(i){var o,l={};for(o in i)y(i,o)&&(l[o]=i[o]);return l}var Ue=[].concat;function dt(i){return Ue.apply([],i)}var jt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(dt([8,16,32,64].map(function(i){return["Int","Uint","Float"].map(function(o){return o+i+"Array"})}))).filter(function(i){return a[i]}),It=new Set(jt.map(function(i){return a[i]})),Ee=null;function Ne(i){return Ee=new WeakMap,i=function o(l){if(!l||typeof l!="object")return l;var I=Ee.get(l);if(I)return I;if(u(l)){I=[],Ee.set(l,I);for(var C=0,p=l.length;C<p;++C)I.push(o(l[C]))}else if(It.has(l.constructor))I=l;else{var Z,B=h(l);for(Z in I=B===Object.prototype?{}:Object.create(B),Ee.set(l,I),l)y(l,Z)&&(I[Z]=o(l[Z]))}return I}(i),Ee=null,i}var rt={}.toString;function Pe(i){return rt.call(i).slice(8,-1)}var mt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ct=typeof mt=="symbol"?function(i){var o;return i!=null&&(o=i[mt])&&o.apply(i)}:function(){return null};function it(i,o){return o=i.indexOf(o),0<=o&&i.splice(o,1),0<=o}var Ae={};function De(i){var o,l,I,C;if(arguments.length===1){if(u(i))return i.slice();if(this===Ae&&typeof i=="string")return[i];if(C=ct(i)){for(l=[];!(I=C.next()).done;)l.push(I.value);return l}if(i==null)return[i];if(typeof(o=i.length)!="number")return[i];for(l=new Array(o);o--;)l[o]=i[o];return l}for(o=arguments.length,l=new Array(o);o--;)l[o]=arguments[o];return l}var en=typeof Symbol<"u"?function(i){return i[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Xn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ct=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Xn),Mn={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function vt(i,o){this.name=i,this.message=o}function tn(i,o){return i+". Errors: "+Object.keys(o).map(function(l){return o[l].toString()}).filter(function(l,I,C){return C.indexOf(l)===I}).join(`
`)}function $e(i,o,l,I){this.failures=o,this.failedKeys=I,this.successCount=l,this.message=tn(i,o)}function ht(i,o){this.name="BulkError",this.failures=Object.keys(o).map(function(l){return o[l]}),this.failuresByPos=o,this.message=tn(i,this.failures)}Q(vt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),Q($e).from(vt),Q(ht).from(vt);var nn=Ct.reduce(function(i,o){return i[o]=o+"Error",i},{}),Et=vt,ie=Ct.reduce(function(i,o){var l=o+"Error";function I(C,p){this.name=l,C?typeof C=="string"?(this.message="".concat(C).concat(p?`
 `+p:""),this.inner=p||null):typeof C=="object"&&(this.message="".concat(C.name," ").concat(C.message),this.inner=C):(this.message=Mn[o]||l,this.inner=null)}return Q(I).from(Et),i[o]=I,i},{});ie.Syntax=SyntaxError,ie.Type=TypeError,ie.Range=RangeError;var rn=Xn.reduce(function(i,o){return i[o+"Error"]=ie[o],i},{}),Wt=Ct.reduce(function(i,o){return["Syntax","Type","Range"].indexOf(o)===-1&&(i[o+"Error"]=ie[o]),i},{});function Ge(){}function st(i){return i}function Vn(i,o){return i==null||i===st?o:function(l){return o(i(l))}}function ot(i,o){return function(){i.apply(this,arguments),o.apply(this,arguments)}}function lt(i,o){return i===Ge?o:function(){var l=i.apply(this,arguments);l!==void 0&&(arguments[0]=l);var I=this.onsuccess,C=this.onerror;this.onsuccess=null,this.onerror=null;var p=o.apply(this,arguments);return I&&(this.onsuccess=this.onsuccess?ot(I,this.onsuccess):I),C&&(this.onerror=this.onerror?ot(C,this.onerror):C),p!==void 0?p:l}}function ft(i,o){return i===Ge?o:function(){i.apply(this,arguments);var l=this.onsuccess,I=this.onerror;this.onsuccess=this.onerror=null,o.apply(this,arguments),l&&(this.onsuccess=this.onsuccess?ot(l,this.onsuccess):l),I&&(this.onerror=this.onerror?ot(I,this.onerror):I)}}function xt(i,o){return i===Ge?o:function(l){var I=i.apply(this,arguments);d(l,I);var C=this.onsuccess,p=this.onerror;return this.onsuccess=null,this.onerror=null,l=o.apply(this,arguments),C&&(this.onsuccess=this.onsuccess?ot(C,this.onsuccess):C),p&&(this.onerror=this.onerror?ot(p,this.onerror):p),I===void 0?l===void 0?void 0:l:d(I,l)}}function Rn(i,o){return i===Ge?o:function(){return o.apply(this,arguments)!==!1&&i.apply(this,arguments)}}function sn(i,o){return i===Ge?o:function(){var l=i.apply(this,arguments);if(l&&typeof l.then=="function"){for(var I=this,C=arguments.length,p=new Array(C);C--;)p[C]=arguments[C];return l.then(function(){return o.apply(I,p)})}return o.apply(this,arguments)}}Wt.ModifyError=$e,Wt.DexieError=vt,Wt.BulkError=ht;var qe=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Fr(i){qe=i}var Zt={},Yn=100,jt=typeof Promise>"u"?[]:function(){var i=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[i,h(i),i];var o=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[o,h(o),i]}(),Xn=jt[0],Ct=jt[1],jt=jt[2],Ct=Ct&&Ct.then,le=Xn&&Xn.constructor,kr=!!jt,on=function(i,o){Sn.push([i,o]),Dn&&(queueMicrotask(to),Dn=!1)},Pn=!0,Dn=!0,Lt=[],Hn=[],Jr=st,Vt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ge,pgp:!1,env:{},finalize:Ge},se=Vt,Sn=[],Qt=0,$n=[];function q(i){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var o=this._PSD=se;if(typeof i!="function"){if(i!==Zt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Tr(this,this._value))}this._state=null,this._value=null,++o.ref,function l(I,C){try{C(function(p){if(I._state===null){if(p===I)throw new TypeError("A promise cannot be resolved with itself.");var Z=I._lib&&an();p&&typeof p.then=="function"?l(I,function(B,X){p instanceof q?p._then(B,X):p.then(B,X)}):(I._state=!0,I._value=p,Vi(I)),Z&&cn()}},Tr.bind(null,I))}catch(p){Tr(I,p)}}(this,i)}var zr={get:function(){var i=se,o=nr;function l(I,C){var p=this,Z=!i.global&&(i!==se||o!==nr),B=Z&&!Yt(),X=new q(function(R,N){Ur(p,new Wi(g(I,i,Z,B),g(C,i,Z,B),R,N,i))});return this._consoleTask&&(X._consoleTask=this._consoleTask),X}return l.prototype=Zt,l},set:function(i){F(this,"then",i&&i.prototype===Zt?zr:{get:function(){return i},set:zr.set})}};function Wi(i,o,l,I,C){this.onFulfilled=typeof i=="function"?i:null,this.onRejected=typeof o=="function"?o:null,this.resolve=l,this.reject=I,this.psd=C}function Tr(i,o){var l,I;Hn.push(o),i._state===null&&(l=i._lib&&an(),o=Jr(o),i._state=!1,i._value=o,I=i,Lt.some(function(C){return C._value===I._value})||Lt.push(I),Vi(i),l&&cn())}function Vi(i){var o=i._listeners;i._listeners=[];for(var l=0,I=o.length;l<I;++l)Ur(i,o[l]);var C=i._PSD;--C.ref||C.finalize(),Qt===0&&(++Qt,on(function(){--Qt==0&&Er()},[]))}function Ur(i,o){if(i._state!==null){var l=i._state?o.onFulfilled:o.onRejected;if(l===null)return(i._state?o.resolve:o.reject)(i._value);++o.psd.ref,++Qt,on(eo,[l,i,o])}else i._listeners.push(o)}function eo(i,o,l){try{var I,C=o._value;!o._state&&Hn.length&&(Hn=[]),I=qe&&o._consoleTask?o._consoleTask.run(function(){return i(C)}):i(C),o._state||Hn.indexOf(C)!==-1||function(p){for(var Z=Lt.length;Z;)if(Lt[--Z]._value===p._value)return Lt.splice(Z,1)}(o),l.resolve(I)}catch(p){l.reject(p)}finally{--Qt==0&&Er(),--l.psd.ref||l.psd.finalize()}}function to(){G(Vt,function(){an()&&cn()})}function an(){var i=Pn;return Dn=Pn=!1,i}function cn(){var i,o,l;do for(;0<Sn.length;)for(i=Sn,Sn=[],l=i.length,o=0;o<l;++o){var I=i[o];I[0].apply(null,I[1])}while(0<Sn.length);Dn=Pn=!0}function Er(){var i=Lt;Lt=[],i.forEach(function(I){I._PSD.onunhandled.call(null,I._value,I)});for(var o=$n.slice(0),l=o.length;l;)o[--l]()}function qn(i){return new q(Zt,!1,i)}function Ye(i,o){var l=se;return function(){var I=an(),C=se;try{return Xt(l,!0),i.apply(this,arguments)}catch(p){o&&o(p)}finally{Xt(C,!1),I&&cn()}}}v(q.prototype,{then:zr,_then:function(i,o){Ur(this,new Wi(null,null,i,o,se))},catch:function(i){if(arguments.length===1)return this.then(null,i);var o=i,l=arguments[1];return typeof o=="function"?this.then(null,function(I){return(I instanceof o?l:qn)(I)}):this.then(null,function(I){return(I&&I.name===o?l:qn)(I)})},finally:function(i){return this.then(function(o){return q.resolve(i()).then(function(){return o})},function(o){return q.resolve(i()).then(function(){return qn(o)})})},timeout:function(i,o){var l=this;return i<1/0?new q(function(I,C){var p=setTimeout(function(){return C(new ie.Timeout(o))},i);l.then(I,C).finally(clearTimeout.bind(null,p))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&F(q.prototype,Symbol.toStringTag,"Dexie.Promise"),Vt.env=Yi(),v(q,{all:function(){var i=De.apply(null,arguments).map(rr);return new q(function(o,l){i.length===0&&o([]);var I=i.length;i.forEach(function(C,p){return q.resolve(C).then(function(Z){i[p]=Z,--I||o(i)},l)})})},resolve:function(i){return i instanceof q?i:i&&typeof i.then=="function"?new q(function(o,l){i.then(o,l)}):new q(Zt,!0,i)},reject:qn,race:function(){var i=De.apply(null,arguments).map(rr);return new q(function(o,l){i.map(function(I){return q.resolve(I).then(o,l)})})},PSD:{get:function(){return se},set:function(i){return se=i}},totalEchoes:{get:function(){return nr}},newPSD:Rt,usePSD:G,scheduler:{get:function(){return on},set:function(i){on=i}},rejectionMapper:{get:function(){return Jr},set:function(i){Jr=i}},follow:function(i,o){return new q(function(l,I){return Rt(function(C,p){var Z=se;Z.unhandleds=[],Z.onunhandled=p,Z.finalize=ot(function(){var B,X=this;B=function(){X.unhandleds.length===0?C():p(X.unhandleds[0])},$n.push(function R(){B(),$n.splice($n.indexOf(R),1)}),++Qt,on(function(){--Qt==0&&Er()},[])},Z.finalize),i()},o,l,I)})}}),le&&(le.allSettled&&F(q,"allSettled",function(){var i=De.apply(null,arguments).map(rr);return new q(function(o){i.length===0&&o([]);var l=i.length,I=new Array(l);i.forEach(function(C,p){return q.resolve(C).then(function(Z){return I[p]={status:"fulfilled",value:Z}},function(Z){return I[p]={status:"rejected",reason:Z}}).then(function(){return--l||o(I)})})})}),le.any&&typeof AggregateError<"u"&&F(q,"any",function(){var i=De.apply(null,arguments).map(rr);return new q(function(o,l){i.length===0&&l(new AggregateError([]));var I=i.length,C=new Array(I);i.forEach(function(p,Z){return q.resolve(p).then(function(B){return o(B)},function(B){C[Z]=B,--I||l(new AggregateError(C))})})})}));var _e={awaits:0,echoes:0,id:0},no=0,er=[],tr=0,nr=0,Ri=0;function Rt(i,o,l,I){var C=se,p=Object.create(C);return p.parent=C,p.ref=0,p.global=!1,p.id=++Ri,Vt.env,p.env=kr?{Promise:q,PromiseProp:{value:q,configurable:!0,writable:!0},all:q.all,race:q.race,allSettled:q.allSettled,any:q.any,resolve:q.resolve,reject:q.reject}:{},o&&d(p,o),++C.ref,p.finalize=function(){--this.parent.ref||this.parent.finalize()},I=G(p,i,l,I),p.ref===0&&p.finalize(),I}function ln(){return _e.id||(_e.id=++no),++_e.awaits,_e.echoes+=Yn,_e.id}function Yt(){return!!_e.awaits&&(--_e.awaits==0&&(_e.id=0),_e.echoes=_e.awaits*Yn,!0)}function rr(i){return _e.echoes&&i&&i.constructor===le?(ln(),i.then(function(o){return Yt(),o},function(o){return Yt(),f(o)})):i}function ro(){var i=er[er.length-1];er.pop(),Xt(i,!1)}function Xt(i,o){var l,I=se;(o?!_e.echoes||tr++&&i===se:!tr||--tr&&i===se)||queueMicrotask(o?(function(C){++nr,_e.echoes&&--_e.echoes!=0||(_e.echoes=_e.awaits=_e.id=0),er.push(se),Xt(C,!0)}).bind(null,i):ro),i!==se&&(se=i,I===Vt&&(Vt.env=Yi()),kr&&(l=Vt.env.Promise,o=i.env,(I.global||i.global)&&(Object.defineProperty(a,"Promise",o.PromiseProp),l.all=o.all,l.race=o.race,l.resolve=o.resolve,l.reject=o.reject,o.allSettled&&(l.allSettled=o.allSettled),o.any&&(l.any=o.any))))}function Yi(){var i=a.Promise;return kr?{Promise:i,PromiseProp:Object.getOwnPropertyDescriptor(a,"Promise"),all:i.all,race:i.race,allSettled:i.allSettled,any:i.any,resolve:i.resolve,reject:i.reject}:{}}function G(i,o,l,I,C){var p=se;try{return Xt(i,!0),o(l,I,C)}finally{Xt(p,!1)}}function g(i,o,l,I){return typeof i!="function"?i:function(){var C=se;l&&ln(),Xt(o,!0);try{return i.apply(this,arguments)}finally{Xt(C,!1),I&&queueMicrotask(Yt)}}}function b(i){Promise===le&&_e.echoes===0?tr===0?i():enqueueNativeMicroTask(i):setTimeout(i,0)}(""+Ct).indexOf("[native code]")===-1&&(ln=Yt=Ge);var f=q.reject,V=String.fromCharCode(65535),A="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",O="String expected.",E=[],ae="__dbnames",ne="readonly",he="readwrite";function Fe(i,o){return i?o?function(){return i.apply(this,arguments)&&o.apply(this,arguments)}:i:o}var io={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function gn(i){return typeof i!="string"||/\./.test(i)?function(o){return o}:function(o){return o[i]===void 0&&i in o&&delete(o=Ne(o))[i],o}}function Nc(){throw ie.Type()}function Be(i,o){try{var l=wc(i),I=wc(o);if(l!==I)return l==="Array"?1:I==="Array"?-1:l==="binary"?1:I==="binary"?-1:l==="string"?1:I==="string"?-1:l==="Date"?1:I!=="Date"?NaN:-1;switch(l){case"number":case"Date":case"string":return o<i?1:i<o?-1:0;case"binary":return function(C,p){for(var Z=C.length,B=p.length,X=Z<B?Z:B,R=0;R<X;++R)if(C[R]!==p[R])return C[R]<p[R]?-1:1;return Z===B?0:Z<B?-1:1}(Kc(i),Kc(o));case"Array":return function(C,p){for(var Z=C.length,B=p.length,X=Z<B?Z:B,R=0;R<X;++R){var N=Be(C[R],p[R]);if(N!==0)return N}return Z===B?0:Z<B?-1:1}(i,o)}}catch{}return NaN}function wc(i){var o=typeof i;return o!="object"?o:ArrayBuffer.isView(i)?"binary":(i=Pe(i),i==="ArrayBuffer"?"binary":i)}function Kc(i){return i instanceof Uint8Array?i:ArrayBuffer.isView(i)?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i)}var _c=(Xe.prototype._trans=function(i,o,l){var I=this._tx||se.trans,C=this.name,p=qe&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(i==="readonly"?"read":"write"," ").concat(this.name));function Z(R,N,W){if(!W.schema[C])throw new ie.NotFound("Table "+C+" not part of transaction");return o(W.idbtrans,W)}var B=an();try{var X=I&&I.db._novip===this.db._novip?I===se.trans?I._promise(i,Z,l):Rt(function(){return I._promise(i,Z,l)},{trans:I,transless:se.transless||se}):function R(N,W,w,Y){if(N.idbdb&&(N._state.openComplete||se.letThrough||N._vip)){var S=N._createTransaction(W,w,N._dbSchema);try{S.create(),N._state.PR1398_maxLoop=3}catch(K){return K.name===nn.InvalidState&&N.isOpen()&&0<--N._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),N.close({disableAutoOpen:!1}),N.open().then(function(){return R(N,W,w,Y)})):f(K)}return S._promise(W,function(K,H){return Rt(function(){return se.trans=S,Y(K,H,S)})}).then(function(K){if(W==="readwrite")try{S.idbtrans.commit()}catch{}return W==="readonly"?K:S._completion.then(function(){return K})})}if(N._state.openComplete)return f(new ie.DatabaseClosed(N._state.dbOpenError));if(!N._state.isBeingOpened){if(!N._state.autoOpen)return f(new ie.DatabaseClosed);N.open().catch(Ge)}return N._state.dbReadyPromise.then(function(){return R(N,W,w,Y)})}(this.db,i,[this.name],Z);return p&&(X._consoleTask=p,X=X.catch(function(R){return console.trace(R),f(R)})),X}finally{B&&cn()}},Xe.prototype.get=function(i,o){var l=this;return i&&i.constructor===Object?this.where(i).first(o):i==null?f(new ie.Type("Invalid argument to Table.get()")):this._trans("readonly",function(I){return l.core.get({trans:I,key:i}).then(function(C){return l.hook.reading.fire(C)})}).then(o)},Xe.prototype.where=function(i){if(typeof i=="string")return new this.db.WhereClause(this,i);if(u(i))return new this.db.WhereClause(this,"[".concat(i.join("+"),"]"));var o=c(i);if(o.length===1)return this.where(o[0]).equals(i[o[0]]);var l=this.schema.indexes.concat(this.schema.primKey).filter(function(X){if(X.compound&&o.every(function(N){return 0<=X.keyPath.indexOf(N)})){for(var R=0;R<o.length;++R)if(o.indexOf(X.keyPath[R])===-1)return!1;return!0}return!1}).sort(function(X,R){return X.keyPath.length-R.keyPath.length})[0];if(l&&this.db._maxKey!==V){var Z=l.keyPath.slice(0,o.length);return this.where(Z).equals(Z.map(function(R){return i[R]}))}!l&&qe&&console.warn("The query ".concat(JSON.stringify(i)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(o.join("+"),"]"));var I=this.schema.idxByName,C=this.db._deps.indexedDB;function p(X,R){return C.cmp(X,R)===0}var B=o.reduce(function(w,R){var N=w[0],W=w[1],w=I[R],Y=i[R];return[N||w,N||!w?Fe(W,w&&w.multi?function(S){return S=oe(S,R),u(S)&&S.some(function(K){return p(Y,K)})}:function(S){return p(Y,oe(S,R))}):W]},[null,null]),Z=B[0],B=B[1];return Z?this.where(Z.name).equals(i[Z.keyPath]).filter(B):l?this.filter(B):this.where(o).equals("")},Xe.prototype.filter=function(i){return this.toCollection().and(i)},Xe.prototype.count=function(i){return this.toCollection().count(i)},Xe.prototype.offset=function(i){return this.toCollection().offset(i)},Xe.prototype.limit=function(i){return this.toCollection().limit(i)},Xe.prototype.each=function(i){return this.toCollection().each(i)},Xe.prototype.toArray=function(i){return this.toCollection().toArray(i)},Xe.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Xe.prototype.orderBy=function(i){return new this.db.Collection(new this.db.WhereClause(this,u(i)?"[".concat(i.join("+"),"]"):i))},Xe.prototype.reverse=function(){return this.toCollection().reverse()},Xe.prototype.mapToClass=function(i){var o,l=this.db,I=this.name;function C(){return o!==null&&o.apply(this,arguments)||this}(this.schema.mappedClass=i).prototype instanceof Nc&&(function(X,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");function N(){this.constructor=X}n(X,R),X.prototype=R===null?Object.create(R):(N.prototype=R.prototype,new N)}(C,o=i),Object.defineProperty(C.prototype,"db",{get:function(){return l},enumerable:!1,configurable:!0}),C.prototype.table=function(){return I},i=C);for(var p=new Set,Z=i.prototype;Z;Z=h(Z))Object.getOwnPropertyNames(Z).forEach(function(X){return p.add(X)});function B(X){if(!X)return X;var R,N=Object.create(i.prototype);for(R in X)if(!p.has(R))try{N[R]=X[R]}catch{}return N}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=B,this.hook("reading",B),i},Xe.prototype.defineClass=function(){return this.mapToClass(function(i){d(this,i)})},Xe.prototype.add=function(i,o){var l=this,I=this.schema.primKey,C=I.auto,p=I.keyPath,Z=i;return p&&C&&(Z=gn(p)(i)),this._trans("readwrite",function(B){return l.core.mutate({trans:B,type:"add",keys:o!=null?[o]:null,values:[Z]})}).then(function(B){return B.numFailures?q.reject(B.failures[0]):B.lastResult}).then(function(B){if(p)try{ue(i,p,B)}catch{}return B})},Xe.prototype.update=function(i,o){return typeof i!="object"||u(i)?this.where(":id").equals(i).modify(o):(i=oe(i,this.schema.primKey.keyPath),i===void 0?f(new ie.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(i).modify(o))},Xe.prototype.put=function(i,o){var l=this,I=this.schema.primKey,C=I.auto,p=I.keyPath,Z=i;return p&&C&&(Z=gn(p)(i)),this._trans("readwrite",function(B){return l.core.mutate({trans:B,type:"put",values:[Z],keys:o!=null?[o]:null})}).then(function(B){return B.numFailures?q.reject(B.failures[0]):B.lastResult}).then(function(B){if(p)try{ue(i,p,B)}catch{}return B})},Xe.prototype.delete=function(i){var o=this;return this._trans("readwrite",function(l){return o.core.mutate({trans:l,type:"delete",keys:[i]})}).then(function(l){return l.numFailures?q.reject(l.failures[0]):void 0})},Xe.prototype.clear=function(){var i=this;return this._trans("readwrite",function(o){return i.core.mutate({trans:o,type:"deleteRange",range:io})}).then(function(o){return o.numFailures?q.reject(o.failures[0]):void 0})},Xe.prototype.bulkGet=function(i){var o=this;return this._trans("readonly",function(l){return o.core.getMany({keys:i,trans:l}).then(function(I){return I.map(function(C){return o.hook.reading.fire(C)})})})},Xe.prototype.bulkAdd=function(i,o,l){var I=this,C=Array.isArray(o)?o:void 0,p=(l=l||(C?void 0:o))?l.allKeys:void 0;return this._trans("readwrite",function(Z){var R=I.schema.primKey,B=R.auto,R=R.keyPath;if(R&&C)throw new ie.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(C&&C.length!==i.length)throw new ie.InvalidArgument("Arguments objects and keys must have the same length");var X=i.length,R=R&&B?i.map(gn(R)):i;return I.core.mutate({trans:Z,type:"add",keys:C,values:R,wantResults:p}).then(function(S){var W=S.numFailures,w=S.results,Y=S.lastResult,S=S.failures;if(W===0)return p?w:Y;throw new ht("".concat(I.name,".bulkAdd(): ").concat(W," of ").concat(X," operations failed"),S)})})},Xe.prototype.bulkPut=function(i,o,l){var I=this,C=Array.isArray(o)?o:void 0,p=(l=l||(C?void 0:o))?l.allKeys:void 0;return this._trans("readwrite",function(Z){var R=I.schema.primKey,B=R.auto,R=R.keyPath;if(R&&C)throw new ie.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(C&&C.length!==i.length)throw new ie.InvalidArgument("Arguments objects and keys must have the same length");var X=i.length,R=R&&B?i.map(gn(R)):i;return I.core.mutate({trans:Z,type:"put",keys:C,values:R,wantResults:p}).then(function(S){var W=S.numFailures,w=S.results,Y=S.lastResult,S=S.failures;if(W===0)return p?w:Y;throw new ht("".concat(I.name,".bulkPut(): ").concat(W," of ").concat(X," operations failed"),S)})})},Xe.prototype.bulkUpdate=function(i){var o=this,l=this.core,I=i.map(function(Z){return Z.key}),C=i.map(function(Z){return Z.changes}),p=[];return this._trans("readwrite",function(Z){return l.getMany({trans:Z,keys:I,cache:"clone"}).then(function(B){var X=[],R=[];i.forEach(function(W,w){var Y=W.key,S=W.changes,K=B[w];if(K){for(var H=0,k=Object.keys(S);H<k.length;H++){var J=k[H],T=S[J];if(J===o.schema.primKey.keyPath){if(Be(T,Y)!==0)throw new ie.Constraint("Cannot update primary key in bulkUpdate()")}else ue(K,J,T)}p.push(w),X.push(Y),R.push(K)}});var N=X.length;return l.mutate({trans:Z,type:"put",keys:X,values:R,updates:{keys:I,changeSpecs:C}}).then(function(W){var w=W.numFailures,Y=W.failures;if(w===0)return N;for(var S=0,K=Object.keys(Y);S<K.length;S++){var H,k=K[S],J=p[Number(k)];J!=null&&(H=Y[k],delete Y[k],Y[J]=H)}throw new ht("".concat(o.name,".bulkUpdate(): ").concat(w," of ").concat(N," operations failed"),Y)})})})},Xe.prototype.bulkDelete=function(i){var o=this,l=i.length;return this._trans("readwrite",function(I){return o.core.mutate({trans:I,type:"delete",keys:i})}).then(function(Z){var C=Z.numFailures,p=Z.lastResult,Z=Z.failures;if(C===0)return p;throw new ht("".concat(o.name,".bulkDelete(): ").concat(C," of ").concat(l," operations failed"),Z)})},Xe);function Xe(){}function xr(i){function o(Z,B){if(B){for(var X=arguments.length,R=new Array(X-1);--X;)R[X-1]=arguments[X];return l[Z].subscribe.apply(null,R),i}if(typeof Z=="string")return l[Z]}var l={};o.addEventType=p;for(var I=1,C=arguments.length;I<C;++I)p(arguments[I]);return o;function p(Z,B,X){if(typeof Z!="object"){var R;B=B||Rn;var N={subscribers:[],fire:X=X||Ge,subscribe:function(W){N.subscribers.indexOf(W)===-1&&(N.subscribers.push(W),N.fire=B(N.fire,W))},unsubscribe:function(W){N.subscribers=N.subscribers.filter(function(w){return w!==W}),N.fire=N.subscribers.reduce(B,X)}};return l[Z]=o[Z]=N}c(R=Z).forEach(function(W){var w=R[W];if(u(w))p(W,R[W][0],R[W][1]);else{if(w!=="asap")throw new ie.InvalidArgument("Invalid event config");var Y=p(W,st,function(){for(var S=arguments.length,K=new Array(S);S--;)K[S]=arguments[S];Y.subscribers.forEach(function(H){fe(function(){H.apply(null,K)})})})}})}}function Lr(i,o){return Q(o).from({prototype:i}),o}function ir(i,o){return!(i.filter||i.algorithm||i.or)&&(o?i.justLimit:!i.replayFilter)}function so(i,o){i.filter=Fe(i.filter,o)}function oo(i,o,l){var I=i.replayFilter;i.replayFilter=I?function(){return Fe(I(),o())}:o,i.justLimit=l&&!I}function Xi(i,o){if(i.isPrimKey)return o.primaryKey;var l=o.getIndexByKeyPath(i.index);if(!l)throw new ie.Schema("KeyPath "+i.index+" on object store "+o.name+" is not indexed");return l}function Fc(i,o,l){var I=Xi(i,o.schema);return o.openCursor({trans:l,values:!i.keysOnly,reverse:i.dir==="prev",unique:!!i.unique,query:{index:I,range:i.range}})}function Hi(i,o,l,I){var C=i.replayFilter?Fe(i.filter,i.replayFilter()):i.filter;if(i.or){var p={},Z=function(B,X,R){var N,W;C&&!C(X,R,function(w){return X.stop(w)},function(w){return X.fail(w)})||((W=""+(N=X.primaryKey))=="[object ArrayBuffer]"&&(W=""+new Uint8Array(N)),y(p,W)||(p[W]=!0,o(B,X,R)))};return Promise.all([i.or._iterate(Z,l),kc(Fc(i,I,l),i.algorithm,Z,!i.keysOnly&&i.valueMapper)])}return kc(Fc(i,I,l),Fe(i.algorithm,C),o,!i.keysOnly&&i.valueMapper)}function kc(i,o,l,I){var C=Ye(I?function(p,Z,B){return l(I(p),Z,B)}:l);return i.then(function(p){if(p)return p.start(function(){var Z=function(){return p.continue()};o&&!o(p,function(B){return Z=B},function(B){p.stop(B),Z=Ge},function(B){p.fail(B),Z=Ge})||C(p.value,p,function(B){return Z=B}),Z()})})}var jt=Symbol(),ao=(Jc.prototype.execute=function(i){var o=(o=this.replacePrefix)===null||o===void 0?void 0:o[0];return o&&typeof i=="string"&&i.startsWith(o)?this.replacePrefix[1]+i.substring(o.length):i},Jc);function Jc(i){Object.assign(this,i)}var oh=(ye.prototype._read=function(i,o){var l=this._ctx;return l.error?l.table._trans(null,f.bind(null,l.error)):l.table._trans("readonly",i).then(o)},ye.prototype._write=function(i){var o=this._ctx;return o.error?o.table._trans(null,f.bind(null,o.error)):o.table._trans("readwrite",i,"locked")},ye.prototype._addAlgorithm=function(i){var o=this._ctx;o.algorithm=Fe(o.algorithm,i)},ye.prototype._iterate=function(i,o){return Hi(this._ctx,i,o,this._ctx.table.core)},ye.prototype.clone=function(i){var o=Object.create(this.constructor.prototype),l=Object.create(this._ctx);return i&&d(l,i),o._ctx=l,o},ye.prototype.raw=function(){return this._ctx.valueMapper=null,this},ye.prototype.each=function(i){var o=this._ctx;return this._read(function(l){return Hi(o,i,l,o.table.core)})},ye.prototype.count=function(i){var o=this;return this._read(function(l){var I=o._ctx,C=I.table.core;if(ir(I,!0))return C.count({trans:l,query:{index:Xi(I,C.schema),range:I.range}}).then(function(Z){return Math.min(Z,I.limit)});var p=0;return Hi(I,function(){return++p,!1},l,C).then(function(){return p})}).then(i)},ye.prototype.sortBy=function(i,o){var l=i.split(".").reverse(),I=l[0],C=l.length-1;function p(X,R){return R?p(X[l[R]],R-1):X[I]}var Z=this._ctx.dir==="next"?1:-1;function B(X,R){return X=p(X,C),R=p(R,C),X<R?-Z:R<X?Z:0}return this.toArray(function(X){return X.sort(B)}).then(o)},ye.prototype.toArray=function(i){var o=this;return this._read(function(l){var I=o._ctx;if(I.dir==="next"&&ir(I,!0)&&0<I.limit){var C=I.valueMapper,p=Xi(I,I.table.core.schema);return I.table.core.query({trans:l,limit:I.limit,values:!0,query:{index:p,range:I.range}}).then(function(B){return B=B.result,C?B.map(C):B})}var Z=[];return Hi(I,function(B){return Z.push(B)},l,I.table.core).then(function(){return Z})},i)},ye.prototype.offset=function(i){var o=this._ctx;return i<=0||(o.offset+=i,ir(o)?oo(o,function(){var l=i;return function(I,C){return l===0||(l===1?--l:C(function(){I.advance(l),l=0}),!1)}}):oo(o,function(){var l=i;return function(){return--l<0}})),this},ye.prototype.limit=function(i){return this._ctx.limit=Math.min(this._ctx.limit,i),oo(this._ctx,function(){var o=i;return function(l,I,C){return--o<=0&&I(C),0<=o}},!0),this},ye.prototype.until=function(i,o){return so(this._ctx,function(l,I,C){return!i(l.value)||(I(C),o)}),this},ye.prototype.first=function(i){return this.limit(1).toArray(function(o){return o[0]}).then(i)},ye.prototype.last=function(i){return this.reverse().first(i)},ye.prototype.filter=function(i){var o;return so(this._ctx,function(l){return i(l.value)}),(o=this._ctx).isMatch=Fe(o.isMatch,i),this},ye.prototype.and=function(i){return this.filter(i)},ye.prototype.or=function(i){return new this.db.WhereClause(this._ctx.table,i,this)},ye.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ye.prototype.desc=function(){return this.reverse()},ye.prototype.eachKey=function(i){var o=this._ctx;return o.keysOnly=!o.isMatch,this.each(function(l,I){i(I.key,I)})},ye.prototype.eachUniqueKey=function(i){return this._ctx.unique="unique",this.eachKey(i)},ye.prototype.eachPrimaryKey=function(i){var o=this._ctx;return o.keysOnly=!o.isMatch,this.each(function(l,I){i(I.primaryKey,I)})},ye.prototype.keys=function(i){var o=this._ctx;o.keysOnly=!o.isMatch;var l=[];return this.each(function(I,C){l.push(C.key)}).then(function(){return l}).then(i)},ye.prototype.primaryKeys=function(i){var o=this._ctx;if(o.dir==="next"&&ir(o,!0)&&0<o.limit)return this._read(function(I){var C=Xi(o,o.table.core.schema);return o.table.core.query({trans:I,values:!1,limit:o.limit,query:{index:C,range:o.range}})}).then(function(I){return I.result}).then(i);o.keysOnly=!o.isMatch;var l=[];return this.each(function(I,C){l.push(C.primaryKey)}).then(function(){return l}).then(i)},ye.prototype.uniqueKeys=function(i){return this._ctx.unique="unique",this.keys(i)},ye.prototype.firstKey=function(i){return this.limit(1).keys(function(o){return o[0]}).then(i)},ye.prototype.lastKey=function(i){return this.reverse().firstKey(i)},ye.prototype.distinct=function(){var i=this._ctx,i=i.index&&i.table.schema.idxByName[i.index];if(!i||!i.multi)return this;var o={};return so(this._ctx,function(C){var I=C.primaryKey.toString(),C=y(o,I);return o[I]=!0,!C}),this},ye.prototype.modify=function(i){var o=this,l=this._ctx;return this._write(function(I){var C,p,Z;Z=typeof i=="function"?i:(C=c(i),p=C.length,function(H){for(var k=!1,J=0;J<p;++J){var T=C[J],U=i[T],x=oe(H,T);U instanceof ao?(ue(H,T,U.execute(x)),k=!0):x!==U&&(ue(H,T,U),k=!0)}return k});function B(H,T){var J=T.failures,T=T.numFailures;S+=H-T;for(var U=0,x=c(J);U<x.length;U++){var D=x[U];Y.push(J[D])}}var X=l.table.core,R=X.schema.primaryKey,N=R.outbound,W=R.extractKey,w=o.db._options.modifyChunkSize||200,Y=[],S=0,K=[];return o.clone().primaryKeys().then(function(H){function k(J){var T=Math.min(w,H.length-J);return X.getMany({trans:I,keys:H.slice(J,J+T),cache:"immutable"}).then(function(U){for(var x=[],D=[],M=N?[]:null,P=[],$=0;$<T;++$){var ee=U[$],de={value:Ne(ee),primKey:H[J+$]};Z.call(de,de.value,de)!==!1&&(de.value==null?P.push(H[J+$]):N||Be(W(ee),W(de.value))===0?(D.push(de.value),N&&M.push(H[J+$])):(P.push(H[J+$]),x.push(de.value)))}var Ce=ir(l)&&l.limit===1/0&&(typeof i!="function"||i===co)&&{index:l.index,range:l.range};return Promise.resolve(0<x.length&&X.mutate({trans:I,type:"add",values:x}).then(function(me){for(var be in me.failures)P.splice(parseInt(be),1);B(x.length,me)})).then(function(){return(0<D.length||Ce&&typeof i=="object")&&X.mutate({trans:I,type:"put",keys:M,values:D,criteria:Ce,changeSpec:typeof i!="function"&&i}).then(function(me){return B(D.length,me)})}).then(function(){return(0<P.length||Ce&&i===co)&&X.mutate({trans:I,type:"delete",keys:P,criteria:Ce}).then(function(me){return B(P.length,me)})}).then(function(){return H.length>J+T&&k(J+w)})})}return k(0).then(function(){if(0<Y.length)throw new $e("Error modifying one or more objects",Y,S,K);return H.length})})})},ye.prototype.delete=function(){var i=this._ctx,o=i.range;return ir(i)&&(i.isPrimKey||o.type===3)?this._write(function(l){var I=i.table.core.schema.primaryKey,C=o;return i.table.core.count({trans:l,query:{index:I,range:C}}).then(function(p){return i.table.core.mutate({trans:l,type:"deleteRange",range:C}).then(function(Z){var B=Z.failures;if(Z.lastResult,Z.results,Z=Z.numFailures,Z)throw new $e("Could not delete some values",Object.keys(B).map(function(X){return B[X]}),p-Z);return p-Z})})}):this.modify(co)},ye);function ye(){}var co=function(i,o){return o.value=null};function ah(i,o){return i<o?-1:i===o?0:1}function ch(i,o){return o<i?-1:i===o?0:1}function gt(i,o,l){return i=i instanceof Tc?new i.Collection(i):i,i._ctx.error=new(l||TypeError)(o),i}function sr(i){return new i.Collection(i,function(){return zc("")}).limit(0)}function Si(i,o,l,I){var C,p,Z,B,X,R,N,W=l.length;if(!l.every(function(S){return typeof S=="string"}))return gt(i,O);function w(S){C=S==="next"?function(H){return H.toUpperCase()}:function(H){return H.toLowerCase()},p=S==="next"?function(H){return H.toLowerCase()}:function(H){return H.toUpperCase()},Z=S==="next"?ah:ch;var K=l.map(function(H){return{lower:p(H),upper:C(H)}}).sort(function(H,k){return Z(H.lower,k.lower)});B=K.map(function(H){return H.upper}),X=K.map(function(H){return H.lower}),N=(R=S)==="next"?"":I}w("next"),i=new i.Collection(i,function(){return un(B[0],X[W-1]+I)}),i._ondirectionchange=function(S){w(S)};var Y=0;return i._addAlgorithm(function(S,K,H){var k=S.key;if(typeof k!="string")return!1;var J=p(k);if(o(J,X,Y))return!0;for(var T=null,U=Y;U<W;++U){var x=function(D,M,P,$,ee,de){for(var Ce=Math.min(D.length,$.length),me=-1,be=0;be<Ce;++be){var yt=M[be];if(yt!==$[be])return ee(D[be],P[be])<0?D.substr(0,be)+P[be]+P.substr(be+1):ee(D[be],$[be])<0?D.substr(0,be)+$[be]+P.substr(be+1):0<=me?D.substr(0,me)+M[me]+P.substr(me+1):null;ee(D[be],yt)<0&&(me=be)}return Ce<$.length&&de==="next"?D+P.substr(D.length):Ce<D.length&&de==="prev"?D.substr(0,P.length):me<0?null:D.substr(0,me)+$[me]+P.substr(me+1)}(k,J,B[U],X[U],Z,R);x===null&&T===null?Y=U+1:(T===null||0<Z(T,x))&&(T=x)}return K(T!==null?function(){S.continue(T+N)}:H),!1}),i}function un(i,o,l,I){return{type:2,lower:i,upper:o,lowerOpen:l,upperOpen:I}}function zc(i){return{type:1,lower:i,upper:i}}var Tc=(Object.defineProperty(Te.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Te.prototype.between=function(i,o,l,I){l=l!==!1,I=I===!0;try{return 0<this._cmp(i,o)||this._cmp(i,o)===0&&(l||I)&&(!l||!I)?sr(this):new this.Collection(this,function(){return un(i,o,!l,!I)})}catch{return gt(this,A)}},Te.prototype.equals=function(i){return i==null?gt(this,A):new this.Collection(this,function(){return zc(i)})},Te.prototype.above=function(i){return i==null?gt(this,A):new this.Collection(this,function(){return un(i,void 0,!0)})},Te.prototype.aboveOrEqual=function(i){return i==null?gt(this,A):new this.Collection(this,function(){return un(i,void 0,!1)})},Te.prototype.below=function(i){return i==null?gt(this,A):new this.Collection(this,function(){return un(void 0,i,!1,!0)})},Te.prototype.belowOrEqual=function(i){return i==null?gt(this,A):new this.Collection(this,function(){return un(void 0,i)})},Te.prototype.startsWith=function(i){return typeof i!="string"?gt(this,O):this.between(i,i+V,!0,!0)},Te.prototype.startsWithIgnoreCase=function(i){return i===""?this.startsWith(i):Si(this,function(o,l){return o.indexOf(l[0])===0},[i],V)},Te.prototype.equalsIgnoreCase=function(i){return Si(this,function(o,l){return o===l[0]},[i],"")},Te.prototype.anyOfIgnoreCase=function(){var i=De.apply(Ae,arguments);return i.length===0?sr(this):Si(this,function(o,l){return l.indexOf(o)!==-1},i,"")},Te.prototype.startsWithAnyOfIgnoreCase=function(){var i=De.apply(Ae,arguments);return i.length===0?sr(this):Si(this,function(o,l){return l.some(function(I){return o.indexOf(I)===0})},i,V)},Te.prototype.anyOf=function(){var i=this,o=De.apply(Ae,arguments),l=this._cmp;try{o.sort(l)}catch{return gt(this,A)}if(o.length===0)return sr(this);var I=new this.Collection(this,function(){return un(o[0],o[o.length-1])});I._ondirectionchange=function(p){l=p==="next"?i._ascending:i._descending,o.sort(l)};var C=0;return I._addAlgorithm(function(p,Z,B){for(var X=p.key;0<l(X,o[C]);)if(++C===o.length)return Z(B),!1;return l(X,o[C])===0||(Z(function(){p.continue(o[C])}),!1)}),I},Te.prototype.notEqual=function(i){return this.inAnyRange([[-1/0,i],[i,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Te.prototype.noneOf=function(){var i=De.apply(Ae,arguments);if(i.length===0)return new this.Collection(this);try{i.sort(this._ascending)}catch{return gt(this,A)}var o=i.reduce(function(l,I){return l?l.concat([[l[l.length-1][1],I]]):[[-1/0,I]]},null);return o.push([i[i.length-1],this.db._maxKey]),this.inAnyRange(o,{includeLowers:!1,includeUppers:!1})},Te.prototype.inAnyRange=function(k,o){var l=this,I=this._cmp,C=this._ascending,p=this._descending,Z=this._min,B=this._max;if(k.length===0)return sr(this);if(!k.every(function(J){return J[0]!==void 0&&J[1]!==void 0&&C(J[0],J[1])<=0}))return gt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ie.InvalidArgument);var X=!o||o.includeLowers!==!1,R=o&&o.includeUppers===!0,N,W=C;function w(J,T){return W(J[0],T[0])}try{(N=k.reduce(function(J,T){for(var U=0,x=J.length;U<x;++U){var D=J[U];if(I(T[0],D[1])<0&&0<I(T[1],D[0])){D[0]=Z(D[0],T[0]),D[1]=B(D[1],T[1]);break}}return U===x&&J.push(T),J},[])).sort(w)}catch{return gt(this,A)}var Y=0,S=R?function(J){return 0<C(J,N[Y][1])}:function(J){return 0<=C(J,N[Y][1])},K=X?function(J){return 0<p(J,N[Y][0])}:function(J){return 0<=p(J,N[Y][0])},H=S,k=new this.Collection(this,function(){return un(N[0][0],N[N.length-1][1],!X,!R)});return k._ondirectionchange=function(J){W=J==="next"?(H=S,C):(H=K,p),N.sort(w)},k._addAlgorithm(function(J,T,U){for(var x,D=J.key;H(D);)if(++Y===N.length)return T(U),!1;return!S(x=D)&&!K(x)||(l._cmp(D,N[Y][1])===0||l._cmp(D,N[Y][0])===0||T(function(){W===C?J.continue(N[Y][0]):J.continue(N[Y][1])}),!1)}),k},Te.prototype.startsWithAnyOf=function(){var i=De.apply(Ae,arguments);return i.every(function(o){return typeof o=="string"})?i.length===0?sr(this):this.inAnyRange(i.map(function(o){return[o,o+V]})):gt(this,"startsWithAnyOf() only works with strings")},Te);function Te(){}function Ht(i){return Ye(function(o){return Qr(o),i(o.target.error),!1})}function Qr(i){i.stopPropagation&&i.stopPropagation(),i.preventDefault&&i.preventDefault()}var jr="storagemutated",lo="x-storagemutated-1",dn=xr(null,jr),lh=(St.prototype._lock=function(){return Ie(!se.global),++this._reculock,this._reculock!==1||se.global||(se.lockOwnerFor=this),this},St.prototype._unlock=function(){if(Ie(!se.global),--this._reculock==0)for(se.global||(se.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var i=this._blockedFuncs.shift();try{G(i[1],i[0])}catch{}}return this},St.prototype._locked=function(){return this._reculock&&se.lockOwnerFor!==this},St.prototype.create=function(i){var o=this;if(!this.mode)return this;var l=this.db.idbdb,I=this.db._state.dbOpenError;if(Ie(!this.idbtrans),!i&&!l)switch(I&&I.name){case"DatabaseClosedError":throw new ie.DatabaseClosed(I);case"MissingAPIError":throw new ie.MissingAPI(I.message,I);default:throw new ie.OpenFailed(I)}if(!this.active)throw new ie.TransactionInactive;return Ie(this._completion._state===null),(i=this.idbtrans=i||(this.db.core||l).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ye(function(C){Qr(C),o._reject(i.error)}),i.onabort=Ye(function(C){Qr(C),o.active&&o._reject(new ie.Abort(i.error)),o.active=!1,o.on("abort").fire(C)}),i.oncomplete=Ye(function(){o.active=!1,o._resolve(),"mutatedParts"in i&&dn.storagemutated.fire(i.mutatedParts)}),this},St.prototype._promise=function(i,o,l){var I=this;if(i==="readwrite"&&this.mode!=="readwrite")return f(new ie.ReadOnly("Transaction is readonly"));if(!this.active)return f(new ie.TransactionInactive);if(this._locked())return new q(function(p,Z){I._blockedFuncs.push([function(){I._promise(i,o,l).then(p,Z)},se])});if(l)return Rt(function(){var p=new q(function(Z,B){I._lock();var X=o(Z,B,I);X&&X.then&&X.then(Z,B)});return p.finally(function(){return I._unlock()}),p._lib=!0,p});var C=new q(function(p,Z){var B=o(p,Z,I);B&&B.then&&B.then(p,Z)});return C._lib=!0,C},St.prototype._root=function(){return this.parent?this.parent._root():this},St.prototype.waitFor=function(i){var o,l=this._root(),I=q.resolve(i);l._waitingFor?l._waitingFor=l._waitingFor.then(function(){return I}):(l._waitingFor=I,l._waitingQueue=[],o=l.idbtrans.objectStore(l.storeNames[0]),function p(){for(++l._spinCount;l._waitingQueue.length;)l._waitingQueue.shift()();l._waitingFor&&(o.get(-1/0).onsuccess=p)}());var C=l._waitingFor;return new q(function(p,Z){I.then(function(B){return l._waitingQueue.push(Ye(p.bind(null,B)))},function(B){return l._waitingQueue.push(Ye(Z.bind(null,B)))}).finally(function(){l._waitingFor===C&&(l._waitingFor=null)})})},St.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ie.Abort))},St.prototype.table=function(i){var o=this._memoizedTables||(this._memoizedTables={});if(y(o,i))return o[i];var l=this.schema[i];if(!l)throw new ie.NotFound("Table "+i+" not part of transaction");return l=new this.db.Table(i,l,this),l.core=this.db.core.table(i),o[i]=l},St);function St(){}function go(i,o,l,I,C,p,Z){return{name:i,keyPath:o,unique:l,multi:I,auto:C,compound:p,src:(l&&!Z?"&":"")+(I?"*":"")+(C?"++":"")+Uc(o)}}function Uc(i){return typeof i=="string"?i:i?"["+[].join.call(i,"+")+"]":""}function uo(i,o,l){return{name:i,primKey:o,indexes:l,mappedClass:null,idxByName:(I=function(C){return[C.name,C]},l.reduce(function(C,p,Z){return Z=I(p,Z),Z&&(C[Z[0]]=Z[1]),C},{}))};var I}var Or=function(i){try{return i.only([[]]),Or=function(){return[[]]},[[]]}catch{return Or=function(){return V},V}};function Io(i){return i==null?function(){}:typeof i=="string"?(o=i).split(".").length===1?function(l){return l[o]}:function(l){return oe(l,o)}:function(l){return oe(l,i)};var o}function Ec(i){return[].slice.call(i)}var gh=0;function Mr(i){return i==null?":id":typeof i=="string"?i:"[".concat(i.join("+"),"]")}function uh(i,o,X){function I(H){if(H.type===3)return null;if(H.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var Y=H.lower,S=H.upper,K=H.lowerOpen,H=H.upperOpen;return Y===void 0?S===void 0?null:o.upperBound(S,!!H):S===void 0?o.lowerBound(Y,!!K):o.bound(Y,S,!!K,!!H)}function C(w){var Y,S=w.name;return{name:S,schema:w,mutate:function(K){var H=K.trans,k=K.type,J=K.keys,T=K.values,U=K.range;return new Promise(function(x,D){x=Ye(x);var M=H.objectStore(S),P=M.keyPath==null,$=k==="put"||k==="add";if(!$&&k!=="delete"&&k!=="deleteRange")throw new Error("Invalid operation type: "+k);var ee,de=(J||T||{length:1}).length;if(J&&T&&J.length!==T.length)throw new Error("Given keys array must have same length as given values array.");if(de===0)return x({numFailures:0,failures:{},results:[],lastResult:void 0});function Ce(et){++yt,Qr(et)}var me=[],be=[],yt=0;if(k==="deleteRange"){if(U.type===4)return x({numFailures:yt,failures:be,results:[],lastResult:void 0});U.type===3?me.push(ee=M.clear()):me.push(ee=M.delete(I(U)))}else{var P=$?P?[T,J]:[T,null]:[J,null],pe=P[0],Le=P[1];if($)for(var Qe=0;Qe<de;++Qe)me.push(ee=Le&&Le[Qe]!==void 0?M[k](pe[Qe],Le[Qe]):M[k](pe[Qe])),ee.onerror=Ce;else for(Qe=0;Qe<de;++Qe)me.push(ee=M[k](pe[Qe])),ee.onerror=Ce}function Li(et){et=et.target.result,me.forEach(function(Kn,So){return Kn.error!=null&&(be[So]=Kn.error)}),x({numFailures:yt,failures:be,results:k==="delete"?J:me.map(function(Kn){return Kn.result}),lastResult:et})}ee.onerror=function(et){Ce(et),Li(et)},ee.onsuccess=Li})},getMany:function(K){var H=K.trans,k=K.keys;return new Promise(function(J,T){J=Ye(J);for(var U,x=H.objectStore(S),D=k.length,M=new Array(D),P=0,$=0,ee=function(me){me=me.target,M[me._pos]=me.result,++$===P&&J(M)},de=Ht(T),Ce=0;Ce<D;++Ce)k[Ce]!=null&&((U=x.get(k[Ce]))._pos=Ce,U.onsuccess=ee,U.onerror=de,++P);P===0&&J(M)})},get:function(K){var H=K.trans,k=K.key;return new Promise(function(J,T){J=Ye(J);var U=H.objectStore(S).get(k);U.onsuccess=function(x){return J(x.target.result)},U.onerror=Ht(T)})},query:(Y=R,function(K){return new Promise(function(H,k){H=Ye(H);var J,T,U,P=K.trans,x=K.values,D=K.limit,ee=K.query,M=D===1/0?void 0:D,$=ee.index,ee=ee.range,P=P.objectStore(S),$=$.isPrimaryKey?P:P.index($.name),ee=I(ee);if(D===0)return H({result:[]});Y?((M=x?$.getAll(ee,M):$.getAllKeys(ee,M)).onsuccess=function(de){return H({result:de.target.result})},M.onerror=Ht(k)):(J=0,T=!x&&"openKeyCursor"in $?$.openKeyCursor(ee):$.openCursor(ee),U=[],T.onsuccess=function(de){var Ce=T.result;return Ce?(U.push(x?Ce.value:Ce.primaryKey),++J===D?H({result:U}):void Ce.continue()):H({result:U})},T.onerror=Ht(k))})}),openCursor:function(K){var H=K.trans,k=K.values,J=K.query,T=K.reverse,U=K.unique;return new Promise(function(x,D){x=Ye(x);var $=J.index,M=J.range,P=H.objectStore(S),P=$.isPrimaryKey?P:P.index($.name),$=T?U?"prevunique":"prev":U?"nextunique":"next",ee=!k&&"openKeyCursor"in P?P.openKeyCursor(I(M),$):P.openCursor(I(M),$);ee.onerror=Ht(D),ee.onsuccess=Ye(function(de){var Ce,me,be,yt,pe=ee.result;pe?(pe.___id=++gh,pe.done=!1,Ce=pe.continue.bind(pe),me=(me=pe.continuePrimaryKey)&&me.bind(pe),be=pe.advance.bind(pe),yt=function(){throw new Error("Cursor not stopped")},pe.trans=H,pe.stop=pe.continue=pe.continuePrimaryKey=pe.advance=function(){throw new Error("Cursor not started")},pe.fail=Ye(D),pe.next=function(){var Le=this,Qe=1;return this.start(function(){return Qe--?Le.continue():Le.stop()}).then(function(){return Le})},pe.start=function(Le){function Qe(){if(ee.result)try{Le()}catch(et){pe.fail(et)}else pe.done=!0,pe.start=function(){throw new Error("Cursor behind last entry")},pe.stop()}var Li=new Promise(function(et,Kn){et=Ye(et),ee.onerror=Ht(Kn),pe.fail=Kn,pe.stop=function(So){pe.stop=pe.continue=pe.continuePrimaryKey=pe.advance=yt,et(So)}});return ee.onsuccess=Ye(function(et){ee.onsuccess=Qe,Qe()}),pe.continue=Ce,pe.continuePrimaryKey=me,pe.advance=be,Qe(),Li},x(pe)):x(null)},D)})},count:function(K){var H=K.query,k=K.trans,J=H.index,T=H.range;return new Promise(function(U,x){var D=k.objectStore(S),M=J.isPrimaryKey?D:D.index(J.name),D=I(T),M=D?M.count(D):M.count();M.onsuccess=Ye(function(P){return U(P.target.result)}),M.onerror=Ht(x)})}}}var p,Z,B,N=(Z=X,B=Ec((p=i).objectStoreNames),{schema:{name:p.name,tables:B.map(function(w){return Z.objectStore(w)}).map(function(w){var Y=w.keyPath,H=w.autoIncrement,S=u(Y),K={},H={name:w.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:Y==null,compound:S,keyPath:Y,autoIncrement:H,unique:!0,extractKey:Io(Y)},indexes:Ec(w.indexNames).map(function(k){return w.index(k)}).map(function(U){var J=U.name,T=U.unique,x=U.multiEntry,U=U.keyPath,x={name:J,compound:u(U),keyPath:U,unique:T,multiEntry:x,extractKey:Io(U)};return K[Mr(U)]=x}),getIndexByKeyPath:function(k){return K[Mr(k)]}};return K[":id"]=H.primaryKey,Y!=null&&(K[Mr(Y)]=H.primaryKey),H})},hasGetAll:0<B.length&&"getAll"in Z.objectStore(B[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),X=N.schema,R=N.hasGetAll,N=X.tables.map(C),W={};return N.forEach(function(w){return W[w.name]=w}),{stack:"dbcore",transaction:i.transaction.bind(i),table:function(w){if(!W[w])throw new Error("Table '".concat(w,"' not found"));return W[w]},MIN_KEY:-1/0,MAX_KEY:Or(o),schema:X}}function dh(i,o,l,I){var C=l.IDBKeyRange;return l.indexedDB,{dbcore:(I=uh(o,C,I),i.dbcore.reduce(function(p,Z){return Z=Z.create,r(r({},p),Z(p))},I))}}function Ni(i,I){var l=I.db,I=dh(i._middlewares,l,i._deps,I);i.core=I.dbcore,i.tables.forEach(function(C){var p=C.name;i.core.schema.tables.some(function(Z){return Z.name===p})&&(C.core=i.core.table(p),i[p]instanceof i.Table&&(i[p].core=C.core))})}function wi(i,o,l,I){l.forEach(function(C){var p=I[C];o.forEach(function(Z){var B=function X(R,N){return z(R,N)||(R=h(R))&&X(R,N)}(Z,C);(!B||"value"in B&&B.value===void 0)&&(Z===i.Transaction.prototype||Z instanceof i.Transaction?F(Z,C,{get:function(){return this.table(C)},set:function(X){_(this,C,{value:X,writable:!0,configurable:!0,enumerable:!0})}}):Z[C]=new i.Table(C,p))})})}function ho(i,o){o.forEach(function(l){for(var I in l)l[I]instanceof i.Table&&delete l[I]})}function Ih(i,o){return i._cfg.version-o._cfg.version}function hh(i,o,l,I){var C=i._dbSchema;l.objectStoreNames.contains("$meta")&&!C.$meta&&(C.$meta=uo("$meta",Lc("")[0],[]),i._storeNames.push("$meta"));var p=i._createTransaction("readwrite",i._storeNames,C);p.create(l),p._completion.catch(I);var Z=p._reject.bind(p),B=se.transless||se;Rt(function(){return se.trans=p,se.transless=B,o!==0?(Ni(i,l),R=o,((X=p).storeNames.includes("$meta")?X.table("$meta").get("version").then(function(N){return N??R}):q.resolve(R)).then(function(N){return w=N,Y=p,S=l,K=[],N=(W=i)._versions,H=W._dbSchema=_i(0,W.idbdb,S),(N=N.filter(function(k){return k._cfg.version>=w})).length!==0?(N.forEach(function(k){K.push(function(){var J=H,T=k._cfg.dbschema;Fi(W,J,S),Fi(W,T,S),H=W._dbSchema=T;var U=Co(J,T);U.add.forEach(function($){bo(S,$[0],$[1].primKey,$[1].indexes)}),U.change.forEach(function($){if($.recreate)throw new ie.Upgrade("Not yet support for changing primary key");var ee=S.objectStore($.name);$.add.forEach(function(de){return Ki(ee,de)}),$.change.forEach(function(de){ee.deleteIndex(de.name),Ki(ee,de)}),$.del.forEach(function(de){return ee.deleteIndex(de)})});var x=k._cfg.contentUpgrade;if(x&&k._cfg.version>w){Ni(W,S),Y._memoizedTables={};var D=Ke(T);U.del.forEach(function($){D[$]=J[$]}),ho(W,[W.Transaction.prototype]),wi(W,[W.Transaction.prototype],c(D),D),Y.schema=D;var M,P=en(x);return P&&ln(),U=q.follow(function(){var $;(M=x(Y))&&P&&($=Yt.bind(null,null),M.then($,$))}),M&&typeof M.then=="function"?q.resolve(M):U.then(function(){return M})}}),K.push(function(J){var T,U,x=k._cfg.dbschema;T=x,U=J,[].slice.call(U.db.objectStoreNames).forEach(function(D){return T[D]==null&&U.db.deleteObjectStore(D)}),ho(W,[W.Transaction.prototype]),wi(W,[W.Transaction.prototype],W._storeNames,W._dbSchema),Y.schema=W._dbSchema}),K.push(function(J){W.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(W.idbdb.version/10)===k._cfg.version?(W.idbdb.deleteObjectStore("$meta"),delete W._dbSchema.$meta,W._storeNames=W._storeNames.filter(function(T){return T!=="$meta"})):J.objectStore("$meta").put(k._cfg.version,"version"))})}),function k(){return K.length?q.resolve(K.shift()(Y.idbtrans)).then(k):q.resolve()}().then(function(){xc(H,S)})):q.resolve();var W,w,Y,S,K,H}).catch(Z)):(c(C).forEach(function(N){bo(l,N,C[N].primKey,C[N].indexes)}),Ni(i,l),void q.follow(function(){return i.on.populate.fire(p)}).catch(Z));var X,R})}function Ch(i,o){xc(i._dbSchema,o),o.db.version%10!=0||o.objectStoreNames.contains("$meta")||o.db.createObjectStore("$meta").add(Math.ceil(o.db.version/10-1),"version");var l=_i(0,i.idbdb,o);Fi(i,i._dbSchema,o);for(var I=0,C=Co(l,i._dbSchema).change;I<C.length;I++){var p=function(Z){if(Z.change.length||Z.recreate)return console.warn("Unable to patch indexes of table ".concat(Z.name," because it has changes on the type of index or primary key.")),{value:void 0};var B=o.objectStore(Z.name);Z.add.forEach(function(X){qe&&console.debug("Dexie upgrade patch: Creating missing index ".concat(Z.name,".").concat(X.src)),Ki(B,X)})}(C[I]);if(typeof p=="object")return p.value}}function Co(i,o){var l,I={del:[],add:[],change:[]};for(l in i)o[l]||I.del.push(l);for(l in o){var C=i[l],p=o[l];if(C){var Z={name:l,def:p,recreate:!1,del:[],add:[],change:[]};if(""+(C.primKey.keyPath||"")!=""+(p.primKey.keyPath||"")||C.primKey.auto!==p.primKey.auto)Z.recreate=!0,I.change.push(Z);else{var B=C.idxByName,X=p.idxByName,R=void 0;for(R in B)X[R]||Z.del.push(R);for(R in X){var N=B[R],W=X[R];N?N.src!==W.src&&Z.change.push(W):Z.add.push(W)}(0<Z.del.length||0<Z.add.length||0<Z.change.length)&&I.change.push(Z)}}else I.add.push([l,p])}return I}function bo(i,o,l,I){var C=i.db.createObjectStore(o,l.keyPath?{keyPath:l.keyPath,autoIncrement:l.auto}:{autoIncrement:l.auto});return I.forEach(function(p){return Ki(C,p)}),C}function xc(i,o){c(i).forEach(function(l){o.db.objectStoreNames.contains(l)||(qe&&console.debug("Dexie: Creating missing table",l),bo(o,l,i[l].primKey,i[l].indexes))})}function Ki(i,o){i.createIndex(o.name,o.keyPath,{unique:o.unique,multiEntry:o.multi})}function _i(i,o,l){var I={};return ce(o.objectStoreNames,0).forEach(function(C){for(var p=l.objectStore(C),Z=go(Uc(R=p.keyPath),R||"",!0,!1,!!p.autoIncrement,R&&typeof R!="string",!0),B=[],X=0;X<p.indexNames.length;++X){var N=p.index(p.indexNames[X]),R=N.keyPath,N=go(N.name,R,!!N.unique,!!N.multiEntry,!1,R&&typeof R!="string",!1);B.push(N)}I[C]=uo(C,Z,B)}),I}function Fi(i,o,l){for(var I=l.db.objectStoreNames,C=0;C<I.length;++C){var p=I[C],Z=l.objectStore(p);i._hasGetAll="getAll"in Z;for(var B=0;B<Z.indexNames.length;++B){var X=Z.indexNames[B],R=Z.index(X).keyPath,N=typeof R=="string"?R:"["+ce(R).join("+")+"]";!o[p]||(R=o[p].idxByName[N])&&(R.name=X,delete o[p].idxByName[N],o[p].idxByName[X]=R)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&a.WorkerGlobalScope&&a instanceof a.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(i._hasGetAll=!1)}function Lc(i){return i.split(",").map(function(o,l){var I=(o=o.trim()).replace(/([&*]|\+\+)/g,""),C=/^\[/.test(I)?I.match(/^\[(.*)\]$/)[1].split("+"):I;return go(I,C||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),u(C),l===0)})}var bh=(ki.prototype._parseStoresSpec=function(i,o){c(i).forEach(function(l){if(i[l]!==null){var I=Lc(i[l]),C=I.shift();if(C.unique=!0,C.multi)throw new ie.Schema("Primary key cannot be multi-valued");I.forEach(function(p){if(p.auto)throw new ie.Schema("Only primary key can be marked as autoIncrement (++)");if(!p.keyPath)throw new ie.Schema("Index must have a name and cannot be an empty string")}),o[l]=uo(l,C,I)}})},ki.prototype.stores=function(l){var o=this.db;this._cfg.storesSource=this._cfg.storesSource?d(this._cfg.storesSource,l):l;var l=o._versions,I={},C={};return l.forEach(function(p){d(I,p._cfg.storesSource),C=p._cfg.dbschema={},p._parseStoresSpec(I,C)}),o._dbSchema=C,ho(o,[o._allTables,o,o.Transaction.prototype]),wi(o,[o._allTables,o,o.Transaction.prototype,this._cfg.tables],c(C),C),o._storeNames=c(C),this},ki.prototype.upgrade=function(i){return this._cfg.contentUpgrade=sn(this._cfg.contentUpgrade||Ge,i),this},ki);function ki(){}function po(i,o){var l=i._dbNamesDB;return l||(l=i._dbNamesDB=new Ot(ae,{addons:[],indexedDB:i,IDBKeyRange:o})).version(1).stores({dbnames:"name"}),l.table("dbnames")}function mo(i){return i&&typeof i.databases=="function"}function fo(i){return Rt(function(){return se.letThrough=!0,i()})}function Zo(i){return!("from"in i)}var xe=function(i,o){if(!this){var l=new xe;return i&&"d"in i&&d(l,i),l}d(this,arguments.length?{d:1,from:i,to:1<arguments.length?o:i}:{d:0})};function Pr(i,o,l){var I=Be(o,l);if(!isNaN(I)){if(0<I)throw RangeError();if(Zo(i))return d(i,{from:o,to:l,d:1});var C=i.l,I=i.r;if(Be(l,i.from)<0)return C?Pr(C,o,l):i.l={from:o,to:l,d:1,l:null,r:null},Qc(i);if(0<Be(o,i.to))return I?Pr(I,o,l):i.r={from:o,to:l,d:1,l:null,r:null},Qc(i);Be(o,i.from)<0&&(i.from=o,i.l=null,i.d=I?I.d+1:1),0<Be(l,i.to)&&(i.to=l,i.r=null,i.d=i.l?i.l.d+1:1),l=!i.r,C&&!i.l&&Dr(i,C),I&&l&&Dr(i,I)}}function Dr(i,o){Zo(o)||function l(I,X){var p=X.from,Z=X.to,B=X.l,X=X.r;Pr(I,p,Z),B&&l(I,B),X&&l(I,X)}(i,o)}function Ji(i,o){var l=yo(o),I=l.next();if(I.done)return!1;for(var C=I.value,p=yo(i),Z=p.next(C.from),B=Z.value;!I.done&&!Z.done;){if(Be(B.from,C.to)<=0&&0<=Be(B.to,C.from))return!0;Be(C.from,B.from)<0?C=(I=l.next(B.from)).value:B=(Z=p.next(C.from)).value}return!1}function yo(i){var o=Zo(i)?null:{s:0,n:i};return{next:function(l){for(var I=0<arguments.length;o;)switch(o.s){case 0:if(o.s=1,I)for(;o.n.l&&Be(l,o.n.from)<0;)o={up:o,n:o.n.l,s:1};else for(;o.n.l;)o={up:o,n:o.n.l,s:1};case 1:if(o.s=2,!I||Be(l,o.n.to)<=0)return{value:o.n,done:!1};case 2:if(o.n.r){o.s=3,o={up:o,n:o.n.r,s:0};continue}case 3:o=o.up}return{done:!0}}}}function Qc(i){var o,l,I=(((o=i.r)===null||o===void 0?void 0:o.d)||0)-(((l=i.l)===null||l===void 0?void 0:l.d)||0),C=1<I?"r":I<-1?"l":"";C&&(o=C=="r"?"l":"r",l=r({},i),I=i[C],i.from=I.from,i.to=I.to,i[C]=I[C],l[C]=I[o],(i[o]=l).d=jc(l)),i.d=jc(i)}function jc(l){var o=l.r,l=l.l;return(o?l?Math.max(o.d,l.d):o.d:l?l.d:0)+1}function zi(i,o){return c(o).forEach(function(l){i[l]?Dr(i[l],o[l]):i[l]=function I(C){var p,Z,B={};for(p in C)y(C,p)&&(Z=C[p],B[p]=!Z||typeof Z!="object"||It.has(Z.constructor)?Z:I(Z));return B}(o[l])}),i}function Go(i,o){return i.all||o.all||Object.keys(i).some(function(l){return o[l]&&Ji(o[l],i[l])})}v(xe.prototype,((Ct={add:function(i){return Dr(this,i),this},addKey:function(i){return Pr(this,i,i),this},addKeys:function(i){var o=this;return i.forEach(function(l){return Pr(o,l,l)}),this}})[mt]=function(){return yo(this)},Ct));var Nn={},Bo={},Ao=!1;function Ti(i){zi(Bo,i),Ao||(Ao=!0,setTimeout(function(){Ao=!1,vo(Bo,!(Bo={}))},0))}function vo(i,o){o===void 0&&(o=!1);var l=new Set;if(i.all)for(var I=0,C=Object.values(Nn);I<C.length;I++)Oc(Z=C[I],i,l,o);else for(var p in i){var Z,B=/^idb\:\/\/(.*)\/(.*)\//.exec(p);B&&(p=B[1],B=B[2],(Z=Nn["idb://".concat(p,"/").concat(B)])&&Oc(Z,i,l,o))}l.forEach(function(X){return X()})}function Oc(i,o,l,I){for(var C=[],p=0,Z=Object.entries(i.queries.query);p<Z.length;p++){for(var B=Z[p],X=B[0],R=[],N=0,W=B[1];N<W.length;N++){var w=W[N];Go(o,w.obsSet)?w.subscribers.forEach(function(H){return l.add(H)}):I&&R.push(w)}I&&C.push([X,R])}if(I)for(var Y=0,S=C;Y<S.length;Y++){var K=S[Y],X=K[0],R=K[1];i.queries.query[X]=R}}function ph(i){var o=i._state,l=i._deps.indexedDB;if(o.isBeingOpened||i.idbdb)return o.dbReadyPromise.then(function(){return o.dbOpenError?f(o.dbOpenError):i});o.isBeingOpened=!0,o.dbOpenError=null,o.openComplete=!1;var I=o.openCanceller,C=Math.round(10*i.verno),p=!1;function Z(){if(o.openCanceller!==I)throw new ie.DatabaseClosed("db.open() was cancelled")}function B(){return new q(function(w,Y){if(Z(),!l)throw new ie.MissingAPI;var S=i.name,K=o.autoSchema||!C?l.open(S):l.open(S,C);if(!K)throw new ie.MissingAPI;K.onerror=Ht(Y),K.onblocked=Ye(i._fireOnBlocked),K.onupgradeneeded=Ye(function(H){var k;N=K.transaction,o.autoSchema&&!i._options.allowEmptyDB?(K.onerror=Qr,N.abort(),K.result.close(),(k=l.deleteDatabase(S)).onsuccess=k.onerror=Ye(function(){Y(new ie.NoSuchDatabase("Database ".concat(S," doesnt exist")))})):(N.onerror=Ht(Y),H=H.oldVersion>Math.pow(2,62)?0:H.oldVersion,W=H<1,i.idbdb=K.result,p&&Ch(i,N),hh(i,H/10,N,Y))},Y),K.onsuccess=Ye(function(){N=null;var H,k,J,T,U,x=i.idbdb=K.result,D=ce(x.objectStoreNames);if(0<D.length)try{var M=x.transaction((T=D).length===1?T[0]:T,"readonly");if(o.autoSchema)k=x,J=M,(H=i).verno=k.version/10,J=H._dbSchema=_i(0,k,J),H._storeNames=ce(k.objectStoreNames,0),wi(H,[H._allTables],c(J),J);else if(Fi(i,i._dbSchema,M),((U=Co(_i(0,(U=i).idbdb,M),U._dbSchema)).add.length||U.change.some(function(P){return P.add.length||P.change.length}))&&!p)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),x.close(),C=x.version+1,p=!0,w(B());Ni(i,M)}catch{}E.push(i),x.onversionchange=Ye(function(P){o.vcFired=!0,i.on("versionchange").fire(P)}),x.onclose=Ye(function(P){i.on("close").fire(P)}),W&&(U=i._deps,M=S,x=U.indexedDB,U=U.IDBKeyRange,mo(x)||M===ae||po(x,U).put({name:M}).catch(Ge)),w()},Y)}).catch(function(w){switch(w==null?void 0:w.name){case"UnknownError":if(0<o.PR1398_maxLoop)return o.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),B();break;case"VersionError":if(0<C)return C=0,B()}return q.reject(w)})}var X,R=o.dbReadyResolve,N=null,W=!1;return q.race([I,(typeof navigator>"u"?q.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(w){function Y(){return indexedDB.databases().finally(w)}X=setInterval(Y,100),Y()}).finally(function(){return clearInterval(X)}):Promise.resolve()).then(B)]).then(function(){return Z(),o.onReadyBeingFired=[],q.resolve(fo(function(){return i.on.ready.fire(i.vip)})).then(function w(){if(0<o.onReadyBeingFired.length){var Y=o.onReadyBeingFired.reduce(sn,Ge);return o.onReadyBeingFired=[],q.resolve(fo(function(){return Y(i.vip)})).then(w)}})}).finally(function(){o.openCanceller===I&&(o.onReadyBeingFired=null,o.isBeingOpened=!1)}).catch(function(w){o.dbOpenError=w;try{N&&N.abort()}catch{}return I===o.openCanceller&&i._close(),f(w)}).finally(function(){o.openComplete=!0,R()}).then(function(){var w;return W&&(w={},i.tables.forEach(function(Y){Y.schema.indexes.forEach(function(S){S.name&&(w["idb://".concat(i.name,"/").concat(Y.name,"/").concat(S.name)]=new xe(-1/0,[[[]]]))}),w["idb://".concat(i.name,"/").concat(Y.name,"/")]=w["idb://".concat(i.name,"/").concat(Y.name,"/:dels")]=new xe(-1/0,[[[]]])}),dn(jr).fire(w),vo(w,!0)),i})}function Wo(i){function o(p){return i.next(p)}var l=C(o),I=C(function(p){return i.throw(p)});function C(p){return function(X){var B=p(X),X=B.value;return B.done?X:X&&typeof X.then=="function"?X.then(l,I):u(X)?Promise.all(X).then(l,I):l(X)}}return C(o)()}function Ui(i,o,l){for(var I=u(i)?i.slice():[i],C=0;C<l;++C)I.push(o);return I}var mh={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(i){return r(r({},i),{table:function(o){var l=i.table(o),I=l.schema,C={},p=[];function Z(W,w,Y){var S=Mr(W),K=C[S]=C[S]||[],H=W==null?0:typeof W=="string"?1:W.length,k=0<w,k=r(r({},Y),{name:k?"".concat(S,"(virtual-from:").concat(Y.name,")"):Y.name,lowLevelIndex:Y,isVirtual:k,keyTail:w,keyLength:H,extractKey:Io(W),unique:!k&&Y.unique});return K.push(k),k.isPrimaryKey||p.push(k),1<H&&Z(H===2?W[0]:W.slice(0,H-1),w+1,Y),K.sort(function(J,T){return J.keyTail-T.keyTail}),k}o=Z(I.primaryKey.keyPath,0,I.primaryKey),C[":id"]=[o];for(var B=0,X=I.indexes;B<X.length;B++){var R=X[B];Z(R.keyPath,0,R)}function N(W){var w,Y=W.query.index;return Y.isVirtual?r(r({},W),{query:{index:Y.lowLevelIndex,range:(w=W.query.range,Y=Y.keyTail,{type:w.type===1?2:w.type,lower:Ui(w.lower,w.lowerOpen?i.MAX_KEY:i.MIN_KEY,Y),lowerOpen:!0,upper:Ui(w.upper,w.upperOpen?i.MIN_KEY:i.MAX_KEY,Y),upperOpen:!0})}}):W}return r(r({},l),{schema:r(r({},I),{primaryKey:o,indexes:p,getIndexByKeyPath:function(W){return(W=C[Mr(W)])&&W[0]}}),count:function(W){return l.count(N(W))},query:function(W){return l.query(N(W))},openCursor:function(W){var w=W.query.index,Y=w.keyTail,S=w.isVirtual,K=w.keyLength;return S?l.openCursor(N(W)).then(function(k){return k&&H(k)}):l.openCursor(W);function H(k){return Object.create(k,{continue:{value:function(J){J!=null?k.continue(Ui(J,W.reverse?i.MAX_KEY:i.MIN_KEY,Y)):W.unique?k.continue(k.key.slice(0,K).concat(W.reverse?i.MIN_KEY:i.MAX_KEY,Y)):k.continue()}},continuePrimaryKey:{value:function(J,T){k.continuePrimaryKey(Ui(J,i.MAX_KEY,Y),T)}},primaryKey:{get:function(){return k.primaryKey}},key:{get:function(){var J=k.key;return K===1?J[0]:J.slice(0,K)}},value:{get:function(){return k.value}}})}}})}})}};function Vo(i,o,l,I){return l=l||{},I=I||"",c(i).forEach(function(C){var p,Z,B;y(o,C)?(p=i[C],Z=o[C],typeof p=="object"&&typeof Z=="object"&&p&&Z?(B=Pe(p))!==Pe(Z)?l[I+C]=o[C]:B==="Object"?Vo(p,Z,l,I+C+"."):p!==Z&&(l[I+C]=o[C]):p!==Z&&(l[I+C]=o[C])):l[I+C]=void 0}),c(o).forEach(function(C){y(i,C)||(l[I+C]=o[C])}),l}function Ro(i,o){return o.type==="delete"?o.keys:o.keys||o.values.map(i.extractKey)}var fh={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(i){return r(r({},i),{table:function(o){var l=i.table(o),I=l.schema.primaryKey;return r(r({},l),{mutate:function(C){var p=se.trans,Z=p.table(o).hook,B=Z.deleting,X=Z.creating,R=Z.updating;switch(C.type){case"add":if(X.fire===Ge)break;return p._promise("readwrite",function(){return N(C)},!0);case"put":if(X.fire===Ge&&R.fire===Ge)break;return p._promise("readwrite",function(){return N(C)},!0);case"delete":if(B.fire===Ge)break;return p._promise("readwrite",function(){return N(C)},!0);case"deleteRange":if(B.fire===Ge)break;return p._promise("readwrite",function(){return function W(w,Y,S){return l.query({trans:w,values:!1,query:{index:I,range:Y},limit:S}).then(function(K){var H=K.result;return N({type:"delete",keys:H,trans:w}).then(function(k){return 0<k.numFailures?Promise.reject(k.failures[0]):H.length<S?{failures:[],numFailures:0,lastResult:void 0}:W(w,r(r({},Y),{lower:H[H.length-1],lowerOpen:!0}),S)})})}(C.trans,C.range,1e4)},!0)}return l.mutate(C);function N(W){var w,Y,S,K=se.trans,H=W.keys||Ro(I,W);if(!H)throw new Error("Keys missing");return(W=W.type==="add"||W.type==="put"?r(r({},W),{keys:H}):r({},W)).type!=="delete"&&(W.values=s([],W.values,!0)),W.keys&&(W.keys=s([],W.keys,!0)),w=l,S=H,((Y=W).type==="add"?Promise.resolve([]):w.getMany({trans:Y.trans,keys:S,cache:"immutable"})).then(function(k){var J=H.map(function(T,U){var x,D,M,P=k[U],$={onerror:null,onsuccess:null};return W.type==="delete"?B.fire.call($,T,P,K):W.type==="add"||P===void 0?(x=X.fire.call($,T,W.values[U],K),T==null&&x!=null&&(W.keys[U]=T=x,I.outbound||ue(W.values[U],I.keyPath,T))):(x=Vo(P,W.values[U]),(D=R.fire.call($,x,T,P,K))&&(M=W.values[U],Object.keys(D).forEach(function(ee){y(M,ee)?M[ee]=D[ee]:ue(M,ee,D[ee])}))),$});return l.mutate(W).then(function(T){for(var U=T.failures,x=T.results,D=T.numFailures,T=T.lastResult,M=0;M<H.length;++M){var P=(x||H)[M],$=J[M];P==null?$.onerror&&$.onerror(U[M]):$.onsuccess&&$.onsuccess(W.type==="put"&&k[M]?W.values[M]:P)}return{failures:U,results:x,numFailures:D,lastResult:T}}).catch(function(T){return J.forEach(function(U){return U.onerror&&U.onerror(T)}),Promise.reject(T)})})}}})}})}};function Mc(i,o,l){try{if(!o||o.keys.length<i.length)return null;for(var I=[],C=0,p=0;C<o.keys.length&&p<i.length;++C)Be(o.keys[C],i[p])===0&&(I.push(l?Ne(o.values[C]):o.values[C]),++p);return I.length===i.length?I:null}catch{return null}}var Zh={stack:"dbcore",level:-1,create:function(i){return{table:function(o){var l=i.table(o);return r(r({},l),{getMany:function(I){if(!I.cache)return l.getMany(I);var C=Mc(I.keys,I.trans._cache,I.cache==="clone");return C?q.resolve(C):l.getMany(I).then(function(p){return I.trans._cache={keys:I.keys,values:I.cache==="clone"?Ne(p):p},p})},mutate:function(I){return I.type!=="add"&&(I.trans._cache=null),l.mutate(I)}})}}}};function Pc(i,o){return i.trans.mode==="readonly"&&!!i.subscr&&!i.trans.explicit&&i.trans.db._options.cache!=="disabled"&&!o.schema.primaryKey.outbound}function Dc(i,o){switch(i){case"query":return o.values&&!o.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var yh={stack:"dbcore",level:0,name:"Observability",create:function(i){var o=i.schema.name,l=new xe(i.MIN_KEY,i.MAX_KEY);return r(r({},i),{transaction:function(I,C,p){if(se.subscr&&C!=="readonly")throw new ie.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(se.querier));return i.transaction(I,C,p)},table:function(I){var C=i.table(I),p=C.schema,Z=p.primaryKey,W=p.indexes,B=Z.extractKey,X=Z.outbound,R=Z.autoIncrement&&W.filter(function(Y){return Y.compound&&Y.keyPath.includes(Z.keyPath)}),N=r(r({},C),{mutate:function(Y){function S(ee){return ee="idb://".concat(o,"/").concat(I,"/").concat(ee),T[ee]||(T[ee]=new xe)}var K,H,k,J=Y.trans,T=Y.mutatedParts||(Y.mutatedParts={}),U=S(""),x=S(":dels"),D=Y.type,$=Y.type==="deleteRange"?[Y.range]:Y.type==="delete"?[Y.keys]:Y.values.length<50?[Ro(Z,Y).filter(function(ee){return ee}),Y.values]:[],M=$[0],P=$[1],$=Y.trans._cache;return u(M)?(U.addKeys(M),($=D==="delete"||M.length===P.length?Mc(M,$):null)||x.addKeys(M),($||P)&&(K=S,H=$,k=P,p.indexes.forEach(function(ee){var de=K(ee.name||"");function Ce(be){return be!=null?ee.extractKey(be):null}function me(be){return ee.multiEntry&&u(be)?be.forEach(function(yt){return de.addKey(yt)}):de.addKey(be)}(H||k).forEach(function(be,Le){var pe=H&&Ce(H[Le]),Le=k&&Ce(k[Le]);Be(pe,Le)!==0&&(pe!=null&&me(pe),Le!=null&&me(Le))})}))):M?(P={from:M.lower,to:M.upper},x.add(P),U.add(P)):(U.add(l),x.add(l),p.indexes.forEach(function(ee){return S(ee.name).add(l)})),C.mutate(Y).then(function(ee){return!M||Y.type!=="add"&&Y.type!=="put"||(U.addKeys(ee.results),R&&R.forEach(function(de){var Ce=Y.values.map(function(be){return de.extractKey(be)}),me=de.keyPath.findIndex(function(be){return be===Z.keyPath});ee.results.forEach(function(be){return Ce[me]=be}),S(de.name).addKeys(Ce)})),J.mutatedParts=zi(J.mutatedParts||{},T),ee})}}),W=function(S){var K=S.query,S=K.index,K=K.range;return[S,new xe((S=K.lower)!==null&&S!==void 0?S:i.MIN_KEY,(K=K.upper)!==null&&K!==void 0?K:i.MAX_KEY)]},w={get:function(Y){return[Z,new xe(Y.key)]},getMany:function(Y){return[Z,new xe().addKeys(Y.keys)]},count:W,query:W,openCursor:W};return c(w).forEach(function(Y){N[Y]=function(S){var K=se.subscr,H=!!K,k=Pc(se,C)&&Dc(Y,S)?S.obsSet={}:K;if(H){var J=function(P){return P="idb://".concat(o,"/").concat(I,"/").concat(P),k[P]||(k[P]=new xe)},T=J(""),U=J(":dels"),K=w[Y](S),H=K[0],K=K[1];if((Y==="query"&&H.isPrimaryKey&&!S.values?U:J(H.name||"")).add(K),!H.isPrimaryKey){if(Y!=="count"){var x=Y==="query"&&X&&S.values&&C.query(r(r({},S),{values:!1}));return C[Y].apply(this,arguments).then(function(P){if(Y==="query"){if(X&&S.values)return x.then(function(Ce){return Ce=Ce.result,T.addKeys(Ce),P});var $=S.values?P.result.map(B):P.result;(S.values?T:U).addKeys($)}else if(Y==="openCursor"){var ee=P,de=S.values;return ee&&Object.create(ee,{key:{get:function(){return U.addKey(ee.primaryKey),ee.key}},primaryKey:{get:function(){var Ce=ee.primaryKey;return U.addKey(Ce),Ce}},value:{get:function(){return de&&T.addKey(ee.primaryKey),ee.value}}})}return P})}U.add(l)}}return C[Y].apply(this,arguments)}}),N}})}};function $c(i,o,l){if(l.numFailures===0)return o;if(o.type==="deleteRange")return null;var I=o.keys?o.keys.length:"values"in o&&o.values?o.values.length:1;return l.numFailures===I?null:(o=r({},o),u(o.keys)&&(o.keys=o.keys.filter(function(C,p){return!(p in l.failures)})),"values"in o&&u(o.values)&&(o.values=o.values.filter(function(C,p){return!(p in l.failures)})),o)}function Yo(i,o){return l=i,((I=o).lower===void 0||(I.lowerOpen?0<Be(l,I.lower):0<=Be(l,I.lower)))&&(i=i,(o=o).upper===void 0||(o.upperOpen?Be(i,o.upper)<0:Be(i,o.upper)<=0));var l,I}function qc(i,o,w,I,C,p){if(!w||w.length===0)return i;var Z=o.query.index,B=Z.multiEntry,X=o.query.range,R=I.schema.primaryKey.extractKey,N=Z.extractKey,W=(Z.lowLevelIndex||Z).extractKey,w=w.reduce(function(Y,S){var K=Y,H=S.type==="add"||S.type==="put"?S.values.filter(function(U){return U=N(U),B&&u(U)?U.some(function(x){return Yo(x,X)}):Yo(U,X)}).map(function(U){return U=Ne(U),p&&Object.freeze(U),U}):[];switch(S.type){case"add":K=Y.concat(o.values?H:H.map(function(x){return R(x)}));break;case"put":var k=new xe().addKeys(S.values.map(function(x){return R(x)})),K=Y.filter(function(x){return x=o.values?R(x):x,!Ji(new xe(x),k)}).concat(o.values?H:H.map(function(x){return R(x)}));break;case"delete":var J=new xe().addKeys(S.keys);K=Y.filter(function(x){return x=o.values?R(x):x,!Ji(new xe(x),J)});break;case"deleteRange":var T=S.range;K=Y.filter(function(x){return!Yo(R(x),T)})}return K},i);return w===i?i:(w.sort(function(Y,S){return Be(W(Y),W(S))||Be(R(Y),R(S))}),o.limit&&o.limit<1/0&&(w.length>o.limit?w.length=o.limit:i.length===o.limit&&w.length<o.limit&&(C.dirty=!0)),p?Object.freeze(w):w)}function el(i,o){return Be(i.lower,o.lower)===0&&Be(i.upper,o.upper)===0&&!!i.lowerOpen==!!o.lowerOpen&&!!i.upperOpen==!!o.upperOpen}function Gh(i,o){return function(l,I,C,p){if(l===void 0)return I!==void 0?-1:0;if(I===void 0)return 1;if((I=Be(l,I))===0){if(C&&p)return 0;if(C)return 1;if(p)return-1}return I}(i.lower,o.lower,i.lowerOpen,o.lowerOpen)<=0&&0<=function(l,I,C,p){if(l===void 0)return I!==void 0?1:0;if(I===void 0)return-1;if((I=Be(l,I))===0){if(C&&p)return 0;if(C)return-1;if(p)return 1}return I}(i.upper,o.upper,i.upperOpen,o.upperOpen)}function Bh(i,o,l,I){i.subscribers.add(l),I.addEventListener("abort",function(){var C,p;i.subscribers.delete(l),i.subscribers.size===0&&(C=i,p=o,setTimeout(function(){C.subscribers.size===0&&it(p,C)},3e3))})}var Ah={stack:"dbcore",level:0,name:"Cache",create:function(i){var o=i.schema.name;return r(r({},i),{transaction:function(l,I,C){var p,Z,B=i.transaction(l,I,C);return I==="readwrite"&&(Z=(p=new AbortController).signal,C=function(X){return function(){if(p.abort(),I==="readwrite"){for(var R=new Set,N=0,W=l;N<W.length;N++){var w=W[N],Y=Nn["idb://".concat(o,"/").concat(w)];if(Y){var S=i.table(w),K=Y.optimisticOps.filter(function(de){return de.trans===B});if(B._explicit&&X&&B.mutatedParts)for(var H=0,k=Object.values(Y.queries.query);H<k.length;H++)for(var J=0,T=(D=k[H]).slice();J<T.length;J++)Go((M=T[J]).obsSet,B.mutatedParts)&&(it(D,M),M.subscribers.forEach(function(de){return R.add(de)}));else if(0<K.length){Y.optimisticOps=Y.optimisticOps.filter(function(de){return de.trans!==B});for(var U=0,x=Object.values(Y.queries.query);U<x.length;U++)for(var D,M,P,$=0,ee=(D=x[U]).slice();$<ee.length;$++)(M=ee[$]).res!=null&&B.mutatedParts&&(X&&!M.dirty?(P=Object.isFrozen(M.res),P=qc(M.res,M.req,K,S,M,P),M.dirty?(it(D,M),M.subscribers.forEach(function(de){return R.add(de)})):P!==M.res&&(M.res=P,M.promise=q.resolve({result:P}))):(M.dirty&&it(D,M),M.subscribers.forEach(function(de){return R.add(de)})))}}}R.forEach(function(de){return de()})}}},B.addEventListener("abort",C(!1),{signal:Z}),B.addEventListener("error",C(!1),{signal:Z}),B.addEventListener("complete",C(!0),{signal:Z})),B},table:function(l){var I=i.table(l),C=I.schema.primaryKey;return r(r({},I),{mutate:function(p){var Z=se.trans;if(C.outbound||Z.db._options.cache==="disabled"||Z.explicit)return I.mutate(p);var B=Nn["idb://".concat(o,"/").concat(l)];return B?(Z=I.mutate(p),p.type!=="add"&&p.type!=="put"||!(50<=p.values.length||Ro(C,p).some(function(X){return X==null}))?(B.optimisticOps.push(p),p.mutatedParts&&Ti(p.mutatedParts),Z.then(function(X){0<X.numFailures&&(it(B.optimisticOps,p),(X=$c(0,p,X))&&B.optimisticOps.push(X),p.mutatedParts&&Ti(p.mutatedParts))}),Z.catch(function(){it(B.optimisticOps,p),p.mutatedParts&&Ti(p.mutatedParts)})):Z.then(function(X){var R=$c(0,r(r({},p),{values:p.values.map(function(Y,W){var w,Y=(w=C.keyPath)!==null&&w!==void 0&&w.includes(".")?Ne(Y):r({},Y);return ue(Y,C.keyPath,X.results[W]),Y})}),X);B.optimisticOps.push(R),queueMicrotask(function(){return p.mutatedParts&&Ti(p.mutatedParts)})}),Z):I.mutate(p)},query:function(p){if(!Pc(se,I)||!Dc("query",p))return I.query(p);var Z=((R=se.trans)===null||R===void 0?void 0:R.db._options.cache)==="immutable",W=se,B=W.requery,X=W.signal,R=function(S,K,H,k){var J=Nn["idb://".concat(S,"/").concat(K)];if(!J)return[];if(!(K=J.queries[H]))return[null,!1,J,null];var T=K[(k.query?k.query.index.name:null)||""];if(!T)return[null,!1,J,null];switch(H){case"query":var U=T.find(function(x){return x.req.limit===k.limit&&x.req.values===k.values&&el(x.req.query.range,k.query.range)});return U?[U,!0,J,T]:[T.find(function(x){return("limit"in x.req?x.req.limit:1/0)>=k.limit&&(!k.values||x.req.values)&&Gh(x.req.query.range,k.query.range)}),!1,J,T];case"count":return U=T.find(function(x){return el(x.req.query.range,k.query.range)}),[U,!!U,J,T]}}(o,l,"query",p),N=R[0],W=R[1],w=R[2],Y=R[3];return N&&W?N.obsSet=p.obsSet:(W=I.query(p).then(function(S){var K=S.result;if(N&&(N.res=K),Z){for(var H=0,k=K.length;H<k;++H)Object.freeze(K[H]);Object.freeze(K)}else S.result=Ne(K);return S}).catch(function(S){return Y&&N&&it(Y,N),Promise.reject(S)}),N={obsSet:p.obsSet,promise:W,subscribers:new Set,type:"query",req:p,dirty:!1},Y?Y.push(N):(Y=[N],(w=w||(Nn["idb://".concat(o,"/").concat(l)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[p.query.index.name||""]=Y)),Bh(N,Y,B,X),N.promise.then(function(S){return{result:qc(S.result,p,w==null?void 0:w.optimisticOps,I,N,Z)}})}})}})}};function Ei(i,o){return new Proxy(i,{get:function(l,I,C){return I==="db"?o:Reflect.get(l,I,C)}})}var Ot=(we.prototype.version=function(i){if(isNaN(i)||i<.1)throw new ie.Type("Given version is not a positive number");if(i=Math.round(10*i)/10,this.idbdb||this._state.isBeingOpened)throw new ie.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,i);var o=this._versions,l=o.filter(function(I){return I._cfg.version===i})[0];return l||(l=new this.Version(i),o.push(l),o.sort(Ih),l.stores({}),this._state.autoSchema=!1,l)},we.prototype._whenReady=function(i){var o=this;return this.idbdb&&(this._state.openComplete||se.letThrough||this._vip)?i():new q(function(l,I){if(o._state.openComplete)return I(new ie.DatabaseClosed(o._state.dbOpenError));if(!o._state.isBeingOpened){if(!o._state.autoOpen)return void I(new ie.DatabaseClosed);o.open().catch(Ge)}o._state.dbReadyPromise.then(l,I)}).then(i)},we.prototype.use=function(i){var o=i.stack,l=i.create,I=i.level,C=i.name;return C&&this.unuse({stack:o,name:C}),i=this._middlewares[o]||(this._middlewares[o]=[]),i.push({stack:o,create:l,level:I??10,name:C}),i.sort(function(p,Z){return p.level-Z.level}),this},we.prototype.unuse=function(i){var o=i.stack,l=i.name,I=i.create;return o&&this._middlewares[o]&&(this._middlewares[o]=this._middlewares[o].filter(function(C){return I?C.create!==I:!!l&&C.name!==l})),this},we.prototype.open=function(){var i=this;return G(Vt,function(){return ph(i)})},we.prototype._close=function(){var i=this._state,o=E.indexOf(this);if(0<=o&&E.splice(o,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}i.isBeingOpened||(i.dbReadyPromise=new q(function(l){i.dbReadyResolve=l}),i.openCanceller=new q(function(l,I){i.cancelOpen=I}))},we.prototype.close=function(l){var o=(l===void 0?{disableAutoOpen:!0}:l).disableAutoOpen,l=this._state;o?(l.isBeingOpened&&l.cancelOpen(new ie.DatabaseClosed),this._close(),l.autoOpen=!1,l.dbOpenError=new ie.DatabaseClosed):(this._close(),l.autoOpen=this._options.autoOpen||l.isBeingOpened,l.openComplete=!1,l.dbOpenError=null)},we.prototype.delete=function(i){var o=this;i===void 0&&(i={disableAutoOpen:!0});var l=0<arguments.length&&typeof arguments[0]!="object",I=this._state;return new q(function(C,p){function Z(){o.close(i);var B=o._deps.indexedDB.deleteDatabase(o.name);B.onsuccess=Ye(function(){var X,R,N;X=o._deps,R=o.name,N=X.indexedDB,X=X.IDBKeyRange,mo(N)||R===ae||po(N,X).delete(R).catch(Ge),C()}),B.onerror=Ht(p),B.onblocked=o._fireOnBlocked}if(l)throw new ie.InvalidArgument("Invalid closeOptions argument to db.delete()");I.isBeingOpened?I.dbReadyPromise.then(Z):Z()})},we.prototype.backendDB=function(){return this.idbdb},we.prototype.isOpen=function(){return this.idbdb!==null},we.prototype.hasBeenClosed=function(){var i=this._state.dbOpenError;return i&&i.name==="DatabaseClosed"},we.prototype.hasFailed=function(){return this._state.dbOpenError!==null},we.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(we.prototype,"tables",{get:function(){var i=this;return c(this._allTables).map(function(o){return i._allTables[o]})},enumerable:!1,configurable:!0}),we.prototype.transaction=function(){var i=(function(o,l,I){var C=arguments.length;if(C<2)throw new ie.InvalidArgument("Too few arguments");for(var p=new Array(C-1);--C;)p[C-1]=arguments[C];return I=p.pop(),[o,dt(p),I]}).apply(this,arguments);return this._transaction.apply(this,i)},we.prototype._transaction=function(i,o,l){var I=this,C=se.trans;C&&C.db===this&&i.indexOf("!")===-1||(C=null);var p,Z,B=i.indexOf("?")!==-1;i=i.replace("!","").replace("?","");try{if(Z=o.map(function(R){if(R=R instanceof I.Table?R.name:R,typeof R!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return R}),i=="r"||i===ne)p=ne;else{if(i!="rw"&&i!=he)throw new ie.InvalidArgument("Invalid transaction mode: "+i);p=he}if(C){if(C.mode===ne&&p===he){if(!B)throw new ie.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");C=null}C&&Z.forEach(function(R){if(C&&C.storeNames.indexOf(R)===-1){if(!B)throw new ie.SubTransaction("Table "+R+" not included in parent transaction.");C=null}}),B&&C&&!C.active&&(C=null)}}catch(R){return C?C._promise(null,function(N,W){W(R)}):f(R)}var X=(function R(N,W,w,Y,S){return q.resolve().then(function(){var K=se.transless||se,H=N._createTransaction(W,w,N._dbSchema,Y);if(H.explicit=!0,K={trans:H,transless:K},Y)H.idbtrans=Y.idbtrans;else try{H.create(),H.idbtrans._explicit=!0,N._state.PR1398_maxLoop=3}catch(T){return T.name===nn.InvalidState&&N.isOpen()&&0<--N._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),N.close({disableAutoOpen:!1}),N.open().then(function(){return R(N,W,w,null,S)})):f(T)}var k,J=en(S);return J&&ln(),K=q.follow(function(){var T;(k=S.call(H,H))&&(J?(T=Yt.bind(null,null),k.then(T,T)):typeof k.next=="function"&&typeof k.throw=="function"&&(k=Wo(k)))},K),(k&&typeof k.then=="function"?q.resolve(k).then(function(T){return H.active?T:f(new ie.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):K.then(function(){return k})).then(function(T){return Y&&H._resolve(),H._completion.then(function(){return T})}).catch(function(T){return H._reject(T),f(T)})})}).bind(null,this,p,Z,C,l);return C?C._promise(p,X,"lock"):se.trans?G(se.transless,function(){return I._whenReady(X)}):this._whenReady(X)},we.prototype.table=function(i){if(!y(this._allTables,i))throw new ie.InvalidTable("Table ".concat(i," does not exist"));return this._allTables[i]},we);function we(i,o){var l=this;this._middlewares={},this.verno=0;var I=we.dependencies;this._options=o=r({addons:we.addons,autoOpen:!0,indexedDB:I.indexedDB,IDBKeyRange:I.IDBKeyRange,cache:"cloned"},o),this._deps={indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange},I=o.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var C,p,Z,B,X,R={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Ge,dbReadyPromise:null,cancelOpen:Ge,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:o.autoOpen};R.dbReadyPromise=new q(function(W){R.dbReadyResolve=W}),R.openCanceller=new q(function(W,w){R.cancelOpen=w}),this._state=R,this.name=i,this.on=xr(this,"populate","blocked","versionchange","close",{ready:[sn,Ge]}),this.on.ready.subscribe=re(this.on.ready.subscribe,function(W){return function(w,Y){we.vip(function(){var S,K=l._state;K.openComplete?(K.dbOpenError||q.resolve().then(w),Y&&W(w)):K.onReadyBeingFired?(K.onReadyBeingFired.push(w),Y&&W(w)):(W(w),S=l,Y||W(function H(){S.on.ready.unsubscribe(w),S.on.ready.unsubscribe(H)}))})}}),this.Collection=(C=this,Lr(oh.prototype,function(k,H){this.db=C;var Y=io,S=null;if(H)try{Y=H()}catch(J){S=J}var K=k._ctx,H=K.table,k=H.hook.reading.fire;this._ctx={table:H,index:K.index,isPrimKey:!K.index||H.schema.primKey.keyPath&&K.index===H.schema.primKey.name,range:Y,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:S,or:K.or,valueMapper:k!==st?k:null}})),this.Table=(p=this,Lr(_c.prototype,function(W,w,Y){this.db=p,this._tx=Y,this.name=W,this.schema=w,this.hook=p._allTables[W]?p._allTables[W].hook:xr(null,{creating:[lt,Ge],reading:[Vn,st],updating:[xt,Ge],deleting:[ft,Ge]})})),this.Transaction=(Z=this,Lr(lh.prototype,function(W,w,Y,S,K){var H=this;this.db=Z,this.mode=W,this.storeNames=w,this.schema=Y,this.chromeTransactionDurability=S,this.idbtrans=null,this.on=xr(this,"complete","error","abort"),this.parent=K||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new q(function(k,J){H._resolve=k,H._reject=J}),this._completion.then(function(){H.active=!1,H.on.complete.fire()},function(k){var J=H.active;return H.active=!1,H.on.error.fire(k),H.parent?H.parent._reject(k):J&&H.idbtrans&&H.idbtrans.abort(),f(k)})})),this.Version=(B=this,Lr(bh.prototype,function(W){this.db=B,this._cfg={version:W,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(X=this,Lr(Tc.prototype,function(W,w,Y){if(this.db=X,this._ctx={table:W,index:w===":id"?null:w,or:Y},this._cmp=this._ascending=Be,this._descending=function(S,K){return Be(K,S)},this._max=function(S,K){return 0<Be(S,K)?S:K},this._min=function(S,K){return Be(S,K)<0?S:K},this._IDBKeyRange=X._deps.IDBKeyRange,!this._IDBKeyRange)throw new ie.MissingAPI})),this.on("versionchange",function(W){0<W.newVersion?console.warn("Another connection wants to upgrade database '".concat(l.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(l.name,"'. Closing db now to resume the delete request.")),l.close({disableAutoOpen:!1})}),this.on("blocked",function(W){!W.newVersion||W.newVersion<W.oldVersion?console.warn("Dexie.delete('".concat(l.name,"') was blocked")):console.warn("Upgrade '".concat(l.name,"' blocked by other connection holding version ").concat(W.oldVersion/10))}),this._maxKey=Or(o.IDBKeyRange),this._createTransaction=function(W,w,Y,S){return new l.Transaction(W,w,Y,l._options.chromeTransactionDurability,S)},this._fireOnBlocked=function(W){l.on("blocked").fire(W),E.filter(function(w){return w.name===l.name&&w!==l&&!w._state.vcFired}).map(function(w){return w.on("versionchange").fire(W)})},this.use(Zh),this.use(Ah),this.use(yh),this.use(mh),this.use(fh);var N=new Proxy(this,{get:function(W,w,Y){if(w==="_vip")return!0;if(w==="table")return function(K){return Ei(l.table(K),N)};var S=Reflect.get(W,w,Y);return S instanceof _c?Ei(S,N):w==="tables"?S.map(function(K){return Ei(K,N)}):w==="_createTransaction"?function(){return Ei(S.apply(this,arguments),N)}:S}});this.vip=N,I.forEach(function(W){return W(l)})}var xi,Ct=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",vh=(Xo.prototype.subscribe=function(i,o,l){return this._subscribe(i&&typeof i!="function"?i:{next:i,error:o,complete:l})},Xo.prototype[Ct]=function(){return this},Xo);function Xo(i){this._subscribe=i}try{xi={indexedDB:a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,IDBKeyRange:a.IDBKeyRange||a.webkitIDBKeyRange}}catch{xi={indexedDB:null,IDBKeyRange:null}}function tl(i){var o,l=!1,I=new vh(function(C){var p=en(i),Z,B=!1,X={},R={},N={get closed(){return B},unsubscribe:function(){B||(B=!0,Z&&Z.abort(),W&&dn.storagemutated.unsubscribe(Y))}};C.start&&C.start(N);var W=!1,w=function(){return b(S)},Y=function(K){zi(X,K),Go(R,X)&&w()},S=function(){var K,H,k;!B&&xi.indexedDB&&(X={},K={},Z&&Z.abort(),Z=new AbortController,k=function(J){var T=an();try{p&&ln();var U=Rt(i,J);return U=p?U.finally(Yt):U}finally{T&&cn()}}(H={subscr:K,signal:Z.signal,requery:w,querier:i,trans:null}),Promise.resolve(k).then(function(J){l=!0,o=J,B||H.signal.aborted||(X={},function(T){for(var U in T)if(y(T,U))return;return 1}(R=K)||W||(dn(jr,Y),W=!0),b(function(){return!B&&C.next&&C.next(J)}))},function(J){l=!1,["DatabaseClosedError","AbortError"].includes(J==null?void 0:J.name)||B||b(function(){B||C.error&&C.error(J)})}))};return setTimeout(w,0),N});return I.hasValue=function(){return l},I.getValue=function(){return o},I}var wn=Ot;function Ho(i){var o=In;try{In=!0,dn.storagemutated.fire(i),vo(i,!0)}finally{In=o}}v(wn,r(r({},Wt),{delete:function(i){return new wn(i,{addons:[]}).delete()},exists:function(i){return new wn(i,{addons:[]}).open().then(function(o){return o.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(i){try{return o=wn.dependencies,l=o.indexedDB,o=o.IDBKeyRange,(mo(l)?Promise.resolve(l.databases()).then(function(I){return I.map(function(C){return C.name}).filter(function(C){return C!==ae})}):po(l,o).toCollection().primaryKeys()).then(i)}catch{return f(new ie.MissingAPI)}var o,l},defineClass:function(){return function(i){d(this,i)}},ignoreTransaction:function(i){return se.trans?G(se.transless,i):i()},vip:fo,async:function(i){return function(){try{var o=Wo(i.apply(this,arguments));return o&&typeof o.then=="function"?o:q.resolve(o)}catch(l){return f(l)}}},spawn:function(i,o,l){try{var I=Wo(i.apply(l,o||[]));return I&&typeof I.then=="function"?I:q.resolve(I)}catch(C){return f(C)}},currentTransaction:{get:function(){return se.trans||null}},waitFor:function(i,o){return o=q.resolve(typeof i=="function"?wn.ignoreTransaction(i):i).timeout(o||6e4),se.trans?se.trans.waitFor(o):o},Promise:q,debug:{get:function(){return qe},set:function(i){Fr(i)}},derive:Q,extend:d,props:v,override:re,Events:xr,on:dn,liveQuery:tl,extendObservabilitySet:zi,getByKeyPath:oe,setByKeyPath:ue,delByKeyPath:function(i,o){typeof o=="string"?ue(i,o,void 0):"length"in o&&[].map.call(o,function(l){ue(i,l,void 0)})},shallowClone:Ke,deepClone:Ne,getObjectDiff:Vo,cmp:Be,asap:fe,minKey:-1/0,addons:[],connections:E,errnames:nn,dependencies:xi,cache:Nn,semVer:"4.0.4",version:"4.0.4".split(".").map(function(i){return parseInt(i)}).reduce(function(i,o,l){return i+o/Math.pow(10,2*l)})})),wn.maxKey=Or(wn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(dn(jr,function(i){In||(i=new CustomEvent(lo,{detail:i}),In=!0,dispatchEvent(i),In=!1)}),addEventListener(lo,function(i){i=i.detail,In||Ho(i)}));var or,In=!1,nl=function(){};return typeof BroadcastChannel<"u"&&((nl=function(){(or=new BroadcastChannel(lo)).onmessage=function(i){return i.data&&Ho(i.data)}})(),typeof or.unref=="function"&&or.unref(),dn(jr,function(i){In||or.postMessage(i)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(i){if(!Ot.disableBfCache&&i.persisted){qe&&console.debug("Dexie: handling persisted pagehide"),or!=null&&or.close();for(var o=0,l=E;o<l.length;o++)l[o].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(i){!Ot.disableBfCache&&i.persisted&&(qe&&console.debug("Dexie: handling persisted pageshow"),nl(),Ho({all:new xe(-1/0,[[]])}))})),q.rejectionMapper=function(i,o){return!i||i instanceof vt||i instanceof TypeError||i instanceof SyntaxError||!i.name||!rn[i.name]?i:(o=new rn[i.name](o||i.message,i),"stack"in i&&F(o,"stack",{get:function(){return this.inner.stack}}),o)},Fr(qe),r(Ot,Object.freeze({__proto__:null,Dexie:Ot,liveQuery:tl,Entity:Nc,cmp:Be,PropModSymbol:jt,PropModification:ao,replacePrefix:function(i,o){return new ao({replacePrefix:[i,o]})},default:Ot,RangeSet:xe,mergeRanges:Dr,rangesOverlap:Ji}),{default:Ot}),Ot})})(Pd);var cG=Pd.exports;const aa=Ln(cG),xl=Symbol.for("Dexie"),bt=globalThis[xl]||(globalThis[xl]=aa);if(aa.semVer!==bt.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${aa.semVer} and ${bt.semVer}`);var ke={},ca={},Jt={},Us={},Zi={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getParsedType=e.ZodParsedType=e.objectUtil=e.util=void 0;var t;(function(r){r.assertEqual=u=>u;function s(u){}r.assertIs=s;function a(u){throw new Error}r.assertNever=a,r.arrayToEnum=u=>{const d={};for(const h of u)d[h]=h;return d},r.getValidEnumValues=u=>{const d=r.objectKeys(u).filter(m=>typeof u[u[m]]!="number"),h={};for(const m of d)h[m]=u[m];return r.objectValues(h)},r.objectValues=u=>r.objectKeys(u).map(function(d){return u[d]}),r.objectKeys=typeof Object.keys=="function"?u=>Object.keys(u):u=>{const d=[];for(const h in u)Object.prototype.hasOwnProperty.call(u,h)&&d.push(h);return d},r.find=(u,d)=>{for(const h of u)if(d(h))return h},r.isInteger=typeof Number.isInteger=="function"?u=>Number.isInteger(u):u=>typeof u=="number"&&isFinite(u)&&Math.floor(u)===u;function c(u,d=" | "){return u.map(h=>typeof h=="string"?`'${h}'`:h).join(d)}r.joinValues=c,r.jsonStringifyReplacer=(u,d)=>typeof d=="bigint"?d.toString():d})(t=e.util||(e.util={})),function(r){r.mergeShapes=(s,a)=>({...s,...a})}(e.objectUtil||(e.objectUtil={})),e.ZodParsedType=t.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);const n=r=>{switch(typeof r){case"undefined":return e.ZodParsedType.undefined;case"string":return e.ZodParsedType.string;case"number":return isNaN(r)?e.ZodParsedType.nan:e.ZodParsedType.number;case"boolean":return e.ZodParsedType.boolean;case"function":return e.ZodParsedType.function;case"bigint":return e.ZodParsedType.bigint;case"symbol":return e.ZodParsedType.symbol;case"object":return Array.isArray(r)?e.ZodParsedType.array:r===null?e.ZodParsedType.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?e.ZodParsedType.promise:typeof Map<"u"&&r instanceof Map?e.ZodParsedType.map:typeof Set<"u"&&r instanceof Set?e.ZodParsedType.set:typeof Date<"u"&&r instanceof Date?e.ZodParsedType.date:e.ZodParsedType.object;default:return e.ZodParsedType.unknown}};e.getParsedType=n})(Zi);var zt={};Object.defineProperty(zt,"__esModule",{value:!0});zt.ZodError=zt.quotelessJson=zt.ZodIssueCode=void 0;const Dd=Zi;zt.ZodIssueCode=Dd.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);const lG=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");zt.quotelessJson=lG;class la extends Error{constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){const n=t||function(a){return a.message},r={_errors:[]},s=a=>{for(const c of a.issues)if(c.code==="invalid_union")c.unionErrors.map(s);else if(c.code==="invalid_return_type")s(c.returnTypeError);else if(c.code==="invalid_arguments")s(c.argumentsError);else if(c.path.length===0)r._errors.push(n(c));else{let u=r,d=0;for(;d<c.path.length;){const h=c.path[d];d===c.path.length-1?(u[h]=u[h]||{_errors:[]},u[h]._errors.push(n(c))):u[h]=u[h]||{_errors:[]},u=u[h],d++}}};return s(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,Dd.util.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const s of this.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(t(s))):r.push(t(s));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}zt.ZodError=la;la.create=e=>new la(e);Object.defineProperty(Us,"__esModule",{value:!0});const _n=Zi,je=zt,gG=(e,t)=>{let n;switch(e.code){case je.ZodIssueCode.invalid_type:e.received===_n.ZodParsedType.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case je.ZodIssueCode.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,_n.util.jsonStringifyReplacer)}`;break;case je.ZodIssueCode.unrecognized_keys:n=`Unrecognized key(s) in object: ${_n.util.joinValues(e.keys,", ")}`;break;case je.ZodIssueCode.invalid_union:n="Invalid input";break;case je.ZodIssueCode.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${_n.util.joinValues(e.options)}`;break;case je.ZodIssueCode.invalid_enum_value:n=`Invalid enum value. Expected ${_n.util.joinValues(e.options)}, received '${e.received}'`;break;case je.ZodIssueCode.invalid_arguments:n="Invalid function arguments";break;case je.ZodIssueCode.invalid_return_type:n="Invalid function return type";break;case je.ZodIssueCode.invalid_date:n="Invalid date";break;case je.ZodIssueCode.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:_n.util.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case je.ZodIssueCode.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case je.ZodIssueCode.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case je.ZodIssueCode.custom:n="Invalid input";break;case je.ZodIssueCode.invalid_intersection_types:n="Intersection results could not be merged";break;case je.ZodIssueCode.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case je.ZodIssueCode.not_finite:n="Number must be finite";break;default:n=t.defaultError,_n.util.assertNever(e)}return{message:n}};Us.default=gG;var uG=We&&We.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Jt,"__esModule",{value:!0});Jt.getErrorMap=Jt.setErrorMap=Jt.defaultErrorMap=void 0;const $d=uG(Us);Jt.defaultErrorMap=$d.default;let qd=$d.default;function dG(e){qd=e}Jt.setErrorMap=dG;function IG(){return qd}Jt.getErrorMap=IG;var ac={};(function(e){var t=We&&We.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(e,"__esModule",{value:!0}),e.isAsync=e.isValid=e.isDirty=e.isAborted=e.OK=e.DIRTY=e.INVALID=e.ParseStatus=e.addIssueToContext=e.EMPTY_PATH=e.makeIssue=void 0;const n=Jt,r=t(Us),s=_=>{const{data:F,path:Q,errorMaps:z,issueData:te}=_,ce=[...Q,...te.path||[]],re={...te,path:ce};let Ie="";const fe=z.filter(oe=>!!oe).slice().reverse();for(const oe of fe)Ie=oe(re,{data:F,defaultError:Ie}).message;return{...te,path:ce,message:te.message||Ie}};e.makeIssue=s,e.EMPTY_PATH=[];function a(_,F){const Q=(0,e.makeIssue)({issueData:F,data:_.data,path:_.path,errorMaps:[_.common.contextualErrorMap,_.schemaErrorMap,(0,n.getErrorMap)(),r.default].filter(z=>!!z)});_.common.issues.push(Q)}e.addIssueToContext=a;class c{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(F,Q){const z=[];for(const te of Q){if(te.status==="aborted")return e.INVALID;te.status==="dirty"&&F.dirty(),z.push(te.value)}return{status:F.value,value:z}}static async mergeObjectAsync(F,Q){const z=[];for(const te of Q)z.push({key:await te.key,value:await te.value});return c.mergeObjectSync(F,z)}static mergeObjectSync(F,Q){const z={};for(const te of Q){const{key:ce,value:re}=te;if(ce.status==="aborted"||re.status==="aborted")return e.INVALID;ce.status==="dirty"&&F.dirty(),re.status==="dirty"&&F.dirty(),ce.value!=="__proto__"&&(typeof re.value<"u"||te.alwaysSet)&&(z[ce.value]=re.value)}return{status:F.value,value:z}}}e.ParseStatus=c,e.INVALID=Object.freeze({status:"aborted"});const u=_=>({status:"dirty",value:_});e.DIRTY=u;const d=_=>({status:"valid",value:_});e.OK=d;const h=_=>_.status==="aborted";e.isAborted=h;const m=_=>_.status==="dirty";e.isDirty=m;const y=_=>_.status==="valid";e.isValid=y;const v=_=>typeof Promise<"u"&&_ instanceof Promise;e.isAsync=v})(ac);var eI={};Object.defineProperty(eI,"__esModule",{value:!0});var tI={},nI={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.errorUtil=void 0,function(t){t.errToObj=n=>typeof n=="string"?{message:n}:n||{},t.toString=n=>typeof n=="string"?n:n==null?void 0:n.message}(e.errorUtil||(e.errorUtil={}))})(nI);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.date=e.boolean=e.bigint=e.array=e.any=e.coerce=e.ZodFirstPartyTypeKind=e.late=e.ZodSchema=e.Schema=e.custom=e.ZodReadonly=e.ZodPipeline=e.ZodBranded=e.BRAND=e.ZodNaN=e.ZodCatch=e.ZodDefault=e.ZodNullable=e.ZodOptional=e.ZodTransformer=e.ZodEffects=e.ZodPromise=e.ZodNativeEnum=e.ZodEnum=e.ZodLiteral=e.ZodLazy=e.ZodFunction=e.ZodSet=e.ZodMap=e.ZodRecord=e.ZodTuple=e.ZodIntersection=e.ZodDiscriminatedUnion=e.ZodUnion=e.ZodObject=e.ZodArray=e.ZodVoid=e.ZodNever=e.ZodUnknown=e.ZodAny=e.ZodNull=e.ZodUndefined=e.ZodSymbol=e.ZodDate=e.ZodBoolean=e.ZodBigInt=e.ZodNumber=e.ZodString=e.ZodType=void 0,e.NEVER=e.void=e.unknown=e.union=e.undefined=e.tuple=e.transformer=e.symbol=e.string=e.strictObject=e.set=e.record=e.promise=e.preprocess=e.pipeline=e.ostring=e.optional=e.onumber=e.oboolean=e.object=e.number=e.nullable=e.null=e.never=e.nativeEnum=e.nan=e.map=e.literal=e.lazy=e.intersection=e.instanceof=e.function=e.enum=e.effect=e.discriminatedUnion=void 0;const t=Jt,n=nI,r=ac,s=Zi,a=zt;class c{constructor(g,b,f,V){this._cachedPath=[],this.parent=g,this.data=b,this._path=f,this._key=V}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const u=(G,g)=>{if((0,r.isValid)(g))return{success:!0,data:g.value};if(!G.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const b=new a.ZodError(G.common.issues);return this._error=b,this._error}}};function d(G){if(!G)return{};const{errorMap:g,invalid_type_error:b,required_error:f,description:V}=G;if(g&&(b||f))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return g?{errorMap:g,description:V}:{errorMap:(O,E)=>O.code!=="invalid_type"?{message:E.defaultError}:typeof E.data>"u"?{message:f??E.defaultError}:{message:b??E.defaultError},description:V}}class h{constructor(g){this.spa=this.safeParseAsync,this._def=g,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(g){return(0,s.getParsedType)(g.data)}_getOrReturnCtx(g,b){return b||{common:g.parent.common,data:g.data,parsedType:(0,s.getParsedType)(g.data),schemaErrorMap:this._def.errorMap,path:g.path,parent:g.parent}}_processInputParams(g){return{status:new r.ParseStatus,ctx:{common:g.parent.common,data:g.data,parsedType:(0,s.getParsedType)(g.data),schemaErrorMap:this._def.errorMap,path:g.path,parent:g.parent}}}_parseSync(g){const b=this._parse(g);if((0,r.isAsync)(b))throw new Error("Synchronous parse encountered promise.");return b}_parseAsync(g){const b=this._parse(g);return Promise.resolve(b)}parse(g,b){const f=this.safeParse(g,b);if(f.success)return f.data;throw f.error}safeParse(g,b){var f;const V={common:{issues:[],async:(f=b==null?void 0:b.async)!==null&&f!==void 0?f:!1,contextualErrorMap:b==null?void 0:b.errorMap},path:(b==null?void 0:b.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:g,parsedType:(0,s.getParsedType)(g)},A=this._parseSync({data:g,path:V.path,parent:V});return u(V,A)}async parseAsync(g,b){const f=await this.safeParseAsync(g,b);if(f.success)return f.data;throw f.error}async safeParseAsync(g,b){const f={common:{issues:[],contextualErrorMap:b==null?void 0:b.errorMap,async:!0},path:(b==null?void 0:b.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:g,parsedType:(0,s.getParsedType)(g)},V=this._parse({data:g,path:f.path,parent:f}),A=await((0,r.isAsync)(V)?V:Promise.resolve(V));return u(f,A)}refine(g,b){const f=V=>typeof b=="string"||typeof b>"u"?{message:b}:typeof b=="function"?b(V):b;return this._refinement((V,A)=>{const O=g(V),E=()=>A.addIssue({code:a.ZodIssueCode.custom,...f(V)});return typeof Promise<"u"&&O instanceof Promise?O.then(ae=>ae?!0:(E(),!1)):O?!0:(E(),!1)})}refinement(g,b){return this._refinement((f,V)=>g(f)?!0:(V.addIssue(typeof b=="function"?b(f,V):b),!1))}_refinement(g){return new lt({schema:this,typeName:le.ZodEffects,effect:{type:"refinement",refinement:g}})}superRefine(g){return this._refinement(g)}optional(){return ft.create(this,this._def)}nullable(){return xt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ct.create(this,this._def)}promise(){return ot.create(this,this._def)}or(g){return De.create([this,g],this._def)}and(g){return tn.create(this,g,this._def)}transform(g){return new lt({...d(this._def),schema:this,typeName:le.ZodEffects,effect:{type:"transform",transform:g}})}default(g){const b=typeof g=="function"?g:()=>g;return new Rn({...d(this._def),innerType:this,defaultValue:b,typeName:le.ZodDefault})}brand(){return new Fr({typeName:le.ZodBranded,type:this,...d(this._def)})}catch(g){const b=typeof g=="function"?g:()=>g;return new sn({...d(this._def),innerType:this,catchValue:b,typeName:le.ZodCatch})}describe(g){const b=this.constructor;return new b({...this._def,description:g})}pipe(g){return Zt.create(this,g)}readonly(){return Yn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}e.ZodType=h,e.Schema=h,e.ZodSchema=h;const m=/^c[^\s-]{8,}$/i,y=/^[a-z][a-z0-9]*$/,v=/[0-9A-HJKMNP-TV-Z]{26}/,_=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,F=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Q=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,z=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,te=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ce=G=>G.precision?G.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${G.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${G.precision}}Z$`):G.precision===0?G.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):G.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function re(G,g){return!!((g==="v4"||!g)&&z.test(G)||(g==="v6"||!g)&&te.test(G))}class Ie extends h{constructor(){super(...arguments),this._regex=(g,b,f)=>this.refinement(V=>g.test(V),{validation:b,code:a.ZodIssueCode.invalid_string,...n.errorUtil.errToObj(f)}),this.nonempty=g=>this.min(1,n.errorUtil.errToObj(g)),this.trim=()=>new Ie({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new Ie({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new Ie({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(g){if(this._def.coerce&&(g.data=String(g.data)),this._getType(g)!==s.ZodParsedType.string){const A=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(A,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.string,received:A.parsedType}),r.INVALID}const f=new r.ParseStatus;let V;for(const A of this._def.checks)if(A.kind==="min")g.data.length<A.value&&(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{code:a.ZodIssueCode.too_small,minimum:A.value,type:"string",inclusive:!0,exact:!1,message:A.message}),f.dirty());else if(A.kind==="max")g.data.length>A.value&&(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{code:a.ZodIssueCode.too_big,maximum:A.value,type:"string",inclusive:!0,exact:!1,message:A.message}),f.dirty());else if(A.kind==="length"){const O=g.data.length>A.value,E=g.data.length<A.value;(O||E)&&(V=this._getOrReturnCtx(g,V),O?(0,r.addIssueToContext)(V,{code:a.ZodIssueCode.too_big,maximum:A.value,type:"string",inclusive:!0,exact:!0,message:A.message}):E&&(0,r.addIssueToContext)(V,{code:a.ZodIssueCode.too_small,minimum:A.value,type:"string",inclusive:!0,exact:!0,message:A.message}),f.dirty())}else if(A.kind==="email")F.test(g.data)||(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{validation:"email",code:a.ZodIssueCode.invalid_string,message:A.message}),f.dirty());else if(A.kind==="emoji")Q.test(g.data)||(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{validation:"emoji",code:a.ZodIssueCode.invalid_string,message:A.message}),f.dirty());else if(A.kind==="uuid")_.test(g.data)||(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{validation:"uuid",code:a.ZodIssueCode.invalid_string,message:A.message}),f.dirty());else if(A.kind==="cuid")m.test(g.data)||(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{validation:"cuid",code:a.ZodIssueCode.invalid_string,message:A.message}),f.dirty());else if(A.kind==="cuid2")y.test(g.data)||(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{validation:"cuid2",code:a.ZodIssueCode.invalid_string,message:A.message}),f.dirty());else if(A.kind==="ulid")v.test(g.data)||(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{validation:"ulid",code:a.ZodIssueCode.invalid_string,message:A.message}),f.dirty());else if(A.kind==="url")try{new URL(g.data)}catch{V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{validation:"url",code:a.ZodIssueCode.invalid_string,message:A.message}),f.dirty()}else A.kind==="regex"?(A.regex.lastIndex=0,A.regex.test(g.data)||(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{validation:"regex",code:a.ZodIssueCode.invalid_string,message:A.message}),f.dirty())):A.kind==="trim"?g.data=g.data.trim():A.kind==="includes"?g.data.includes(A.value,A.position)||(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{code:a.ZodIssueCode.invalid_string,validation:{includes:A.value,position:A.position},message:A.message}),f.dirty()):A.kind==="toLowerCase"?g.data=g.data.toLowerCase():A.kind==="toUpperCase"?g.data=g.data.toUpperCase():A.kind==="startsWith"?g.data.startsWith(A.value)||(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{code:a.ZodIssueCode.invalid_string,validation:{startsWith:A.value},message:A.message}),f.dirty()):A.kind==="endsWith"?g.data.endsWith(A.value)||(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{code:a.ZodIssueCode.invalid_string,validation:{endsWith:A.value},message:A.message}),f.dirty()):A.kind==="datetime"?ce(A).test(g.data)||(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{code:a.ZodIssueCode.invalid_string,validation:"datetime",message:A.message}),f.dirty()):A.kind==="ip"?re(g.data,A.version)||(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{validation:"ip",code:a.ZodIssueCode.invalid_string,message:A.message}),f.dirty()):s.util.assertNever(A);return{status:f.value,value:g.data}}_addCheck(g){return new Ie({...this._def,checks:[...this._def.checks,g]})}email(g){return this._addCheck({kind:"email",...n.errorUtil.errToObj(g)})}url(g){return this._addCheck({kind:"url",...n.errorUtil.errToObj(g)})}emoji(g){return this._addCheck({kind:"emoji",...n.errorUtil.errToObj(g)})}uuid(g){return this._addCheck({kind:"uuid",...n.errorUtil.errToObj(g)})}cuid(g){return this._addCheck({kind:"cuid",...n.errorUtil.errToObj(g)})}cuid2(g){return this._addCheck({kind:"cuid2",...n.errorUtil.errToObj(g)})}ulid(g){return this._addCheck({kind:"ulid",...n.errorUtil.errToObj(g)})}ip(g){return this._addCheck({kind:"ip",...n.errorUtil.errToObj(g)})}datetime(g){var b;return typeof g=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:g}):this._addCheck({kind:"datetime",precision:typeof(g==null?void 0:g.precision)>"u"?null:g==null?void 0:g.precision,offset:(b=g==null?void 0:g.offset)!==null&&b!==void 0?b:!1,...n.errorUtil.errToObj(g==null?void 0:g.message)})}regex(g,b){return this._addCheck({kind:"regex",regex:g,...n.errorUtil.errToObj(b)})}includes(g,b){return this._addCheck({kind:"includes",value:g,position:b==null?void 0:b.position,...n.errorUtil.errToObj(b==null?void 0:b.message)})}startsWith(g,b){return this._addCheck({kind:"startsWith",value:g,...n.errorUtil.errToObj(b)})}endsWith(g,b){return this._addCheck({kind:"endsWith",value:g,...n.errorUtil.errToObj(b)})}min(g,b){return this._addCheck({kind:"min",value:g,...n.errorUtil.errToObj(b)})}max(g,b){return this._addCheck({kind:"max",value:g,...n.errorUtil.errToObj(b)})}length(g,b){return this._addCheck({kind:"length",value:g,...n.errorUtil.errToObj(b)})}get isDatetime(){return!!this._def.checks.find(g=>g.kind==="datetime")}get isEmail(){return!!this._def.checks.find(g=>g.kind==="email")}get isURL(){return!!this._def.checks.find(g=>g.kind==="url")}get isEmoji(){return!!this._def.checks.find(g=>g.kind==="emoji")}get isUUID(){return!!this._def.checks.find(g=>g.kind==="uuid")}get isCUID(){return!!this._def.checks.find(g=>g.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(g=>g.kind==="cuid2")}get isULID(){return!!this._def.checks.find(g=>g.kind==="ulid")}get isIP(){return!!this._def.checks.find(g=>g.kind==="ip")}get minLength(){let g=null;for(const b of this._def.checks)b.kind==="min"&&(g===null||b.value>g)&&(g=b.value);return g}get maxLength(){let g=null;for(const b of this._def.checks)b.kind==="max"&&(g===null||b.value<g)&&(g=b.value);return g}}e.ZodString=Ie,Ie.create=G=>{var g;return new Ie({checks:[],typeName:le.ZodString,coerce:(g=G==null?void 0:G.coerce)!==null&&g!==void 0?g:!1,...d(G)})};function fe(G,g){const b=(G.toString().split(".")[1]||"").length,f=(g.toString().split(".")[1]||"").length,V=b>f?b:f,A=parseInt(G.toFixed(V).replace(".","")),O=parseInt(g.toFixed(V).replace(".",""));return A%O/Math.pow(10,V)}class oe extends h{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(g){if(this._def.coerce&&(g.data=Number(g.data)),this._getType(g)!==s.ZodParsedType.number){const A=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(A,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.number,received:A.parsedType}),r.INVALID}let f;const V=new r.ParseStatus;for(const A of this._def.checks)A.kind==="int"?s.util.isInteger(g.data)||(f=this._getOrReturnCtx(g,f),(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:A.message}),V.dirty()):A.kind==="min"?(A.inclusive?g.data<A.value:g.data<=A.value)&&(f=this._getOrReturnCtx(g,f),(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.too_small,minimum:A.value,type:"number",inclusive:A.inclusive,exact:!1,message:A.message}),V.dirty()):A.kind==="max"?(A.inclusive?g.data>A.value:g.data>=A.value)&&(f=this._getOrReturnCtx(g,f),(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.too_big,maximum:A.value,type:"number",inclusive:A.inclusive,exact:!1,message:A.message}),V.dirty()):A.kind==="multipleOf"?fe(g.data,A.value)!==0&&(f=this._getOrReturnCtx(g,f),(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.not_multiple_of,multipleOf:A.value,message:A.message}),V.dirty()):A.kind==="finite"?Number.isFinite(g.data)||(f=this._getOrReturnCtx(g,f),(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.not_finite,message:A.message}),V.dirty()):s.util.assertNever(A);return{status:V.value,value:g.data}}gte(g,b){return this.setLimit("min",g,!0,n.errorUtil.toString(b))}gt(g,b){return this.setLimit("min",g,!1,n.errorUtil.toString(b))}lte(g,b){return this.setLimit("max",g,!0,n.errorUtil.toString(b))}lt(g,b){return this.setLimit("max",g,!1,n.errorUtil.toString(b))}setLimit(g,b,f,V){return new oe({...this._def,checks:[...this._def.checks,{kind:g,value:b,inclusive:f,message:n.errorUtil.toString(V)}]})}_addCheck(g){return new oe({...this._def,checks:[...this._def.checks,g]})}int(g){return this._addCheck({kind:"int",message:n.errorUtil.toString(g)})}positive(g){return this._addCheck({kind:"min",value:0,inclusive:!1,message:n.errorUtil.toString(g)})}negative(g){return this._addCheck({kind:"max",value:0,inclusive:!1,message:n.errorUtil.toString(g)})}nonpositive(g){return this._addCheck({kind:"max",value:0,inclusive:!0,message:n.errorUtil.toString(g)})}nonnegative(g){return this._addCheck({kind:"min",value:0,inclusive:!0,message:n.errorUtil.toString(g)})}multipleOf(g,b){return this._addCheck({kind:"multipleOf",value:g,message:n.errorUtil.toString(b)})}finite(g){return this._addCheck({kind:"finite",message:n.errorUtil.toString(g)})}safe(g){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:n.errorUtil.toString(g)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:n.errorUtil.toString(g)})}get minValue(){let g=null;for(const b of this._def.checks)b.kind==="min"&&(g===null||b.value>g)&&(g=b.value);return g}get maxValue(){let g=null;for(const b of this._def.checks)b.kind==="max"&&(g===null||b.value<g)&&(g=b.value);return g}get isInt(){return!!this._def.checks.find(g=>g.kind==="int"||g.kind==="multipleOf"&&s.util.isInteger(g.value))}get isFinite(){let g=null,b=null;for(const f of this._def.checks){if(f.kind==="finite"||f.kind==="int"||f.kind==="multipleOf")return!0;f.kind==="min"?(b===null||f.value>b)&&(b=f.value):f.kind==="max"&&(g===null||f.value<g)&&(g=f.value)}return Number.isFinite(b)&&Number.isFinite(g)}}e.ZodNumber=oe,oe.create=G=>new oe({checks:[],typeName:le.ZodNumber,coerce:(G==null?void 0:G.coerce)||!1,...d(G)});class ue extends h{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(g){if(this._def.coerce&&(g.data=BigInt(g.data)),this._getType(g)!==s.ZodParsedType.bigint){const A=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(A,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.bigint,received:A.parsedType}),r.INVALID}let f;const V=new r.ParseStatus;for(const A of this._def.checks)A.kind==="min"?(A.inclusive?g.data<A.value:g.data<=A.value)&&(f=this._getOrReturnCtx(g,f),(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.too_small,type:"bigint",minimum:A.value,inclusive:A.inclusive,message:A.message}),V.dirty()):A.kind==="max"?(A.inclusive?g.data>A.value:g.data>=A.value)&&(f=this._getOrReturnCtx(g,f),(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.too_big,type:"bigint",maximum:A.value,inclusive:A.inclusive,message:A.message}),V.dirty()):A.kind==="multipleOf"?g.data%A.value!==BigInt(0)&&(f=this._getOrReturnCtx(g,f),(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.not_multiple_of,multipleOf:A.value,message:A.message}),V.dirty()):s.util.assertNever(A);return{status:V.value,value:g.data}}gte(g,b){return this.setLimit("min",g,!0,n.errorUtil.toString(b))}gt(g,b){return this.setLimit("min",g,!1,n.errorUtil.toString(b))}lte(g,b){return this.setLimit("max",g,!0,n.errorUtil.toString(b))}lt(g,b){return this.setLimit("max",g,!1,n.errorUtil.toString(b))}setLimit(g,b,f,V){return new ue({...this._def,checks:[...this._def.checks,{kind:g,value:b,inclusive:f,message:n.errorUtil.toString(V)}]})}_addCheck(g){return new ue({...this._def,checks:[...this._def.checks,g]})}positive(g){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:n.errorUtil.toString(g)})}negative(g){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:n.errorUtil.toString(g)})}nonpositive(g){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:n.errorUtil.toString(g)})}nonnegative(g){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:n.errorUtil.toString(g)})}multipleOf(g,b){return this._addCheck({kind:"multipleOf",value:g,message:n.errorUtil.toString(b)})}get minValue(){let g=null;for(const b of this._def.checks)b.kind==="min"&&(g===null||b.value>g)&&(g=b.value);return g}get maxValue(){let g=null;for(const b of this._def.checks)b.kind==="max"&&(g===null||b.value<g)&&(g=b.value);return g}}e.ZodBigInt=ue,ue.create=G=>{var g;return new ue({checks:[],typeName:le.ZodBigInt,coerce:(g=G==null?void 0:G.coerce)!==null&&g!==void 0?g:!1,...d(G)})};class Ke extends h{_parse(g){if(this._def.coerce&&(g.data=!!g.data),this._getType(g)!==s.ZodParsedType.boolean){const f=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.boolean,received:f.parsedType}),r.INVALID}return(0,r.OK)(g.data)}}e.ZodBoolean=Ke,Ke.create=G=>new Ke({typeName:le.ZodBoolean,coerce:(G==null?void 0:G.coerce)||!1,...d(G)});class Ue extends h{_parse(g){if(this._def.coerce&&(g.data=new Date(g.data)),this._getType(g)!==s.ZodParsedType.date){const A=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(A,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.date,received:A.parsedType}),r.INVALID}if(isNaN(g.data.getTime())){const A=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(A,{code:a.ZodIssueCode.invalid_date}),r.INVALID}const f=new r.ParseStatus;let V;for(const A of this._def.checks)A.kind==="min"?g.data.getTime()<A.value&&(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{code:a.ZodIssueCode.too_small,message:A.message,inclusive:!0,exact:!1,minimum:A.value,type:"date"}),f.dirty()):A.kind==="max"?g.data.getTime()>A.value&&(V=this._getOrReturnCtx(g,V),(0,r.addIssueToContext)(V,{code:a.ZodIssueCode.too_big,message:A.message,inclusive:!0,exact:!1,maximum:A.value,type:"date"}),f.dirty()):s.util.assertNever(A);return{status:f.value,value:new Date(g.data.getTime())}}_addCheck(g){return new Ue({...this._def,checks:[...this._def.checks,g]})}min(g,b){return this._addCheck({kind:"min",value:g.getTime(),message:n.errorUtil.toString(b)})}max(g,b){return this._addCheck({kind:"max",value:g.getTime(),message:n.errorUtil.toString(b)})}get minDate(){let g=null;for(const b of this._def.checks)b.kind==="min"&&(g===null||b.value>g)&&(g=b.value);return g!=null?new Date(g):null}get maxDate(){let g=null;for(const b of this._def.checks)b.kind==="max"&&(g===null||b.value<g)&&(g=b.value);return g!=null?new Date(g):null}}e.ZodDate=Ue,Ue.create=G=>new Ue({checks:[],coerce:(G==null?void 0:G.coerce)||!1,typeName:le.ZodDate,...d(G)});class dt extends h{_parse(g){if(this._getType(g)!==s.ZodParsedType.symbol){const f=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.symbol,received:f.parsedType}),r.INVALID}return(0,r.OK)(g.data)}}e.ZodSymbol=dt,dt.create=G=>new dt({typeName:le.ZodSymbol,...d(G)});class It extends h{_parse(g){if(this._getType(g)!==s.ZodParsedType.undefined){const f=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.undefined,received:f.parsedType}),r.INVALID}return(0,r.OK)(g.data)}}e.ZodUndefined=It,It.create=G=>new It({typeName:le.ZodUndefined,...d(G)});class Ee extends h{_parse(g){if(this._getType(g)!==s.ZodParsedType.null){const f=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.null,received:f.parsedType}),r.INVALID}return(0,r.OK)(g.data)}}e.ZodNull=Ee,Ee.create=G=>new Ee({typeName:le.ZodNull,...d(G)});class Ne extends h{constructor(){super(...arguments),this._any=!0}_parse(g){return(0,r.OK)(g.data)}}e.ZodAny=Ne,Ne.create=G=>new Ne({typeName:le.ZodAny,...d(G)});class rt extends h{constructor(){super(...arguments),this._unknown=!0}_parse(g){return(0,r.OK)(g.data)}}e.ZodUnknown=rt,rt.create=G=>new rt({typeName:le.ZodUnknown,...d(G)});class Pe extends h{_parse(g){const b=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(b,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.never,received:b.parsedType}),r.INVALID}}e.ZodNever=Pe,Pe.create=G=>new Pe({typeName:le.ZodNever,...d(G)});class mt extends h{_parse(g){if(this._getType(g)!==s.ZodParsedType.undefined){const f=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.void,received:f.parsedType}),r.INVALID}return(0,r.OK)(g.data)}}e.ZodVoid=mt,mt.create=G=>new mt({typeName:le.ZodVoid,...d(G)});class ct extends h{_parse(g){const{ctx:b,status:f}=this._processInputParams(g),V=this._def;if(b.parsedType!==s.ZodParsedType.array)return(0,r.addIssueToContext)(b,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.array,received:b.parsedType}),r.INVALID;if(V.exactLength!==null){const O=b.data.length>V.exactLength.value,E=b.data.length<V.exactLength.value;(O||E)&&((0,r.addIssueToContext)(b,{code:O?a.ZodIssueCode.too_big:a.ZodIssueCode.too_small,minimum:E?V.exactLength.value:void 0,maximum:O?V.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:V.exactLength.message}),f.dirty())}if(V.minLength!==null&&b.data.length<V.minLength.value&&((0,r.addIssueToContext)(b,{code:a.ZodIssueCode.too_small,minimum:V.minLength.value,type:"array",inclusive:!0,exact:!1,message:V.minLength.message}),f.dirty()),V.maxLength!==null&&b.data.length>V.maxLength.value&&((0,r.addIssueToContext)(b,{code:a.ZodIssueCode.too_big,maximum:V.maxLength.value,type:"array",inclusive:!0,exact:!1,message:V.maxLength.message}),f.dirty()),b.common.async)return Promise.all([...b.data].map((O,E)=>V.type._parseAsync(new c(b,O,b.path,E)))).then(O=>r.ParseStatus.mergeArray(f,O));const A=[...b.data].map((O,E)=>V.type._parseSync(new c(b,O,b.path,E)));return r.ParseStatus.mergeArray(f,A)}get element(){return this._def.type}min(g,b){return new ct({...this._def,minLength:{value:g,message:n.errorUtil.toString(b)}})}max(g,b){return new ct({...this._def,maxLength:{value:g,message:n.errorUtil.toString(b)}})}length(g,b){return new ct({...this._def,exactLength:{value:g,message:n.errorUtil.toString(b)}})}nonempty(g){return this.min(1,g)}}e.ZodArray=ct,ct.create=(G,g)=>new ct({type:G,minLength:null,maxLength:null,exactLength:null,typeName:le.ZodArray,...d(g)});function it(G){if(G instanceof Ae){const g={};for(const b in G.shape){const f=G.shape[b];g[b]=ft.create(it(f))}return new Ae({...G._def,shape:()=>g})}else return G instanceof ct?new ct({...G._def,type:it(G.element)}):G instanceof ft?ft.create(it(G.unwrap())):G instanceof xt?xt.create(it(G.unwrap())):G instanceof $e?$e.create(G.items.map(g=>it(g))):G}class Ae extends h{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const g=this._def.shape(),b=s.util.objectKeys(g);return this._cached={shape:g,keys:b}}_parse(g){if(this._getType(g)!==s.ZodParsedType.object){const ne=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(ne,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.object,received:ne.parsedType}),r.INVALID}const{status:f,ctx:V}=this._processInputParams(g),{shape:A,keys:O}=this._getCached(),E=[];if(!(this._def.catchall instanceof Pe&&this._def.unknownKeys==="strip"))for(const ne in V.data)O.includes(ne)||E.push(ne);const ae=[];for(const ne of O){const he=A[ne],Fe=V.data[ne];ae.push({key:{status:"valid",value:ne},value:he._parse(new c(V,Fe,V.path,ne)),alwaysSet:ne in V.data})}if(this._def.catchall instanceof Pe){const ne=this._def.unknownKeys;if(ne==="passthrough")for(const he of E)ae.push({key:{status:"valid",value:he},value:{status:"valid",value:V.data[he]}});else if(ne==="strict")E.length>0&&((0,r.addIssueToContext)(V,{code:a.ZodIssueCode.unrecognized_keys,keys:E}),f.dirty());else if(ne!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const ne=this._def.catchall;for(const he of E){const Fe=V.data[he];ae.push({key:{status:"valid",value:he},value:ne._parse(new c(V,Fe,V.path,he)),alwaysSet:he in V.data})}}return V.common.async?Promise.resolve().then(async()=>{const ne=[];for(const he of ae){const Fe=await he.key;ne.push({key:Fe,value:await he.value,alwaysSet:he.alwaysSet})}return ne}).then(ne=>r.ParseStatus.mergeObjectSync(f,ne)):r.ParseStatus.mergeObjectSync(f,ae)}get shape(){return this._def.shape()}strict(g){return n.errorUtil.errToObj,new Ae({...this._def,unknownKeys:"strict",...g!==void 0?{errorMap:(b,f)=>{var V,A,O,E;const ae=(O=(A=(V=this._def).errorMap)===null||A===void 0?void 0:A.call(V,b,f).message)!==null&&O!==void 0?O:f.defaultError;return b.code==="unrecognized_keys"?{message:(E=n.errorUtil.errToObj(g).message)!==null&&E!==void 0?E:ae}:{message:ae}}}:{}})}strip(){return new Ae({...this._def,unknownKeys:"strip"})}passthrough(){return new Ae({...this._def,unknownKeys:"passthrough"})}extend(g){return new Ae({...this._def,shape:()=>({...this._def.shape(),...g})})}merge(g){return new Ae({unknownKeys:g._def.unknownKeys,catchall:g._def.catchall,shape:()=>({...this._def.shape(),...g._def.shape()}),typeName:le.ZodObject})}setKey(g,b){return this.augment({[g]:b})}catchall(g){return new Ae({...this._def,catchall:g})}pick(g){const b={};return s.util.objectKeys(g).forEach(f=>{g[f]&&this.shape[f]&&(b[f]=this.shape[f])}),new Ae({...this._def,shape:()=>b})}omit(g){const b={};return s.util.objectKeys(this.shape).forEach(f=>{g[f]||(b[f]=this.shape[f])}),new Ae({...this._def,shape:()=>b})}deepPartial(){return it(this)}partial(g){const b={};return s.util.objectKeys(this.shape).forEach(f=>{const V=this.shape[f];g&&!g[f]?b[f]=V:b[f]=V.optional()}),new Ae({...this._def,shape:()=>b})}required(g){const b={};return s.util.objectKeys(this.shape).forEach(f=>{if(g&&!g[f])b[f]=this.shape[f];else{let A=this.shape[f];for(;A instanceof ft;)A=A._def.innerType;b[f]=A}}),new Ae({...this._def,shape:()=>b})}keyof(){return Ge(s.util.objectKeys(this.shape))}}e.ZodObject=Ae,Ae.create=(G,g)=>new Ae({shape:()=>G,unknownKeys:"strip",catchall:Pe.create(),typeName:le.ZodObject,...d(g)}),Ae.strictCreate=(G,g)=>new Ae({shape:()=>G,unknownKeys:"strict",catchall:Pe.create(),typeName:le.ZodObject,...d(g)}),Ae.lazycreate=(G,g)=>new Ae({shape:G,unknownKeys:"strip",catchall:Pe.create(),typeName:le.ZodObject,...d(g)});class De extends h{_parse(g){const{ctx:b}=this._processInputParams(g),f=this._def.options;function V(A){for(const E of A)if(E.result.status==="valid")return E.result;for(const E of A)if(E.result.status==="dirty")return b.common.issues.push(...E.ctx.common.issues),E.result;const O=A.map(E=>new a.ZodError(E.ctx.common.issues));return(0,r.addIssueToContext)(b,{code:a.ZodIssueCode.invalid_union,unionErrors:O}),r.INVALID}if(b.common.async)return Promise.all(f.map(async A=>{const O={...b,common:{...b.common,issues:[]},parent:null};return{result:await A._parseAsync({data:b.data,path:b.path,parent:O}),ctx:O}})).then(V);{let A;const O=[];for(const ae of f){const ne={...b,common:{...b.common,issues:[]},parent:null},he=ae._parseSync({data:b.data,path:b.path,parent:ne});if(he.status==="valid")return he;he.status==="dirty"&&!A&&(A={result:he,ctx:ne}),ne.common.issues.length&&O.push(ne.common.issues)}if(A)return b.common.issues.push(...A.ctx.common.issues),A.result;const E=O.map(ae=>new a.ZodError(ae));return(0,r.addIssueToContext)(b,{code:a.ZodIssueCode.invalid_union,unionErrors:E}),r.INVALID}}get options(){return this._def.options}}e.ZodUnion=De,De.create=(G,g)=>new De({options:G,typeName:le.ZodUnion,...d(g)});const en=G=>G instanceof rn?en(G.schema):G instanceof lt?en(G.innerType()):G instanceof Wt?[G.value]:G instanceof st?G.options:G instanceof Vn?Object.keys(G.enum):G instanceof Rn?en(G._def.innerType):G instanceof It?[void 0]:G instanceof Ee?[null]:null;class Mn extends h{_parse(g){const{ctx:b}=this._processInputParams(g);if(b.parsedType!==s.ZodParsedType.object)return(0,r.addIssueToContext)(b,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.object,received:b.parsedType}),r.INVALID;const f=this.discriminator,V=b.data[f],A=this.optionsMap.get(V);return A?b.common.async?A._parseAsync({data:b.data,path:b.path,parent:b}):A._parseSync({data:b.data,path:b.path,parent:b}):((0,r.addIssueToContext)(b,{code:a.ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[f]}),r.INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(g,b,f){const V=new Map;for(const A of b){const O=en(A.shape[g]);if(!O)throw new Error(`A discriminator value for key \`${g}\` could not be extracted from all schema options`);for(const E of O){if(V.has(E))throw new Error(`Discriminator property ${String(g)} has duplicate value ${String(E)}`);V.set(E,A)}}return new Mn({typeName:le.ZodDiscriminatedUnion,discriminator:g,options:b,optionsMap:V,...d(f)})}}e.ZodDiscriminatedUnion=Mn;function vt(G,g){const b=(0,s.getParsedType)(G),f=(0,s.getParsedType)(g);if(G===g)return{valid:!0,data:G};if(b===s.ZodParsedType.object&&f===s.ZodParsedType.object){const V=s.util.objectKeys(g),A=s.util.objectKeys(G).filter(E=>V.indexOf(E)!==-1),O={...G,...g};for(const E of A){const ae=vt(G[E],g[E]);if(!ae.valid)return{valid:!1};O[E]=ae.data}return{valid:!0,data:O}}else if(b===s.ZodParsedType.array&&f===s.ZodParsedType.array){if(G.length!==g.length)return{valid:!1};const V=[];for(let A=0;A<G.length;A++){const O=G[A],E=g[A],ae=vt(O,E);if(!ae.valid)return{valid:!1};V.push(ae.data)}return{valid:!0,data:V}}else return b===s.ZodParsedType.date&&f===s.ZodParsedType.date&&+G==+g?{valid:!0,data:G}:{valid:!1}}class tn extends h{_parse(g){const{status:b,ctx:f}=this._processInputParams(g),V=(A,O)=>{if((0,r.isAborted)(A)||(0,r.isAborted)(O))return r.INVALID;const E=vt(A.value,O.value);return E.valid?(((0,r.isDirty)(A)||(0,r.isDirty)(O))&&b.dirty(),{status:b.value,value:E.data}):((0,r.addIssueToContext)(f,{code:a.ZodIssueCode.invalid_intersection_types}),r.INVALID)};return f.common.async?Promise.all([this._def.left._parseAsync({data:f.data,path:f.path,parent:f}),this._def.right._parseAsync({data:f.data,path:f.path,parent:f})]).then(([A,O])=>V(A,O)):V(this._def.left._parseSync({data:f.data,path:f.path,parent:f}),this._def.right._parseSync({data:f.data,path:f.path,parent:f}))}}e.ZodIntersection=tn,tn.create=(G,g,b)=>new tn({left:G,right:g,typeName:le.ZodIntersection,...d(b)});class $e extends h{_parse(g){const{status:b,ctx:f}=this._processInputParams(g);if(f.parsedType!==s.ZodParsedType.array)return(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.array,received:f.parsedType}),r.INVALID;if(f.data.length<this._def.items.length)return(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.INVALID;!this._def.rest&&f.data.length>this._def.items.length&&((0,r.addIssueToContext)(f,{code:a.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),b.dirty());const A=[...f.data].map((O,E)=>{const ae=this._def.items[E]||this._def.rest;return ae?ae._parse(new c(f,O,f.path,E)):null}).filter(O=>!!O);return f.common.async?Promise.all(A).then(O=>r.ParseStatus.mergeArray(b,O)):r.ParseStatus.mergeArray(b,A)}get items(){return this._def.items}rest(g){return new $e({...this._def,rest:g})}}e.ZodTuple=$e,$e.create=(G,g)=>{if(!Array.isArray(G))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new $e({items:G,typeName:le.ZodTuple,rest:null,...d(g)})};class ht extends h{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(g){const{status:b,ctx:f}=this._processInputParams(g);if(f.parsedType!==s.ZodParsedType.object)return(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.object,received:f.parsedType}),r.INVALID;const V=[],A=this._def.keyType,O=this._def.valueType;for(const E in f.data)V.push({key:A._parse(new c(f,E,f.path,E)),value:O._parse(new c(f,f.data[E],f.path,E))});return f.common.async?r.ParseStatus.mergeObjectAsync(b,V):r.ParseStatus.mergeObjectSync(b,V)}get element(){return this._def.valueType}static create(g,b,f){return b instanceof h?new ht({keyType:g,valueType:b,typeName:le.ZodRecord,...d(f)}):new ht({keyType:Ie.create(),valueType:g,typeName:le.ZodRecord,...d(b)})}}e.ZodRecord=ht;class nn extends h{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(g){const{status:b,ctx:f}=this._processInputParams(g);if(f.parsedType!==s.ZodParsedType.map)return(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.map,received:f.parsedType}),r.INVALID;const V=this._def.keyType,A=this._def.valueType,O=[...f.data.entries()].map(([E,ae],ne)=>({key:V._parse(new c(f,E,f.path,[ne,"key"])),value:A._parse(new c(f,ae,f.path,[ne,"value"]))}));if(f.common.async){const E=new Map;return Promise.resolve().then(async()=>{for(const ae of O){const ne=await ae.key,he=await ae.value;if(ne.status==="aborted"||he.status==="aborted")return r.INVALID;(ne.status==="dirty"||he.status==="dirty")&&b.dirty(),E.set(ne.value,he.value)}return{status:b.value,value:E}})}else{const E=new Map;for(const ae of O){const ne=ae.key,he=ae.value;if(ne.status==="aborted"||he.status==="aborted")return r.INVALID;(ne.status==="dirty"||he.status==="dirty")&&b.dirty(),E.set(ne.value,he.value)}return{status:b.value,value:E}}}}e.ZodMap=nn,nn.create=(G,g,b)=>new nn({valueType:g,keyType:G,typeName:le.ZodMap,...d(b)});class Et extends h{_parse(g){const{status:b,ctx:f}=this._processInputParams(g);if(f.parsedType!==s.ZodParsedType.set)return(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.set,received:f.parsedType}),r.INVALID;const V=this._def;V.minSize!==null&&f.data.size<V.minSize.value&&((0,r.addIssueToContext)(f,{code:a.ZodIssueCode.too_small,minimum:V.minSize.value,type:"set",inclusive:!0,exact:!1,message:V.minSize.message}),b.dirty()),V.maxSize!==null&&f.data.size>V.maxSize.value&&((0,r.addIssueToContext)(f,{code:a.ZodIssueCode.too_big,maximum:V.maxSize.value,type:"set",inclusive:!0,exact:!1,message:V.maxSize.message}),b.dirty());const A=this._def.valueType;function O(ae){const ne=new Set;for(const he of ae){if(he.status==="aborted")return r.INVALID;he.status==="dirty"&&b.dirty(),ne.add(he.value)}return{status:b.value,value:ne}}const E=[...f.data.values()].map((ae,ne)=>A._parse(new c(f,ae,f.path,ne)));return f.common.async?Promise.all(E).then(ae=>O(ae)):O(E)}min(g,b){return new Et({...this._def,minSize:{value:g,message:n.errorUtil.toString(b)}})}max(g,b){return new Et({...this._def,maxSize:{value:g,message:n.errorUtil.toString(b)}})}size(g,b){return this.min(g,b).max(g,b)}nonempty(g){return this.min(1,g)}}e.ZodSet=Et,Et.create=(G,g)=>new Et({valueType:G,minSize:null,maxSize:null,typeName:le.ZodSet,...d(g)});class ie extends h{constructor(){super(...arguments),this.validate=this.implement}_parse(g){const{ctx:b}=this._processInputParams(g);if(b.parsedType!==s.ZodParsedType.function)return(0,r.addIssueToContext)(b,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.function,received:b.parsedType}),r.INVALID;function f(E,ae){return(0,r.makeIssue)({data:E,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,(0,t.getErrorMap)(),t.defaultErrorMap].filter(ne=>!!ne),issueData:{code:a.ZodIssueCode.invalid_arguments,argumentsError:ae}})}function V(E,ae){return(0,r.makeIssue)({data:E,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,(0,t.getErrorMap)(),t.defaultErrorMap].filter(ne=>!!ne),issueData:{code:a.ZodIssueCode.invalid_return_type,returnTypeError:ae}})}const A={errorMap:b.common.contextualErrorMap},O=b.data;if(this._def.returns instanceof ot){const E=this;return(0,r.OK)(async function(...ae){const ne=new a.ZodError([]),he=await E._def.args.parseAsync(ae,A).catch(gn=>{throw ne.addIssue(f(ae,gn)),ne}),Fe=await Reflect.apply(O,this,he);return await E._def.returns._def.type.parseAsync(Fe,A).catch(gn=>{throw ne.addIssue(V(Fe,gn)),ne})})}else{const E=this;return(0,r.OK)(function(...ae){const ne=E._def.args.safeParse(ae,A);if(!ne.success)throw new a.ZodError([f(ae,ne.error)]);const he=Reflect.apply(O,this,ne.data),Fe=E._def.returns.safeParse(he,A);if(!Fe.success)throw new a.ZodError([V(he,Fe.error)]);return Fe.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...g){return new ie({...this._def,args:$e.create(g).rest(rt.create())})}returns(g){return new ie({...this._def,returns:g})}implement(g){return this.parse(g)}strictImplement(g){return this.parse(g)}static create(g,b,f){return new ie({args:g||$e.create([]).rest(rt.create()),returns:b||rt.create(),typeName:le.ZodFunction,...d(f)})}}e.ZodFunction=ie;class rn extends h{get schema(){return this._def.getter()}_parse(g){const{ctx:b}=this._processInputParams(g);return this._def.getter()._parse({data:b.data,path:b.path,parent:b})}}e.ZodLazy=rn,rn.create=(G,g)=>new rn({getter:G,typeName:le.ZodLazy,...d(g)});class Wt extends h{_parse(g){if(g.data!==this._def.value){const b=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(b,{received:b.data,code:a.ZodIssueCode.invalid_literal,expected:this._def.value}),r.INVALID}return{status:"valid",value:g.data}}get value(){return this._def.value}}e.ZodLiteral=Wt,Wt.create=(G,g)=>new Wt({value:G,typeName:le.ZodLiteral,...d(g)});function Ge(G,g){return new st({values:G,typeName:le.ZodEnum,...d(g)})}class st extends h{_parse(g){if(typeof g.data!="string"){const b=this._getOrReturnCtx(g),f=this._def.values;return(0,r.addIssueToContext)(b,{expected:s.util.joinValues(f),received:b.parsedType,code:a.ZodIssueCode.invalid_type}),r.INVALID}if(this._def.values.indexOf(g.data)===-1){const b=this._getOrReturnCtx(g),f=this._def.values;return(0,r.addIssueToContext)(b,{received:b.data,code:a.ZodIssueCode.invalid_enum_value,options:f}),r.INVALID}return(0,r.OK)(g.data)}get options(){return this._def.values}get enum(){const g={};for(const b of this._def.values)g[b]=b;return g}get Values(){const g={};for(const b of this._def.values)g[b]=b;return g}get Enum(){const g={};for(const b of this._def.values)g[b]=b;return g}extract(g){return st.create(g)}exclude(g){return st.create(this.options.filter(b=>!g.includes(b)))}}e.ZodEnum=st,st.create=Ge;class Vn extends h{_parse(g){const b=s.util.getValidEnumValues(this._def.values),f=this._getOrReturnCtx(g);if(f.parsedType!==s.ZodParsedType.string&&f.parsedType!==s.ZodParsedType.number){const V=s.util.objectValues(b);return(0,r.addIssueToContext)(f,{expected:s.util.joinValues(V),received:f.parsedType,code:a.ZodIssueCode.invalid_type}),r.INVALID}if(b.indexOf(g.data)===-1){const V=s.util.objectValues(b);return(0,r.addIssueToContext)(f,{received:f.data,code:a.ZodIssueCode.invalid_enum_value,options:V}),r.INVALID}return(0,r.OK)(g.data)}get enum(){return this._def.values}}e.ZodNativeEnum=Vn,Vn.create=(G,g)=>new Vn({values:G,typeName:le.ZodNativeEnum,...d(g)});class ot extends h{unwrap(){return this._def.type}_parse(g){const{ctx:b}=this._processInputParams(g);if(b.parsedType!==s.ZodParsedType.promise&&b.common.async===!1)return(0,r.addIssueToContext)(b,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.promise,received:b.parsedType}),r.INVALID;const f=b.parsedType===s.ZodParsedType.promise?b.data:Promise.resolve(b.data);return(0,r.OK)(f.then(V=>this._def.type.parseAsync(V,{path:b.path,errorMap:b.common.contextualErrorMap})))}}e.ZodPromise=ot,ot.create=(G,g)=>new ot({type:G,typeName:le.ZodPromise,...d(g)});class lt extends h{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===le.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(g){const{status:b,ctx:f}=this._processInputParams(g),V=this._def.effect||null,A={addIssue:O=>{(0,r.addIssueToContext)(f,O),O.fatal?b.abort():b.dirty()},get path(){return f.path}};if(A.addIssue=A.addIssue.bind(A),V.type==="preprocess"){const O=V.transform(f.data,A);return f.common.issues.length?{status:"dirty",value:f.data}:f.common.async?Promise.resolve(O).then(E=>this._def.schema._parseAsync({data:E,path:f.path,parent:f})):this._def.schema._parseSync({data:O,path:f.path,parent:f})}if(V.type==="refinement"){const O=E=>{const ae=V.refinement(E,A);if(f.common.async)return Promise.resolve(ae);if(ae instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return E};if(f.common.async===!1){const E=this._def.schema._parseSync({data:f.data,path:f.path,parent:f});return E.status==="aborted"?r.INVALID:(E.status==="dirty"&&b.dirty(),O(E.value),{status:b.value,value:E.value})}else return this._def.schema._parseAsync({data:f.data,path:f.path,parent:f}).then(E=>E.status==="aborted"?r.INVALID:(E.status==="dirty"&&b.dirty(),O(E.value).then(()=>({status:b.value,value:E.value}))))}if(V.type==="transform")if(f.common.async===!1){const O=this._def.schema._parseSync({data:f.data,path:f.path,parent:f});if(!(0,r.isValid)(O))return O;const E=V.transform(O.value,A);if(E instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:b.value,value:E}}else return this._def.schema._parseAsync({data:f.data,path:f.path,parent:f}).then(O=>(0,r.isValid)(O)?Promise.resolve(V.transform(O.value,A)).then(E=>({status:b.value,value:E})):O);s.util.assertNever(V)}}e.ZodEffects=lt,e.ZodTransformer=lt,lt.create=(G,g,b)=>new lt({schema:G,typeName:le.ZodEffects,effect:g,...d(b)}),lt.createWithPreprocess=(G,g,b)=>new lt({schema:g,effect:{type:"preprocess",transform:G},typeName:le.ZodEffects,...d(b)});class ft extends h{_parse(g){return this._getType(g)===s.ZodParsedType.undefined?(0,r.OK)(void 0):this._def.innerType._parse(g)}unwrap(){return this._def.innerType}}e.ZodOptional=ft,ft.create=(G,g)=>new ft({innerType:G,typeName:le.ZodOptional,...d(g)});class xt extends h{_parse(g){return this._getType(g)===s.ZodParsedType.null?(0,r.OK)(null):this._def.innerType._parse(g)}unwrap(){return this._def.innerType}}e.ZodNullable=xt,xt.create=(G,g)=>new xt({innerType:G,typeName:le.ZodNullable,...d(g)});class Rn extends h{_parse(g){const{ctx:b}=this._processInputParams(g);let f=b.data;return b.parsedType===s.ZodParsedType.undefined&&(f=this._def.defaultValue()),this._def.innerType._parse({data:f,path:b.path,parent:b})}removeDefault(){return this._def.innerType}}e.ZodDefault=Rn,Rn.create=(G,g)=>new Rn({innerType:G,typeName:le.ZodDefault,defaultValue:typeof g.default=="function"?g.default:()=>g.default,...d(g)});class sn extends h{_parse(g){const{ctx:b}=this._processInputParams(g),f={...b,common:{...b.common,issues:[]}},V=this._def.innerType._parse({data:f.data,path:f.path,parent:{...f}});return(0,r.isAsync)(V)?V.then(A=>({status:"valid",value:A.status==="valid"?A.value:this._def.catchValue({get error(){return new a.ZodError(f.common.issues)},input:f.data})})):{status:"valid",value:V.status==="valid"?V.value:this._def.catchValue({get error(){return new a.ZodError(f.common.issues)},input:f.data})}}removeCatch(){return this._def.innerType}}e.ZodCatch=sn,sn.create=(G,g)=>new sn({innerType:G,typeName:le.ZodCatch,catchValue:typeof g.catch=="function"?g.catch:()=>g.catch,...d(g)});class qe extends h{_parse(g){if(this._getType(g)!==s.ZodParsedType.nan){const f=this._getOrReturnCtx(g);return(0,r.addIssueToContext)(f,{code:a.ZodIssueCode.invalid_type,expected:s.ZodParsedType.nan,received:f.parsedType}),r.INVALID}return{status:"valid",value:g.data}}}e.ZodNaN=qe,qe.create=G=>new qe({typeName:le.ZodNaN,...d(G)}),e.BRAND=Symbol("zod_brand");class Fr extends h{_parse(g){const{ctx:b}=this._processInputParams(g),f=b.data;return this._def.type._parse({data:f,path:b.path,parent:b})}unwrap(){return this._def.type}}e.ZodBranded=Fr;class Zt extends h{_parse(g){const{status:b,ctx:f}=this._processInputParams(g);if(f.common.async)return(async()=>{const A=await this._def.in._parseAsync({data:f.data,path:f.path,parent:f});return A.status==="aborted"?r.INVALID:A.status==="dirty"?(b.dirty(),(0,r.DIRTY)(A.value)):this._def.out._parseAsync({data:A.value,path:f.path,parent:f})})();{const V=this._def.in._parseSync({data:f.data,path:f.path,parent:f});return V.status==="aborted"?r.INVALID:V.status==="dirty"?(b.dirty(),{status:"dirty",value:V.value}):this._def.out._parseSync({data:V.value,path:f.path,parent:f})}}static create(g,b){return new Zt({in:g,out:b,typeName:le.ZodPipeline})}}e.ZodPipeline=Zt;class Yn extends h{_parse(g){const b=this._def.innerType._parse(g);return(0,r.isValid)(b)&&(b.value=Object.freeze(b.value)),b}}e.ZodReadonly=Yn,Yn.create=(G,g)=>new Yn({innerType:G,typeName:le.ZodReadonly,...d(g)});const Xn=(G,g={},b)=>G?Ne.create().superRefine((f,V)=>{var A,O;if(!G(f)){const E=typeof g=="function"?g(f):typeof g=="string"?{message:g}:g,ae=(O=(A=E.fatal)!==null&&A!==void 0?A:b)!==null&&O!==void 0?O:!0,ne=typeof E=="string"?{message:E}:E;V.addIssue({code:"custom",...ne,fatal:ae})}}):Ne.create();e.custom=Xn,e.late={object:Ae.lazycreate};var le;(function(G){G.ZodString="ZodString",G.ZodNumber="ZodNumber",G.ZodNaN="ZodNaN",G.ZodBigInt="ZodBigInt",G.ZodBoolean="ZodBoolean",G.ZodDate="ZodDate",G.ZodSymbol="ZodSymbol",G.ZodUndefined="ZodUndefined",G.ZodNull="ZodNull",G.ZodAny="ZodAny",G.ZodUnknown="ZodUnknown",G.ZodNever="ZodNever",G.ZodVoid="ZodVoid",G.ZodArray="ZodArray",G.ZodObject="ZodObject",G.ZodUnion="ZodUnion",G.ZodDiscriminatedUnion="ZodDiscriminatedUnion",G.ZodIntersection="ZodIntersection",G.ZodTuple="ZodTuple",G.ZodRecord="ZodRecord",G.ZodMap="ZodMap",G.ZodSet="ZodSet",G.ZodFunction="ZodFunction",G.ZodLazy="ZodLazy",G.ZodLiteral="ZodLiteral",G.ZodEnum="ZodEnum",G.ZodEffects="ZodEffects",G.ZodNativeEnum="ZodNativeEnum",G.ZodOptional="ZodOptional",G.ZodNullable="ZodNullable",G.ZodDefault="ZodDefault",G.ZodCatch="ZodCatch",G.ZodPromise="ZodPromise",G.ZodBranded="ZodBranded",G.ZodPipeline="ZodPipeline",G.ZodReadonly="ZodReadonly"})(le=e.ZodFirstPartyTypeKind||(e.ZodFirstPartyTypeKind={}));const kr=(G,g={message:`Input not instance of ${G.name}`})=>(0,e.custom)(b=>b instanceof G,g);e.instanceof=kr;const on=Ie.create;e.string=on;const Pn=oe.create;e.number=Pn;const Dn=qe.create;e.nan=Dn;const Lt=ue.create;e.bigint=Lt;const Hn=Ke.create;e.boolean=Hn;const Jr=Ue.create;e.date=Jr;const Vt=dt.create;e.symbol=Vt;const se=It.create;e.undefined=se;const Sn=Ee.create;e.null=Sn;const Qt=Ne.create;e.any=Qt;const $n=rt.create;e.unknown=$n;const q=Pe.create;e.never=q;const zr=mt.create;e.void=zr;const Wi=ct.create;e.array=Wi;const Tr=Ae.create;e.object=Tr;const Vi=Ae.strictCreate;e.strictObject=Vi;const Ur=De.create;e.union=Ur;const eo=Mn.create;e.discriminatedUnion=eo;const to=tn.create;e.intersection=to;const an=$e.create;e.tuple=an;const cn=ht.create;e.record=cn;const Er=nn.create;e.map=Er;const qn=Et.create;e.set=qn;const Ye=ie.create;e.function=Ye;const _e=rn.create;e.lazy=_e;const no=Wt.create;e.literal=no;const er=st.create;e.enum=er;const tr=Vn.create;e.nativeEnum=tr;const nr=ot.create;e.promise=nr;const Ri=lt.create;e.effect=Ri,e.transformer=Ri;const Rt=ft.create;e.optional=Rt;const ln=xt.create;e.nullable=ln;const Yt=lt.createWithPreprocess;e.preprocess=Yt;const rr=Zt.create;e.pipeline=rr;const ro=()=>on().optional();e.ostring=ro;const Xt=()=>Pn().optional();e.onumber=Xt;const Yi=()=>Hn().optional();e.oboolean=Yi,e.coerce={string:G=>Ie.create({...G,coerce:!0}),number:G=>oe.create({...G,coerce:!0}),boolean:G=>Ke.create({...G,coerce:!0}),bigint:G=>ue.create({...G,coerce:!0}),date:G=>Ue.create({...G,coerce:!0})},e.NEVER=r.INVALID})(tI);(function(e){var t=We&&We.__createBinding||(Object.create?function(r,s,a,c){c===void 0&&(c=a),Object.defineProperty(r,c,{enumerable:!0,get:function(){return s[a]}})}:function(r,s,a,c){c===void 0&&(c=a),r[c]=s[a]}),n=We&&We.__exportStar||function(r,s){for(var a in r)a!=="default"&&!Object.prototype.hasOwnProperty.call(s,a)&&t(s,r,a)};Object.defineProperty(e,"__esModule",{value:!0}),n(Jt,e),n(ac,e),n(eI,e),n(Zi,e),n(tI,e),n(zt,e)})(ca);(function(e){var t=We&&We.__createBinding||(Object.create?function(c,u,d,h){h===void 0&&(h=d),Object.defineProperty(c,h,{enumerable:!0,get:function(){return u[d]}})}:function(c,u,d,h){h===void 0&&(h=d),c[h]=u[d]}),n=We&&We.__setModuleDefault||(Object.create?function(c,u){Object.defineProperty(c,"default",{enumerable:!0,value:u})}:function(c,u){c.default=u}),r=We&&We.__importStar||function(c){if(c&&c.__esModule)return c;var u={};if(c!=null)for(var d in c)d!=="default"&&Object.prototype.hasOwnProperty.call(c,d)&&t(u,c,d);return n(u,c),u},s=We&&We.__exportStar||function(c,u){for(var d in c)d!=="default"&&!Object.prototype.hasOwnProperty.call(u,d)&&t(u,c,d)};Object.defineProperty(e,"__esModule",{value:!0}),e.z=void 0;const a=r(ca);e.z=a,s(ca,e),e.default=a})(ke);var hG=typeof We=="object"&&We&&We.Object===Object&&We,rI=hG,CG=rI,bG=typeof self=="object"&&self&&self.Object===Object&&self,pG=CG||bG||Function("return this")(),$t=pG,mG=$t,fG=mG.Symbol,Es=fG,Ll=Es,iI=Object.prototype,ZG=iI.hasOwnProperty,yG=iI.toString,ti=Ll?Ll.toStringTag:void 0;function GG(e){var t=ZG.call(e,ti),n=e[ti];try{e[ti]=void 0;var r=!0}catch{}var s=yG.call(e);return r&&(t?e[ti]=n:delete e[ti]),s}var BG=GG,AG=Object.prototype,vG=AG.toString;function WG(e){return vG.call(e)}var VG=WG,Ql=Es,RG=BG,YG=VG,XG="[object Null]",HG="[object Undefined]",jl=Ql?Ql.toStringTag:void 0;function SG(e){return e==null?e===void 0?HG:XG:jl&&jl in Object(e)?RG(e):YG(e)}var cc=SG;function NG(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var sI=NG,wG=cc,KG=sI,_G="[object AsyncFunction]",FG="[object Function]",kG="[object GeneratorFunction]",JG="[object Proxy]";function zG(e){if(!KG(e))return!1;var t=wG(e);return t==FG||t==kG||t==_G||t==JG}var TG=zG,UG=$t,EG=UG["__core-js_shared__"],xG=EG,Uo=xG,Ol=function(){var e=/[^.]+$/.exec(Uo&&Uo.keys&&Uo.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function LG(e){return!!Ol&&Ol in e}var QG=LG,jG=Function.prototype,OG=jG.toString;function MG(e){if(e!=null){try{return OG.call(e)}catch{}try{return e+""}catch{}}return""}var oI=MG,PG=TG,DG=QG,$G=sI,qG=oI,eB=/[\\^$.*+?()[\]{}|]/g,tB=/^\[object .+?Constructor\]$/,nB=Function.prototype,rB=Object.prototype,iB=nB.toString,sB=rB.hasOwnProperty,oB=RegExp("^"+iB.call(sB).replace(eB,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function aB(e){if(!$G(e)||DG(e))return!1;var t=PG(e)?oB:tB;return t.test(qG(e))}var cB=aB;function lB(e,t){return e==null?void 0:e[t]}var gB=lB,uB=cB,dB=gB;function IB(e,t){var n=dB(e,t);return uB(n)?n:void 0}var jn=IB,hB=jn,CB=$t,bB=hB(CB,"DataView"),pB=bB,mB=jn,fB=$t,ZB=mB(fB,"Map"),lc=ZB,yB=jn,GB=$t,BB=yB(GB,"Promise"),AB=BB,vB=jn,WB=$t,VB=vB(WB,"Set"),RB=VB,YB=jn,XB=$t,HB=YB(XB,"WeakMap"),SB=HB,ga=pB,ua=lc,da=AB,Ia=RB,ha=SB,aI=cc,Wr=oI,Ml="[object Map]",NB="[object Object]",Pl="[object Promise]",Dl="[object Set]",$l="[object WeakMap]",ql="[object DataView]",wB=Wr(ga),KB=Wr(ua),_B=Wr(da),FB=Wr(Ia),kB=Wr(ha),ar=aI;(ga&&ar(new ga(new ArrayBuffer(1)))!=ql||ua&&ar(new ua)!=Ml||da&&ar(da.resolve())!=Pl||Ia&&ar(new Ia)!=Dl||ha&&ar(new ha)!=$l)&&(ar=function(e){var t=aI(e),n=t==NB?e.constructor:void 0,r=n?Wr(n):"";if(r)switch(r){case wB:return ql;case KB:return Ml;case _B:return Pl;case FB:return Dl;case kB:return $l}return t});function JB(e){return e!=null&&typeof e=="object"}var cI=JB,zB=cc,TB=cI,UB="[object Arguments]";function EB(e){return TB(e)&&zB(e)==UB}var xB=EB,eg=xB,LB=cI,lI=Object.prototype,QB=lI.hasOwnProperty,jB=lI.propertyIsEnumerable;eg(function(){return arguments}());var Cs={exports:{}};function OB(){return!1}var MB=OB;Cs.exports;(function(e,t){var n=$t,r=MB,s=t&&!t.nodeType&&t,a=s&&!0&&e&&!e.nodeType&&e,c=a&&a.exports===s,u=c?n.Buffer:void 0,d=u?u.isBuffer:void 0,h=d||r;e.exports=h})(Cs,Cs.exports);Cs.exports;var bs={exports:{}};bs.exports;(function(e,t){var n=rI,r=t&&!t.nodeType&&t,s=r&&!0&&e&&!e.nodeType&&e,a=s&&s.exports===r,c=a&&n.process,u=function(){try{var d=s&&s.require&&s.require("util").types;return d||c&&c.binding&&c.binding("util")}catch{}}();e.exports=u})(bs,bs.exports);var PB=bs.exports,tg=PB;tg&&tg.isTypedArray;var DB={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(d,h,m){this.fn=d,this.context=h,this.once=m||!1}function a(d,h,m,y,v){if(typeof m!="function")throw new TypeError("The listener must be a function");var _=new s(m,y||d,v),F=n?n+h:h;return d._events[F]?d._events[F].fn?d._events[F]=[d._events[F],_]:d._events[F].push(_):(d._events[F]=_,d._eventsCount++),d}function c(d,h){--d._eventsCount===0?d._events=new r:delete d._events[h]}function u(){this._events=new r,this._eventsCount=0}u.prototype.eventNames=function(){var h=[],m,y;if(this._eventsCount===0)return h;for(y in m=this._events)t.call(m,y)&&h.push(n?y.slice(1):y);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(m)):h},u.prototype.listeners=function(h){var m=n?n+h:h,y=this._events[m];if(!y)return[];if(y.fn)return[y.fn];for(var v=0,_=y.length,F=new Array(_);v<_;v++)F[v]=y[v].fn;return F},u.prototype.listenerCount=function(h){var m=n?n+h:h,y=this._events[m];return y?y.fn?1:y.length:0},u.prototype.emit=function(h,m,y,v,_,F){var Q=n?n+h:h;if(!this._events[Q])return!1;var z=this._events[Q],te=arguments.length,ce,re;if(z.fn){switch(z.once&&this.removeListener(h,z.fn,void 0,!0),te){case 1:return z.fn.call(z.context),!0;case 2:return z.fn.call(z.context,m),!0;case 3:return z.fn.call(z.context,m,y),!0;case 4:return z.fn.call(z.context,m,y,v),!0;case 5:return z.fn.call(z.context,m,y,v,_),!0;case 6:return z.fn.call(z.context,m,y,v,_,F),!0}for(re=1,ce=new Array(te-1);re<te;re++)ce[re-1]=arguments[re];z.fn.apply(z.context,ce)}else{var Ie=z.length,fe;for(re=0;re<Ie;re++)switch(z[re].once&&this.removeListener(h,z[re].fn,void 0,!0),te){case 1:z[re].fn.call(z[re].context);break;case 2:z[re].fn.call(z[re].context,m);break;case 3:z[re].fn.call(z[re].context,m,y);break;case 4:z[re].fn.call(z[re].context,m,y,v);break;default:if(!ce)for(fe=1,ce=new Array(te-1);fe<te;fe++)ce[fe-1]=arguments[fe];z[re].fn.apply(z[re].context,ce)}}return!0},u.prototype.on=function(h,m,y){return a(this,h,m,y,!1)},u.prototype.once=function(h,m,y){return a(this,h,m,y,!0)},u.prototype.removeListener=function(h,m,y,v){var _=n?n+h:h;if(!this._events[_])return this;if(!m)return c(this,_),this;var F=this._events[_];if(F.fn)F.fn===m&&(!v||F.once)&&(!y||F.context===y)&&c(this,_);else{for(var Q=0,z=[],te=F.length;Q<te;Q++)(F[Q].fn!==m||v&&!F[Q].once||y&&F[Q].context!==y)&&z.push(F[Q]);z.length?this._events[_]=z.length===1?z[0]:z:c(this,_)}return this},u.prototype.removeAllListeners=function(h){var m;return h?(m=n?n+h:h,this._events[m]&&c(this,m)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,e.exports=u})(DB);var $B=jn;(function(){try{var e=$B(Object,"defineProperty");return e({},"",{}),e}catch{}})();function qB(){this.__data__=[],this.size=0}var eA=qB;function tA(e,t){return e===t||e!==e&&t!==t}var nA=tA,rA=nA;function iA(e,t){for(var n=e.length;n--;)if(rA(e[n][0],t))return n;return-1}var xs=iA,sA=xs,oA=Array.prototype,aA=oA.splice;function cA(e){var t=this.__data__,n=sA(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():aA.call(t,n,1),--this.size,!0}var lA=cA,gA=xs;function uA(e){var t=this.__data__,n=gA(t,e);return n<0?void 0:t[n][1]}var dA=uA,IA=xs;function hA(e){return IA(this.__data__,e)>-1}var CA=hA,bA=xs;function pA(e,t){var n=this.__data__,r=bA(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}var mA=pA,fA=eA,ZA=lA,yA=dA,GA=CA,BA=mA;function Vr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Vr.prototype.clear=fA;Vr.prototype.delete=ZA;Vr.prototype.get=yA;Vr.prototype.has=GA;Vr.prototype.set=BA;var Ls=Vr,AA=Ls;function vA(){this.__data__=new AA,this.size=0}var WA=vA;function VA(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}var RA=VA;function YA(e){return this.__data__.get(e)}var XA=YA;function HA(e){return this.__data__.has(e)}var SA=HA,NA=jn,wA=NA(Object,"create"),Qs=wA,ng=Qs;function KA(){this.__data__=ng?ng(null):{},this.size=0}var _A=KA;function FA(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var kA=FA,JA=Qs,zA="__lodash_hash_undefined__",TA=Object.prototype,UA=TA.hasOwnProperty;function EA(e){var t=this.__data__;if(JA){var n=t[e];return n===zA?void 0:n}return UA.call(t,e)?t[e]:void 0}var xA=EA,LA=Qs,QA=Object.prototype,jA=QA.hasOwnProperty;function OA(e){var t=this.__data__;return LA?t[e]!==void 0:jA.call(t,e)}var MA=OA,PA=Qs,DA="__lodash_hash_undefined__";function $A(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=PA&&t===void 0?DA:t,this}var qA=$A,e0=_A,t0=kA,n0=xA,r0=MA,i0=qA;function Rr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Rr.prototype.clear=e0;Rr.prototype.delete=t0;Rr.prototype.get=n0;Rr.prototype.has=r0;Rr.prototype.set=i0;var s0=Rr,rg=s0,o0=Ls,a0=lc;function c0(){this.size=0,this.__data__={hash:new rg,map:new(a0||o0),string:new rg}}var l0=c0;function g0(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var u0=g0,d0=u0;function I0(e,t){var n=e.__data__;return d0(t)?n[typeof t=="string"?"string":"hash"]:n.map}var js=I0,h0=js;function C0(e){var t=h0(this,e).delete(e);return this.size-=t?1:0,t}var b0=C0,p0=js;function m0(e){return p0(this,e).get(e)}var f0=m0,Z0=js;function y0(e){return Z0(this,e).has(e)}var G0=y0,B0=js;function A0(e,t){var n=B0(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}var v0=A0,W0=l0,V0=b0,R0=f0,Y0=G0,X0=v0;function Yr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Yr.prototype.clear=W0;Yr.prototype.delete=V0;Yr.prototype.get=R0;Yr.prototype.has=Y0;Yr.prototype.set=X0;var gc=Yr,H0=Ls,S0=lc,N0=gc,w0=200;function K0(e,t){var n=this.__data__;if(n instanceof H0){var r=n.__data__;if(!S0||r.length<w0-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new N0(r)}return n.set(e,t),this.size=n.size,this}var _0=K0,F0=Ls,k0=WA,J0=RA,z0=XA,T0=SA,U0=_0;function yi(e){var t=this.__data__=new F0(e);this.size=t.size}yi.prototype.clear=k0;yi.prototype.delete=J0;yi.prototype.get=z0;yi.prototype.has=T0;yi.prototype.set=U0;var E0="__lodash_hash_undefined__";function x0(e){return this.__data__.set(e,E0),this}var L0=x0;function Q0(e){return this.__data__.has(e)}var j0=Q0,O0=gc,M0=L0,P0=j0;function Ca(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new O0;++t<n;)this.add(e[t])}Ca.prototype.add=Ca.prototype.push=M0;Ca.prototype.has=P0;var D0=$t;D0.Uint8Array;var ig=Es,sg=ig?ig.prototype:void 0;sg&&sg.valueOf;var gI=gc,$0="Expected a function";function uc(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError($0);var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],a=n.cache;if(a.has(s))return a.get(s);var c=e.apply(this,r);return n.cache=a.set(s,c)||a,c};return n.cache=new(uc.Cache||gI),n}uc.Cache=gI;var q0=uc,ev=q0,tv=500;function nv(e){var t=ev(e,function(r){return n.size===tv&&n.clear(),r}),n=t.cache;return t}var rv=nv,iv=rv,sv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ov=/\\(\\)?/g;iv(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(sv,function(n,r,s,a){t.push(s?a.replace(ov,"$1"):r||n)}),t});var og=Es,ag=og?og.prototype:void 0;ag&&ag.toString;class dc extends Error{constructor(n,r,s=500,a){super(n);hn(this,"safeToLog",!0);this.requestId=r,this.status=s,this.payload=a}static fromEvent(n,r,s){return new dc("Sync transport error",r,n,s)}}for(var Eo=0;Eo<256;++Eo)(Eo+256).toString(16).substr(1);class av extends Error{constructor(){super(...arguments);hn(this,"name","DialogAlreadyOpened");hn(this,"ignorable",!0)}}class uI extends Error{constructor(){super(...arguments);hn(this,"safeToLog",!0);hn(this,"name","SafeToLogError")}}class Ic extends Error{constructor(){super(...arguments);hn(this,"name","UserCancelDialogueError");hn(this,"ignorable",!0)}static swallow(n){if(n instanceof Ic)return n;throw n}}function Xr(e){return t=>e.safeParse(t).success}function cv(e){return e}var hc=cv;const lv=Ln(hc);var gv=typeof We=="object"&&We&&We.Object===Object&&We,dI=gv,uv=dI,dv=typeof self=="object"&&self&&self.Object===Object&&self,Iv=uv||dv||Function("return this")(),Ut=Iv,hv=Ut,Cv=hv.Symbol,Gi=Cv,cg=Gi,II=Object.prototype,bv=II.hasOwnProperty,pv=II.toString,ni=cg?cg.toStringTag:void 0;function mv(e){var t=bv.call(e,ni),n=e[ni];try{e[ni]=void 0;var r=!0}catch{}var s=pv.call(e);return r&&(t?e[ni]=n:delete e[ni]),s}var fv=mv,Zv=Object.prototype,yv=Zv.toString;function Gv(e){return yv.call(e)}var Bv=Gv,lg=Gi,Av=fv,vv=Bv,Wv="[object Null]",Vv="[object Undefined]",gg=lg?lg.toStringTag:void 0;function Rv(e){return e==null?e===void 0?Vv:Wv:gg&&gg in Object(e)?Av(e):vv(e)}var Bi=Rv;function Yv(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Os=Yv,Xv=Bi,Hv=Os,Sv="[object AsyncFunction]",Nv="[object Function]",wv="[object GeneratorFunction]",Kv="[object Proxy]";function _v(e){if(!Hv(e))return!1;var t=Xv(e);return t==Nv||t==wv||t==Sv||t==Kv}var hI=_v,Fv=Ut,kv=Fv["__core-js_shared__"],Jv=kv,xo=Jv,ug=function(){var e=/[^.]+$/.exec(xo&&xo.keys&&xo.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function zv(e){return!!ug&&ug in e}var Tv=zv,Uv=Function.prototype,Ev=Uv.toString;function xv(e){if(e!=null){try{return Ev.call(e)}catch{}try{return e+""}catch{}}return""}var CI=xv,Lv=hI,Qv=Tv,jv=Os,Ov=CI,Mv=/[\\^$.*+?()[\]{}|]/g,Pv=/^\[object .+?Constructor\]$/,Dv=Function.prototype,$v=Object.prototype,qv=Dv.toString,eW=$v.hasOwnProperty,tW=RegExp("^"+qv.call(eW).replace(Mv,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function nW(e){if(!jv(e)||Qv(e))return!1;var t=Lv(e)?tW:Pv;return t.test(Ov(e))}var rW=nW;function iW(e,t){return e==null?void 0:e[t]}var sW=iW,oW=rW,aW=sW;function cW(e,t){var n=aW(e,t);return oW(n)?n:void 0}var On=cW,lW=On,gW=function(){try{var e=lW(Object,"defineProperty");return e({},"",{}),e}catch{}}(),bI=gW,dg=bI;function uW(e,t,n){t=="__proto__"&&dg?dg(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var pI=uW;function dW(e){return function(t,n,r){for(var s=-1,a=Object(t),c=r(t),u=c.length;u--;){var d=c[e?u:++s];if(n(a[d],d,a)===!1)break}return t}}var IW=dW,hW=IW,CW=hW(),bW=CW;function pW(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var mW=pW;function fW(e){return e!=null&&typeof e=="object"}var Hr=fW,ZW=Bi,yW=Hr,GW="[object Arguments]";function BW(e){return yW(e)&&ZW(e)==GW}var AW=BW,Ig=AW,vW=Hr,mI=Object.prototype,WW=mI.hasOwnProperty,VW=mI.propertyIsEnumerable,RW=Ig(function(){return arguments}())?Ig:function(e){return vW(e)&&WW.call(e,"callee")&&!VW.call(e,"callee")},Cc=RW,YW=Array.isArray,qt=YW,ps={exports:{}};function XW(){return!1}var HW=XW;ps.exports;(function(e,t){var n=Ut,r=HW,s=t&&!t.nodeType&&t,a=s&&!0&&e&&!e.nodeType&&e,c=a&&a.exports===s,u=c?n.Buffer:void 0,d=u?u.isBuffer:void 0,h=d||r;e.exports=h})(ps,ps.exports);var bc=ps.exports,SW=9007199254740991,NW=/^(?:0|[1-9]\d*)$/;function wW(e,t){var n=typeof e;return t=t??SW,!!t&&(n=="number"||n!="symbol"&&NW.test(e))&&e>-1&&e%1==0&&e<t}var pc=wW,KW=9007199254740991;function _W(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=KW}var mc=_W,FW=Bi,kW=mc,JW=Hr,zW="[object Arguments]",TW="[object Array]",UW="[object Boolean]",EW="[object Date]",xW="[object Error]",LW="[object Function]",QW="[object Map]",jW="[object Number]",OW="[object Object]",MW="[object RegExp]",PW="[object Set]",DW="[object String]",$W="[object WeakMap]",qW="[object ArrayBuffer]",eV="[object DataView]",tV="[object Float32Array]",nV="[object Float64Array]",rV="[object Int8Array]",iV="[object Int16Array]",sV="[object Int32Array]",oV="[object Uint8Array]",aV="[object Uint8ClampedArray]",cV="[object Uint16Array]",lV="[object Uint32Array]",He={};He[tV]=He[nV]=He[rV]=He[iV]=He[sV]=He[oV]=He[aV]=He[cV]=He[lV]=!0;He[zW]=He[TW]=He[qW]=He[UW]=He[eV]=He[EW]=He[xW]=He[LW]=He[QW]=He[jW]=He[OW]=He[MW]=He[PW]=He[DW]=He[$W]=!1;function gV(e){return JW(e)&&kW(e.length)&&!!He[FW(e)]}var uV=gV;function dV(e){return function(t){return e(t)}}var fI=dV,ms={exports:{}};ms.exports;(function(e,t){var n=dI,r=t&&!t.nodeType&&t,s=r&&!0&&e&&!e.nodeType&&e,a=s&&s.exports===r,c=a&&n.process,u=function(){try{var d=s&&s.require&&s.require("util").types;return d||c&&c.binding&&c.binding("util")}catch{}}();e.exports=u})(ms,ms.exports);var IV=ms.exports,hV=uV,CV=fI,hg=IV,Cg=hg&&hg.isTypedArray,bV=Cg?CV(Cg):hV,fc=bV,pV=mW,mV=Cc,fV=qt,ZV=bc,yV=pc,GV=fc,BV=Object.prototype,AV=BV.hasOwnProperty;function vV(e,t){var n=fV(e),r=!n&&mV(e),s=!n&&!r&&ZV(e),a=!n&&!r&&!s&&GV(e),c=n||r||s||a,u=c?pV(e.length,String):[],d=u.length;for(var h in e)(t||AV.call(e,h))&&!(c&&(h=="length"||s&&(h=="offset"||h=="parent")||a&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||yV(h,d)))&&u.push(h);return u}var ZI=vV,WV=Object.prototype;function VV(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||WV;return e===n}var yI=VV;function RV(e,t){return function(n){return e(t(n))}}var GI=RV,YV=GI,XV=YV(Object.keys,Object),HV=XV,SV=yI,NV=HV,wV=Object.prototype,KV=wV.hasOwnProperty;function _V(e){if(!SV(e))return NV(e);var t=[];for(var n in Object(e))KV.call(e,n)&&n!="constructor"&&t.push(n);return t}var BI=_V,FV=hI,kV=mc;function JV(e){return e!=null&&kV(e.length)&&!FV(e)}var AI=JV,zV=ZI,TV=BI,UV=AI;function EV(e){return UV(e)?zV(e):TV(e)}var Zc=EV,xV=bW,LV=Zc;function QV(e,t){return e&&xV(e,t,LV)}var vI=QV;function jV(){this.__data__=[],this.size=0}var OV=jV;function MV(e,t){return e===t||e!==e&&t!==t}var yc=MV,PV=yc;function DV(e,t){for(var n=e.length;n--;)if(PV(e[n][0],t))return n;return-1}var Ms=DV,$V=Ms,qV=Array.prototype,e2=qV.splice;function t2(e){var t=this.__data__,n=$V(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():e2.call(t,n,1),--this.size,!0}var n2=t2,r2=Ms;function i2(e){var t=this.__data__,n=r2(t,e);return n<0?void 0:t[n][1]}var s2=i2,o2=Ms;function a2(e){return o2(this.__data__,e)>-1}var c2=a2,l2=Ms;function g2(e,t){var n=this.__data__,r=l2(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}var u2=g2,d2=OV,I2=n2,h2=s2,C2=c2,b2=u2;function Sr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Sr.prototype.clear=d2;Sr.prototype.delete=I2;Sr.prototype.get=h2;Sr.prototype.has=C2;Sr.prototype.set=b2;var Ps=Sr,p2=Ps;function m2(){this.__data__=new p2,this.size=0}var f2=m2;function Z2(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}var y2=Z2;function G2(e){return this.__data__.get(e)}var B2=G2;function A2(e){return this.__data__.has(e)}var v2=A2,W2=On,V2=Ut,R2=W2(V2,"Map"),Gc=R2,Y2=On,X2=Y2(Object,"create"),Ds=X2,bg=Ds;function H2(){this.__data__=bg?bg(null):{},this.size=0}var S2=H2;function N2(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var w2=N2,K2=Ds,_2="__lodash_hash_undefined__",F2=Object.prototype,k2=F2.hasOwnProperty;function J2(e){var t=this.__data__;if(K2){var n=t[e];return n===_2?void 0:n}return k2.call(t,e)?t[e]:void 0}var z2=J2,T2=Ds,U2=Object.prototype,E2=U2.hasOwnProperty;function x2(e){var t=this.__data__;return T2?t[e]!==void 0:E2.call(t,e)}var L2=x2,Q2=Ds,j2="__lodash_hash_undefined__";function O2(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Q2&&t===void 0?j2:t,this}var M2=O2,P2=S2,D2=w2,$2=z2,q2=L2,eR=M2;function Nr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Nr.prototype.clear=P2;Nr.prototype.delete=D2;Nr.prototype.get=$2;Nr.prototype.has=q2;Nr.prototype.set=eR;var tR=Nr,pg=tR,nR=Ps,rR=Gc;function iR(){this.size=0,this.__data__={hash:new pg,map:new(rR||nR),string:new pg}}var sR=iR;function oR(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var aR=oR,cR=aR;function lR(e,t){var n=e.__data__;return cR(t)?n[typeof t=="string"?"string":"hash"]:n.map}var $s=lR,gR=$s;function uR(e){var t=gR(this,e).delete(e);return this.size-=t?1:0,t}var dR=uR,IR=$s;function hR(e){return IR(this,e).get(e)}var CR=hR,bR=$s;function pR(e){return bR(this,e).has(e)}var mR=pR,fR=$s;function ZR(e,t){var n=fR(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}var yR=ZR,GR=sR,BR=dR,AR=CR,vR=mR,WR=yR;function wr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}wr.prototype.clear=GR;wr.prototype.delete=BR;wr.prototype.get=AR;wr.prototype.has=vR;wr.prototype.set=WR;var Bc=wr,VR=Ps,RR=Gc,YR=Bc,XR=200;function HR(e,t){var n=this.__data__;if(n instanceof VR){var r=n.__data__;if(!RR||r.length<XR-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new YR(r)}return n.set(e,t),this.size=n.size,this}var SR=HR,NR=Ps,wR=f2,KR=y2,_R=B2,FR=v2,kR=SR;function Kr(e){var t=this.__data__=new NR(e);this.size=t.size}Kr.prototype.clear=wR;Kr.prototype.delete=KR;Kr.prototype.get=_R;Kr.prototype.has=FR;Kr.prototype.set=kR;var WI=Kr,JR="__lodash_hash_undefined__";function zR(e){return this.__data__.set(e,JR),this}var TR=zR;function UR(e){return this.__data__.has(e)}var ER=UR,xR=Bc,LR=TR,QR=ER;function fs(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new xR;++t<n;)this.add(e[t])}fs.prototype.add=fs.prototype.push=LR;fs.prototype.has=QR;var VI=fs;function jR(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var OR=jR;function MR(e,t){return e.has(t)}var RI=MR,PR=VI,DR=OR,$R=RI,qR=1,eY=2;function tY(e,t,n,r,s,a){var c=n&qR,u=e.length,d=t.length;if(u!=d&&!(c&&d>u))return!1;var h=a.get(e),m=a.get(t);if(h&&m)return h==t&&m==e;var y=-1,v=!0,_=n&eY?new PR:void 0;for(a.set(e,t),a.set(t,e);++y<u;){var F=e[y],Q=t[y];if(r)var z=c?r(Q,F,y,t,e,a):r(F,Q,y,e,t,a);if(z!==void 0){if(z)continue;v=!1;break}if(_){if(!DR(t,function(te,ce){if(!$R(_,ce)&&(F===te||s(F,te,n,r,a)))return _.push(ce)})){v=!1;break}}else if(!(F===Q||s(F,Q,n,r,a))){v=!1;break}}return a.delete(e),a.delete(t),v}var YI=tY,nY=Ut,rY=nY.Uint8Array,iY=rY;function sY(e){var t=-1,n=Array(e.size);return e.forEach(function(r,s){n[++t]=[s,r]}),n}var oY=sY;function aY(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var XI=aY,mg=Gi,fg=iY,cY=yc,lY=YI,gY=oY,uY=XI,dY=1,IY=2,hY="[object Boolean]",CY="[object Date]",bY="[object Error]",pY="[object Map]",mY="[object Number]",fY="[object RegExp]",ZY="[object Set]",yY="[object String]",GY="[object Symbol]",BY="[object ArrayBuffer]",AY="[object DataView]",Zg=mg?mg.prototype:void 0,Lo=Zg?Zg.valueOf:void 0;function vY(e,t,n,r,s,a,c){switch(n){case AY:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case BY:return!(e.byteLength!=t.byteLength||!a(new fg(e),new fg(t)));case hY:case CY:case mY:return cY(+e,+t);case bY:return e.name==t.name&&e.message==t.message;case fY:case yY:return e==t+"";case pY:var u=gY;case ZY:var d=r&dY;if(u||(u=uY),e.size!=t.size&&!d)return!1;var h=c.get(e);if(h)return h==t;r|=IY,c.set(e,t);var m=lY(u(e),u(t),r,s,a,c);return c.delete(e),m;case GY:if(Lo)return Lo.call(e)==Lo.call(t)}return!1}var WY=vY;function VY(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e}var HI=VY,RY=HI,YY=qt;function XY(e,t,n){var r=t(e);return YY(e)?r:RY(r,n(e))}var SI=XY;function HY(e,t){for(var n=-1,r=e==null?0:e.length,s=0,a=[];++n<r;){var c=e[n];t(c,n,e)&&(a[s++]=c)}return a}var SY=HY;function NY(){return[]}var NI=NY,wY=SY,KY=NI,_Y=Object.prototype,FY=_Y.propertyIsEnumerable,yg=Object.getOwnPropertySymbols,kY=yg?function(e){return e==null?[]:(e=Object(e),wY(yg(e),function(t){return FY.call(e,t)}))}:KY,wI=kY,JY=SI,zY=wI,TY=Zc;function UY(e){return JY(e,TY,zY)}var EY=UY,Gg=EY,xY=1,LY=Object.prototype,QY=LY.hasOwnProperty;function jY(e,t,n,r,s,a){var c=n&xY,u=Gg(e),d=u.length,h=Gg(t),m=h.length;if(d!=m&&!c)return!1;for(var y=d;y--;){var v=u[y];if(!(c?v in t:QY.call(t,v)))return!1}var _=a.get(e),F=a.get(t);if(_&&F)return _==t&&F==e;var Q=!0;a.set(e,t),a.set(t,e);for(var z=c;++y<d;){v=u[y];var te=e[v],ce=t[v];if(r)var re=c?r(ce,te,v,t,e,a):r(te,ce,v,e,t,a);if(!(re===void 0?te===ce||s(te,ce,n,r,a):re)){Q=!1;break}z||(z=v=="constructor")}if(Q&&!z){var Ie=e.constructor,fe=t.constructor;Ie!=fe&&"constructor"in e&&"constructor"in t&&!(typeof Ie=="function"&&Ie instanceof Ie&&typeof fe=="function"&&fe instanceof fe)&&(Q=!1)}return a.delete(e),a.delete(t),Q}var OY=jY,MY=On,PY=Ut,DY=MY(PY,"DataView"),$Y=DY,qY=On,eX=Ut,tX=qY(eX,"Promise"),nX=tX,rX=On,iX=Ut,sX=rX(iX,"Set"),KI=sX,oX=On,aX=Ut,cX=oX(aX,"WeakMap"),_I=cX,ba=$Y,pa=Gc,ma=nX,fa=KI,Za=_I,FI=Bi,_r=CI,Bg="[object Map]",lX="[object Object]",Ag="[object Promise]",vg="[object Set]",Wg="[object WeakMap]",Vg="[object DataView]",gX=_r(ba),uX=_r(pa),dX=_r(ma),IX=_r(fa),hX=_r(Za),Fn=FI;(ba&&Fn(new ba(new ArrayBuffer(1)))!=Vg||pa&&Fn(new pa)!=Bg||ma&&Fn(ma.resolve())!=Ag||fa&&Fn(new fa)!=vg||Za&&Fn(new Za)!=Wg)&&(Fn=function(e){var t=FI(e),n=t==lX?e.constructor:void 0,r=n?_r(n):"";if(r)switch(r){case gX:return Vg;case uX:return Bg;case dX:return Ag;case IX:return vg;case hX:return Wg}return t});var kI=Fn,Qo=WI,CX=YI,bX=WY,pX=OY,Rg=kI,Yg=qt,Xg=bc,mX=fc,fX=1,Hg="[object Arguments]",Sg="[object Array]",qi="[object Object]",ZX=Object.prototype,Ng=ZX.hasOwnProperty;function yX(e,t,n,r,s,a){var c=Yg(e),u=Yg(t),d=c?Sg:Rg(e),h=u?Sg:Rg(t);d=d==Hg?qi:d,h=h==Hg?qi:h;var m=d==qi,y=h==qi,v=d==h;if(v&&Xg(e)){if(!Xg(t))return!1;c=!0,m=!1}if(v&&!m)return a||(a=new Qo),c||mX(e)?CX(e,t,n,r,s,a):bX(e,t,d,n,r,s,a);if(!(n&fX)){var _=m&&Ng.call(e,"__wrapped__"),F=y&&Ng.call(t,"__wrapped__");if(_||F){var Q=_?e.value():e,z=F?t.value():t;return a||(a=new Qo),s(Q,z,n,r,a)}}return v?(a||(a=new Qo),pX(e,t,n,r,s,a)):!1}var GX=yX,BX=GX,wg=Hr;function JI(e,t,n,r,s){return e===t?!0:e==null||t==null||!wg(e)&&!wg(t)?e!==e&&t!==t:BX(e,t,n,r,JI,s)}var Ac=JI,AX=WI,vX=Ac,WX=1,VX=2;function RX(e,t,n,r){var s=n.length,a=s,c=!r;if(e==null)return!a;for(e=Object(e);s--;){var u=n[s];if(c&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++s<a;){u=n[s];var d=u[0],h=e[d],m=u[1];if(c&&u[2]){if(h===void 0&&!(d in e))return!1}else{var y=new AX;if(r)var v=r(h,m,d,e,t,y);if(!(v===void 0?vX(m,h,WX|VX,r,y):v))return!1}}return!0}var YX=RX,XX=Os;function HX(e){return e===e&&!XX(e)}var zI=HX,SX=zI,NX=Zc;function wX(e){for(var t=NX(e),n=t.length;n--;){var r=t[n],s=e[r];t[n]=[r,s,SX(s)]}return t}var KX=wX;function _X(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}var TI=_X,FX=YX,kX=KX,JX=TI;function zX(e){var t=kX(e);return t.length==1&&t[0][2]?JX(t[0][0],t[0][1]):function(n){return n===e||FX(n,e,t)}}var TX=zX,UX=Bi,EX=Hr,xX="[object Symbol]";function LX(e){return typeof e=="symbol"||EX(e)&&UX(e)==xX}var qs=LX,QX=qt,jX=qs,OX=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,MX=/^\w*$/;function PX(e,t){if(QX(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||jX(e)?!0:MX.test(e)||!OX.test(e)||t!=null&&e in Object(t)}var vc=PX,UI=Bc,DX="Expected a function";function Wc(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(DX);var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],a=n.cache;if(a.has(s))return a.get(s);var c=e.apply(this,r);return n.cache=a.set(s,c)||a,c};return n.cache=new(Wc.Cache||UI),n}Wc.Cache=UI;var $X=Wc,qX=$X,eH=500;function tH(e){var t=qX(e,function(r){return n.size===eH&&n.clear(),r}),n=t.cache;return t}var nH=tH,rH=nH,iH=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,sH=/\\(\\)?/g,oH=rH(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(iH,function(n,r,s,a){t.push(s?a.replace(sH,"$1"):r||n)}),t}),aH=oH;function cH(e,t){for(var n=-1,r=e==null?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s}var EI=cH,Kg=Gi,lH=EI,gH=qt,uH=qs,dH=1/0,_g=Kg?Kg.prototype:void 0,Fg=_g?_g.toString:void 0;function xI(e){if(typeof e=="string")return e;if(gH(e))return lH(e,xI)+"";if(uH(e))return Fg?Fg.call(e):"";var t=e+"";return t=="0"&&1/e==-dH?"-0":t}var IH=xI,hH=IH;function CH(e){return e==null?"":hH(e)}var LI=CH,bH=qt,pH=vc,mH=aH,fH=LI;function ZH(e,t){return bH(e)?e:pH(e,t)?[e]:mH(fH(e))}var Vc=ZH,yH=qs,GH=1/0;function BH(e){if(typeof e=="string"||yH(e))return e;var t=e+"";return t=="0"&&1/e==-GH?"-0":t}var Ai=BH,AH=Vc,vH=Ai;function WH(e,t){t=AH(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[vH(t[n++])];return n&&n==r?e:void 0}var Rc=WH,VH=Rc;function RH(e,t,n){var r=e==null?void 0:VH(e,t);return r===void 0?n:r}var YH=RH;function XH(e,t){return e!=null&&t in Object(e)}var HH=XH,SH=Vc,NH=Cc,wH=qt,KH=pc,_H=mc,FH=Ai;function kH(e,t,n){t=SH(t,e);for(var r=-1,s=t.length,a=!1;++r<s;){var c=FH(t[r]);if(!(a=e!=null&&n(e,c)))break;e=e[c]}return a||++r!=s?a:(s=e==null?0:e.length,!!s&&_H(s)&&KH(c,s)&&(wH(e)||NH(e)))}var JH=kH,zH=HH,TH=JH;function UH(e,t){return e!=null&&TH(e,t,zH)}var EH=UH,xH=Ac,LH=YH,QH=EH,jH=vc,OH=zI,MH=TI,PH=Ai,DH=1,$H=2;function qH(e,t){return jH(e)&&OH(t)?MH(PH(e),t):function(n){var r=LH(n,e);return r===void 0&&r===t?QH(n,e):xH(t,r,DH|$H)}}var eS=qH;function tS(e){return function(t){return t==null?void 0:t[e]}}var nS=tS,rS=Rc;function iS(e){return function(t){return rS(t,e)}}var sS=iS,oS=nS,aS=sS,cS=vc,lS=Ai;function gS(e){return cS(e)?oS(lS(e)):aS(e)}var uS=gS,dS=TX,IS=eS,hS=hc,CS=qt,bS=uS;function pS(e){return typeof e=="function"?e:e==null?hS:typeof e=="object"?CS(e)?IS(e[0],e[1]):dS(e):bS(e)}var QI=pS,mS=pI,fS=vI,ZS=QI;function yS(e,t){var n={};return t=ZS(t),fS(e,function(r,s,a){mS(n,s,t(r,s,a))}),n}var GS=yS;const BS=Ln(GS);var AS=yr.inspect,Yc=typeof Map=="function"&&Map.prototype,jo=Object.getOwnPropertyDescriptor&&Yc?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Zs=Yc&&jo&&typeof jo.get=="function"?jo.get:null,kg=Yc&&Map.prototype.forEach,Xc=typeof Set=="function"&&Set.prototype,Oo=Object.getOwnPropertyDescriptor&&Xc?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,ys=Xc&&Oo&&typeof Oo.get=="function"?Oo.get:null,Jg=Xc&&Set.prototype.forEach,vS=typeof WeakMap=="function"&&WeakMap.prototype,ci=vS?WeakMap.prototype.has:null,WS=typeof WeakSet=="function"&&WeakSet.prototype,li=WS?WeakSet.prototype.has:null,VS=typeof WeakRef=="function"&&WeakRef.prototype,zg=VS?WeakRef.prototype.deref:null,RS=Boolean.prototype.valueOf,YS=Object.prototype.toString,XS=Function.prototype.toString,HS=String.prototype.match,Hc=String.prototype.slice,bn=String.prototype.replace,SS=String.prototype.toUpperCase,Tg=String.prototype.toLowerCase,jI=RegExp.prototype.test,Ug=Array.prototype.concat,_t=Array.prototype.join,NS=Array.prototype.slice,Eg=Math.floor,ya=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Mo=Object.getOwnPropertySymbols,Ga=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Zr=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Me=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Zr||"symbol")?Symbol.toStringTag:null,OI=Object.prototype.propertyIsEnumerable,xg=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function Lg(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||jI.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e=="number"){var r=e<0?-Eg(-e):Eg(e);if(r!==e){var s=String(r),a=Hc.call(t,s.length+1);return bn.call(s,n,"$&_")+"."+bn.call(bn.call(a,/([0-9]{3})/g,"$&_"),/_$/,"")}}return bn.call(t,n,"$&_")}var Ba=AS,Qg=Ba.custom,jg=PI(Qg)?Qg:null,wS=function e(t,n,r,s){var a=n||{};if(Cn(a,"quoteStyle")&&a.quoteStyle!=="single"&&a.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Cn(a,"maxStringLength")&&(typeof a.maxStringLength=="number"?a.maxStringLength<0&&a.maxStringLength!==1/0:a.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var c=Cn(a,"customInspect")?a.customInspect:!0;if(typeof c!="boolean"&&c!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Cn(a,"indent")&&a.indent!==null&&a.indent!=="	"&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Cn(a,"numericSeparator")&&typeof a.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var u=a.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return $I(t,a);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var d=String(t);return u?Lg(t,d):d}if(typeof t=="bigint"){var h=String(t)+"n";return u?Lg(t,h):h}var m=typeof a.depth>"u"?5:a.depth;if(typeof r>"u"&&(r=0),r>=m&&m>0&&typeof t=="object")return Aa(t)?"[Array]":"[Object]";var y=$S(a,r);if(typeof s>"u")s=[];else if(DI(s,t)>=0)return"[Circular]";function v(Ne,rt,Pe){if(rt&&(s=NS.call(s),s.push(rt)),Pe){var mt={depth:a.depth};return Cn(a,"quoteStyle")&&(mt.quoteStyle=a.quoteStyle),e(Ne,mt,r+1,s)}return e(Ne,a,r+1,s)}if(typeof t=="function"&&!Og(t)){var _=ES(t),F=es(t,v);return"[Function"+(_?": "+_:" (anonymous)")+"]"+(F.length>0?" { "+_t.call(F,", ")+" }":"")}if(PI(t)){var Q=Zr?bn.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Ga.call(t);return typeof t=="object"&&!Zr?ri(Q):Q}if(MS(t)){for(var z="<"+Tg.call(String(t.nodeName)),te=t.attributes||[],ce=0;ce<te.length;ce++)z+=" "+te[ce].name+"="+MI(KS(te[ce].value),"double",a);return z+=">",t.childNodes&&t.childNodes.length&&(z+="..."),z+="</"+Tg.call(String(t.nodeName))+">",z}if(Aa(t)){if(t.length===0)return"[]";var re=es(t,v);return y&&!DS(re)?"["+va(re,y)+"]":"[ "+_t.call(re,", ")+" ]"}if(FS(t)){var Ie=es(t,v);return!("cause"in Error.prototype)&&"cause"in t&&!OI.call(t,"cause")?"{ ["+String(t)+"] "+_t.call(Ug.call("[cause]: "+v(t.cause),Ie),", ")+" }":Ie.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+_t.call(Ie,", ")+" }"}if(typeof t=="object"&&c){if(jg&&typeof t[jg]=="function"&&Ba)return Ba(t,{depth:m-r});if(c!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(xS(t)){var fe=[];return kg&&kg.call(t,function(Ne,rt){fe.push(v(rt,t,!0)+" => "+v(Ne,t))}),Mg("Map",Zs.call(t),fe,y)}if(jS(t)){var oe=[];return Jg&&Jg.call(t,function(Ne){oe.push(v(Ne,t))}),Mg("Set",ys.call(t),oe,y)}if(LS(t))return Po("WeakMap");if(OS(t))return Po("WeakSet");if(QS(t))return Po("WeakRef");if(JS(t))return ri(v(Number(t)));if(TS(t))return ri(v(ya.call(t)));if(zS(t))return ri(RS.call(t));if(kS(t))return ri(v(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===We)return"{ [object globalThis] }";if(!_S(t)&&!Og(t)){var ue=es(t,v),Ke=xg?xg(t)===Object.prototype:t instanceof Object||t.constructor===Object,Ue=t instanceof Object?"":"null prototype",dt=!Ke&&Me&&Object(t)===t&&Me in t?Hc.call(Wn(t),8,-1):Ue?"Object":"",It=Ke||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",Ee=It+(dt||Ue?"["+_t.call(Ug.call([],dt||[],Ue||[]),": ")+"] ":"");return ue.length===0?Ee+"{}":y?Ee+"{"+va(ue,y)+"}":Ee+"{ "+_t.call(ue,", ")+" }"}return String(t)};function MI(e,t,n){var r=(n.quoteStyle||t)==="double"?'"':"'";return r+e+r}function KS(e){return bn.call(String(e),/"/g,"&quot;")}function Aa(e){return Wn(e)==="[object Array]"&&(!Me||!(typeof e=="object"&&Me in e))}function _S(e){return Wn(e)==="[object Date]"&&(!Me||!(typeof e=="object"&&Me in e))}function Og(e){return Wn(e)==="[object RegExp]"&&(!Me||!(typeof e=="object"&&Me in e))}function FS(e){return Wn(e)==="[object Error]"&&(!Me||!(typeof e=="object"&&Me in e))}function kS(e){return Wn(e)==="[object String]"&&(!Me||!(typeof e=="object"&&Me in e))}function JS(e){return Wn(e)==="[object Number]"&&(!Me||!(typeof e=="object"&&Me in e))}function zS(e){return Wn(e)==="[object Boolean]"&&(!Me||!(typeof e=="object"&&Me in e))}function PI(e){if(Zr)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!Ga)return!1;try{return Ga.call(e),!0}catch{}return!1}function TS(e){if(!e||typeof e!="object"||!ya)return!1;try{return ya.call(e),!0}catch{}return!1}var US=Object.prototype.hasOwnProperty||function(e){return e in this};function Cn(e,t){return US.call(e,t)}function Wn(e){return YS.call(e)}function ES(e){if(e.name)return e.name;var t=HS.call(XS.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function DI(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function xS(e){if(!Zs||!e||typeof e!="object")return!1;try{Zs.call(e);try{ys.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function LS(e){if(!ci||!e||typeof e!="object")return!1;try{ci.call(e,ci);try{li.call(e,li)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function QS(e){if(!zg||!e||typeof e!="object")return!1;try{return zg.call(e),!0}catch{}return!1}function jS(e){if(!ys||!e||typeof e!="object")return!1;try{ys.call(e);try{Zs.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function OS(e){if(!li||!e||typeof e!="object")return!1;try{li.call(e,li);try{ci.call(e,ci)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function MS(e){return!e||typeof e!="object"?!1:typeof HTMLElement<"u"&&e instanceof HTMLElement?!0:typeof e.nodeName=="string"&&typeof e.getAttribute=="function"}function $I(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return $I(Hc.call(e,0,t.maxStringLength),t)+r}var s=bn.call(bn.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,PS);return MI(s,"single",t)}function PS(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+SS.call(t.toString(16))}function ri(e){return"Object("+e+")"}function Po(e){return e+" { ? }"}function Mg(e,t,n,r){var s=r?va(n,r):_t.call(n,", ");return e+" ("+t+") {"+s+"}"}function DS(e){for(var t=0;t<e.length;t++)if(DI(e[t],`
`)>=0)return!1;return!0}function $S(e,t){var n;if(e.indent==="	")n="	";else if(typeof e.indent=="number"&&e.indent>0)n=_t.call(Array(e.indent+1)," ");else return null;return{base:n,prev:_t.call(Array(t+1),n)}}function va(e,t){if(e.length===0)return"";var n=`
`+t.prev+t.base;return n+_t.call(e,","+n)+`
`+t.prev}function es(e,t){var n=Aa(e),r=[];if(n){r.length=e.length;for(var s=0;s<e.length;s++)r[s]=Cn(e,s)?t(e[s],e):""}var a=typeof Mo=="function"?Mo(e):[],c;if(Zr){c={};for(var u=0;u<a.length;u++)c["$"+a[u]]=a[u]}for(var d in e)Cn(e,d)&&(n&&String(Number(d))===d&&d<e.length||Zr&&c["$"+d]instanceof Symbol||(jI.call(/[^\w$]/,d)?r.push(t(d,e)+": "+t(e[d],e)):r.push(d+": "+t(e[d],e))));if(typeof Mo=="function")for(var h=0;h<a.length;h++)OI.call(e,a[h])&&r.push("["+t(a[h])+"]: "+t(e[a[h]],e));return r}const qS=Ln(wS);class eN extends Error{constructor(t,n){const r=`${t}, error: ${tN(n)}`;super(r),n instanceof Error?(this.name=n.name,this.stack=n.stack):this.name=qI(n)}}function qI(e){const t=Object.prototype.toString.call(e).slice(8,-1);return t==="Object"&&e!=null&&typeof e=="object"?`Object, ${e.constructor.name}`:t}function tN(e){return e==null||typeof e!="object"?"":qS(BS(e,nN(e)))}const nN=e=>{if(e instanceof uI||e instanceof TypeError)return lv;const t=qI(e)==="Object, Object";return(n,r)=>typeof n=="string"&&!(r==="title"||r==="code"||r==="syscall"||r==="name"||t&&r==="message")?"[String]":typeof n=="object"?"[Object]":n};function rN(e){var r,s;const t="ignorable"in e&&!!e.ignorable,n=e.stack!=null?((r=e.stack)==null?void 0:r.startsWith(new Ic().name))||((s=e.stack)==null?void 0:s.startsWith(new av().name)):!1;return t||n}const iN=(e,t)=>({isIgnorableError:rN,exception:(n,r,s)=>{aN(r)&&cN(r)&&typeof r.message=="string"&&r.message!==""&&(n=`${n}:
${r.message}`);const c=new eN(n,r);e.captureException(c,s),e.addBreadcrumb({level:"error",category:t,message:`${c.name}: ${c.message}`})},info:(n,r)=>{e.addBreadcrumb({level:"info",category:t,message:n,data:r})},setUser:n=>{e.configureScope(r=>r.setUser(n))}});function sN(){const e="app:///";return Md({iteratee:t=>(t.filename&&(t.filename=oN(e,t.filename)),t)})}function oN(e,t){const r=/^[a-zA-Z]:\\/.test(t)||t.includes("\\")&&!t.includes("/")?t.replace(/^[a-zA-Z]:/,"").replace(/\\/g,"/"):t,s=Xb(r);return`${e}${s}`}function aN(e){const t=e instanceof bt.AbortError||e instanceof bt.BulkError||e instanceof bt.ConstraintError||e instanceof bt.DatabaseClosedError||e instanceof bt.DataError||e instanceof bt.InvalidStateError||e instanceof bt.ModifyError||e instanceof bt.OpenFailedError||e instanceof bt.QuotaExceededError||e instanceof bt.VersionError;return e instanceof uI||e instanceof TypeError||e instanceof RangeError||e instanceof dc||gN(e)||t}function cN(e){return typeof e=="object"&&e!=null&&"message"in e}const lN=ke.z.object({safeToLog:ke.z.literal(!0)}),gN=Xr(lN);kd({dsn:"https://55af16af94074b88844cd7e16f535fa5@o76327.ingest.sentry.io/193727",environment:"production",release:"Termius@9.31.5",maxBreadcrumbs:100,integrations:[sN()],beforeSend:(e,t)=>e});const uN=iN(eG,"node"),eh=new Map;function dN(e){return{...e,name:e.name,message:e.message,stack:e.stack}}function vi(e){eh.set(new e().name,e)}function IN({name:e,message:t,...n}){let r=eh.get(e);return r==null&&(r=Error),Object.assign(new r(t),n)}vi(Error);vi(TypeError);vi(RangeError);vi(ReferenceError);var hN=Pg,th=function(){return hN.randomBytes(16)},nh=[];for(var ts=0;ts<256;++ts)nh[ts]=(ts+256).toString(16).substr(1);function CN(e,t){var n=t||0,r=nh;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}var rh=CN,bN=th,pN=rh;function mN(e,t,n){var r=t&&n||0;typeof e=="string"&&(t=e==="binary"?new Array(16):null,e=null),e=e||{};var s=e.random||(e.rng||bN)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t)for(var a=0;a<16;++a)t[r+a]=s[a];return t||pN(s)}var ih=mN;const fN=Ln(ih),sh=ke.z.object({id:ke.z.string()}),ZN=Xr(sh),Sc=sh.extend({name:ke.z.string()}),Gs=ke.z.object({type:ke.z.literal("Buffer"),data:ke.z.array(ke.z.number())}),yN=Sc.extend({info:ke.z.object({keyHandle:Gs,data:Gs,publicKey:ke.z.string(),application:ke.z.string(),flags:ke.z.number(),pin:ke.z.string()})}),GN=Xr(yN),BN=Sc.extend({data:Gs,credentialId:ke.z.string(),windowHandle:Gs}),AN=Xr(BN),vN=ke.z.object({type:ke.z.literal("fido-process-allocated"),ipcId:ke.z.string()}),WN=Xr(vN);exports.BasicSignMessageSchema=Sc;exports._Set=KI;exports._SetCache=VI;exports._Symbol=Gi;exports._WeakMap=_I;exports._arrayLikeKeys=ZI;exports._arrayMap=EI;exports._arrayPush=HI;exports._baseAssignValue=pI;exports._baseForOwn=vI;exports._baseGet=Rc;exports._baseGetAllKeys=SI;exports._baseIsEqual=Ac;exports._baseIteratee=QI;exports._baseKeys=BI;exports._baseUnary=fI;exports._cacheHas=RI;exports._castPath=Vc;exports._defineProperty=bI;exports._getSymbols=wI;exports._getTag=kI;exports._isIndex=pc;exports._isPrototype=yI;exports._overArg=GI;exports._root=Ut;exports._setToArray=XI;exports._toKey=Ai;exports.bytesToUuid_1=rh;exports.commonjsGlobal=We;exports.deserializeIpcError=IN;exports.eq_1=yc;exports.getDefaultExportFromCjs=Ln;exports.identity_1=hc;exports.ipcSingleton=NC;exports.isAllocationEvent=WN;exports.isArguments_1=Cc;exports.isArrayLike_1=AI;exports.isArray_1=qt;exports.isBasicMessage=ZN;exports.isBufferExports=bc;exports.isFidoSignMessage=GN;exports.isObjectLike_1=Hr;exports.isObject_1=Os;exports.isSymbol_1=qs;exports.isTypedArray_1=fc;exports.isWindowsHelloSignMessage=AN;exports.lib=ke;exports.logger=uN;exports.makeIPC=wC;exports.registerIpcError=vi;exports.rng=th;exports.serializeIpcError=dN;exports.stubArray_1=NI;exports.toString_1=LI;exports.uuidv4=fN;exports.v4_1=ih;exports.zodGuard=Xr;
//# sourceMappingURL=schema-8e15f296.js.map

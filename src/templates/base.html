<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ event_name }} - ç‚¹äº®æ˜Ÿå¤œçš„çŒ«è€³é»‘å®¢å˜‰å¹´å">
    <meta name="theme-color" content="#F9A8D4">
    
    <title>{% block title %}{{ event_name }} | NekoCTF{% endblock %}</title>
    
    <!-- MD3 Expressive Stylesheet -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/md3-main.css') }}">
    
    <!-- htmx for dynamic interactions -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    {% block extra_head %}{% endblock %}
</head>
<body>
    <!-- MD3 Expressive Header -->
    <header class="md3-header">
        <div class="md3-header__container">
            <a href="{{ url_for('public.home') }}" class="md3-header__brand">
                <span class="md3-header__brand-icon">ğŸ¾</span>
                <span>{{ event_name }}</span>
            </a>
            
            <nav class="md3-header__nav" id="mainNav">
                <a href="{{ url_for('public.home') }}" class="md3-nav-link {% if request.endpoint == 'public.home' %}md3-nav-link--active{% endif %}">
                    <span class="material-symbols-outlined" style="font-size: 1.2rem; vertical-align: middle; margin-right: 4px;">home</span>
                    ä¸»é¡µ
                </a>
                <a href="{{ url_for('public.challenges') }}" class="md3-nav-link {% if request.endpoint == 'public.challenges' %}md3-nav-link--active{% endif %}">
                    <span class="material-symbols-outlined" style="font-size: 1.2rem; vertical-align: middle; margin-right: 4px;">quiz</span>
                    é¢˜ç›®åˆ—è¡¨
                </a>
                <a href="{{ url_for('public.leaderboard') }}" class="md3-nav-link {% if request.endpoint == 'public.leaderboard' %}md3-nav-link--active{% endif %}">
                    <span class="material-symbols-outlined" style="font-size: 1.2rem; vertical-align: middle; margin-right: 4px;">leaderboard</span>
                    æ’è¡Œæ¦œ
                </a>
                <a href="{{ url_for('public.about') }}" class="md3-nav-link {% if request.endpoint == 'public.about' %}md3-nav-link--active{% endif %}">
                    <span class="material-symbols-outlined" style="font-size: 1.2rem; vertical-align: middle; margin-right: 4px;">info</span>
                    å…³äº
                </a>
                
                {% if current_user.is_authenticated %}
                    {% if current_user.is_admin %}
                        <a href="{{ url_for('admin.admin_challenges') }}" class="md3-nav-link">
                            <span class="material-symbols-outlined" style="font-size: 1.2rem; vertical-align: middle; margin-right: 4px;">admin_panel_settings</span>
                            åå°
                        </a>
                    {% endif %}
                    <a href="{{ url_for('public.profile_me') }}" class="md3-nav-user">
                        <span class="material-symbols-outlined" style="font-size: 1.2rem; vertical-align: middle; margin-right: 4px;">account_circle</span>
                        {{ current_user.username }}
                    </a>
                    <a href="{{ url_for('public.logout') }}" class="md3-nav-link">
                        <span class="material-symbols-outlined" style="font-size: 1.2rem; vertical-align: middle; margin-right: 4px;">logout</span>
                        é€€å‡º
                    </a>
                {% else %}
                    <a href="{{ url_for('public.login') }}" class="md3-nav-link">
                        <span class="material-symbols-outlined" style="font-size: 1.2rem; vertical-align: middle; margin-right: 4px;">login</span>
                        ç™»å½•
                    </a>
                    <a href="{{ url_for('public.register') }}" class="md3-nav-link">
                        <span class="material-symbols-outlined" style="font-size: 1.2rem; vertical-align: middle; margin-right: 4px;">person_add</span>
                        æ³¨å†Œ
                    </a>
                {% endif %}
                
            </nav>
            
            <button class="md3-header__toggle" onclick="toggleNav()" aria-label="åˆ‡æ¢å¯¼èˆªèœå•">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Email Verification Banner -->
    {% if current_user.is_authenticated and not current_user.email_verified and not current_user.is_admin %}
    <div class="verification-banner">
        <div class="verification-banner__content">
            <div class="verification-banner__icon">
                <span class="material-symbols-outlined">mark_email_unread</span>
            </div>
            <div class="verification-banner__text">
                <strong>é‚®ç®±å°šæœªéªŒè¯</strong>
                <span>è¯·æŸ¥æ”¶éªŒè¯é‚®ä»¶å®Œæˆæ¿€æ´»ï¼ŒéªŒè¯åæ–¹å¯æäº¤ flag å–µï½</span>
            </div>
            <div class="verification-banner__actions">
                <a href="{{ url_for('public.resend_verification') }}" class="md3-btn md3-btn--primary verification-banner__btn">
                    <span class="material-symbols-outlined">send</span>
                    <span>é‡æ–°å‘é€</span>
                </a>
            </div>
            <button class="verification-banner__close" aria-label="å…³é—­æç¤º">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
    </div>
    {% endif %}

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div id="flashMessages" style="position: fixed; top: 100px; right: var(--md3-space-2xl); z-index: var(--md3-z-notification); display: flex; flex-direction: column; gap: var(--md3-space-md); max-width: 400px;">
                {% for category, text in messages %}
                <div class="md3-flash md3-flash--{{ category }} fade-in">
                    {{ text }}
                </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Back to Top FAB -->
    <button id="backToTop" class="md3-fab" style="opacity: 0; pointer-events: none; transition: opacity var(--md3-duration-medium3) var(--md3-easing-emphasized);" aria-label="å›åˆ°é¡¶éƒ¨">
        <span class="material-symbols-outlined">arrow_upward</span>
    </button>

    <!-- MD3 Expressive Footer -->
    <footer class="md3-footer">
        <div class="md3-footer__container">
            <div class="md3-footer__top">
                <div class="md3-footer__brand">
                    <div class="md3-footer__logo">
                        <span class="md3-footer__logo-icon">ğŸ¾</span>
                        <span>{{ event_name }}</span>
                    </div>
                    <p class="md3-footer__tagline">
                        ç‚¹äº®æ˜Ÿå¤œçš„çŒ«è€³é»‘å®¢å˜‰å¹´å â€”â€” æ±‡èšå‰§æƒ…çˆ±å¥½è€…ä¸æ”»é˜²è‰ºæœ¯å®¶çš„æ²‰æµ¸å¼ CTF æ—…ç¨‹
                    </p>
                    <div class="md3-footer__social">
                        <a href="#" class="md3-footer__social-link" title="GitHub" aria-label="GitHub">
                            <span class="material-symbols-outlined">code</span>
                        </a>
                        <a href="#" class="md3-footer__social-link" title="Twitter" aria-label="Twitter">
                            <span class="material-symbols-outlined">chat</span>
                        </a>
                        <a href="#" class="md3-footer__social-link" title="Discord" aria-label="Discord">
                            <span class="material-symbols-outlined">forum</span>
                        </a>
                        <a href="mailto:{{ contact_email }}" class="md3-footer__social-link" title="Email" aria-label="Email">
                            <span class="material-symbols-outlined">mail</span>
                        </a>
                    </div>
                </div>
                
                <div class="md3-footer__section">
                    <h3 class="md3-footer__title">å¿«é€Ÿé“¾æ¥</h3>
                    <ul class="md3-footer__links">
                        <li><a href="{{ url_for('public.challenges') }}" class="md3-footer__link">æŒ‘æˆ˜é¢˜ç›®</a></li>
                        <li><a href="{{ url_for('public.leaderboard') }}" class="md3-footer__link">æ’è¡Œæ¦œ</a></li>
                        <li><a href="{{ url_for('public.submit') }}" class="md3-footer__link">æŠ•ç¨¿é¢˜ç›®</a></li>
                    </ul>
                </div>
                
                <div class="md3-footer__section">
                    <h3 class="md3-footer__title">å…³äºæˆ‘ä»¬</h3>
                    <ul class="md3-footer__links">
                        <li><a href="{{ url_for('public.about') }}" class="md3-footer__link">å…³äºèµ›äº‹</a></li>
                        <li><a href="#" class="md3-footer__link">å›¢é˜Ÿä»‹ç»</a></li>
                        <li><a href="#" class="md3-footer__link">è”ç³»æˆ‘ä»¬</a></li>
                    </ul>
                </div>
                
                <div class="md3-footer__section">
                    <h3 class="md3-footer__title">èµ„æº</h3>
                    <ul class="md3-footer__links">
                        <li><a href="#" class="md3-footer__link">è§„åˆ™è¯´æ˜</a></li>
                        <li><a href="#" class="md3-footer__link">å¸¸è§é—®é¢˜</a></li>
                        <li><a href="#" class="md3-footer__link">æ–‡æ¡£ä¸­å¿ƒ</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="md3-footer__bottom">
                <div class="md3-footer__copyright">
                    <span>Â© 2025 {{ event_name }}</span>
                    <span>Â·</span>
                    <span>Made with <span class="md3-footer__heart">â¤ï¸</span> for all neko hackers</span>
                </div>
                
                <div class="md3-footer__badges">
                    <span class="md3-footer__badge">
                        <span class="md3-footer__badge-icon">âš¡</span>
                        <span>Powered by MD3 Expressive</span>
                    </span>
                    <span class="md3-footer__badge">
                        <span class="md3-footer__badge-icon">âœ¨</span>
                        <span>htmx Enhanced</span>
                    </span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Mobile navigation toggle
        function toggleNav() {
            const nav = document.getElementById('mainNav');
            nav.classList.toggle('md3-header__nav--open');
        }
        
        // Close nav when clicking outside
        document.addEventListener('click', function(event) {
            const nav = document.getElementById('mainNav');
            const toggle = document.querySelector('.md3-header__toggle');
            const header = document.querySelector('.md3-header');
            
            if (nav.classList.contains('md3-header__nav--open') && 
                !header.contains(event.target)) {
                nav.classList.remove('md3-header__nav--open');
            }
        });
        
        // Auto-hide flash messages after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const flashes = document.querySelectorAll('.md3-flash');
            flashes.forEach(flash => {
                setTimeout(() => {
                    flash.style.animation = 'flashSlideIn 0.4s var(--md3-easing-emphasized) reverse';
                    setTimeout(() => flash.remove(), 400);
                }, 5000);
            });
            
            // Email verification banner close functionality
            const verificationBanner = document.querySelector('.verification-banner');
            if (verificationBanner) {
                const closeBtn = verificationBanner.querySelector('.verification-banner__close');
                if (closeBtn) {
                    closeBtn.addEventListener('click', function() {
                        verificationBanner.style.animation = 'slideDown 0.3s var(--md3-easing-emphasized) reverse';
                        setTimeout(() => {
                            verificationBanner.style.display = 'none';
                        }, 300);
                    });
                }
            }
        });
        
        // Smooth scroll behavior
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const targetId = this.getAttribute('href');
                if (targetId !== '#') {
                    e.preventDefault();
                    const target = document.querySelector(targetId);
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                }
            });
        });
        
        // Intersection Observer for animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);
        
        // Observe sections for fade-in effect
        document.addEventListener('DOMContentLoaded', function() {
            const sections = document.querySelectorAll('.md3-section');
            sections.forEach(section => {
                section.style.opacity = '0';
                section.style.transform = 'translateY(30px)';
                section.style.transition = 'opacity 0.8s cubic-bezier(0.05, 0.7, 0.1, 1), transform 0.8s cubic-bezier(0.05, 0.7, 0.1, 1)';
                observer.observe(section);
            });
        });
        
        // Add parallax effect to hero background
        document.addEventListener('DOMContentLoaded', function() {
            const hero = document.querySelector('.md3-hero');
            if (hero) {
                window.addEventListener('scroll', function() {
                    const scrolled = window.pageYOffset;
                    const parallaxElements = hero.querySelectorAll('.md3-hero__glow, .md3-hero__orb');
                    parallaxElements.forEach((el, index) => {
                        const speed = 0.3 + (index * 0.1);
                        el.style.transform = `translateY(${scrolled * speed}px)`;
                    });
                });
            }
        });
        
        // Add ripple effect on button clicks
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('.md3-btn');
            buttons.forEach(button => {
                button.addEventListener('click', function(e) {
                    const ripple = document.createElement('span');
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;
                    
                    ripple.style.width = ripple.style.height = size + 'px';
                    ripple.style.left = x + 'px';
                    ripple.style.top = y + 'px';
                    ripple.style.position = 'absolute';
                    ripple.style.borderRadius = '50%';
                    ripple.style.background = 'rgba(255, 255, 255, 0.5)';
                    ripple.style.pointerEvents = 'none';
                    ripple.style.animation = 'ripple 0.6s ease-out';
                    
                    this.appendChild(ripple);
                    setTimeout(() => ripple.remove(), 600);
                });
            });
        });
        
        // Add CSS for ripple animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple {
                from {
                    transform: scale(0);
                    opacity: 1;
                }
                to {
                    transform: scale(2);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
        
        // Back to Top Button
        const backToTopBtn = document.getElementById('backToTop');
        if (backToTopBtn) {
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    backToTopBtn.style.opacity = '1';
                    backToTopBtn.style.pointerEvents = 'all';
                } else {
                    backToTopBtn.style.opacity = '0';
                    backToTopBtn.style.pointerEvents = 'none';
                }
            });
            
            backToTopBtn.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }
    </script>
    
    {% block extra_scripts %}{% endblock %}
</body>
</html>
